import{V as nt,b as Be,r as B,O as jt,_ as pe,$ as H,a0 as R,a2 as C,a9 as _e,ab as oe,a4 as I,ac as pt,an as Su,aa as se,a1 as we,ad as Ve,ae as We,ao as dr,af as ne,a7 as X,as as Ut,ak as le,at as Ja,au as Qa,a6 as Ye,a3 as ke,ar as ft,j as Or,a5 as de,a8 as ro,ah as Ke,aq as Re,T as Jt,w as iv,Y as Ys,n as kd,ag as sv,am as Td,aD as Za,aE as ur,aF as bt,aG as Mo,aH as Cu,aI as uv,aJ as Nd,aK as Tr,aL as lv,aM as Rd,aN as cv,aO as or,aP as Ad,aQ as oc,aR as dv,aS as pv,aT as fv,aU as hv,aV as vv,aW as Li,aX as mv,aY as gv,aZ as yv,av as ga,I as Xn,ap as Pd,o as xv,aw as bv}from"./index-DUj6Qat5.js";import{Q as ht,a as an}from"./QInnerLoading-BjTJWTbo.js";import{a as _v,b as wv}from"./QResizeObserver-DvN4Q8-d.js";import{Q as Ka,a as Ev}from"./QFooter-B2YPwZ7w.js";import{h as ys}from"./moment-BVHJYo2c.js";import{T as me,g as Iu,a as Sv}from"./sweetalert-CVlrw-cm.js";import{Q as Mt}from"./QDate-Dbu_svyZ.js";import{Q as Ft,C as yo}from"./ClosePopup-B7_6mH7x.js";import{Q as lt,a as ct,b as Rn}from"./QItem-Bma97t3C.js";import{Q as An}from"./QSelect-De-kUDd9.js";import{_ as Kn}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{_ as Cv,a as Iv,b as Dv,c as kv,d as Tv,e as Nv,f as Rv,g as Av,h as Pv,i as Ov,j as Mv,k as Fv,l as Vv,m as Lv,n as Bv,o as Uv,p as Wv,q as qv,r as zv,s as $v,t as Hv,u as Gv,v as jv,w as Xv,x as Yv}from"./9-Dj9y5jTE.js";import{Q as Sn}from"./QSpinnerPuff-CjcpssDc.js";import{Q as Od}from"./QFile-D5G8XFw3.js";import{Q as Kv}from"./QBadge--CvgpeWN.js";import"./format-CoaQEihs.js";const Jv={key:0},Qv={key:0,class:"q-mb-xl"},Zv={class:"card-grid"},em={class:"text-caption text-uppercase"},tm={class:"checkmark-overlay"},nm={class:"row q-col-gutter-xs q-mb-md"},rm={class:"col-2"},am={class:"col-2"},om={class:"col-2"},im={class:"col-1"},sm={class:"row q-col-gutter-xs q-mb-md"},um={class:"col-2"},lm={class:"q-gutter-sm"},cm={class:"col"},dm={class:"q-gutter-sm"},pm={class:"row q-col-gutter-xs q-mb-md"},fm={class:"col-2"},hm={class:"col-4"},vm={class:"row q-col-gutter-xs q-mb-md"},mm={class:"col-6"},gm={class:"q-gutter-sm"},ym={class:"row q-col-gutter-xs q-mb-md"},xm={class:"col-2"},bm={class:"col-2"},_m={key:1},wm={key:0,class:"q-mb-md"},Em={class:"card-grid"},Sm={class:"inner-card-anim-wrapper",style:{animationDelay:"100ms"}},Cm={class:"text-caption text-dark text-uppercase"},Im={class:"text-caption text-grey text-uppercase"},Dm={class:"absolute-left"},km={key:1,class:"q-mb-md"},Tm={class:"q-mb-md"},Nm={class:"text-body1 text-uppercase"},Rm={class:"text-body1 text-uppercase"},Am={class:"q-mb-md"},Pm={class:"q-gutter-sm"},Om={class:"row q-col-gutter-xs q-mb-md"},Mm={class:"col-2"},Fm={class:"col-2"},Vm={class:"row q-col-gutter-xs q-mb-md"},Lm={class:"col-2"},Bm={class:"col-2"},Um={class:"col-2"},Wm={class:"col-2"},qm={key:2},zm={class:"q-mb-md"},$m={class:"q-gutter-sm"},Hm={class:"row q-col-gutter-xs q-mb-md"},Gm={class:"col-2"},jm={class:"col-2"},Xm={key:3},Ym={class:"row q-col-gutter-xs q-mb-md"},Km={class:"col-2"},Jm={class:"col-2"},Qm={class:"col-2"},Zm={class:"col-2"},eg={class:"row q-gutter-sm"},tg={class:"text-caption text-uppercase text-grey"},ic=4,ng={__name:"EmployeeDialog",props:{modelValue:String,dialogName:String},emits:["update:modelValue","saved"],setup(n,{emit:t}){nt();const e=n,r=t,a=Be({get:()=>e.modelValue===e.dialogName,set:te=>{te||r("update:modelValue",null)}}),o=B(!1),i=B(null),s=B(""),u=B(""),l=B(""),c=B(""),p=B(""),f=B(""),d=B(new Date().toISOString().split("T")[0]),h=B(""),v=B(""),g=B(""),m=B(""),x=B(""),y=B(new Date().toISOString().split("T")[0]),w=B(""),E=B(""),D=B(""),k=B(""),S=B(""),_=B(""),b=B(""),N=B(""),T=B(""),P=B(""),F=B(new Date().toISOString().split("T")[0]),M=B(""),L=B(""),A=jt({firstname:{type:null,msg:""},middlename:{type:null,msg:""},lastname:{type:null,msg:""},suffix:{type:null,msg:""},sex:{type:null,msg:""},civilstatus:{type:null,msg:""},birthdate:{type:null,msg:""},birthplace:{type:null,msg:""},address:{type:null,msg:""},email:{type:null,msg:""},contactNo:{type:null,msg:""},employeeNo:{type:null,msg:""},dateHired:{type:null,msg:""},employmentstatus:{type:null,msg:""},positionId:{type:null,msg:""},tin:{type:null,msg:""},sssNo:{type:null,msg:""},philhealthNo:{type:null,msg:""},pagibigNo:{type:null,msg:""},salarygroup:{type:null,msg:""},payrollgroup:{type:null,msg:""},taxstatus:{type:null,msg:""},shiftId:{type:null,msg:""},effectiveFrom:{type:null,msg:""}}),$=()=>me.fire({icon:"error",html:`
      <div class="text-h6 text-bold text-uppercase">Request Failed</div>
      <div class="text-caption">Something went wrong.</div>
    `}),q=(te,G="required")=>(A[te].type=!0,A[te].msg=G,!0),z=te=>(A[te].type=null,A[te].msg="",!1),K=(te,G)=>G?z(te):q(te,"required"),re=(te,G,Q,Ae="invalid")=>G&&String(G).length>Q?q(te,Ae):z(te),ae=te=>{if(!te)return!1;const G=new Date,Q=new Date(te);let Ae=G.getFullYear()-Q.getFullYear();const Ln=G.getMonth()-Q.getMonth();return(Ln<0||Ln===0&&G.getDate()<Q.getDate())&&Ae--,Ae>=15},Se=()=>{const te=["SR","JR","II","III","IV","V","VI","VII","VIII","IX","X"],G=/^[^\s@]+@[^\s@]+\.[^\s@]+$/,Q=/^09\d{9}$/;let Ae=!1;return Ae||=K("firstname",s.value),Ae||=K("middlename",u.value),Ae||=K("lastname",l.value),Ae||=c.value&&!te.includes(c.value.trim().toUpperCase())?q("suffix","invalid"):z("suffix"),Ae||=K("sex",p.value),Ae||=K("civilstatus",f.value),d.value?ae(d.value)?z("birthdate"):Ae||=q("birthdate","invalid"):Ae||=q("birthdate","required"),Ae||=K("birthplace",h.value),g.value?G.test(g.value)?g.value.length>100?Ae||=q("email","invalid"):z("email"):Ae||=q("email","invalid"):Ae||=q("email","required"),m.value?Q.test(m.value)?z("contactNo"):Ae||=q("contactNo","invalid"):Ae||=q("contactNo","required"),Ae||=K("address",v.value),Ae&&$(),!Ae},Ce=()=>{let te=!1;return te||=K("positionId",E.value),te||=K("employmentstatus",w.value),te||=K("dateHired",y.value),te||=re("tin",D.value,15,"invalid"),te||=re("sssNo",k.value,15,"invalid"),te||=re("philhealthNo",S.value,15,"invalid"),te||=re("pagibigNo",_.value,15,"invalid"),te&&$(),!te},Pe=()=>{let te=!1;return te||=K("payrollgroup",N.value),te||=K("salarygroup",b.value),te||=K("taxstatus",T.value),te&&$(),!te},Me=()=>{let te=!1;return te||=K("shiftId",P.value),te||=K("effectiveFrom",F.value),te&&$(),!te},ie=()=>{i.value=null,s.value="",u.value="",l.value="",c.value="",p.value="",f.value="",d.value=new Date().toISOString().split("T")[0],h.value="",v.value="",g.value="",m.value="",x.value="",y.value=new Date().toISOString().split("T")[0],w.value="",E.value="",D.value="",k.value="",S.value="",_.value="",b.value="",N.value="",T.value="",P.value="",F.value=new Date().toISOString().split("T")[0],M.value="",L.value=""},ee=()=>{Object.keys(A).forEach(te=>{A[te].type=null,A[te].msg=""})},ue=B([]),Ie=B(["Male","Female"]),$e=B(["Single","Married","Widowed","Divorced","Separated"]),ze=B(["Regular","Probationary","Contractual","Temporary","Intern"]),Qe=B([]),Xe=B([]),Ze=B([{value:"HIRE",label:"Hiring Rate"},{value:"PROMO",label:"Promotion Increase"},{value:"MERIT",label:"Merit Increase"},{value:"ANNUAL",label:"Annual Increase"},{value:"COLA",label:"Cost of Living Allowance"},{value:"PROB",label:"Probationary Increase"},{value:"ADJUST",label:"Salary Adjustment"},{value:"GOVT",label:"Government Mandated Increase"}]),mn=B(["Monthly","Semi-Monthly","Weekly"]),gn=B(["S","ME","S1","S2","S3","S4","ME1","ME2","ME3","ME4","Z"]),Nt=B([]),yr=(te,G)=>(Q,Ae)=>{if(Q===""){Ae(()=>{G.value=te.value});return}Ae(()=>{const Ln=Q.toLowerCase();G.value=te.value.filter(ov=>ov.label.toLowerCase().includes(Ln))})};function yn(te,G="PHP"){if(!te)return"";const Q=te.split("|")[0].trim(),Ae=parseFloat(Q.replace(/,/g,""));return isNaN(Ae)?te:Ae.toLocaleString("en-PH",{style:"currency",currency:G,minimumFractionDigits:2})}const Fn=yr(Xe,Nt),In=async()=>{try{const te=await Re.get("/employee/option/applicant");ue.value=te.data}catch(te){console.error("Error fetching options:",te)}},xr=async()=>{try{const{data:te}=await Re.get("/employee/option/shift");Xe.value=(te||[]).map(G=>({label:G.label??G.name??String(G.text??G.value??""),value:Number(G.value??G.id)})),Nt.value=[...Xe.value]}catch(te){console.error("Error fetching options:",te)}},Dn=async()=>{try{const te=await Re.get("/employee/option/position");Qe.value=te.data}catch(te){console.error("Error fetching options:",te)}},Wa=()=>{xr(),Dn(),In(),ie(),ee(),Qt.value=0},br=te=>{s.value=te.first_name,u.value=te.middle_name,l.value=te.last_name,c.value=te.suffix,p.value=te.sex,f.value=te.civil_status,d.value=te.birthdate,h.value=te.birthplace,v.value=te.address,g.value=te.email,m.value=te.contact_number,w.value=te.vacancy.employment_status,E.value=te.vacancy.position_id,P.value=te.vacancy.shift_id},xn=async()=>{o.value=!0;const te=i.value?.id??null;try{const G=await Re.post("/employee",{applicantId:te,firstname:s.value,middlename:u.value,lastname:l.value,suffix:c.value,sex:p.value,civilstatus:f.value,birthdate:d.value,birthplace:h.value,address:v.value,email:g.value,contactNo:m.value,employeeNo:x.value,dateHired:y.value,tin:D.value,sssNo:k.value,philhealthNo:S.value,pagibigNo:_.value,positionId:E.value,employmentstatus:w.value,salarygroup:b.value,payrollgroup:N.value,taxstatus:T.value,shiftId:P.value,effectiveFrom:F.value,effectiveTo:M.value,notes:L.value});r("saved"),r("update:modelValue",null),me.fire({icon:"success",html:`
                <div class="text-h6 text-bold text-uppercase">granted!</div>
                <div class="text-caption text-capitalize;">${G.data.message}<div>
            `})}catch(G){G.response&&G.response.data&&(qa(G.response.data),me.fire({icon:"error",html:`
                    <div class="text-h6 text-bold text-uppercase">Request Failed</div>
                    <div class="text-caption">Something went wrong.</div>
                `}))}finally{o.value=!1}},qa=te=>{const G=Array.isArray(te)?te:te?.errors||[];Object.keys(A).forEach(Q=>{A[Q].type=null,A[Q].messages=[]}),G.forEach(Q=>{A[Q.path]!==void 0&&(A[Q.path].type=!0,A[Q.path].messages.push(Q.msg))})},Vn=B(null),za=B(""),Oo=Be(()=>{const te=za.value.trim().toLowerCase();return Qe.value.filter(G=>G.status==="Vacant").filter(G=>!te||String(G.label||"").toLowerCase().includes(te))}),_r=Be(()=>Oo.value.slice(0,5)),$a=Be(()=>_r.value.length),Ha=Be(()=>Oo.value.length),Qt=B(0),tv=[Se,Ce,Pe,Me],nv=()=>{const te=tv[Qt.value];te&&!te()||Qt.value++},rv=()=>{Qt.value>0&&Qt.value--},av=te=>{if(!te)return"";const G=te.first_name||"",Q=te.middle_name?te.middle_name.charAt(0).toUpperCase()+".":"",Ae=te.last_name||"",Ln=te.suffix?` ${te.suffix}`:"";return`${G} ${Q} ${Ae}${Ln}`.trim()};return(te,G)=>(H(),pe(Ke,{modelValue:a.value,"onUpdate:modelValue":G[39]||(G[39]=Q=>a.value=Q),"full-height":"",position:"right",persistent:"",square:"",class:"dialog",onBeforeShow:G[40]||(G[40]=Q=>Wa())},{default:R(()=>[C(_e,{class:"dialog-card column full-height"},{default:R(()=>[C(oe,{class:"q-pa-lg"},{default:R(()=>G[41]||(G[41]=[I("div",{class:"text-h6 text-uppercase"},"new employee",-1)])),_:1,__:[41]}),C(pt,{inset:""}),C(oe,{class:"col q-pa-lg scroll"},{default:R(()=>[C(Su,{name:"fade-slide",mode:"out-in"},{default:R(()=>[(H(),se("div",{key:Qt.value},[Qt.value===0?(H(),se("div",Jv,[ue.value.length?(H(),se("div",Qv,[G[42]||(G[42]=I("div",{class:"q-mb-sm"},[I("span",{class:"text-caption text-uppercase text-grey q-mr-sm"},"choose hired applicant")],-1)),I("div",Zv,[(H(!0),se(Ve,null,We(ue.value,(Q,Ae)=>(H(),se("div",{key:`data-${Q.id}`,class:"inner-card-anim-wrapper",style:dr({animationDelay:`${Ae*120}ms`})},[C(_e,{class:ne(["card card-menu card-hover-animate flex column justify-center items-center no-shadow cursor-pointer radius-sm",{"card--active":i.value===Q}]),tag:"label",onClick:()=>{i.value=Q,br(Q)}},{default:R(()=>[C(oe,null,{default:R(()=>[I("div",em,X(av(Q)),1)]),_:2},1024),I("div",tm,[C(Ut,{modelValue:i.value,"onUpdate:modelValue":G[0]||(G[0]=Ln=>i.value=Ln),val:Q,"checked-icon":"bi-check-circle-fill","unchecked-icon":"bi-check-circle",size:"xs"},null,8,["modelValue","val"])])]),_:2},1032,["class","onClick"])],4))),128))])])):we("",!0),G[43]||(G[43]=I("div",{class:"text-overline text-uppercase text-bold q-mb-md"},"personal information",-1)),I("div",nm,[I("div",rm,[I("div",{class:ne(["text-caption text-uppercase",A.firstname.type?"text-negative text-italic":"text-grey"])},X(A.firstname.type?A.firstname.msg:"firstname"),3),C(le,{modelValue:s.value,"onUpdate:modelValue":G[1]||(G[1]=Q=>s.value=Q),label:"Enter Firstname",outlined:"",error:A.firstname.type,"no-error-icon":!0,"input-class":"text-capitalize"},null,8,["modelValue","error"])]),I("div",am,[I("div",{class:ne(["text-caption text-uppercase",A.middlename.type?"text-negative text-italic":"text-grey"])},X(A.middlename.type?A.middlename.msg:"middlename"),3),C(le,{modelValue:u.value,"onUpdate:modelValue":G[2]||(G[2]=Q=>u.value=Q),label:"Enter Middlename",outlined:"",error:A.middlename.type,"no-error-icon":!0,"input-class":"text-capitalize"},null,8,["modelValue","error"])]),I("div",om,[I("div",{class:ne(["text-caption text-uppercase",A.lastname.type?"text-negative text-italic":"text-grey"])},X(A.lastname.type?A.lastname.msg:"lastname"),3),C(le,{modelValue:l.value,"onUpdate:modelValue":G[3]||(G[3]=Q=>l.value=Q),label:"Enter Lastname",outlined:"",error:A.lastname.type,"no-error-icon":!0,"input-class":"text-capitalize"},null,8,["modelValue","error"])]),I("div",im,[I("div",{class:ne(["text-caption text-uppercase",A.suffix.type?"text-negative text-italic":"text-grey"])},X(A.suffix.type?A.suffix.msg:"suffix"),3),C(le,{modelValue:c.value,"onUpdate:modelValue":G[4]||(G[4]=Q=>c.value=Q),label:"Enter Suffix",outlined:"",error:A.suffix.type,"no-error-icon":!0,"input-class":"text-capitalize"},null,8,["modelValue","error"])])]),I("div",sm,[I("div",um,[I("div",{class:ne(["text-caption text-uppercase",A.sex.type?"text-negative text-italic":"text-grey"])},X(A.sex.type?A.sex.msg:"sex"),3),I("div",lm,[(H(!0),se(Ve,null,We(Ie.value,Q=>(H(),pe(Ut,{modelValue:p.value,"onUpdate:modelValue":G[5]||(G[5]=Ae=>p.value=Ae),"checked-icon":"bi-check-circle-fill","unchecked-icon":"bi-check-circle",val:Q,label:Q},null,8,["modelValue","val","label"]))),256))])]),I("div",cm,[I("div",{class:ne(["text-caption text-uppercase",A.civilstatus.type?"text-negative text-italic":"text-grey"])},X(A.civilstatus.type?A.civilstatus.msg:"civil status"),3),I("div",dm,[(H(!0),se(Ve,null,We($e.value,Q=>(H(),pe(Ut,{modelValue:f.value,"onUpdate:modelValue":G[6]||(G[6]=Ae=>f.value=Ae),"checked-icon":"bi-check-circle-fill","unchecked-icon":"bi-check-circle",val:Q,label:Q},null,8,["modelValue","val","label"]))),256))])])]),I("div",pm,[I("div",fm,[I("div",{class:ne(["text-caption text-uppercase",A.birthdate.type?"text-negative text-italic":"text-grey"])},X(A.birthdate.type?A.birthdate.msg:"birthdate (YYYY-MM-DD)"),3),C(le,{outlined:"",modelValue:d.value,"onUpdate:modelValue":G[9]||(G[9]=Q=>d.value=Q),label:"Enter Date",error:A.birthdate.type,"no-error-icon":!0},{default:R(()=>[C(Ft,{cover:"","transition-show":"scale","transition-hide":"scale",ref_key:"popup",ref:Vn,class:"no-shadow custom-border radius-sm"},{default:R(()=>[C(Mt,{modelValue:d.value,"onUpdate:modelValue":[G[7]||(G[7]=Q=>d.value=Q),G[8]||(G[8]=()=>{Vn.value.hide()})],mask:"YYYY-MM-DD"},null,8,["modelValue"])]),_:1},512)]),_:1},8,["modelValue","error"])]),I("div",hm,[I("div",{class:ne(["text-caption text-uppercase",A.birthplace.type?"text-negative text-italic":"text-grey"])},X(A.birthplace.type?A.birthplace.msg:"birthplace"),3),C(le,{modelValue:h.value,"onUpdate:modelValue":G[10]||(G[10]=Q=>h.value=Q),label:"Enter Birthplace",outlined:"",error:A.birthplace.type,"no-error-icon":!0,"input-class":"text-capitalize"},null,8,["modelValue","error"])])]),I("div",vm,[I("div",mm,[I("div",{class:ne(["text-caption text-uppercase",A.address.type?"text-negative text-italic":"text-grey"])},X(A.address.type?A.address.msg:"address"),3),I("div",gm,[C(le,{modelValue:v.value,"onUpdate:modelValue":G[11]||(G[11]=Q=>v.value=Q),label:"Enter Address",outlined:"",error:A.address.type,"no-error-icon":!0,"input-class":"text-capitalize"},null,8,["modelValue","error"])])])]),I("div",ym,[I("div",xm,[I("div",{class:ne(["text-caption text-uppercase",A.email.type?"text-negative text-italic":"text-grey"])},X(A.email.type?A.email.msg:"email address"),3),C(le,{modelValue:g.value,"onUpdate:modelValue":G[12]||(G[12]=Q=>g.value=Q),label:"Enter Email Address",outlined:"",error:A.email.type,"no-error-icon":!0},null,8,["modelValue","error"])]),I("div",bm,[I("div",{class:ne(["text-caption text-uppercase",A.contactNo.type?"text-negative text-italic":"text-grey"])},X(A.contactNo.type?A.contactNo.msg:"contact number"),3),C(le,{modelValue:m.value,"onUpdate:modelValue":G[13]||(G[13]=Q=>m.value=Q),label:"Enter Contact No.",mask:"###########",outlined:"",error:A.contactNo.type,"no-error-icon":!0},null,8,["modelValue","error"])])])])):Qt.value===1?(H(),se("div",_m,[G[47]||(G[47]=I("div",{class:"text-overline text-uppercase text-bold q-mb-md"},"employment information",-1)),i.value?we("",!0):(H(),se("div",wm,[I("div",{class:ne(["text-caption text-uppercase q-mb-sm",A.positionId.type?"text-negative text-italic":"text-grey"])},X(A.positionId.type?A.positionId.msg:"position"),3),I("div",Em,[I("div",Sm,[_r.value.length?we("",!0):(H(),pe(_e,{key:0,class:"card card-menu card-hover-animate flex column justify-center items-center no-shadow cursor-pointer radius-sm"},{default:R(()=>[C(oe,null,{default:R(()=>G[44]||(G[44]=[I("div",{class:"text-caption text-dark text-uppercase"},"no record found",-1)])),_:1,__:[44]})]),_:1}))]),_r.value.length?(H(!0),se(Ve,{key:0},We(_r.value,(Q,Ae)=>(H(),se("div",{key:`data-${Q.id}`,class:"inner-card-anim-wrapper",style:dr({animationDelay:`${Ae*100}ms`})},[C(_e,{onClick:()=>{E.value=Q.id},class:ne(["card card-menu card-hover-animate flex column justify-center items-center no-shadow cursor-pointer radius-sm",{"card--active":E.value===Q.id}])},{default:R(()=>[C(oe,null,{default:R(()=>[I("div",Cm,X(Q.label),1),I("div",Im,X(yn(Q?.amount)),1)]),_:2},1024),I("div",Dm,[C(Ut,{modelValue:E.value,"onUpdate:modelValue":G[14]||(G[14]=Ln=>E.value=Ln),val:Q.id,"checked-icon":"bi-check-circle-fill","unchecked-icon":"bi-check-circle",size:"xs"},null,8,["modelValue","val"])])]),_:2},1032,["onClick","class"])],4))),128)):we("",!0)])])),i.value?(H(),se("div",km,[I("div",Tm,[G[45]||(G[45]=I("div",{class:"text-caption text-uppercase text-grey"},"position",-1)),I("div",Nm,X(i.value?.vacancy?.position?.name),1)]),I("div",null,[G[46]||(G[46]=I("div",{class:"text-caption text-uppercase text-grey"},"salary",-1)),I("div",Rm,X(yn(i.value?.vacancy?.position?.salary_amount)),1)])])):we("",!0),I("div",Am,[I("div",{class:ne(["text-caption text-uppercase",A.employmentstatus.type?"text-negative text-italic":"text-grey"])},X(A.employmentstatus.type?A.employmentstatus.msg:"employment status"),3),I("div",Pm,[(H(!0),se(Ve,null,We(ze.value,Q=>(H(),pe(Ut,{modelValue:w.value,"onUpdate:modelValue":G[15]||(G[15]=Ae=>w.value=Ae),"checked-icon":"bi-check-circle-fill","unchecked-icon":"bi-check-circle",val:Q,label:Q,class:"text-capitalize"},null,8,["modelValue","val","label"]))),256))])]),I("div",Om,[I("div",Mm,[I("div",{class:ne(["text-caption text-uppercase",A.dateHired.msg?"text-negative text-italic":"text-grey"])},X(A.dateHired.msg?A.dateHired.msg:"date hired (YYYY-MM-DD)"),3),C(le,{outlined:"",modelValue:y.value,"onUpdate:modelValue":G[18]||(G[18]=Q=>y.value=Q),label:"Enter Date",error:A.dateHired.type,"no-error-icon":!0},{default:R(()=>[C(Ft,{cover:"","transition-show":"scale","transition-hide":"scale",ref_key:"popup",ref:Vn,class:"no-shadow custom-border radius-sm"},{default:R(()=>[C(Mt,{modelValue:y.value,"onUpdate:modelValue":[G[16]||(G[16]=Q=>y.value=Q),G[17]||(G[17]=()=>{Vn.value.hide()})],mask:"YYYY-MM-DD"},null,8,["modelValue"])]),_:1},512)]),_:1},8,["modelValue","error"])]),I("div",Fm,[I("div",{class:ne(["text-caption text-uppercase",A.employeeNo.msg?"text-negative text-italic":"text-grey"])},X(A.employeeNo.msg?A.employeeNo.msg:"id number (YYYY-NNN)"),3),C(le,{modelValue:x.value,"onUpdate:modelValue":G[19]||(G[19]=Q=>x.value=Q),label:"Enter ID No.",mask:"####-###",outlined:"",error:A.employeeNo.type,"no-error-icon":!0},null,8,["modelValue","error"])])]),I("div",Vm,[I("div",Lm,[I("div",{class:ne(["text-caption text-uppercase",A.tin.type?"text-negative text-italic":"text-grey"])},X(A.tin.type?A.tin.msg:"TIN"),3),C(le,{modelValue:D.value,"onUpdate:modelValue":G[20]||(G[20]=Q=>D.value=Q),label:"Enter TIN",mask:"###-###-###-###",outlined:"",error:A.tin.type,"no-error-icon":!0,class:"text-capitalize"},null,8,["modelValue","error"])]),I("div",Bm,[I("div",{class:ne(["text-caption text-uppercase",A.sssNo.type?"text-negative text-italic":"text-grey"])},X(A.sssNo.type?A.sssNo.msg:"SSS no"),3),C(le,{modelValue:k.value,"onUpdate:modelValue":G[21]||(G[21]=Q=>k.value=Q),label:"Enter SSS No.",mask:"##-#######-#",outlined:"",error:A.sssNo.type,"no-error-icon":!0,class:"text-capitalize"},null,8,["modelValue","error"])]),I("div",Um,[I("div",{class:ne(["text-caption text-uppercase",A.philhealthNo.type?"text-negative text-italic":"text-grey"])},X(A.philhealthNo.type?A.philhealthNo.msg:"Philhealth No."),3),C(le,{modelValue:S.value,"onUpdate:modelValue":G[22]||(G[22]=Q=>S.value=Q),label:"Enter Philhealth No.",mask:"##-#######-#",outlined:"",error:A.philhealthNo.type,"no-error-icon":!0,class:"text-capitalize"},null,8,["modelValue","error"])]),I("div",Wm,[I("div",{class:ne(["text-caption text-uppercase",A.pagibigNo.type?"text-negative text-italic":"text-grey"])},X(A.pagibigNo.type?A.pagibigNo.msg:"pagibig no."),3),C(le,{modelValue:_.value,"onUpdate:modelValue":G[23]||(G[23]=Q=>_.value=Q),label:"Enter Pagibig No.",mask:"####-####-####",outlined:"",error:A.pagibigNo.type,"no-error-icon":!0,class:"text-capitalize"},null,8,["modelValue","error"])])])])):Qt.value===2?(H(),se("div",qm,[G[50]||(G[50]=I("div",{class:"text-overline text-uppercase text-bold q-mb-md"},"salary schedule",-1)),I("div",zm,[I("div",{class:ne(["text-caption text-uppercase",A.payrollgroup.type?"text-negative text-italic":"text-grey"])},X(A.payrollgroup.type?A.payrollgroup.msg:"payroll group"),3),I("div",$m,[(H(!0),se(Ve,null,We(mn.value,Q=>(H(),pe(Ut,{modelValue:N.value,"onUpdate:modelValue":G[24]||(G[24]=Ae=>N.value=Ae),"checked-icon":"bi-check-circle-fill","unchecked-icon":"bi-check-circle",val:Q,label:Q,class:"text-capitalize"},null,8,["modelValue","val","label"]))),256))])]),I("div",Hm,[I("div",Gm,[I("div",{class:ne(["text-caption text-uppercase",A.salarygroup.type?"text-negative text-italic":"text-grey"])},X(A.salarygroup.type?A.salarygroup.msg:"salary group"),3),C(An,{outlined:"",modelValue:b.value,"onUpdate:modelValue":G[25]||(G[25]=Q=>b.value=Q),label:"Choose Salary Group","emit-value":"","map-options":"","use-input":"","input-debounce":"300",options:Ze.value,error:A.salarygroup.type,"hide-dropdown-icon":"","no-error-icon":!0,class:"text-capitalize"},{"no-option":R(()=>[C(lt,null,{default:R(()=>[C(ct,{class:"text-italic text-grey"},{default:R(()=>G[48]||(G[48]=[Ye(" No options ")])),_:1,__:[48]})]),_:1})]),option:R(Q=>[C(lt,Ja(Qa(Q.itemProps)),{default:R(()=>[C(ct,null,{default:R(()=>[C(Rn,null,{default:R(()=>[Ye(X(te.$CapitalizeWords(Q.opt.label)),1)]),_:2},1024)]),_:2},1024)]),_:2},1040)]),_:1},8,["modelValue","options","error"])]),I("div",jm,[I("div",{class:ne(["text-caption text-uppercase",A.taxstatus.type?"text-negative text-italic":"text-grey"])},X(A.taxstatus.type?A.taxstatus.msg:"tax status"),3),C(An,{outlined:"",modelValue:T.value,"onUpdate:modelValue":G[26]||(G[26]=Q=>T.value=Q),label:"Choose Tax Status","use-input":"","input-debounce":"300",options:gn.value,error:A.taxstatus.type,"hide-dropdown-icon":"","no-error-icon":!0,class:"text-capitalize"},{"no-option":R(()=>[C(lt,null,{default:R(()=>[C(ct,{class:"text-italic text-grey"},{default:R(()=>G[49]||(G[49]=[Ye(" No options ")])),_:1,__:[49]})]),_:1})]),option:R(Q=>[C(lt,Ja(Qa(Q.itemProps)),{default:R(()=>[C(ct,null,{default:R(()=>[C(Rn,null,{default:R(()=>[Ye(X(te.$CapitalizeWords(Q.opt)),1)]),_:2},1024)]),_:2},1024)]),_:2},1040)]),_:1},8,["modelValue","options","error"])])])])):Qt.value===3?(H(),se("div",Xm,[G[54]||(G[54]=I("div",{class:"text-overline text-uppercase text-bold q-mb-md"},"shift schedule",-1)),I("div",Ym,[I("div",Km,[I("div",{class:ne(["text-caption text-uppercase",A.shiftId.type?"text-negative text-italic":"text-grey"])},X(A.shiftId.type?A.shiftId.msg:"shift"),3),C(An,{outlined:"",modelValue:P.value,"onUpdate:modelValue":G[27]||(G[27]=Q=>P.value=Q),label:"Choose Shift","use-input":"","emit-value":"","map-options":"","input-debounce":"300",options:Nt.value,onFilter:ke(Fn),error:A.shiftId.type,"hide-dropdown-icon":"","no-error-icon":!0,class:"text-capitalize"},{"no-option":R(()=>[C(lt,null,{default:R(()=>[C(ct,{class:"text-italic text-grey"},{default:R(()=>G[51]||(G[51]=[Ye(" No options ")])),_:1,__:[51]})]),_:1})]),option:R(Q=>[C(lt,Ja(Qa(Q.itemProps)),{default:R(()=>[C(ct,null,{default:R(()=>[C(Rn,null,{default:R(()=>[Ye(X(te.$CapitalizeWords(Q.opt.label)),1)]),_:2},1024)]),_:2},1024)]),_:2},1040)]),_:1},8,["modelValue","options","onFilter","error"])]),I("div",Jm,[I("div",{class:ne(["text-caption text-uppercase",A.effectiveFrom.type?"text-negative text-italic":"text-grey"])},X(A.effectiveFrom.type?A.effectiveFrom.msg:"effective from (YYYY-MM-DD)"),3),C(le,{outlined:"",modelValue:F.value,"onUpdate:modelValue":G[30]||(G[30]=Q=>F.value=Q),label:"Enter Date",error:A.effectiveFrom.type,"no-error-icon":!0},{default:R(()=>[C(Ft,{cover:"","transition-show":"scale","transition-hide":"scale",ref_key:"popup",ref:Vn,class:"no-shadow custom-border radius-sm"},{default:R(()=>[C(Mt,{modelValue:F.value,"onUpdate:modelValue":[G[28]||(G[28]=Q=>F.value=Q),G[29]||(G[29]=()=>{Vn.value.hide()})],mask:"YYYY-MM-DD"},null,8,["modelValue"])]),_:1},512)]),_:1},8,["modelValue","error"])]),I("div",Qm,[G[52]||(G[52]=I("div",{class:"text-caption text-uppercase text-grey"},"effective to (YYYY-MM-DD)",-1)),C(le,{outlined:"",modelValue:M.value,"onUpdate:modelValue":G[33]||(G[33]=Q=>M.value=Q),label:"Enter Date","no-error-icon":!0},{default:R(()=>[C(Ft,{cover:"","transition-show":"scale","transition-hide":"scale",ref_key:"popup",ref:Vn,class:"no-shadow custom-border radius-sm"},{default:R(()=>[C(Mt,{modelValue:M.value,"onUpdate:modelValue":[G[31]||(G[31]=Q=>M.value=Q),G[32]||(G[32]=()=>{Vn.value.hide()})],mask:"YYYY-MM-DD"},null,8,["modelValue"])]),_:1},512)]),_:1},8,["modelValue"])]),I("div",Zm,[G[53]||(G[53]=I("div",{class:"text-caption text-uppercase text-grey"},"notes",-1)),C(le,{modelValue:L.value,"onUpdate:modelValue":G[34]||(G[34]=Q=>L.value=Q),label:"Enter Notes",outlined:"","no-error-icon":!0,class:"text-capitalize"},null,8,["modelValue"])])])])):we("",!0)]))]),_:1})]),_:1}),C(ft,{class:"q-pa-lg bg"},{default:R(()=>[I("div",eg,[Qt.value>0?(H(),pe(de,{key:0,unelevated:"",size:"md",color:"primary",class:"btn text-capitalize",label:"back",onClick:G[35]||(G[35]=()=>{rv()})})):we("",!0),Qt.value<ic-1?(H(),pe(de,{key:1,unelevated:"",size:"md",color:"primary",class:"btn text-capitalize",label:"next",onClick:G[36]||(G[36]=()=>{nv()})})):we("",!0),Qt.value===ic-1?(H(),pe(de,{key:2,unelevated:"",size:"md",color:"primary",class:"btn text-capitalize",label:"save",onClick:G[37]||(G[37]=()=>{xn()})})):we("",!0),Or(C(de,{unelevated:"",size:"md",color:"primary",class:"btn text-capitalize",label:"discard",outline:""},null,512),[[yo]]),Qt.value===1&&!i.value?(H(),pe(le,{key:3,outlined:"",dense:"",debounce:"1000",modelValue:za.value,"onUpdate:modelValue":G[38]||(G[38]=Q=>za.value=Q),placeholder:"Search..."},{prepend:R(()=>[C(ro,{name:"bi-search",style:{"font-size":"1rem"}})]),after:R(()=>[I("div",tg,X($a.value)+" of "+X(Ha.value),1)]),_:1},8,["modelValue"])):we("",!0)])]),_:1}),C(ht,{showing:o.value},{default:R(()=>[C(_e,{class:"no-shadow radius-md q-pa-md"},{default:R(()=>[C(oe,{class:"text-center"},{default:R(()=>[I("div",null,[C(an,{color:"dark"})]),G[55]||(G[55]=I("div",{class:"text-dark text-uppercase text-caption"},"we're working on it!",-1))]),_:1,__:[55]})]),_:1})]),_:1},8,["showing"])]),_:1})]),_:1},8,["modelValue"]))}},rg=Kn(ng,[["__scopeId","data-v-93b98663"]]),ag={class:"wrapper"},og={class:"card-grid"},ig={key:0,class:"card-anim-wrapper"},sg={key:1,class:"card-anim-wrapper",style:{animationDelay:"120ms"}},ug={key:2,class:"card-anim-wrapper",style:{animationDelay:"120ms"}},lg={class:"text-caption text-uppercase"},cg={class:"text-subtitle2 text-uppercase"},dg={class:"text-caption text-uppercase"},pg={class:"text-caption text-grey"},fg={class:"text-caption text-grey text-italic"},hg={class:"text-caption text-uppercase"},vg={id:"glass-overlay"},mg={__name:"EmployeeComponent",setup(n){const t=Jt(),e=nt(),r=B([]),a=B({}),o=B(1),i=B(10),s=B(!1),u=B(""),l=async()=>{s.value=!0;try{const{data:k}=await Re.get("/employee",{params:{Page:o.value,Limit:i.value,Filter:u.value||""}});r.value=k.data,a.value=k.meta}catch(k){console.error("Error fetching all data:",k),me.fire({icon:"error",html:`
                <div class="text-h6 text-bold text-uppercase">Error</div>
                <div class="text-caption text-capitalize;">Unable to fetch records</div>
            `})}finally{s.value=!1}};iv(u,()=>{o.value=1,l()});const c=()=>{o.value<a.value.TotalPages&&(o.value++,l())},p=()=>{o.value>1&&(o.value--,l())},f=()=>{o.value>1&&(o.value=1,l())},d=()=>{o.value<a.value.TotalPages&&(o.value=a.value.TotalPages,l())},h=k=>{if(!k)return"";const S=k.first_name||"",_=k.middle_name?k.middle_name.charAt(0).toUpperCase()+".":"",b=k.last_name||"",N=k.suffix?` ${k.suffix}`:"";return`${S} ${_} ${b}${N}`.trim()};Ys(()=>{l()}),B(!1),B(!1),B(null),B(""),B(""),B(""),B(""),B(""),B(""),B(new Date().toISOString().split("T")[0]),B(""),B(""),B(""),B(""),B(""),B(new Date().toISOString().split("T")[0]),B(""),B(""),B(""),B(""),B(""),B(""),B(""),B(""),B(""),B(""),B(""),B(new Date().toISOString().split("T")[0]),B(""),B(""),jt({firstname:{type:null,msg:""},middlename:{type:null,msg:""},lastname:{type:null,msg:""},suffix:{type:null,msg:""},sex:{type:null,msg:""},civilstatus:{type:null,msg:""},birthdate:{type:null,msg:""},birthplace:{type:null,msg:""},address:{type:null,msg:""},email:{type:null,msg:""},contactNo:{type:null,msg:""},employeeNo:{type:null,msg:""},dateHired:{type:null,msg:""},employmentstatus:{type:null,msg:""},departmentId:{type:null,msg:""},positionId:{type:null,msg:""},tin:{type:null,msg:""},sssNo:{type:null,msg:""},philhealthNo:{type:null,msg:""},pagibigNo:{type:null,msg:""},salarygroup:{type:null,msg:""},payrollgroup:{type:null,msg:""},taxstatus:{type:null,msg:""},shiftId:{type:null,msg:""},effectiveFrom:{type:null,msg:""}}),B([]),B(["Male","Female"]),B(["Single","Married","Widowed","Divorced","Separated"]),B(["Regular","Probationary","Contractual","Temporary","Intern"]);const v=B([]);B([]),B([]),B([{value:"HIRE",label:"Hiring Rate"},{value:"PROMO",label:"Promotion Increase"},{value:"MERIT",label:"Merit Increase"},{value:"ANNUAL",label:"Annual Increase"},{value:"COLA",label:"Cost of Living Allowance"},{value:"PROB",label:"Probationary Increase"},{value:"ADJUST",label:"Salary Adjustment"},{value:"GOVT",label:"Government Mandated Increase"}]),B(["Monthly","Semi-Monthly","Weekly"]),B(["S","ME","S1","S2","S3","S4","ME1","ME2","ME3","ME4","Z"]),B([]),B([]);function g(k,S="PHP"){if(!k)return"";const _=k.split("|")[0].trim(),b=parseFloat(_.replace(/,/g,""));return isNaN(b)?k:b.toLocaleString("en-PH",{style:"currency",currency:S,minimumFractionDigits:2})}B(null);const m=B(""),x=Be(()=>{const k=m.value.trim().toLowerCase();return v.value.filter(S=>S.status==="Vacant").filter(S=>!k||String(S.label||"").toLowerCase().includes(k))}),y=Be(()=>x.value.slice(0,5));Be(()=>y.value.length),Be(()=>x.value.length),B(0);const w=B(null),E=k=>{w.value=k},D=B(!0);return kd(()=>{setTimeout(()=>{D.value=!1},1e3)}),(k,S)=>(H(),se("div",ag,[I("div",og,[ke(t).hasRole(["SuperAdmin","Admin","HR"])?(H(),se("div",ig,[Or((H(),pe(_e,{key:"data-add",class:"card card-hover-animate flex column justify-center items-center no-shadow cursor-pointer radius-sm",onClick:S[0]||(S[0]=()=>{E("EmployeeDialog")})},{default:R(()=>[C(oe,null,{default:R(()=>[C(ro,{name:"bi-plus-circle",color:"grey",size:"xl"})]),_:1})]),_:1})),[[sv]])])):we("",!0),s.value?(H(),se("div",sg,[C(_e,{key:"data-add",class:"card card-hover-animate flex column justify-center items-center no-shadow cursor-pointer radius-sm"},{default:R(()=>[C(oe,{class:"text-center"},{default:R(()=>[C(an,{color:"dark"}),S[4]||(S[4]=I("div",{class:"text-caption text-grey text-uppercase q-mt-xs"},"we're working on it!",-1))]),_:1,__:[4]})]),_:1})])):!s.value&&r.value.length===0?(H(),se("div",ug,[C(_e,{key:"data-add",class:"card card-hover-animate flex column justify-center items-center no-shadow cursor-pointer radius-sm"},{default:R(()=>[C(oe,{class:"text-center"},{default:R(()=>S[5]||(S[5]=[I("div",{class:"text-caption text-uppercase text-grey"},"no data found",-1)])),_:1,__:[5]})]),_:1})])):we("",!0),(H(!0),se(Ve,null,We(r.value,(_,b)=>(H(),se("div",{key:`data-${_.id}`,class:"card-anim-wrapper",style:dr({animationDelay:`${b*120}ms`})},[C(_e,{onClick:()=>{ke(e).component="ProfileComponent",ke(e).data=_},class:"card card-hover-animate flex column justify-center items-center no-shadow cursor-pointer radius-sm"},{default:R(()=>[C(oe,null,{default:R(()=>[I("div",lg,X(_?.employment?.employee_no),1),I("div",cg,X(h(_)),1)]),_:2},1024),C(oe,null,{default:R(()=>[I("div",dg,X(_?.employment?.position?.name),1),I("div",pg,X(_?.employment?.employment_status),1),I("div",fg,X(g(_?.employment?.position?.amount)),1)]),_:2},1024),I("div",{class:ne(["absolute-top-left q-ma-sm",_.status=="Active"?"bg-positive":"bg-negative"]),style:{width:"7px",height:"7px","border-radius":"50%"}},null,2)]),_:2},1032,["onClick"])],4))),128))]),C(Ev,{class:"bg-white no-shadow q-mx-lg q-mb-md q-py-sm radius-xs text-grey"},{default:R(()=>[C(_v,null,{default:R(()=>[C(wv,{class:"text-caption text-uppercase"},{default:R(()=>S[6]||(S[6]=[I("div",null,"Â© 2025 WORKFORCE. All Rights Reserved.",-1)])),_:1,__:[6]}),C(le,{outlined:"",dense:"",debounce:"1000",modelValue:u.value,"onUpdate:modelValue":S[1]||(S[1]=_=>u.value=_),placeholder:"Search..."},{before:R(()=>[I("div",hg,X(`page ${a.value.CurrentPage} of ${a.value.TotalPages}`),1)]),after:R(()=>[C(de,{unelevated:"",size:"sm",round:"",color:"primary",icon:"bi-arrow-bar-left",disable:o.value<=1,onClick:f},{default:R(()=>[C(Ka,{anchor:"top middle",self:"top middle","transition-show":"scale","transition-hide":"scale",class:"text-capitalize"},{default:R(()=>S[7]||(S[7]=[Ye("First Page")])),_:1,__:[7]})]),_:1},8,["disable"]),C(de,{unelevated:"",size:"sm",round:"",color:"primary",icon:"bi-arrow-left-short",disable:o.value<=1,onClick:p},{default:R(()=>[C(Ka,{anchor:"top middle",self:"top middle","transition-show":"scale","transition-hide":"scale",class:"text-capitalize"},{default:R(()=>S[8]||(S[8]=[Ye("Previous")])),_:1,__:[8]})]),_:1},8,["disable"]),C(de,{unelevated:"",size:"sm",round:"",color:"primary",icon:"bi-arrow-right-short",disable:o.value>=a.value.TotalPages,onClick:c},{default:R(()=>[C(Ka,{anchor:"top middle",self:"top middle","transition-show":"scale","transition-hide":"scale",class:"text-capitalize"},{default:R(()=>S[9]||(S[9]=[Ye("Next")])),_:1,__:[9]})]),_:1},8,["disable"]),C(de,{unelevated:"",size:"sm",round:"",color:"primary",icon:"bi-arrow-bar-right",disable:o.value>=a.value.TotalPages,onClick:d},{default:R(()=>[C(Ka,{anchor:"top middle",self:"top middle","transition-show":"scale","transition-hide":"scale",class:"text-capitalize"},{default:R(()=>S[10]||(S[10]=[Ye("Last Page")])),_:1,__:[10]})]),_:1},8,["disable"])]),prepend:R(()=>[C(ro,{name:"bi-search",style:{"font-size":"1rem"}})]),_:1},8,["modelValue"])]),_:1})]),_:1}),C(rg,{modelValue:w.value,"onUpdate:modelValue":S[2]||(S[2]=_=>w.value=_),"dialog-name":"EmployeeDialog",onSaved:S[3]||(S[3]=()=>{l()})},null,8,["modelValue"]),C(Su,{name:"glass-fade"},{default:R(()=>[Or(I("div",vg,[C(_e,{class:"no-shadow radius-md q-pa-md"},{default:R(()=>[C(oe,{class:"text-center"},{default:R(()=>[I("div",null,[C(an,{color:"dark"})]),S[11]||(S[11]=I("div",{class:"text-dark text-uppercase text-caption"},"we're working on it!",-1))]),_:1,__:[11]})]),_:1})],512),[[Td,D.value]])]),_:1})]))}},gg=Kn(mg,[["__scopeId","data-v-2182a2ea"]]),yg={class:"row q-col-gutter-xs q-mb-md"},xg={class:"col-2"},bg={class:"col-2"},_g={class:"col-2"},wg={class:"col-1"},Eg={class:"row q-col-gutter-xs q-mb-md"},Sg={class:"col-2"},Cg={class:"q-gutter-sm"},Ig={class:"col"},Dg={class:"q-gutter-sm"},kg={class:"row q-col-gutter-xs q-mb-md"},Tg={class:"col-2"},Ng={class:"col-4"},Rg={class:"row q-col-gutter-xs q-mb-md"},Ag={class:"col-6"},Pg={class:"q-gutter-sm"},Og={class:"row q-col-gutter-xs q-mb-md"},Mg={class:"col-2"},Fg={class:"col-2"},Vg={class:"q-gutter-sm"},Lg={__name:"ProfileDialog",props:{modelValue:String,dialogName:String},emits:["update:modelValue","saved"],setup(n,{emit:t}){const e=Jt(),r=nt(),a=n,o=t,i=Be({get:()=>a.modelValue===a.dialogName,set:M=>{M||o("update:modelValue",null)}}),s=B(!1),u=B(""),l=B(""),c=B(""),p=B(""),f=B(""),d=B(""),h=B(""),v=B(""),g=B(""),m=B(""),x=B(""),y=jt({firstname:{type:null,msg:""},middlename:{type:null,msg:""},lastname:{type:null,msg:""},suffix:{type:null,msg:""},sex:{type:null,msg:""},civilstatus:{type:null,msg:""},birthdate:{type:null,msg:""},birthplace:{type:null,msg:""},address:{type:null,msg:""},email:{type:null,msg:""},contactNo:{type:null,msg:""}}),w=()=>me.fire({icon:"error",html:`
      <div class="text-h6 text-bold text-uppercase">Request Failed</div>
      <div class="text-caption">Something went wrong.</div>
    `}),E=(M,L="required")=>(y[M].type=!0,y[M].msg=L,!0),D=M=>(y[M].type=null,y[M].msg="",!1),k=(M,L)=>L?D(M):E(M,"required"),S=M=>{if(!M)return!1;const L=new Date,A=new Date(M);let $=L.getFullYear()-A.getFullYear();const q=L.getMonth()-A.getMonth();return(q<0||q===0&&L.getDate()<A.getDate())&&$--,$>=15},_=()=>{const M=["SR","JR","II","III","IV","V","VI","VII","VIII","IX","X"],L=/^[^\s@]+@[^\s@]+\.[^\s@]+$/,A=/^09\d{9}$/;let $=!1;return $||=k("firstname",u.value),$||=k("middlename",l.value),$||=k("lastname",c.value),$||=p.value&&!M.includes(p.value.trim().toUpperCase())?E("suffix","invalid"):D("suffix"),$||=k("sex",f.value),$||=k("civilstatus",d.value),h.value?S(h.value)?D("birthdate"):$||=E("birthdate","invalid"):$||=E("birthdate","required"),$||=k("birthplace",v.value),m.value?L.test(m.value)?m.value.length>100?$||=E("email","invalid"):D("email"):$||=E("email","invalid"):$||=E("email","required"),x.value?A.test(x.value)?D("contactNo"):$||=E("contactNo","invalid"):$||=E("contactNo","required"),$||=k("address",g.value),$&&w(),!$},b=B(["Male","Female"]),N=B(["Single","Married","Widowed","Divorced","Separated"]),T=()=>{const M=r.data;u.value=M.first_name,l.value=M.middle_name,c.value=M.last_name,p.value=M.suffix,f.value=M.sex,d.value=M.civil_status,h.value=M.birthdate,v.value=M.birthplace,g.value=M.address,m.value=M.email,x.value=M.contact_number},P=async()=>{if(!(_&&!_())){s.value=!0;try{const M=await Re.post(`/employee/${r.data?.id}/information`,{firstname:u.value,middlename:l.value,lastname:c.value,suffix:p.value,sex:f.value,civilstatus:d.value,birthdate:h.value,address:g.value,email:m.value,contactNo:x.value});o("saved"),o("update:modelValue",null),me.fire({icon:"success",html:`
                <div class="text-h6 text-bold text-uppercase">granted!</div>
                <div class="text-caption text-capitalize;">${M.data.message}<div>
            `})}catch(M){M.response&&M.response.data&&(F(M.response.data),me.fire({icon:"error",html:`
                    <div class="text-h6 text-bold text-uppercase">Request Failed</div>
                    <div class="text-caption">Something went wrong.</div>
                `}))}finally{s.value=!1}}},F=M=>{const L=Array.isArray(M)?M:M?.errors||[];Object.keys(y).forEach(A=>{y[A].type=null,y[A].messages=[]}),L.forEach(A=>{y[A.path]!==void 0&&(y[A.path].type=!0,y[A.path].messages.push(A.msg))})};return(M,L)=>(H(),pe(Ke,{modelValue:i.value,"onUpdate:modelValue":L[15]||(L[15]=A=>i.value=A),"full-height":"",position:"right",persistent:"",square:"",class:"dialog",onBeforeShow:L[16]||(L[16]=A=>T())},{default:R(()=>[C(_e,{class:"dialog-card column full-height"},{default:R(()=>[C(oe,{class:"q-pa-lg"},{default:R(()=>L[17]||(L[17]=[I("div",{class:"text-h6 text-uppercase"},"profile information",-1)])),_:1,__:[17]}),C(pt,{inset:""}),C(oe,{class:"col q-pa-lg scroll"},{default:R(()=>[I("div",yg,[I("div",xg,[I("div",{class:ne(["text-caption text-uppercase",y.firstname.type?"text-negative text-italic":"text-grey"])},X(y.firstname.type?y.firstname.msg:"firstname"),3),C(le,{modelValue:u.value,"onUpdate:modelValue":L[0]||(L[0]=A=>u.value=A),label:"Enter Firstname",outlined:"",error:y.firstname.type,"no-error-icon":!0,"input-class":"text-capitalize"},null,8,["modelValue","error"])]),I("div",bg,[I("div",{class:ne(["text-caption text-uppercase",y.middlename.type?"text-negative text-italic":"text-grey"])},X(y.middlename.type?y.middlename.msg:"middlename"),3),C(le,{modelValue:l.value,"onUpdate:modelValue":L[1]||(L[1]=A=>l.value=A),label:"Enter Middlename",outlined:"",error:y.middlename.type,"no-error-icon":!0,"input-class":"text-capitalize"},null,8,["modelValue","error"])]),I("div",_g,[I("div",{class:ne(["text-caption text-uppercase",y.lastname.type?"text-negative text-italic":"text-grey"])},X(y.lastname.type?y.lastname.msg:"lastname"),3),C(le,{modelValue:c.value,"onUpdate:modelValue":L[2]||(L[2]=A=>c.value=A),label:"Enter Lastname",outlined:"",error:y.lastname.type,"no-error-icon":!0,"input-class":"text-capitalize"},null,8,["modelValue","error"])]),I("div",wg,[I("div",{class:ne(["text-caption text-uppercase",y.suffix.type?"text-negative text-italic":"text-grey"])},X(y.suffix.type?y.suffix.msg:"suffix"),3),C(le,{modelValue:p.value,"onUpdate:modelValue":L[3]||(L[3]=A=>p.value=A),label:"Enter Suffix",outlined:"",error:y.suffix.type,"no-error-icon":!0,"input-class":"text-capitalize"},null,8,["modelValue","error"])])]),I("div",Eg,[I("div",Sg,[I("div",{class:ne(["text-caption text-uppercase",y.sex.type?"text-negative text-italic":"text-grey"])},X(y.sex.type?y.sex.msg:"sex"),3),I("div",Cg,[(H(!0),se(Ve,null,We(b.value,A=>(H(),pe(Ut,{modelValue:f.value,"onUpdate:modelValue":L[4]||(L[4]=$=>f.value=$),"checked-icon":"bi-check-circle-fill","unchecked-icon":"bi-check-circle",val:A,label:A},null,8,["modelValue","val","label"]))),256))])]),I("div",Ig,[I("div",{class:ne(["text-caption text-uppercase",y.civilstatus.type?"text-negative text-italic":"text-grey"])},X(y.civilstatus.type?y.civilstatus.msg:"civil status"),3),I("div",Dg,[(H(!0),se(Ve,null,We(N.value,A=>(H(),pe(Ut,{modelValue:d.value,"onUpdate:modelValue":L[5]||(L[5]=$=>d.value=$),"checked-icon":"bi-check-circle-fill","unchecked-icon":"bi-check-circle",val:A,label:A},null,8,["modelValue","val","label"]))),256))])])]),I("div",kg,[I("div",Tg,[I("div",{class:ne(["text-caption text-uppercase",y.birthdate.type?"text-negative text-italic":"text-grey"])},X(y.birthdate.type?y.birthdate.msg:"birthdate (YYYY-MM-DD)"),3),C(le,{outlined:"",modelValue:h.value,"onUpdate:modelValue":L[8]||(L[8]=A=>h.value=A),label:"Enter Date",error:y.birthdate.type,"no-error-icon":!0},{default:R(()=>[C(Ft,{cover:"","transition-show":"scale","transition-hide":"scale",ref:"popup",class:"no-shadow custom-border radius-sm"},{default:R(()=>[C(Mt,{modelValue:h.value,"onUpdate:modelValue":[L[6]||(L[6]=A=>h.value=A),L[7]||(L[7]=()=>{M.popup.hide()})],mask:"YYYY-MM-DD"},null,8,["modelValue"])]),_:1},512)]),_:1},8,["modelValue","error"])]),I("div",Ng,[I("div",{class:ne(["text-caption text-uppercase",y.birthplace.type?"text-negative text-italic":"text-grey"])},X(y.birthplace.type?y.birthplace.msg:"birthplace"),3),C(le,{modelValue:v.value,"onUpdate:modelValue":L[9]||(L[9]=A=>v.value=A),label:"Enter Birthplace",outlined:"",error:y.birthplace.type,"no-error-icon":!0,"input-class":"text-capitalize"},null,8,["modelValue","error"])])]),I("div",Rg,[I("div",Ag,[I("div",{class:ne(["text-caption text-uppercase",y.address.type?"text-negative text-italic":"text-grey"])},X(y.address.type?y.address.msg:"address"),3),I("div",Pg,[C(le,{modelValue:g.value,"onUpdate:modelValue":L[10]||(L[10]=A=>g.value=A),label:"Enter Address",outlined:"",error:y.address.type,"no-error-icon":!0,"input-class":"text-capitalize"},null,8,["modelValue","error"])])])]),I("div",Og,[I("div",Mg,[I("div",{class:ne(["text-caption text-uppercase",y.email.type?"text-negative text-italic":"text-grey"])},X(y.email.type?y.email.msg:"email address"),3),C(le,{modelValue:m.value,"onUpdate:modelValue":L[11]||(L[11]=A=>m.value=A),label:"Enter Email Address",outlined:"",error:y.email.type,"no-error-icon":!0},null,8,["modelValue","error"])]),I("div",Fg,[I("div",{class:ne(["text-caption text-uppercase",y.contactNo.type?"text-negative text-italic":"text-grey"])},X(y.contactNo.type?y.contactNo.msg:"contact number"),3),C(le,{modelValue:x.value,"onUpdate:modelValue":L[12]||(L[12]=A=>x.value=A),label:"Enter Contact No.",outlined:"",error:y.contactNo.type,"no-error-icon":!0},null,8,["modelValue","error"])])])]),_:1}),C(ft,{class:"q-pa-lg bg"},{default:R(()=>[I("div",Vg,[ke(e).hasRole(["SuperAdmin","Admin","HR"])?(H(),pe(de,{key:0,unelevated:"",size:"md",color:"primary",class:"btn text-capitalize",label:"save",onClick:L[13]||(L[13]=A=>P())})):we("",!0),C(de,{unelevated:"",size:"md",color:"primary",class:"btn text-capitalize",label:"discard",onClick:L[14]||(L[14]=()=>{o("update:modelValue",null)}),outline:""})])]),_:1}),C(ht,{showing:s.value},{default:R(()=>[C(_e,{class:"no-shadow radius-md q-pa-md"},{default:R(()=>[C(oe,{class:"text-center"},{default:R(()=>[I("div",null,[C(an,{color:"dark"})]),L[18]||(L[18]=I("div",{class:"text-dark text-uppercase text-caption"},"we're working on it!",-1))]),_:1,__:[18]})]),_:1})]),_:1},8,["showing"])]),_:1})]),_:1},8,["modelValue"]))}},Bg={class:"q-mb-md"},Ug={class:"q-gutter-sm"},Wg={class:"row q-col-gutter-xs q-mb-md"},qg={class:"col-2"},zg={class:"col-2"},$g={class:"row q-col-gutter-xs q-mb-md"},Hg={class:"col-2"},Gg={class:"col-2"},jg={class:"col-2"},Xg={class:"col-2"},Yg={class:"q-gutter-sm"},Kg={__name:"EmploymentDialog",props:{modelValue:String,dialogName:String},emits:["update:modelValue","saved"],setup(n,{emit:t}){const e=Jt(),r=nt(),a=n,o=t,i=Be({get:()=>a.modelValue===a.dialogName,set:b=>{b||o("update:modelValue",null)}}),s=B(!1),u=B(""),l=B(""),c=B(""),p=B(""),f=B(""),d=B(""),h=B(""),v=jt({employeeNo:{type:null,msg:""},dateHired:{type:null,msg:""},employmentstatus:{type:null,msg:""},tin:{type:null,msg:""},sssNo:{type:null,msg:""},philhealthNo:{type:null,msg:""},pagibigNo:{type:null,msg:""}}),g=()=>me.fire({icon:"error",html:`
      <div class="text-h6 text-bold text-uppercase">Request Failed</div>
      <div class="text-caption">Something went wrong.</div>
    `}),m=(b,N="required")=>(v[b].type=!0,v[b].msg=N,!0),x=b=>(v[b].type=null,v[b].msg="",!1),y=(b,N)=>N?x(b):m(b,"required"),w=(b,N,T,P="invalid")=>N&&String(N).length>T?m(b,P):x(b),E=()=>{let b=!1;return b||=y("employmentstatus",c.value),b||=y("dateHired",l.value),b||=w("tin",p.value,15,"invalid"),b||=w("sssNo",f.value,15,"invalid"),b||=w("philhealthNo",d.value,15,"invalid"),b||=w("pagibigNo",h.value,15,"invalid"),b&&g(),!b},D=B(["Regular","Probationary","Contractual","Temporary","Intern"]),k=()=>{const b=r.data;u.value=b.employment?.employee_no,l.value=b.employment?.date_hired,c.value=b.employment.employment_status,p.value=b.employment.tin,f.value=b.employment.sss_no,d.value=b.employment.philhealth_no,h.value=b.employment.pagibig_no},S=async()=>{if(!(E&&!E())){s.value=!0;try{const b=await Re.post(`/employee/${r.data?.employment?.id}/employment`,{employeeNo:u.value,dateHired:l.value,employmentstatus:c.value,tin:p.value,sssNo:f.value,pagibigNo:h.value,philhealthNo:d.value});o("saved"),o("update:modelValue",null),me.fire({icon:"success",html:`
                <div class="text-h6 text-bold text-uppercase">granted!</div>
                <div class="text-caption text-capitalize;">${b.data.message}<div>
            `})}catch(b){b.response&&b.response.data&&(_(b.response.data),me.fire({icon:"error",html:`
                    <div class="text-h6 text-bold text-uppercase">Request Failed</div>
                    <div class="text-caption">Something went wrong.</div>
                `}))}finally{s.value=!1}}},_=b=>{const N=Array.isArray(b)?b:b?.errors||[];Object.keys(v).forEach(T=>{v[T].type=null,v[T].messages=[]}),N.forEach(T=>{v[T.path]!==void 0&&(v[T.path].type=!0,v[T.path].messages.push(T.msg))})};return(b,N)=>(H(),pe(Ke,{modelValue:i.value,"onUpdate:modelValue":N[11]||(N[11]=T=>i.value=T),"full-height":"",position:"right",persistent:"",square:"",class:"dialog",onBeforeShow:N[12]||(N[12]=T=>k())},{default:R(()=>[C(_e,{class:"dialog-card column full-height"},{default:R(()=>[C(oe,{class:"q-pa-lg"},{default:R(()=>N[13]||(N[13]=[I("div",{class:"text-h6 text-uppercase"},"employment information",-1)])),_:1,__:[13]}),C(pt,{inset:""}),C(oe,{class:"col q-pa-lg scroll"},{default:R(()=>[I("div",Bg,[I("div",{class:ne(["text-caption text-uppercase",v.employmentstatus.type?"text-negative text-italic":"text-grey"])},X(v.employmentstatus.type?v.employmentstatus.msg:"employment status"),3),I("div",Ug,[(H(!0),se(Ve,null,We(D.value,T=>(H(),pe(Ut,{modelValue:c.value,"onUpdate:modelValue":N[0]||(N[0]=P=>c.value=P),"checked-icon":"bi-check-circle-fill","unchecked-icon":"bi-check-circle",val:T,label:T,class:"text-capitalize"},null,8,["modelValue","val","label"]))),256))])]),I("div",Wg,[I("div",qg,[I("div",{class:ne(["text-caption text-uppercase",v.dateHired.msg?"text-negative text-italic":"text-grey"])},X(v.dateHired.msg?v.dateHired.msg:"date hired (YYYY-MM-DD)"),3),C(le,{outlined:"",modelValue:l.value,"onUpdate:modelValue":N[3]||(N[3]=T=>l.value=T),label:"Enter Date",error:v.dateHired.type,"no-error-icon":!0},{default:R(()=>[C(Ft,{cover:"","transition-show":"scale","transition-hide":"scale",ref:"popup",class:"no-shadow custom-border radius-sm"},{default:R(()=>[C(Mt,{modelValue:l.value,"onUpdate:modelValue":[N[1]||(N[1]=T=>l.value=T),N[2]||(N[2]=()=>{b.popup.hide()})],mask:"YYYY-MM-DD"},null,8,["modelValue"])]),_:1},512)]),_:1},8,["modelValue","error"])]),I("div",zg,[I("div",{class:ne(["text-caption text-uppercase",v.employeeNo.msg?"text-negative text-italic":"text-grey"])},X(v.employeeNo.msg?v.employeeNo.msg:"id number (YYYY-NNN)"),3),C(le,{modelValue:u.value,"onUpdate:modelValue":N[4]||(N[4]=T=>u.value=T),label:"Enter ID No.",mask:"####-###",outlined:"",error:v.employeeNo.type,"no-error-icon":!0},null,8,["modelValue","error"])])]),I("div",$g,[I("div",Hg,[I("div",{class:ne(["text-caption text-uppercase",v.tin.type?"text-negative text-italic":"text-grey"])},X(v.tin.type?v.tin.msg:"TIN"),3),C(le,{modelValue:p.value,"onUpdate:modelValue":N[5]||(N[5]=T=>p.value=T),label:"Enter TIN",outlined:"",error:v.tin.type,"no-error-icon":!0,class:"text-capitalize"},null,8,["modelValue","error"])]),I("div",Gg,[I("div",{class:ne(["text-caption text-uppercase",v.sssNo.type?"text-negative text-italic":"text-grey"])},X(v.sssNo.type?v.sssNo.msg:"SSS no"),3),C(le,{modelValue:f.value,"onUpdate:modelValue":N[6]||(N[6]=T=>f.value=T),label:"Enter SSS No.",outlined:"",error:v.sssNo.type,"no-error-icon":!0,class:"text-capitalize"},null,8,["modelValue","error"])]),I("div",jg,[I("div",{class:ne(["text-caption text-uppercase",v.philhealthNo.type?"text-negative text-italic":"text-grey"])},X(v.philhealthNo.type?v.philhealthNo.msg:"Philhealth No."),3),C(le,{modelValue:d.value,"onUpdate:modelValue":N[7]||(N[7]=T=>d.value=T),label:"Enter Philhealth No.",outlined:"",error:v.philhealthNo.type,"no-error-icon":!0,class:"text-capitalize"},null,8,["modelValue","error"])]),I("div",Xg,[I("div",{class:ne(["text-caption text-uppercase",v.pagibigNo.type?"text-negative text-italic":"text-grey"])},X(v.pagibigNo.type?v.pagibigNo.msg:"pagibig no."),3),C(le,{modelValue:h.value,"onUpdate:modelValue":N[8]||(N[8]=T=>h.value=T),label:"Enter Pagibig No.",outlined:"",error:v.pagibigNo.type,"no-error-icon":!0,class:"text-capitalize"},null,8,["modelValue","error"])])])]),_:1}),C(ft,{class:"q-pa-lg bg"},{default:R(()=>[I("div",Yg,[ke(e).hasRole(["SuperAdmin","Admin","HR"])?(H(),pe(de,{key:0,unelevated:"",size:"md",color:"primary",class:"btn text-capitalize",label:"save",onClick:N[9]||(N[9]=T=>S())})):we("",!0),C(de,{unelevated:"",size:"md",color:"primary",class:"btn text-capitalize",label:"discard",onClick:N[10]||(N[10]=()=>{o("update:modelValue",null)}),outline:""})])]),_:1}),C(ht,{showing:s.value},{default:R(()=>[C(_e,{class:"no-shadow radius-md q-pa-md"},{default:R(()=>[C(oe,{class:"text-center"},{default:R(()=>[I("div",null,[C(an,{color:"dark"})]),N[14]||(N[14]=I("div",{class:"text-dark text-uppercase text-caption"},"we're working on it!",-1))]),_:1,__:[14]})]),_:1})]),_:1},8,["showing"])]),_:1})]),_:1},8,["modelValue"]))}},Jg={class:"card-grid"},Qg={key:0,class:"inner-card-anim-wrapper",style:{animationDelay:"120ms"}},Zg={key:1,class:"inner-card-anim-wrapper",style:{animationDelay:"120ms"}},ey={class:"text-subtitle2 text-uppercase"},ty={class:"text-caption text-uppercase"},ny={class:"text-caption text-uppercase"},ry={class:"text-caption text-grey"},ay={key:0,class:"absolute-left"},oy={class:"q-gutter-sm"},iy={class:"text-center"},sy={class:"iframe-container"},uy=["src"],ly={__name:"ServiceDialog",props:{modelValue:String,dialogName:String},emits:["update:modelValue"],setup(n,{emit:t}){const e=Jt(),r=nt(),a=n,o=t,i=Be({get:()=>a.modelValue===a.dialogName,set:w=>{w||o("update:modelValue",null)}}),s=B(!1),u=B([{id:"",amount:"",salarytype:"",salarygroup:"",effectiveDate:"",endDate:"",notes:""}]),l=async w=>{s.value=!0;try{const E=await Re.get("/employee/service",{params:{id:w}});c(E.data.record)}catch(E){console.error("Error fetching all data:",E),me.fire({icon:"error",html:`
                <div class="text-h6 text-bold text-uppercase">Error</div>
                <div class="text-caption text-capitalize;">Unable to fetch records</div>
            `})}finally{s.value=!1}},c=(w=[])=>{u.value=w.map(E=>({id:E.id??"",amount:E.amount??"",salarytype:E.salary_type??"",salarygroup:E.salary_group??"",effectiveDate:E.effective_date??"",endDate:E.end_date??"",notes:E.notes??"",is_active:E.is_active??""}))},p=()=>{l(r.data?.id),m.value=""};jt({amount:{type:null,msg:""},salarytype:{type:null,msg:""},salarygroup:{type:null,msg:""},effectivedate:{type:null,msg:""},enddate:{type:null,msg:""},notes:{type:null,msg:""}});function f(w,E="PHP"){return w?w.split("-").map(D=>parseFloat(D.replace(/,/g,"")).toLocaleString("en-PH",{style:"currency",currency:E,minimumFractionDigits:2})).join(" - "):""}const d=w=>{if(!w?.effectiveDate)return"";const E=S=>new Date(S).toLocaleDateString("en-PH",{year:"numeric",month:"short",day:"2-digit"}),D=E(w.effectiveDate),k=w.endDate?E(w.endDate):"Present";return`${D} â ${k}`},h=B(!1),v=B(null),g=async w=>{s.value=!0;try{const E=await Re.get(`/salary/service/${w}/pdf`,{responseType:"arraybuffer"}),D=new Blob([E.data],{type:"application/pdf"}),k=window.URL.createObjectURL(D)+"#view=FitW";v.value=k,h.value=!0,s.value=!1}catch(E){s.value=!1,console.error("Error generating PDF:",E)}},m=B(""),x=async()=>{s.value=!0;try{const w=await Re.post(`/employee/${m.value}/salary/disable`);l(r.data?.id),m.value="",me.fire({icon:"success",html:`
                <div class="text-h6 text-bold text-uppercase">granted!</div>
                <div class="text-caption text-capitalize;">${w.data.message}<div>
            `})}catch(w){w.response&&w.response.data&&(applyBackendErrors(w.response.data),me.fire({icon:"error",html:`
                    <div class="text-h6 text-bold text-uppercase">Request Failed</div>
                    <div class="text-caption">Something went wrong.</div>
                `}))}finally{s.value=!1}},y=Be(()=>e.hasRole(["SuperAdmin","Admin","HR"]));return(w,E)=>(H(),se(Ve,null,[C(Ke,{modelValue:i.value,"onUpdate:modelValue":E[4]||(E[4]=D=>i.value=D),"full-height":"",position:"right",persistent:"",square:"",class:"dialog",onBeforeShow:E[5]||(E[5]=D=>p())},{default:R(()=>[C(_e,{class:"dialog-card column full-height"},{default:R(()=>[C(oe,{class:"q-pa-lg"},{default:R(()=>E[7]||(E[7]=[I("div",{class:"text-h6 text-uppercase"},"service records",-1)])),_:1,__:[7]}),C(pt,{inset:""}),C(oe,{class:"col q-pa-lg scroll"},{default:R(()=>[I("div",Jg,[w.loading?(H(),se("div",Qg,[C(_e,{key:"data-add",class:"card card-hover-animate flex column justify-center items-center no-shadow cursor-pointer radius-sm"},{default:R(()=>[C(oe,{class:"text-center"},{default:R(()=>[C(Sn,{size:"md"}),E[8]||(E[8]=I("div",{class:"text-caption text-grey text-uppercase q-mt-xs"},"we're working on it!",-1))]),_:1,__:[8]})]),_:1})])):!w.loading&&u.value.length===0?(H(),se("div",Zg,[C(_e,{key:"data-add",class:"card card-hover-animate flex column justify-center items-center no-shadow cursor-pointer radius-sm"},{default:R(()=>[C(oe,{class:"text-center"},{default:R(()=>E[9]||(E[9]=[I("div",{class:"text-caption text-uppercase text-grey"},"no data found",-1)])),_:1,__:[9]})]),_:1})])):we("",!0),(H(!0),se(Ve,null,We(u.value,(D,k)=>(H(),se("div",{key:`data-${D.id}`,class:"inner-card-anim-wrapper",style:dr({animationDelay:`${k*120}ms`})},[C(_e,{class:ne(["card card-menu card-hover-animate flex column justify-center items-center no-shadow cursor-pointer radius-sm",{"card--active":m.value===D.id,"card--disabled":!D.is_active||!y.value}]),onClick:S=>m.value=D.id},{default:R(()=>[C(oe,{class:"text-center full-width"},{default:R(()=>[I("div",ey,X(f(D?.amount)),1),I("div",ty,X(D?.salarytype),1)]),_:2},1024),C(oe,{class:"full-width"},{default:R(()=>[I("div",ny,X(D?.salarygroup),1),I("div",ry,X(d(D)),1)]),_:2},1024),D.is_active?(H(),se("div",ay,[C(Ut,{modelValue:m.value,"onUpdate:modelValue":E[0]||(E[0]=S=>m.value=S),val:D.id,"checked-icon":"bi-check-circle-fill","unchecked-icon":"bi-check-circle",size:"xs"},null,8,["modelValue","val"])])):we("",!0)]),_:2},1032,["onClick","class"])],4))),128))])]),_:1}),C(ft,{class:"q-pa-lg bg"},{default:R(()=>[I("div",oy,[m.value!=""&&ke(e).hasRole(["SuperAdmin","Admin","HR"])?(H(),pe(de,{key:0,unelevated:"",size:"md",color:"primary",class:"btn text-capitalize",label:"remove",onClick:E[1]||(E[1]=D=>x())})):we("",!0),C(de,{unelevated:"",size:"md",color:"primary",class:"btn text-capitalize",label:"print",onClick:E[2]||(E[2]=D=>g(ke(r).data?.id))}),C(de,{unelevated:"",size:"md",color:"primary",class:"btn text-capitalize",label:"discard",onClick:E[3]||(E[3]=()=>{o("update:modelValue",null)}),outline:""})])]),_:1}),C(ht,{showing:s.value},{default:R(()=>[I("div",iy,[C(Sn,{size:"md"}),E[10]||(E[10]=I("div",{class:"text-caption text-grey text-uppercase q-mt-xs"},"we're working on it!",-1))])]),_:1},8,["showing"])]),_:1})]),_:1},8,["modelValue"]),C(Ke,{modelValue:h.value,"onUpdate:modelValue":E[6]||(E[6]=D=>h.value=D),"full-height":"","full-width":"",class:"pdf"},{default:R(()=>[C(_e,{class:"bg-white q-pa-none",style:{height:"100vh",overflow:"hidden"}},{default:R(()=>[Or(C(de,{icon:"bi-x",class:"fixed bg-white text-primary shadow-2",round:"",dense:"",style:{top:"15px",right:"15px","z-index":"999"}},null,512),[[yo]]),C(oe,{class:"q-pa-none",style:{height:"100%",overflow:"hidden"}},{default:R(()=>[I("div",sy,[v.value?(H(),se("iframe",{key:0,src:v.value,frameborder:"0"},null,8,uy)):we("",!0)])]),_:1})]),_:1})]),_:1},8,["modelValue"])],64))}},cy=Kn(ly,[["__scopeId","data-v-a1d861ec"]]);/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var Md=function(n,t){return(Md=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,r){e.__proto__=r}||function(e,r){for(var a in r)r.hasOwnProperty(a)&&(e[a]=r[a])})(n,t)};function On(n,t){function e(){this.constructor=n}Md(n,t),n.prototype=t===null?Object.create(t):(e.prototype=t.prototype,new e)}function he(n,t,e,r){return new(e||(e=Promise))(function(a,o){function i(l){try{u(r.next(l))}catch(c){o(c)}}function s(l){try{u(r.throw(l))}catch(c){o(c)}}function u(l){l.done?a(l.value):new e(function(c){c(l.value)}).then(i,s)}u((r=r.apply(n,[])).next())})}function ve(n,t){var e,r,a,o,i={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function s(u){return function(l){return function(c){if(e)throw new TypeError("Generator is already executing.");for(;i;)try{if(e=1,r&&(a=2&c[0]?r.return:c[0]?r.throw||((a=r.return)&&a.call(r),0):r.next)&&!(a=a.call(r,c[1])).done)return a;switch(r=0,a&&(c=[2&c[0],a.value]),c[0]){case 0:case 1:a=c;break;case 4:return i.label++,{value:c[1],done:!1};case 5:i.label++,r=c[1],c=[0];continue;case 7:c=i.ops.pop(),i.trys.pop();continue;default:if(!(a=(a=i.trys).length>0&&a[a.length-1])&&(c[0]===6||c[0]===2)){i=0;continue}if(c[0]===3&&(!a||c[1]>a[0]&&c[1]<a[3])){i.label=c[1];break}if(c[0]===6&&i.label<a[1]){i.label=a[1],a=c;break}if(a&&i.label<a[2]){i.label=a[2],i.ops.push(c);break}a[2]&&i.ops.pop(),i.trys.pop();continue}c=t.call(n,i)}catch(p){c=[6,p],r=0}finally{e=a=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}([u,l])}}}var dy=function(){function n(t){this.global=t,this.flags={},this.flagRegistry={},this.urlFlags={},this.populateURLFlags()}return n.prototype.setPlatform=function(t,e){this.platform!=null&&console.warn("Platform "+this.platformName+" has already been set. Overwriting the platform with "+e+"."),this.platformName=t,this.platform=e},n.prototype.registerFlag=function(t,e,r){if(this.flagRegistry[t]={evaluationFn:e,setHook:r},this.urlFlags[t]!=null){var a=this.urlFlags[t];console.warn("Setting feature override from URL "+t+": "+a+"."),this.set(t,a)}},n.prototype.get=function(t){return t in this.flags?this.flags[t]:(this.flags[t]=this.evaluateFlag(t),this.flags[t])},n.prototype.getNumber=function(t){return this.get(t)},n.prototype.getBool=function(t){return this.get(t)},n.prototype.getFlags=function(){return this.flags},Object.defineProperty(n.prototype,"features",{get:function(){return this.flags},enumerable:!0,configurable:!0}),n.prototype.set=function(t,e){if(this.flagRegistry[t]==null)throw new Error("Cannot set flag "+t+" as it has not been registered.");this.flags[t]=e,this.flagRegistry[t].setHook!=null&&this.flagRegistry[t].setHook(e)},n.prototype.evaluateFlag=function(t){if(this.flagRegistry[t]==null)throw new Error("Cannot evaluate flag '"+t+"': no evaluation function found.");return this.flagRegistry[t].evaluationFn()},n.prototype.setFlags=function(t){this.flags=Object.assign({},t)},n.prototype.reset=function(){this.flags={},this.urlFlags={},this.populateURLFlags()},n.prototype.populateURLFlags=function(){var t=this;if(this.global!==void 0&&this.global.location!==void 0&&this.global.location.search!==void 0){var e,r,a=(e=this.global.location.search,r={},e.replace(/[?&]([^=?&]+)(?:=([^&]*))?/g,function(o){for(var i=[],s=1;s<arguments.length;s++)i[s-1]=arguments[s];return py(r,i[0],i[1]),i.join("=")}),r);"tfjsflags"in a&&a.tfjsflags.split(",").forEach(function(o){var i=o.split(":"),s=i[0],u=i[1];t.urlFlags[s]=function(l,c){if((c=c.toLowerCase())==="true"||c==="false")return c==="true";if(""+ +c===c)return+c;throw new Error("Could not parse value flag value "+c+" for flag "+l+".")}(s,u)})}},n}();function py(n,t,e){n[decodeURIComponent(t)]=decodeURIComponent(e||"")}function J(){return Fd}var Fd=null,si=new Map,Ks=new Map;function Vd(n,t){var e=Bd(n,t);return si.get(e)}function fy(n){return Ks.get(n)}function sc(n){for(var t=si.entries(),e=[];;){var r=t.next(),a=r.done,o=r.value;if(a)break;var i=o[0],s=o[1];i.split("_")[0]===n&&e.push(s)}return e}function Ld(n){var t=n.kernelName,e=n.backendName,r=Bd(t,e);if(si.has(r))throw new Error("The kernel '"+t+"' for backend '"+e+"' is already registered");si.set(r,n)}function hy(n){var t=n.kernelName;Ks.has(t)&&console.warn("Overriding the gradient for '"+t+"'"),Ks.set(t,n)}function Bd(n,t){return t+"_"+n}function Js(n,t,e){return Math.max(n,Math.min(t,e))}function Ud(n){return n%2==0?n:n+1}function vy(n){for(var t=0,e=0;e<n.length;e++)t+=n[e];return t}function V(n,t){if(!n)throw new Error(typeof t=="string"?t:t())}function je(n,t,e){e===void 0&&(e=""),V(kt(n,t),function(){return e+" Shapes "+n+" and "+t+" must match"})}function Va(n){V(n!=null,function(){return"The input to the tensor constructor must be a non-null value."})}function Da(n,t,e){if(t===void 0&&(t=[]),e===void 0&&(e=!1),t==null&&(t=[]),Array.isArray(n)||Hn(n)&&!e)for(var r=0;r<n.length;++r)Da(n[r],t,e);else t.push(n);return t}function ge(n){if(n.length===0)return 1;for(var t=n[0],e=1;e<n.length;e++)t*=n[e];return t}function kt(n,t){if(n===t)return!0;if(n==null||t==null||n.length!==t.length)return!1;for(var e=0;e<n.length;e++)if(n[e]!==t[e])return!1;return!0}function mt(n){return n%1==0}function my(n){if(Math.tanh!=null)return Math.tanh(n);if(n===1/0)return 1;if(n===-1/0)return-1;var t=Math.exp(2*n);return(t-1)/(t+1)}function Qs(n){var t=Math.ceil(Math.sqrt(n));return[t,Math.ceil(n/t)]}function ya(n,t){return t<=n.length?n:n+" ".repeat(t-n.length)}function uc(n,t,e){return t===void 0&&(t=function(r){return 0}),new Promise(function(r,a){var o=0,i=function(){if(n())r();else{o++;var s=t(o);e!=null&&o>=e?a():setTimeout(i,s)}};i()})}function gy(n,t){for(var e=1,r=-1,a=0;a<n.length;++a)if(n[a]>=0)e*=n[a];else if(n[a]===-1){if(r!==-1)throw Error("Shapes can only have 1 implicit size. Found -1 at dim "+r+" and dim "+a);r=a}else if(n[a]<0)throw Error("Shapes can not be < 0. Found "+n[a]+" at dim "+a);if(r===-1){if(t>0&&t!==e)throw Error("Size("+t+") must match the product of shape "+n);return n}if(e===0)throw Error("Cannot infer the missing size in ["+n+"] when there are 0 elements");if(t%e!=0)throw Error("The implicit shape can't be a fractional number. Got "+t+" / "+e);var o=n.slice();return o[r]=t/e,o}function Ct(n,t){var e=t.length;return V((n=n==null?t.map(function(r,a){return a}):[].concat(n)).every(function(r){return r>=-e&&r<e}),function(){return"All values in axis param must be in range [-"+e+", "+e+") but got axis "+n}),V(n.every(function(r){return mt(r)}),function(){return"All values in axis param must be integers but got axis "+n}),n.map(function(r){return r<0?e+r:r})}function Hr(n,t){for(var e=[],r=[],a=t!=null&&Array.isArray(t)&&t.length===0,o=t==null||a?null:Ct(t,n).sort(),i=0,s=0;s<n.length;++s){if(o!=null){if(o[i]===s&&n[s]!==1)throw new Error("Can't squeeze axis "+s+" since its dim '"+n[s]+"' is not 1");(o[i]==null||o[i]>s)&&n[s]===1&&(e.push(n[s]),r.push(s)),o[i]<=s&&i++}n[s]!==1&&(e.push(n[s]),r.push(s))}return{newShape:e,keptDims:r}}function ao(n,t){var e=null;if(n==null||n==="float32")e=new Float32Array(t);else if(n==="int32")e=new Int32Array(t);else{if(n!=="bool")throw new Error("Unknown data type "+n);e=new Uint8Array(t)}return e}function ui(n,t){var e=null;if(n==null||n==="float32")e=new Float32Array(t);else if(n==="int32")e=new Int32Array(t);else if(n==="bool")e=new Uint8Array(t);else{if(n!=="string")throw new Error("Unknown data type "+n);e=new Array(t)}return e}function yy(n,t){for(var e=0;e<n.length;e++){var r=n[e];if(isNaN(r)||!isFinite(r))throw Error("A tensor of type "+t+" being uploaded contains "+r+".")}}function xy(n){return n==="bool"||n==="complex64"||n==="float32"||n==="int32"||n==="string"}function by(n,t){return t!=="complex64"&&(t!=="float32"||n==="complex64")&&(t!=="int32"||n==="float32"||n==="complex64")&&(t!=="bool"||n!=="bool")}function Hn(n){return n instanceof Float32Array||n instanceof Int32Array||n instanceof Uint8Array}function Wd(n){if(n==="float32"||n==="int32")return 4;if(n==="complex64")return 8;if(n==="bool")return 1;throw new Error("Unknown dtype "+n)}function _y(n){if(n==null)return 0;var t=0;return n.forEach(function(e){return t+=e.length}),t}function Du(n){return typeof n=="string"||n instanceof String}function wy(n){return typeof n=="boolean"}function Ey(n){return typeof n=="number"}function xo(n){return Array.isArray(n)?xo(n[0]):n instanceof Float32Array?"float32":n instanceof Int32Array||n instanceof Uint8Array?"int32":Ey(n)?"float32":Du(n)?"string":wy(n)?"bool":"float32"}function Zs(n){return!!(n&&n.constructor&&n.call&&n.apply)}function eu(n,t){for(var e=t;e<n;++e)if(n%e==0)return e;return n}function Gn(n){var t=n.length;if(t<2)return[];var e=new Array(t-1);e[t-2]=n[t-1];for(var r=t-3;r>=0;--r)e[r]=e[r+1]*n[r+1];return e}function qd(n,t,e){if(t==="string")throw new Error("Cannot convert a string[] to a TypedArray");if(Array.isArray(n)&&(n=Da(n)),e&&yy(n,t),function(o,i){return o instanceof Float32Array&&i==="float32"||o instanceof Int32Array&&i==="int32"||o instanceof Uint8Array&&i==="bool"}(n,t))return n;if(t==null||t==="float32"||t==="complex64")return new Float32Array(n);if(t==="int32")return new Int32Array(n);if(t==="bool"){for(var r=new Uint8Array(n.length),a=0;a<r.length;++a)Math.round(n[a])!==0&&(r[a]=1);return r}throw new Error("Unknown data type "+t)}function lc(n,t){if(n.length===0)return t[0];var e=n.reduce(function(r,a){return r*a});if(e===0)return[];if(e!==t.length)throw new Error("["+n+"] does not match the input size.");return function r(a,o,i){var s=new Array;if(o.length===1)for(var u=o[0],l=0;l<u;l++)s[l]=i[a+l];else{u=o[0];var c=o.slice(1),p=c.reduce(function(f,d){return f*d});for(l=0;l<u;l++)s[l]=r(a+l*p,c,i)}return s}(0,n,t)}function zd(n,t){for(var e=bo(n,t),r=0;r<e.length;r++)e[r]=1;return e}function bo(n,t){if(t==null||t==="float32"||t==="complex64")return new Float32Array(n);if(t==="int32")return new Int32Array(n);if(t==="bool")return new Uint8Array(n);throw new Error("Unknown data type "+t)}function Wn(){return J().platform.now()}function $d(n){n.forEach(function(t){V(Number.isInteger(t)&&t>=0,function(){return"Tensor must have a shape comprised of positive integers but got shape ["+n+"]."})})}function Sy(n,t){return t===void 0&&(t="utf-8"),t=t||"utf-8",J().platform.encode(n,t)}function li(n,t){return t===void 0&&(t="utf-8"),t=t||"utf-8",J().platform.decode(n,t)}function cc(n,t,e){if(t===0)return 0;if(t===1)return n[0];for(var r=n[n.length-1],a=0;a<n.length-1;++a)r+=e[a]*n[a];return r}function Cy(n,t,e){if(t===0)return[];if(t===1)return[n];for(var r=new Array(t),a=0;a<r.length-1;++a)r[a]=Math.floor(n/e[a]),n-=r[a]*e[a];return r[r.length-1]=n,r}var Iy=function(){function n(t,e){this.backendTimer=t,this.logger=e,e==null&&(this.logger=new Dy)}return n.prototype.profileKernel=function(t,e,r){var a,o=this,i=this.backendTimer.time(function(){a=r()});return a.forEach(function(s){s.data().then(function(u){(function(l,c,p){if(c!=="float32")return!1;for(var f=0;f<l.length;f++){var d=l[f];if(isNaN(d)||!isFinite(d))return console.warn("Found "+d+" in the result of '"+p+"'"),!0}})(u,s.dtype,t),i.then(function(l){var c="";l.getExtraProfileInfo!=null&&(c=l.getExtraProfileInfo()),o.logger.logKernelProfile(t,s,u,l.kernelMs,e,c)})})}),a},n}(),Dy=function(){function n(){}return n.prototype.logKernelProfile=function(t,e,r,a,o,i){var s=typeof a=="number"?ya(a+"ms",9):a.error,u=ya(t,25),l=e.rank,c=e.size,p=ya(e.shape.toString(),14),f="";for(var d in o){var h=o[d].shape||e.shape,v=h.length;f+=d+": "+v+"D "+(v>0?h:"")+" "}console.log("%c"+u+"	%c"+s+"	%c"+l+"D "+p+"	%c"+c+"	%c"+f+"	%c"+i,"font-weight:bold","color:red","color:blue","color: orange","color: green","color: steelblue")},n}(),dc=20,Ga=3,xs=7;function ky(n,t,e,r){var a=Gn(t),o=function(l,c,p,f){var d=ge(c),h=f[f.length-1],v=new Array(h).fill(0),g=c.length,m=p==="complex64"?Xa(l):l;if(g>1)for(var x=0;x<d/h;x++)for(var y=x*h,w=0;w<h;w++)v[w]=Math.max(v[w],ja(m[y+w],0,p).length);return v}(n,t,e,a),i=t.length,s=function l(c,p,f,d,h,v){v===void 0&&(v=!0);var g=f==="complex64"?2:1,m=p[0],x=p.length;if(x===0)return f==="complex64"?[ja(Xa(c)[0],0,f)]:f==="bool"?[Hd(c[0])]:[c[0].toString()];if(x===1){if(m>dc){var y=Ga*g,w=Array.from(c.slice(0,y)),E=Array.from(c.slice((m-Ga)*g,m*g));return f==="complex64"&&(w=Xa(w),E=Xa(E)),["["+w.map(function(M,L){return ja(M,h[L],f)}).join(", ")+", ..., "+E.map(function(M,L){return ja(M,h[m-Ga+L],f)}).join(", ")+"]"]}return["["+(f==="complex64"?Xa(c):Array.from(c)).map(function(M,L){return ja(M,h[L],f)}).join(", ")+"]"]}var D=p.slice(1),k=d.slice(1),S=d[0]*g,_=[];if(m>dc){for(var b=0;b<Ga;b++){var N=(T=b*S)+S;_.push.apply(_,l(c.slice(T,N),D,f,k,h,!1))}for(_.push("..."),b=m-Ga;b<m;b++)N=(T=b*S)+S,_.push.apply(_,l(c.slice(T,N),D,f,k,h,b===m-1))}else for(b=0;b<m;b++){var T;N=(T=b*S)+S,_.push.apply(_,l(c.slice(T,N),D,f,k,h,b===m-1))}var P=x===2?",":"";for(_[0]="["+_[0]+P,b=1;b<_.length-1;b++)_[b]=" "+_[b]+P;var F=`,
`;for(b=2;b<x;b++)F+=`
`;return _[_.length-1]=" "+_[_.length-1]+"]"+(v?"":F),_}(n,t,e,a,o),u=["Tensor"];return r&&(u.push("  dtype: "+e),u.push("  rank: "+i),u.push("  shape: ["+t+"]"),u.push("  values:")),u.push(s.map(function(l){return"    "+l}).join(`
`)),u.join(`
`)}function ja(n,t,e){return ya(Array.isArray(n)?parseFloat(n[0].toFixed(xs))+" + "+parseFloat(n[1].toFixed(xs))+"j":Du(n)?"'"+n+"'":e==="bool"?Hd(n):parseFloat(n.toFixed(xs)).toString(),t)}function Hd(n){return n===0?"false":"true"}function Xa(n){for(var t=[],e=0;e<n.length;e+=2)t.push([n[e],n[e+1]]);return t}var oo=function(){function n(t,e,r){var a=this;if(this.dtype=e,this.shape=t.slice(),this.size=ge(t),r!=null){var o=r.length;V(o===this.size,function(){return"Length of values '"+o+"' does not match the size inferred by the shape '"+a.size+"'."})}if(e==="complex64")throw new Error("complex64 dtype TensorBuffers are not supported. Please create a TensorBuffer for the real and imaginary parts separately and call tf.complex(real, imag).");this.values=r||ui(e,this.size),this.strides=Gn(t)}return n.prototype.set=function(t){for(var e=this,r=[],a=1;a<arguments.length;a++)r[a-1]=arguments[a];r.length===0&&(r=[0]),V(r.length===this.rank,function(){return"The number of provided coordinates ("+r.length+") must match the rank ("+e.rank+")"});var o=this.locToIndex(r);this.values[o]=t},n.prototype.get=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];t.length===0&&(t=[0]);for(var r=0,a=0,o=t;a<o.length;a++){var i=o[a];if(i<0||i>=this.shape[r]){var s="Requested out of range element at "+t+".   Buffer shape="+this.shape;throw new Error(s)}r++}for(var u=t[t.length-1],l=0;l<t.length-1;++l)u+=this.strides[l]*t[l];return this.values[u]},n.prototype.locToIndex=function(t){if(this.rank===0)return 0;if(this.rank===1)return t[0];for(var e=t[t.length-1],r=0;r<t.length-1;++r)e+=this.strides[r]*t[r];return e},n.prototype.indexToLoc=function(t){if(this.rank===0)return[];if(this.rank===1)return[t];for(var e=new Array(this.shape.length),r=0;r<e.length-1;++r)e[r]=Math.floor(t/this.strides[r]),t-=e[r]*this.strides[r];return e[e.length-1]=t,e},Object.defineProperty(n.prototype,"rank",{get:function(){return this.shape.length},enumerable:!0,configurable:!0}),n.prototype.toTensor=function(){return qn().makeTensor(this.values,this.shape,this.dtype)},n}(),qn=null,Y=null,Gd=null,at=function(){function n(t,e,r,a){this.kept=!1,this.isDisposedInternal=!1,this.shape=t.slice(),this.dtype=e||"float32",this.size=ge(t),this.strides=Gn(t),this.dataId=r,this.id=a,this.rankType=this.rank<5?this.rank.toString():"higher"}return n.prototype.flatten=function(){return this.throwIfDisposed(),this.as1D()},n.prototype.asScalar=function(){return this.throwIfDisposed(),V(this.size===1,function(){return"The array must have only 1 element."}),this.reshape([])},n.prototype.as1D=function(){return this.throwIfDisposed(),this.reshape([this.size])},n.prototype.as2D=function(t,e){return this.throwIfDisposed(),this.reshape([t,e])},n.prototype.as3D=function(t,e,r){return this.throwIfDisposed(),this.reshape([t,e,r])},n.prototype.as4D=function(t,e,r,a){return this.throwIfDisposed(),this.reshape([t,e,r,a])},n.prototype.as5D=function(t,e,r,a,o){return this.throwIfDisposed(),this.reshape([t,e,r,a,o])},n.prototype.asType=function(t){return this.throwIfDisposed(),Y.cast(this,t)},Object.defineProperty(n.prototype,"rank",{get:function(){return this.shape.length},enumerable:!0,configurable:!0}),n.prototype.buffer=function(){return he(this,void 0,void 0,function(){var t;return ve(this,function(e){switch(e.label){case 0:return[4,this.data()];case 1:return t=e.sent(),[2,Y.buffer(this.shape,this.dtype,t)]}})})},n.prototype.bufferSync=function(){return Y.buffer(this.shape,this.dtype,this.dataSync())},n.prototype.array=function(){return he(this,void 0,void 0,function(){var t;return ve(this,function(e){switch(e.label){case 0:return[4,this.data()];case 1:return t=e.sent(),[2,lc(this.shape,t)]}})})},n.prototype.arraySync=function(){return lc(this.shape,this.dataSync())},n.prototype.data=function(){return he(this,void 0,void 0,function(){var t,e;return ve(this,function(r){switch(r.label){case 0:return this.throwIfDisposed(),t=qn().read(this.dataId),this.dtype!=="string"?[3,2]:[4,t];case 1:e=r.sent();try{return[2,e.map(function(a){return li(a)})]}catch{throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}r.label=2;case 2:return[2,t]}})})},n.prototype.dataSync=function(){this.throwIfDisposed();var t=qn().readSync(this.dataId);if(this.dtype==="string")try{return t.map(function(e){return li(e)})}catch{throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}return t},n.prototype.bytes=function(){return he(this,void 0,void 0,function(){var t;return ve(this,function(e){switch(e.label){case 0:return this.throwIfDisposed(),[4,qn().read(this.dataId)];case 1:return t=e.sent(),this.dtype==="string"?[2,t]:[2,new Uint8Array(t.buffer)]}})})},n.prototype.dispose=function(){this.isDisposed||(qn().disposeTensor(this),this.isDisposedInternal=!0)},Object.defineProperty(n.prototype,"isDisposed",{get:function(){return this.isDisposedInternal},enumerable:!0,configurable:!0}),n.prototype.throwIfDisposed=function(){if(this.isDisposed)throw new Error("Tensor is disposed.")},n.prototype.toFloat=function(){return this.asType("float32")},n.prototype.toInt=function(){return this.asType("int32")},n.prototype.toBool=function(){return this.asType("bool")},n.prototype.print=function(t){return t===void 0&&(t=!1),Y.print(this,t)},n.prototype.reshape=function(t){return this.throwIfDisposed(),Y.reshape(this,t)},n.prototype.reshapeAs=function(t){return this.throwIfDisposed(),this.reshape(t.shape)},n.prototype.expandDims=function(t){return t===void 0&&(t=0),Y.expandDims(this,t)},n.prototype.cumsum=function(t,e,r){return t===void 0&&(t=0),e===void 0&&(e=!1),r===void 0&&(r=!1),Y.cumsum(this,t,e,r)},n.prototype.squeeze=function(t){return this.throwIfDisposed(),Y.squeeze(this,t)},n.prototype.clone=function(){return this.throwIfDisposed(),Y.clone(this)},n.prototype.oneHot=function(t,e,r){return this.throwIfDisposed(),Y.oneHot(this,t,e,r)},n.prototype.toString=function(t){return t===void 0&&(t=!1),ky(this.dataSync(),this.shape,this.dtype,t)},n.prototype.tile=function(t){return this.throwIfDisposed(),Y.tile(this,t)},n.prototype.gather=function(t,e){return e===void 0&&(e=0),this.throwIfDisposed(),Y.gather(this,t,e)},n.prototype.matMul=function(t,e,r){return e===void 0&&(e=!1),r===void 0&&(r=!1),this.throwIfDisposed(),Y.matMul(this,t,e,r)},n.prototype.dot=function(t){return this.throwIfDisposed(),Y.dot(this,t)},n.prototype.norm=function(t,e,r){return t===void 0&&(t="euclidean"),e===void 0&&(e=null),r===void 0&&(r=!1),this.throwIfDisposed(),Y.norm(this,t,e,r)},n.prototype.slice=function(t,e){return this.throwIfDisposed(),Y.slice(this,t,e)},n.prototype.reverse=function(t){return this.throwIfDisposed(),Y.reverse(this,t)},n.prototype.concat=function(t,e){return e===void 0&&(e=0),this.throwIfDisposed(),t instanceof n&&(t=[t]),Y.concat([this].concat(t),e)},n.prototype.split=function(t,e){return e===void 0&&(e=0),this.throwIfDisposed(),Y.split(this,t,e)},n.prototype.stack=function(t,e){return e===void 0&&(e=0),Y.stack([this,t],e)},n.prototype.unstack=function(t){return t===void 0&&(t=0),Y.unstack(this,t)},n.prototype.pad=function(t,e){return e===void 0&&(e=0),Y.pad(this,t,e)},n.prototype.batchNormalization=function(t,e,r,a,o){return r===void 0&&(r=.001),Gd("tf.batchNormalization() is going away. Use tf.batchNorm() instead, and note the positional argument change of scale, offset, and varianceEpsilon"),this.batchNorm(t,e,o,a,r)},n.prototype.batchNorm=function(t,e,r,a,o){return o===void 0&&(o=.001),this.throwIfDisposed(),Y.batchNorm(this,t,e,r,a,o)},n.prototype.all=function(t,e){return t===void 0&&(t=null),e===void 0&&(e=!1),this.throwIfDisposed(),Y.all(this,t,e)},n.prototype.any=function(t,e){return t===void 0&&(t=null),e===void 0&&(e=!1),this.throwIfDisposed(),Y.any(this,t,e)},n.prototype.logSumExp=function(t,e){return t===void 0&&(t=null),e===void 0&&(e=!1),this.throwIfDisposed(),Y.logSumExp(this,t,e)},n.prototype.sum=function(t,e){return t===void 0&&(t=null),e===void 0&&(e=!1),this.throwIfDisposed(),Y.sum(this,t,e)},n.prototype.prod=function(t,e){return t===void 0&&(t=null),e===void 0&&(e=!1),this.throwIfDisposed(),Y.prod(this,t,e)},n.prototype.mean=function(t,e){return t===void 0&&(t=null),e===void 0&&(e=!1),this.throwIfDisposed(),Y.mean(this,t,e)},n.prototype.min=function(t,e){return t===void 0&&(t=null),e===void 0&&(e=!1),this.throwIfDisposed(),Y.min(this,t,e)},n.prototype.max=function(t,e){return t===void 0&&(t=null),e===void 0&&(e=!1),this.throwIfDisposed(),Y.max(this,t,e)},n.prototype.argMin=function(t){return t===void 0&&(t=null),this.throwIfDisposed(),Y.argMin(this,t)},n.prototype.argMax=function(t){return t===void 0&&(t=null),this.throwIfDisposed(),Y.argMax(this,t)},n.prototype.cast=function(t){return this.throwIfDisposed(),Y.cast(this,t)},n.prototype.add=function(t){return this.throwIfDisposed(),Y.add(this,t)},n.prototype.addStrict=function(t){return this.throwIfDisposed(),Y.addStrict(this,t)},n.prototype.atan2=function(t){return this.throwIfDisposed(),Y.atan2(this,t)},n.prototype.sub=function(t){return this.throwIfDisposed(),Y.sub(this,t)},n.prototype.subStrict=function(t){return this.throwIfDisposed(),Y.subStrict(this,t)},n.prototype.pow=function(t){return this.throwIfDisposed(),Y.pow(this,t)},n.prototype.powStrict=function(t){return this.throwIfDisposed(),Y.powStrict(this,t)},n.prototype.mul=function(t){return this.throwIfDisposed(),Y.mul(this,t)},n.prototype.mulStrict=function(t){return this.throwIfDisposed(),Y.mulStrict(this,t)},n.prototype.div=function(t){return this.throwIfDisposed(),Y.div(this,t)},n.prototype.divNoNan=function(t){return this.throwIfDisposed(),Y.divNoNan(this,t)},n.prototype.floorDiv=function(t){return this.throwIfDisposed(),Y.floorDiv(this,t)},n.prototype.divStrict=function(t){return this.throwIfDisposed(),Y.divStrict(this,t)},n.prototype.minimum=function(t){return this.throwIfDisposed(),Y.minimum(this,t)},n.prototype.minimumStrict=function(t){return this.throwIfDisposed(),Y.minimumStrict(this,t)},n.prototype.maximum=function(t){return this.throwIfDisposed(),Y.maximum(this,t)},n.prototype.maximumStrict=function(t){return this.throwIfDisposed(),Y.maximumStrict(this,t)},n.prototype.mod=function(t){return this.throwIfDisposed(),Y.mod(this,t)},n.prototype.modStrict=function(t){return this.throwIfDisposed(),Y.modStrict(this,t)},n.prototype.squaredDifferenceStrict=function(t){return this.throwIfDisposed(),Y.squaredDifferenceStrict(this,t)},n.prototype.transpose=function(t){return this.throwIfDisposed(),Y.transpose(this,t)},n.prototype.notEqual=function(t){return this.throwIfDisposed(),Y.notEqual(this,t)},n.prototype.notEqualStrict=function(t){return this.throwIfDisposed(),Y.notEqualStrict(this,t)},n.prototype.less=function(t){return this.throwIfDisposed(),Y.less(this,t)},n.prototype.lessStrict=function(t){return this.throwIfDisposed(),Y.lessStrict(this,t)},n.prototype.equal=function(t){return this.throwIfDisposed(),Y.equal(this,t)},n.prototype.equalStrict=function(t){return this.throwIfDisposed(),Y.equalStrict(this,t)},n.prototype.lessEqual=function(t){return this.throwIfDisposed(),Y.lessEqual(this,t)},n.prototype.lessEqualStrict=function(t){return this.throwIfDisposed(),Y.lessEqualStrict(this,t)},n.prototype.greater=function(t){return this.throwIfDisposed(),Y.greater(this,t)},n.prototype.greaterStrict=function(t){return this.throwIfDisposed(),Y.greaterStrict(this,t)},n.prototype.greaterEqual=function(t){return this.throwIfDisposed(),Y.greaterEqual(this,t)},n.prototype.greaterEqualStrict=function(t){return this.throwIfDisposed(),Y.greaterEqualStrict(this,t)},n.prototype.logicalAnd=function(t){return this.throwIfDisposed(),Y.logicalAnd(this,t)},n.prototype.logicalOr=function(t){return this.throwIfDisposed(),Y.logicalOr(this,t)},n.prototype.logicalNot=function(){return this.throwIfDisposed(),Y.logicalNot(this)},n.prototype.logicalXor=function(t){return this.throwIfDisposed(),Y.logicalXor(this,t)},n.prototype.where=function(t,e){return this.throwIfDisposed(),Y.where(t,this,e)},n.prototype.neg=function(){return this.throwIfDisposed(),Y.neg(this)},n.prototype.ceil=function(){return this.throwIfDisposed(),Y.ceil(this)},n.prototype.floor=function(){return this.throwIfDisposed(),Y.floor(this)},n.prototype.sign=function(){return this.throwIfDisposed(),Y.sign(this)},n.prototype.isNaN=function(){return this.throwIfDisposed(),Y.isNaN(this)},n.prototype.isInf=function(){return this.throwIfDisposed(),Y.isInf(this)},n.prototype.isFinite=function(){return this.throwIfDisposed(),Y.isFinite(this)},n.prototype.exp=function(){return this.throwIfDisposed(),Y.exp(this)},n.prototype.expm1=function(){return this.throwIfDisposed(),Y.expm1(this)},n.prototype.log=function(){return this.throwIfDisposed(),Y.log(this)},n.prototype.log1p=function(){return this.throwIfDisposed(),Y.log1p(this)},n.prototype.sqrt=function(){return this.throwIfDisposed(),Y.sqrt(this)},n.prototype.rsqrt=function(){return this.throwIfDisposed(),Y.rsqrt(this)},n.prototype.square=function(){return this.throwIfDisposed(),Y.square(this)},n.prototype.reciprocal=function(){return this.throwIfDisposed(),Y.reciprocal(this)},n.prototype.abs=function(){return this.throwIfDisposed(),Y.abs(this)},n.prototype.clipByValue=function(t,e){return this.throwIfDisposed(),Y.clipByValue(this,t,e)},n.prototype.relu=function(){return this.throwIfDisposed(),Y.relu(this)},n.prototype.relu6=function(){return this.throwIfDisposed(),Y.relu6(this)},n.prototype.elu=function(){return this.throwIfDisposed(),Y.elu(this)},n.prototype.selu=function(){return this.throwIfDisposed(),Y.selu(this)},n.prototype.leakyRelu=function(t){return t===void 0&&(t=.2),this.throwIfDisposed(),Y.leakyRelu(this,t)},n.prototype.prelu=function(t){return this.throwIfDisposed(),Y.prelu(this,t)},n.prototype.sigmoid=function(){return this.throwIfDisposed(),Y.sigmoid(this)},n.prototype.logSigmoid=function(){return this.throwIfDisposed(),Y.logSigmoid(this)},n.prototype.softplus=function(){return this.throwIfDisposed(),Y.softplus(this)},n.prototype.zerosLike=function(){return this.throwIfDisposed(),Y.zerosLike(this)},n.prototype.onesLike=function(){return this.throwIfDisposed(),Y.onesLike(this)},n.prototype.sin=function(){return this.throwIfDisposed(),Y.sin(this)},n.prototype.cos=function(){return this.throwIfDisposed(),Y.cos(this)},n.prototype.tan=function(){return this.throwIfDisposed(),Y.tan(this)},n.prototype.asin=function(){return this.throwIfDisposed(),Y.asin(this)},n.prototype.acos=function(){return this.throwIfDisposed(),Y.acos(this)},n.prototype.atan=function(){return this.throwIfDisposed(),Y.atan(this)},n.prototype.sinh=function(){return this.throwIfDisposed(),Y.sinh(this)},n.prototype.cosh=function(){return this.throwIfDisposed(),Y.cosh(this)},n.prototype.tanh=function(){return this.throwIfDisposed(),Y.tanh(this)},n.prototype.asinh=function(){return this.throwIfDisposed(),Y.asinh(this)},n.prototype.acosh=function(){return this.throwIfDisposed(),Y.acosh(this)},n.prototype.atanh=function(){return this.throwIfDisposed(),Y.atanh(this)},n.prototype.erf=function(){return this.throwIfDisposed(),Y.erf(this)},n.prototype.round=function(){return this.throwIfDisposed(),Y.round(this)},n.prototype.step=function(t){return t===void 0&&(t=0),this.throwIfDisposed(),Y.step(this,t)},n.prototype.softmax=function(t){return t===void 0&&(t=-1),this.throwIfDisposed(),Y.softmax(this,t)},n.prototype.logSoftmax=function(t){return t===void 0&&(t=-1),this.throwIfDisposed(),Y.logSoftmax(this,t)},n.prototype.resizeBilinear=function(t,e){return e===void 0&&(e=!1),this.throwIfDisposed(),Y.image.resizeBilinear(this,t,e)},n.prototype.resizeNearestNeighbor=function(t,e){return e===void 0&&(e=!1),this.throwIfDisposed(),Y.image.resizeNearestNeighbor(this,t,e)},n.prototype.conv1d=function(t,e,r,a,o,i){return a===void 0&&(a="NWC"),o===void 0&&(o=1),this.throwIfDisposed(),Y.conv1d(this,t,e,r,a,o,i)},n.prototype.conv2d=function(t,e,r,a,o,i){return a===void 0&&(a="NHWC"),o===void 0&&(o=[1,1]),this.throwIfDisposed(),Y.conv2d(this,t,e,r,a,o,i)},n.prototype.conv2dTranspose=function(t,e,r,a,o){return this.throwIfDisposed(),Y.conv2dTranspose(this,t,e,r,a,o)},n.prototype.depthwiseConv2D=function(t,e,r,a,o,i){return a===void 0&&(a="NHWC"),o===void 0&&(o=[1,1]),this.throwIfDisposed(),Y.depthwiseConv2d(this,t,e,r,a,o,i)},n.prototype.separableConv2d=function(t,e,r,a,o,i){return o===void 0&&(o=[1,1]),i===void 0&&(i="NHWC"),this.throwIfDisposed(),Y.separableConv2d(this,t,e,r,a,o,i)},n.prototype.avgPool=function(t,e,r,a){return this.throwIfDisposed(),Y.avgPool(this,t,e,r,a)},n.prototype.maxPool=function(t,e,r,a){return this.throwIfDisposed(),Y.maxPool(this,t,e,r,a)},n.prototype.localResponseNormalization=function(t,e,r,a){return t===void 0&&(t=5),e===void 0&&(e=1),r===void 0&&(r=1),a===void 0&&(a=.5),Y.localResponseNormalization(this,t,e,r,a)},n.prototype.pool=function(t,e,r,a,o){return this.throwIfDisposed(),Y.pool(this,t,e,r,a,o)},n.prototype.variable=function(t,e,r){return t===void 0&&(t=!0),this.throwIfDisposed(),qn().makeVariable(this,t,e,r)},n.prototype.unsortedSegmentSum=function(t,e){return this.throwIfDisposed(),Y.unsortedSegmentSum(this,t,e)},n.prototype.batchToSpaceND=function(t,e){return this.throwIfDisposed(),Y.batchToSpaceND(this,t,e)},n.prototype.spaceToBatchND=function(t,e){return this.throwIfDisposed(),Y.spaceToBatchND(this,t,e)},n.prototype.topk=function(t,e){return t===void 0&&(t=1),e===void 0&&(e=!0),this.throwIfDisposed(),Y.topk(this,t,e)},n.prototype.stridedSlice=function(t,e,r,a,o,i,s,u){return a===void 0&&(a=0),o===void 0&&(o=0),i===void 0&&(i=0),s===void 0&&(s=0),u===void 0&&(u=0),this.throwIfDisposed(),Y.stridedSlice(this,t,e,r,a,o,i,s,u)},n.prototype.depthToSpace=function(t,e){return this.throwIfDisposed(),Y.depthToSpace(this,t,e)},n.prototype.fft=function(){return this.throwIfDisposed(),Y.spectral.fft(this)},n.prototype.ifft=function(){return this.throwIfDisposed(),Y.spectral.ifft(this)},n.prototype.rfft=function(){return this.throwIfDisposed(),Y.spectral.rfft(this)},n.prototype.irfft=function(){return this.throwIfDisposed(),Y.spectral.irfft(this)},n}();Object.defineProperty(at,Symbol.hasInstance,{value:function(n){return!!n&&n.dataId!=null&&n.shape!=null&&n.dtype!=null}});var pc,tu,nu,ru,au,ka=function(n){function t(e,r,a,o){var i=n.call(this,e.shape,e.dtype,e.dataId,o)||this;return i.trainable=r,i.name=a,i}return On(t,n),t.prototype.assign=function(e){if(e.dtype!==this.dtype)throw new Error("dtype of the new value ("+e.dtype+") and previous value ("+this.dtype+") must match");if(!kt(e.shape,this.shape))throw new Error("shape of the new value ("+e.shape+") and previous value ("+this.shape+") must match");qn().disposeTensor(this),this.dataId=e.dataId,qn().incRef(this,null)},t.prototype.dispose=function(){qn().disposeVariable(this),this.isDisposedInternal=!0},t}(at);Object.defineProperty(ka,Symbol.hasInstance,{value:function(n){return n instanceof at&&n.assign!=null&&n.assign instanceof Function}}),function(n){n.R0="R0",n.R1="R1",n.R2="R2",n.R3="R3",n.R4="R4",n.R5="R5",n.R6="R6"}(pc||(pc={})),function(n){n.float32="float32",n.int32="int32",n.bool="int32",n.complex64="complex64"}(tu||(tu={})),function(n){n.float32="float32",n.int32="int32",n.bool="bool",n.complex64="complex64"}(nu||(nu={})),function(n){n.float32="float32",n.int32="float32",n.bool="float32",n.complex64="complex64"}(ru||(ru={})),function(n){n.float32="complex64",n.int32="complex64",n.bool="complex64",n.complex64="complex64"}(au||(au={}));var Ty={float32:ru,int32:tu,bool:nu,complex64:au};function Pt(n,t){if(n==="string"||t==="string"){if(n==="string"&&t==="string")return"string";throw new Error("Can not upcast "+n+" with "+t)}return Ty[n][t]}function bs(n){return Pt(n,"int32")}function st(n,t){if(n.dtype===t.dtype)return[n,t];var e=Pt(n.dtype,t.dtype);return[n.cast(e),t.cast(e)]}function Ny(n,t){V(n.dtype===t.dtype,function(){return"The dtypes of the first("+n.dtype+") and second("+t.dtype+") input must match"})}function jd(n){var t=[];return function e(r,a,o){if(r!=null){if(r instanceof at)return void a.push(r);if(i=r,!(!Array.isArray(i)&&typeof i!="object")){var i,s=r;for(var u in s){var l=s[u];o.has(l)||(o.add(l),e(l,a,o))}}}}(n,t,new Set),t}var _s,fc=function(){function n(){this.registeredVariables={},this.nextTapeNodeId=0,this.numBytes=0,this.numTensors=0,this.numStringTensors=0,this.numDataBuffers=0,this.gradientDepth=0,this.kernelDepth=0,this.scopeStack=[],this.numDataMovesStack=[],this.nextScopeId=0,this.tensorInfo=new WeakMap,this.profiling=!1,this.activeProfile={newBytes:0,newTensors:0,peakBytes:0,kernels:[],result:null}}return n.prototype.dispose=function(){for(var t in this.registeredVariables)this.registeredVariables[t].dispose()},n}(),Ry=function(){function n(t){this.ENV=t,this.registry={},this.registryFactory={},this.pendingBackendInitId=0,this.state=new fc}return n.prototype.ready=function(){return he(this,void 0,void 0,function(){var t,e,r;return ve(this,function(a){switch(a.label){case 0:if(this.pendingBackendInit!=null)return[2,this.pendingBackendInit.then(function(){})];if(this.backendInstance!=null)return[2];t=this.getSortedBackends(),e=0,a.label=1;case 1:return e<t.length?(r=t[e],[4,this.initializeBackend(r).success]):[3,5];case 2:return a.sent()?[4,this.setBackend(r)]:[3,4];case 3:return a.sent(),[2];case 4:return e++,[3,1];case 5:throw new Error("Could not initialize any backends, all backend initializations failed.")}})})},Object.defineProperty(n.prototype,"backend",{get:function(){if(this.pendingBackendInit!=null)throw new Error("Backend '"+this.backendName+"' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods");if(this.backendInstance==null){var t=this.initializeBackendsAndReturnBest(),e=t.name;if(t.asyncInit)throw new Error("The highest priority backend '"+e+"' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods");this.setBackend(e)}return this.backendInstance},enumerable:!0,configurable:!0}),n.prototype.backendNames=function(){return Object.keys(this.registryFactory)},n.prototype.findBackend=function(t){return!(t in this.registry)&&(!(t in this.registryFactory)||this.initializeBackend(t).asyncInit)?null:this.registry[t]},n.prototype.findBackendFactory=function(t){return t in this.registryFactory?this.registryFactory[t].factory:null},n.prototype.registerBackend=function(t,e,r){return r===void 0&&(r=1),t in this.registryFactory?(console.warn(t+" backend was already registered. Reusing existing backend factory."),!1):(this.registryFactory[t]={factory:e,priority:r},!0)},n.prototype.setBackend=function(t){return he(this,void 0,void 0,function(){var e,r,a;return ve(this,function(o){switch(o.label){case 0:if(this.registryFactory[t]==null)throw new Error("Backend name '"+t+"' not found in registry");return this.backendName=t,this.registry[t]!=null?[3,4]:(this.backendInstance=null,e=this.initializeBackend(t),r=e.success,e.asyncInit?[4,r]:[3,2]);case 1:return a=o.sent(),[3,3];case 2:a=r,o.label=3;case 3:if(!a)return[2,!1];o.label=4;case 4:return this.backendInstance=this.registry[t],this.setupRegisteredKernels(),this.profiler=new Iy(this.backendInstance),[2,!0]}})})},n.prototype.setupRegisteredKernels=function(){var t=this;sc(this.backendName).forEach(function(e){e.setupFunc!=null&&e.setupFunc(t.backendInstance)})},n.prototype.disposeRegisteredKernels=function(t){var e=this;sc(t).forEach(function(r){r.disposeFunc!=null&&r.disposeFunc(e.registry[t])})},n.prototype.initializeBackend=function(t){var e=this,r=this.registryFactory[t];if(r==null)throw new Error("Cannot initialize backend "+t+", no registration found.");try{var a=r.factory();if(Promise.resolve(a)===a){var o=++this.pendingBackendInitId,i=a.then(function(s){return!(o<e.pendingBackendInitId)&&(e.registry[t]=s,e.pendingBackendInit=null,!0)}).catch(function(s){return!(o<e.pendingBackendInitId)&&(e.pendingBackendInit=null,console.warn("Initialization of backend "+t+" failed"),console.warn(s.stack||s.message),!1)});return this.pendingBackendInit=i,{success:i,asyncInit:!0}}return this.registry[t]=a,{success:!0,asyncInit:!1}}catch(s){return console.warn("Initialization of backend "+t+" failed"),console.warn(s.stack||s.message),{success:!1,asyncInit:!1}}},n.prototype.removeBackend=function(t){if(!(t in this.registryFactory))throw new Error(t+" backend not found in registry");this.backendName===t&&this.pendingBackendInit!=null&&this.pendingBackendInitId++,t in this.registry&&(this.disposeRegisteredKernels(t),this.registry[t].dispose(),delete this.registry[t]),delete this.registryFactory[t],this.backendName===t&&(this.pendingBackendInit=null,this.backendName=null,this.backendInstance=null)},n.prototype.getSortedBackends=function(){var t=this;if(Object.keys(this.registryFactory).length===0)throw new Error("No backend found in registry.");return Object.keys(this.registryFactory).sort(function(e,r){return t.registryFactory[r].priority-t.registryFactory[e].priority})},n.prototype.initializeBackendsAndReturnBest=function(){for(var t=this.getSortedBackends(),e=0;e<t.length;e++){var r=t[e],a=this.initializeBackend(r),o=a.success,i=a.asyncInit;if(i||o)return{name:r,asyncInit:i}}throw new Error("Could not initialize any backends, all backend initializations failed.")},n.prototype.moveData=function(t,e){var r=this.state.tensorInfo.get(e),a=r.backend,o=this.readSync(e);a.disposeData(e),r.backend=t,t.move(e,o,r.shape,r.dtype),this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack[this.state.numDataMovesStack.length-1]++},n.prototype.tidy=function(t,e){var r,a=this,o=null;if(e==null){if(typeof t!="function")throw new Error("Please provide a function to tidy()");e=t}else{if(typeof t!="string"&&!(t instanceof String))throw new Error("When calling with two arguments, the first argument to tidy() must be a string");if(typeof e!="function")throw new Error("When calling with two arguments, the 2nd argument to tidy() must be a function");o=t}return this.scopedRun(function(){return a.startScope(o)},function(){return a.endScope(r)},function(){return(r=e())instanceof Promise&&console.error("Cannot return a Promise inside of tidy."),r})},n.prototype.scopedRun=function(t,e,r){t();try{var a=r();return e(),a}catch(o){throw e(),o}},n.prototype.nextTensorId=function(){return n.nextTensorId++},n.prototype.nextVariableId=function(){return n.nextVariableId++},n.prototype.clone=function(t){var e=this.makeTensorFromDataId(t.dataId,t.shape,t.dtype),r={x:t};return this.addTapeNode(this.state.activeScope.name,r,[e],function(a){return{x:function(){return a.toFloat()}}},[]),e},n.prototype.runKernel=function(t,e,r,a,o){return this.runKernelFunc(null,e,null,t,r,a,o)},n.prototype.shouldCheckForMemLeaks=function(){return this.ENV.getBool("IS_TEST")},n.prototype.checkKernelForMemLeak=function(t,e,r){var a=this.backend.numDataIds(),o=0;r.forEach(function(u){o+=u.dtype==="complex64"?3:1});var i=this.state.numDataMovesStack[this.state.numDataMovesStack.length-1],s=a-e-o-i;if(s>0)throw new Error("Backend '"+this.backendName+"' has an internal memory leak ("+s+" data ids) after running '"+t+"'")},n.prototype.runKernelFunc=function(t,e,r,a,o,i,s){var u,l=this;i===void 0&&(i=[]),s===void 0&&(s=[]);var c=[],p=this.isTapeOn();a==null&&(a=this.state.activeScope!=null?this.state.activeScope.name:"");var f,d=function(x){p&&(c=x.map(function(y){return l.keep(l.clone(y))}))},h=this.state.numBytes,v=this.state.numTensors;this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack.push(0);var g,m=Vd(a,this.backendName);return f=m!=null?function(){var x=l.backend.numDataIds();g=m.kernelFunc({inputs:e,attrs:o,backend:l.backend});var y=Array.isArray(g)?g:[g];l.shouldCheckForMemLeaks()&&l.checkKernelForMemLeak(a,x,y);var w=y.map(function(D){var k=D.dataId,S=D.shape,_=D.dtype;return l.makeTensorFromDataId(k,S,_)}),E=w.filter(function(D,k){return s[k]});return d((i||[]).slice().concat(E)),w}:function(){var x=l.backend.numDataIds();g=l.tidy(function(){return t(l.backend,d)});var y=Array.isArray(g)?g:[g];return l.shouldCheckForMemLeaks()&&l.checkKernelForMemLeak(a,x,y),y},this.scopedRun(function(){return l.state.kernelDepth++},function(){return l.state.kernelDepth--},function(){u=l.ENV.getBool("DEBUG")?l.profiler.profileKernel(a,e,function(){return f()}):f()}),p&&this.addTapeNode(a,e,u,r,c),this.state.profiling&&this.state.activeProfile.kernels.push({name:a,bytesAdded:this.state.numBytes-h,totalBytesSnapshot:this.state.numBytes,tensorsAdded:this.state.numTensors-v,totalTensorsSnapshot:this.state.numTensors,inputShapes:Object.keys(e).map(function(x){return e[x].shape}),outputShapes:u.map(function(x){return x.shape})}),Array.isArray(g)?u:u[0]},n.prototype.makeTensor=function(t,e,r,a){if(t==null)throw new Error("Values passed to engine.makeTensor() are null");r=r||"float32",a=a||this.backend;var o=t;r==="string"&&Du(t[0])&&(o=t.map(function(c){return Sy(c)}));var i=a.write(o,e,r),s=new at(e,r,i,this.nextTensorId());if(this.incRef(s,a),r==="string"){var u=this.state.tensorInfo.get(i),l=_y(o);this.state.numBytes+=l-u.bytes,u.bytes=l}return s},n.prototype.makeTensorFromDataId=function(t,e,r,a){var o=new at(e,r=r||"float32",t,this.nextTensorId());return this.incRef(o,a),o},n.prototype.makeVariable=function(t,e,r,a){e===void 0&&(e=!0),r=r||this.nextVariableId().toString(),a!=null&&a!==t.dtype&&(t=t.asType(a));var o=new ka(t,e,r,this.nextTensorId());if(this.state.registeredVariables[o.name]!=null)throw new Error("Variable with name "+o.name+" was already registered");return this.state.registeredVariables[o.name]=o,this.incRef(o,this.backend),o},n.prototype.incRef=function(t,e){var r=this.state.tensorInfo.has(t.dataId)?this.state.tensorInfo.get(t.dataId).refCount:0;if(this.state.numTensors++,t.dtype==="string"&&this.state.numStringTensors++,r===0){this.state.numDataBuffers++;var a=0;t.dtype!=="complex64"&&t.dtype!=="string"&&(a=t.size*Wd(t.dtype)),this.state.tensorInfo.set(t.dataId,{backend:e||this.backend,dtype:t.dtype,shape:t.shape,bytes:a,refCount:0}),this.state.numBytes+=a}this.state.tensorInfo.get(t.dataId).refCount++,t instanceof ka||this.track(t)},n.prototype.disposeTensor=function(t){if(this.state.tensorInfo.has(t.dataId)){this.state.numTensors--,t.dtype==="string"&&this.state.numStringTensors--;var e=this.state.tensorInfo.get(t.dataId);e.refCount<=1?(t.dtype!=="complex64"&&(this.state.numBytes-=e.bytes),this.state.numDataBuffers--,e.backend.disposeData(t.dataId),this.state.tensorInfo.delete(t.dataId)):this.state.tensorInfo.get(t.dataId).refCount--}},n.prototype.disposeVariables=function(){for(var t in this.state.registeredVariables){var e=this.state.registeredVariables[t];this.disposeVariable(e)}},n.prototype.disposeVariable=function(t){this.disposeTensor(t),this.state.registeredVariables[t.name]!=null&&delete this.state.registeredVariables[t.name]},n.prototype.memory=function(){var t=this.backend.memory();return t.numTensors=this.state.numTensors,t.numDataBuffers=this.state.numDataBuffers,t.numBytes=this.state.numBytes,this.state.numStringTensors>0&&(t.unreliable=!0,t.reasons==null&&(t.reasons=[]),t.reasons.push("Memory usage by string tensors is approximate (2 bytes per character)")),t},n.prototype.profile=function(t){return he(this,void 0,void 0,function(){var e,r;return ve(this,function(a){return this.state.profiling=!0,e=this.state.numBytes,r=this.state.numTensors,this.state.activeProfile.kernels=[],this.state.activeProfile.result=t(),this.state.profiling=!1,this.state.activeProfile.peakBytes=Math.max.apply(Math,this.state.activeProfile.kernels.map(function(o){return o.totalBytesSnapshot})),this.state.activeProfile.newBytes=this.state.numBytes-e,this.state.activeProfile.newTensors=this.state.numTensors-r,[2,this.state.activeProfile]})})},n.prototype.isTapeOn=function(){return this.state.gradientDepth>0&&this.state.kernelDepth===0},n.prototype.addTapeNode=function(t,e,r,a,o){var i=this,s={id:this.state.nextTapeNodeId++,kernelName:t,inputs:e,outputs:r,saved:o},u=fy(t);u!=null&&(a=u.gradFunc),a!=null&&(s.gradient=function(l){return l=l.map(function(c,p){if(c==null){var f=r[p],d=bo(f.size,f.dtype);return i.makeTensor(d,f.shape,f.dtype)}return c}),a(l.length>1?l:l[0],o)}),this.state.activeTape.push(s)},n.prototype.keep=function(t){return t.kept=!0,t},n.prototype.startTape=function(){this.state.gradientDepth===0&&(this.state.activeTape=[]),this.state.gradientDepth++},n.prototype.endTape=function(){this.state.gradientDepth--},n.prototype.startScope=function(t){var e={track:[],name:"unnamed scope",id:this.state.nextScopeId++};t&&(e.name=t),this.state.scopeStack.push(e),this.state.activeScope=e},n.prototype.endScope=function(t){for(var e=this,r=jd(t),a=new Set(r.map(function(u){return u.id})),o=0;o<this.state.activeScope.track.length;o++){var i=this.state.activeScope.track[o];i.kept||a.has(i.id)||i.dispose()}var s=this.state.scopeStack.pop();this.state.activeScope=this.state.scopeStack.length===0?null:this.state.scopeStack[this.state.scopeStack.length-1],r.forEach(function(u){u.kept||u.scopeId!==s.id||e.track(u)})},n.prototype.gradients=function(t,e,r,a){var o=this;if(a===void 0&&(a=!1),V(e.length>0,function(){return"gradients() received an empty list of xs."}),r!=null&&r.dtype!=="float32")throw new Error("dy must have 'float32' dtype, but has '"+r.dtype+"'");var i=this.scopedRun(function(){return o.startTape()},function(){return o.endTape()},function(){return o.tidy("forward",t)});V(i instanceof at,function(){return"The result y returned by f() must be a tensor."});var s=function(u,l,c){for(var p={},f={},d=0;d<l.length;d++)p[l[d].id]=!0;for(d=0;d<u.length;d++){var h=(D=u[d]).inputs;for(var v in h){for(var g=h[v],m=!1,x=0;x<l.length;x++)if(p[g.id]){D.outputs.forEach(function(b){return p[b.id]=!0}),m=!0,f[D.id]=!0;break}if(m)break}}var y={};y[c.id]=!0;var w={};for(d=u.length-1;d>=0;d--)for(h=(D=u[d]).inputs,x=0;x<D.outputs.length;x++)if(y[D.outputs[x].id]){for(var v in h)y[h[v].id]=!0,w[D.id]=!0;break}var E=[];for(d=0;d<u.length;d++){var D;if(f[(D=u[d]).id]&&w[D.id]){var k={};for(var v in D.inputs){var S=D.inputs[v];p[S.id]&&(k[v]=S)}var _=Object.assign({},D);_.inputs=k,_.outputs=D.outputs,E.push(_)}}return E}(this.state.activeTape,e,i);if(!a&&s.length===0&&e.length>0)throw new Error("Cannot compute gradient of y=f(x) with respect to x. Make sure that the f you passed encloses all operations that lead from x to y.");return this.tidy("backward",function(){var u,l,c={};c[i.id]=r??(u=i.shape,l=zd(ge(u),"float32"),W.makeTensor(l,u,"float32")),function(f,d,h){for(var v=function(m){var x=d[m],y=[];if(x.outputs.forEach(function(k){var S=f[k.id];S!=null?y.push(S):y.push(null)}),x.gradient==null)throw new Error("Cannot compute gradient: gradient function not found for "+x.kernelName+".");var w=x.gradient(y),E=function(k){if(!(k in w))throw new Error("Cannot backprop through input "+k+". Available gradients found: "+Object.keys(w)+".");var S=h(function(){return w[k]()});if(S.dtype!=="float32")throw new Error("Error in gradient for op "+x.kernelName+". The gradient of input "+k+" must have 'float32' dtype, but has '"+S.dtype+"'");var _=x.inputs[k];if(!kt(S.shape,_.shape))throw new Error("Error in gradient for op "+x.kernelName+". The gradient of input '"+k+"' has shape '"+S.shape+"', which does not match the shape of the input '"+_.shape+"'");if(f[_.id]==null)f[_.id]=S;else{var b=f[_.id];f[_.id]=b.add(S),b.dispose()}};for(var D in x.inputs)E(D)},g=d.length-1;g>=0;g--)v(g)}(c,s,function(f){return o.tidy(f)});var p=e.map(function(f){return c[f.id]});return o.state.gradientDepth===0&&(o.state.activeTape.forEach(function(f){for(var d=0,h=f.saved;d<h.length;d++)h[d].dispose()}),o.state.activeTape=null),{value:i,grads:p}})},n.prototype.customGrad=function(t){var e=this;return V(Zs(t),function(){return"The f passed in customGrad(f) must be a function."}),function(){for(var r,a=[],o=0;o<arguments.length;o++)a[o]=arguments[o];V(a.every(function(s){return s instanceof at}),function(){return"The args passed in customGrad(f)(x1, x2,...) must all be tensors"});var i={};return a.forEach(function(s,u){i[u]=s}),e.runKernelFunc(function(s,u){return V((r=t.apply(void 0,a.concat([u]))).value instanceof at,function(){return"The function f passed in customGrad(f) must return an object where `obj.value` is a tensor"}),V(Zs(r.gradFunc),function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function."}),r.value},i,function(s,u){var l=r.gradFunc(s,u),c=Array.isArray(l)?l:[l];V(c.length===a.length,function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns the same number of tensors as inputs passed to f(...)."}),V(c.every(function(f){return f instanceof at}),function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns a list of only tensors."});var p={};return c.forEach(function(f,d){p[d]=function(){return f}}),p})}},n.prototype.readSync=function(t){return this.state.tensorInfo.get(t).backend.readSync(t)},n.prototype.read=function(t){return this.state.tensorInfo.get(t).backend.read(t)},n.prototype.time=function(t){return he(this,void 0,void 0,function(){var e,r;return ve(this,function(a){switch(a.label){case 0:return e=Wn(),[4,this.backend.time(t)];case 1:return(r=a.sent()).wallMs=Wn()-e,[2,r]}})})},n.prototype.track=function(t){return this.state.activeScope!=null&&(t.scopeId=this.state.activeScope.id,this.state.activeScope.track.push(t)),t},Object.defineProperty(n.prototype,"registeredVariables",{get:function(){return this.state.registeredVariables},enumerable:!0,configurable:!0}),n.prototype.reset=function(){for(var t in this.pendingBackendInitId++,this.state.dispose(),this.ENV.reset(),this.state=new fc,this.registry)this.disposeRegisteredKernels(t),this.registry[t].dispose(),delete this.registry[t];this.backendName=null,this.backendInstance=null,this.pendingBackendInit=null},n.nextTensorId=0,n.nextVariableId=0,n}(),W=function(){var n=function(){if(_s==null){var e=void 0;if(typeof window<"u")e=window;else if(typeof global<"u")e=global;else if(typeof process<"u")e=process;else{if(typeof self>"u")throw new Error("Could not find a global object");e=self}_s=e}return _s}();if(n._tfengine==null){var t=new dy(n);n._tfengine=new Ry(t)}return function(e){Fd=e}(n._tfengine.ENV),qn=function(){return n._tfengine},n._tfengine}();function Xd(){return typeof window<"u"&&window.document!=null||typeof WorkerGlobalScope<"u"}var tr=J();tr.registerFlag("DEBUG",function(){return!1},function(n){n&&console.warn("Debugging mode is ON. The output of every math call will be downloaded to CPU and checked for NaNs. This significantly impacts performance.")}),tr.registerFlag("IS_BROWSER",function(){return Xd()}),tr.registerFlag("IS_NODE",function(){return typeof process<"u"&&process.versions!==void 0&&process.versions.node!==void 0}),tr.registerFlag("IS_CHROME",function(){return typeof navigator<"u"&&navigator!=null&&navigator.userAgent!=null&&/Chrome/.test(navigator.userAgent)&&/Google Inc/.test(navigator.vendor)}),tr.registerFlag("PROD",function(){return!1}),tr.registerFlag("TENSORLIKE_CHECK_SHAPE_CONSISTENCY",function(){return tr.getBool("DEBUG")}),tr.registerFlag("DEPRECATION_WARNINGS_ENABLED",function(){return!0}),tr.registerFlag("IS_TEST",function(){return!1});var io,dn,cn,qr={},ws={alpha:!1,antialias:!1,premultipliedAlpha:!1,preserveDrawingBuffer:!1,depth:!1,stencil:!1,failIfMajorPerformanceCaveat:!0};function Ay(n,t){qr[n]=t}function Jn(n){n in qr||(qr[n]=function(e){if(e!==1&&e!==2)throw new Error("Cannot get WebGL rendering context, WebGL is disabled.");var r=function(a){if(typeof OffscreenCanvas<"u"&&a===2)return new OffscreenCanvas(300,150);if(typeof document<"u")return document.createElement("canvas");throw new Error("Cannot create a canvas in this context")}(e);return r.addEventListener("webglcontextlost",function(a){a.preventDefault(),delete qr[e]},!1),e===1?r.getContext("webgl",ws)||r.getContext("experimental-webgl",ws):r.getContext("webgl2",ws)}(n));var t=qr[n];return t.isContextLost()?(delete qr[n],Jn(n)):(t.disable(t.DEPTH_TEST),t.disable(t.STENCIL_TEST),t.disable(t.BLEND),t.disable(t.DITHER),t.disable(t.POLYGON_OFFSET_FILL),t.disable(t.SAMPLE_COVERAGE),t.enable(t.SCISSOR_TEST),t.enable(t.CULL_FACE),t.cullFace(t.BACK),qr[n])}function Bi(n,t){return[t,n]}function eo(n){var t=ge(n);return Qs(Math.ceil(t/4))}function _o(n,t){return[Math.max(1,Math.ceil(t/2)),Math.max(1,Math.ceil(n/2))]}function ku(n,t){var e,r,a,o,i,s,u,l,c,p=n;return J().getNumber("WEBGL_VERSION")===2?(e=p.R32F,r=p.R16F,a=p.RGBA16F,o=p.RGBA32F,i=p.RED,s=4,u=1,l=p.HALF_FLOAT,c=p.FLOAT):(e=n.RGBA,r=n.RGBA,a=n.RGBA,o=p.RGBA,i=n.RGBA,s=4,u=4,l=t!=null?t.HALF_FLOAT_OES:null,c=n.FLOAT),{internalFormatFloat:e,internalFormatHalfFloat:r,internalFormatPackedHalfFloat:a,internalFormatPackedFloat:o,textureFormatFloat:i,downloadTextureFormat:n.RGBA,downloadUnpackNumChannels:s,defaultNumChannels:u,textureTypeHalfFloat:l,textureTypeFloat:c}}function ye(n,t,e){var r=e();return t&&function(a){var o=a.getError();if(o!==a.NO_ERROR)throw new Error("WebGL Error: "+Fy(a,o))}(n),r}(function(n){n[n.DENSE=0]="DENSE",n[n.SHARED_BATCH=1]="SHARED_BATCH"})(io||(io={})),function(n){n[n.RENDER=0]="RENDER",n[n.UPLOAD=1]="UPLOAD",n[n.PIXELS=2]="PIXELS",n[n.DOWNLOAD=3]="DOWNLOAD"}(dn||(dn={})),function(n){n[n.UNPACKED_FLOAT16=0]="UNPACKED_FLOAT16",n[n.UNPACKED_FLOAT32=1]="UNPACKED_FLOAT32",n[n.PACKED_4X1_UNSIGNED_BYTE=2]="PACKED_4X1_UNSIGNED_BYTE",n[n.PACKED_2X2_FLOAT32=3]="PACKED_2X2_FLOAT32",n[n.PACKED_2X2_FLOAT16=4]="PACKED_2X2_FLOAT16"}(cn||(cn={}));var Py=596e-10,Oy=65504;function My(n){return!!(J().getBool("WEBGL_RENDER_FLOAT32_ENABLED")||n===0||Py<Math.abs(n)&&Math.abs(n)<Oy)}function Fy(n,t){switch(t){case n.NO_ERROR:return"NO_ERROR";case n.INVALID_ENUM:return"INVALID_ENUM";case n.INVALID_VALUE:return"INVALID_VALUE";case n.INVALID_OPERATION:return"INVALID_OPERATION";case n.INVALID_FRAMEBUFFER_OPERATION:return"INVALID_FRAMEBUFFER_OPERATION";case n.OUT_OF_MEMORY:return"OUT_OF_MEMORY";case n.CONTEXT_LOST_WEBGL:return"CONTEXT_LOST_WEBGL";default:return"Unknown error code "+t}}function Fo(n,t,e){return pr(n,t,function(){return n.getExtension(e)},'Extension "'+e+'" not supported on this browser.')}function Vy(n,t,e){var r=pr(n,t,function(){return n.createShader(n.VERTEX_SHADER)},"Unable to create vertex WebGLShader.");if(ye(n,t,function(){return n.shaderSource(r,e)}),ye(n,t,function(){return n.compileShader(r)}),n.getShaderParameter(r,n.COMPILE_STATUS)===!1)throw console.log(n.getShaderInfoLog(r)),new Error("Failed to compile vertex shader.");return r}function Ly(n,t,e){var r=pr(n,t,function(){return n.createShader(n.FRAGMENT_SHADER)},"Unable to create fragment WebGLShader.");if(ye(n,t,function(){return n.shaderSource(r,e)}),ye(n,t,function(){return n.compileShader(r)}),n.getShaderParameter(r,n.COMPILE_STATUS)===!1)throw function(a,o){var i=By.exec(o);if(i==null)return console.log("Couldn't parse line number in error: "+o),void console.log(a);for(var s=+i[1],u=a.split(`
`),l=u.length.toString().length+2,c=u.map(function(g,m){return ya((m+1).toString(),l)+g}),p=0,f=0;f<c.length;f++)p=Math.max(c[f].length,p);var d=c.slice(0,s-1),h=c.slice(s-1,s),v=c.slice(s);console.log(d.join(`
`)),console.log(o.split(`
`)[0]),console.log("%c "+ya(h[0],p),"border:1px solid red; background-color:#e3d2d2; color:#a61717"),console.log(v.join(`
`))}(e,n.getShaderInfoLog(r)),new Error("Failed to compile fragment shader.");return r}var Es,Ss,By=/ERROR: [0-9]+:([0-9]+):/g;function Uy(n,t){return pr(n,t,function(){return n.createProgram()},"Unable to create WebGLProgram.")}function Wy(n,t,e){if(ye(n,t,function(){return n.linkProgram(e)}),n.getProgramParameter(e,n.LINK_STATUS)===!1)throw console.log(n.getProgramInfoLog(e)),new Error("Failed to link vertex and fragment shaders.")}function Cs(n,t,e){if(ye(n,t,function(){return n.validateProgram(e)}),n.getProgramParameter(e,n.VALIDATE_STATUS)===!1)throw console.log(n.getProgramInfoLog(e)),new Error("Shader program validation failed.")}function qy(n,t,e){var r=pr(n,t,function(){return n.createBuffer()},"Unable to create WebGLBuffer");return ye(n,t,function(){return n.bindBuffer(n.ARRAY_BUFFER,r)}),ye(n,t,function(){return n.bufferData(n.ARRAY_BUFFER,e,n.STATIC_DRAW)}),r}function zy(n,t,e){var r=pr(n,t,function(){return n.createBuffer()},"Unable to create WebGLBuffer");return ye(n,t,function(){return n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,r)}),ye(n,t,function(){return n.bufferData(n.ELEMENT_ARRAY_BUFFER,e,n.STATIC_DRAW)}),r}function $y(n,t){return pr(n,t,function(){return n.createTexture()},"Unable to create WebGLTexture.")}function Hy(n,t){var e=J().getNumber("WEBGL_MAX_TEXTURE_SIZE");if(n<=0||t<=0){var r="["+n+"x"+t+"]";throw new Error("Requested texture size "+r+" is invalid.")}if(n>e||t>e)throw r="["+n+"x"+t+"]",new Error("Requested texture size "+r+" greater than WebGL maximum on this browser / GPU "+("["+e+"x"+e+"]")+".")}function Gy(n,t){return pr(n,t,function(){return n.createFramebuffer()},"Unable to create WebGLFramebuffer.")}function hc(n,t,e,r,a,o,i,s){var u=n.getAttribLocation(e,r);return u!==-1&&(ye(n,t,function(){return n.bindBuffer(n.ARRAY_BUFFER,a)}),ye(n,t,function(){return n.vertexAttribPointer(u,o,n.FLOAT,!1,i,s)}),ye(n,t,function(){return n.enableVertexAttribArray(u)}),!0)}function jy(n,t,e,r){Qy(n,r),ye(n,t,function(){return n.activeTexture(n.TEXTURE0+r)}),ye(n,t,function(){return n.bindTexture(n.TEXTURE_2D,e)})}function Xy(n,t,e,r){return pr(n,t,function(){return n.getUniformLocation(e,r)},'uniform "'+r+'" not present in program.')}function Yy(n,t,e){return n.getUniformLocation(t,e)}function Ky(n,t,e,r,a,o){ye(n,t,function(){return jy(n,t,r,o)}),ye(n,t,function(){return n.uniform1i(a,o)})}function Is(n,t,e,r){ye(n,t,function(){return n.bindFramebuffer(n.FRAMEBUFFER,r)}),ye(n,t,function(){return n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,e,0)})}function vc(n,t,e){ye(n,t,function(){return n.bindFramebuffer(n.FRAMEBUFFER,e)}),ye(n,t,function(){return n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,null,0)})}function Vo(n){var t=n.checkFramebufferStatus(n.FRAMEBUFFER);if(t!==n.FRAMEBUFFER_COMPLETE)throw new Error("Error binding framebuffer: "+Jy(n,t))}function Jy(n,t){switch(t){case n.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_ATTACHMENT";case n.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT";case n.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:return"FRAMEBUFFER_INCOMPLETE_DIMENSIONS";case n.FRAMEBUFFER_UNSUPPORTED:return"FRAMEBUFFER_UNSUPPORTED";default:return"unknown error "+t}}function pr(n,t,e,r){var a=ye(n,t,function(){return e()});if(a==null)throw new Error(r);return a}function Qy(n,t){var e=n.MAX_COMBINED_TEXTURE_IMAGE_UNITS-1,r=t+n.TEXTURE0;if(r<n.TEXTURE0||r>e)throw new Error("textureUnit must be in "+("[gl.TEXTURE0, gl.TEXTURE"+e+"]")+".")}function ci(n,t){return t===void 0&&(t=2),ge(n.slice(0,n.length-t))}function di(n){if(n.length===0)throw Error("Cannot get rows and columns of an empty shape array.");return[n.length>1?n[n.length-2]:1,n[n.length-1]]}function Ds(n){var t=[1,1,1];return n.length===0||n.length===1&&n[0]===1||(t=[ci(n)].concat(di(n))),t}function Zy(n,t){var e;t===void 0&&(t=!1);var r=J().getNumber("WEBGL_MAX_TEXTURE_SIZE");if(t&&(r*=2,(n=n.map(function(l,c){return c>=n.length-2?Ud(n[c]):n[c]})).length===1&&(n=[2,n[0]])),n.length!==2){var a=Hr(n);n=a.newShape}var o=ge(n);if(n.length<=1&&o<=r)return[1,o];if(n.length===2&&n[0]<=r&&n[1]<=r)return n;if(n.length===3&&n[0]*n[1]<=r&&n[2]<=r)return[n[0]*n[1],n[2]];if(n.length===3&&n[0]<=r&&n[1]*n[2]<=r)return[n[0],n[1]*n[2]];if(n.length===4&&n[0]*n[1]*n[2]<=r&&n[3]<=r)return[n[0]*n[1]*n[2],n[3]];if(n.length===4&&n[0]<=r&&n[1]*n[2]*n[3]<=r)return[n[0],n[1]*n[2]*n[3]];if(t){var i=ci(n),s=2,u=2;return n.length&&(s=(e=di(n))[0],u=e[1]),Qs(o=i*(s/2)*(u/2)).map(function(l){return 2*l})}return Qs(o)}function Lo(n){return n%2==0}function Bo(n,t){if(kt(n=n.slice(-2),t=t.slice(-2))||!n.length||!t.length||n[0]===0||n[1]===0||t[0]===0||t[1]===0)return!0;if(n.length!==t.length){var e=n.slice(-1)[0],r=t.slice(-1)[0];if(e===r||Lo(e)&&Lo(r)&&(n[0]===1||t[0]===1))return!0}return n[1]===t[1]&&Lo(n[0])&&Lo(t[0])}function ex(n){if(Es==null){var t=Jn(n);Es=t.getParameter(t.MAX_TEXTURE_SIZE)}return Es}function tx(n){if(Ss==null){var t=Jn(n);Ss=t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS)}return Math.min(16,Ss)}function nx(n){if(n===0)return 0;var t=Jn(n);return wn(t,"EXT_disjoint_timer_query_webgl2")&&n===2?2:wn(t,"EXT_disjoint_timer_query")?1:0}function wn(n,t){return n.getExtension(t)!=null}function mc(n){try{if(Jn(n)!=null)return!0}catch{return!1}return!1}function rx(n){if(n===0)return!1;var t=Jn(n);if(n===1){if(!wn(t,"OES_texture_float"))return!1}else if(!wn(t,"EXT_color_buffer_float"))return!1;return ou(t)}function ax(n){if(n===0)return!1;var t=Jn(n);if(n!==1){if(wn(t,"EXT_color_buffer_float"))return ou(t);if(wn(t,"EXT_color_buffer_half_float")){var e=t.getExtension("EXT_color_buffer_half_float");return function(r,a){var o=ku(r,a),i=r.createTexture();r.bindTexture(r.TEXTURE_2D,i),r.texImage2D(r.TEXTURE_2D,0,o.internalFormatHalfFloat,1,1,0,o.textureFormatFloat,o.textureTypeHalfFloat,null);var s=r.createFramebuffer();r.bindFramebuffer(r.FRAMEBUFFER,s),r.framebufferTexture2D(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.TEXTURE_2D,i,0);var u=r.checkFramebufferStatus(r.FRAMEBUFFER)===r.FRAMEBUFFER_COMPLETE;return r.bindTexture(r.TEXTURE_2D,null),r.bindFramebuffer(r.FRAMEBUFFER,null),r.deleteTexture(i),r.deleteFramebuffer(s),u}(t,e)}return!1}return!!wn(t,"OES_texture_float")&&!!wn(t,"WEBGL_color_buffer_float")&&ou(t)}function ou(n){var t=ku(n),e=n.createTexture();n.bindTexture(n.TEXTURE_2D,e),n.texImage2D(n.TEXTURE_2D,0,t.internalFormatFloat,1,1,0,t.textureFormatFloat,t.textureTypeFloat,null);var r=n.createFramebuffer();n.bindFramebuffer(n.FRAMEBUFFER,r),n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,e,0);var a=n.checkFramebufferStatus(n.FRAMEBUFFER)===n.FRAMEBUFFER_COMPLETE;return n.bindTexture(n.TEXTURE_2D,null),n.bindFramebuffer(n.FRAMEBUFFER,null),n.deleteTexture(e),n.deleteFramebuffer(r),a}function ox(n){return n===2&&Jn(n).fenceSync!=null}var Ee=J();function Yd(n){J().getBool("DEPRECATION_WARNINGS_ENABLED")&&console.warn(n+" You can disable deprecation warnings with tf.disableDeprecationWarnings().")}function fe(n,t){return W.tidy(n,t)}function rn(n){jd(n).forEach(function(t){return t.dispose()})}function ix(n){return W.keep(n)}function pi(){for(var n=[],t=0;t<arguments.length;t++)n[t]=arguments[t];J().getBool("IS_TEST")||console.warn.apply(console,n)}function Lr(n,t){var e=n;if(Hn(n))return t==="string"?[]:[n.length];if(!Array.isArray(n))return[];for(var r=[];Array.isArray(e)||Hn(e)&&t!=="string";)r.push(e.length),e=e[0];return Array.isArray(n)&&J().getBool("TENSORLIKE_CHECK_SHAPE_CONSISTENCY")&&function a(o,i,s){if(s=s||[],!Array.isArray(o)&&!Hn(o))return void V(i.length===0,function(){return"Element arr["+s.join("][")+"] is a primitive, but should be an array/TypedArray of "+i[0]+" elements"});V(i.length>0,function(){return"Element arr["+s.join("][")+"] should be a primitive, but is an array of "+o.length+" elements"}),V(o.length===i[0],function(){return"Element arr["+s.join("][")+"] should have "+i[0]+" elements, but has "+o.length+" elements"});for(var u=i.slice(1),l=0;l<o.length;++l)a(o[l],u,s.concat(l))}(n,r,[]),r}function gc(n,t,e,r){if(n!=null&&(n!=="numeric"&&n!==t||n==="numeric"&&t==="string"))throw new Error("Argument '"+e+"' passed to '"+r+"' must be "+n+" tensor, but got "+t+" tensor")}function O(n,t,e,r){if(r===void 0&&(r="numeric"),n instanceof at)return gc(r,n.dtype,t,e),n;var a=xo(n);if(a!=="string"&&["bool","int32","float32"].indexOf(r)>=0&&(a=r),gc(r,a,t,e),n==null||!Hn(n)&&!Array.isArray(n)&&typeof n!="number"&&typeof n!="boolean"&&typeof n!="string"){var o=n==null?"null":n.constructor.name;throw new Error("Argument '"+t+"' passed to '"+e+"' must be a Tensor or TensorLike, but got '"+o+"'")}var i=Lr(n,a);Hn(n)||Array.isArray(n)||(n=[n]);var s=a!=="string"?qd(n,a,J().getBool("DEBUG")):Da(n,[],!0);return W.makeTensor(s,i,a)}function fi(n,t,e,r){if(r===void 0&&(r="numeric"),!Array.isArray(n))throw new Error("Argument "+t+" passed to "+e+" must be a `Tensor[]` or `TensorLike[]`");return n.map(function(a,o){return O(a,t+"["+o+"]",e)},r)}function Kd(n,t){for(var e=0;e<n.length;++e)if(n[n.length-e-1]!==t-1-e)return!1;return!0}function sx(n,t,e){for(var r=n.length+t.length,a=[],o=0,i=0,s=0;s<r;s++)e.indexOf(s)===-1?a.push(n[o++]):a.push(t[i++]);return a}function Bt(n,t){for(var e=[],r=n.length,a=0;a<r;a++)t.indexOf(a)===-1&&e.push(n[a]);return[e,t.map(function(o){return n[o]})]}function on(n,t){return sx(n,t.map(function(e){return 1}),t)}function ln(n,t,e){V(Kd(t,e),function(){return n+" supports only inner-most axes for now. Got axes "+t+" and rank-"+e+" input."})}function Qn(n,t){if(Kd(n,t))return null;for(var e=[],r=0;r<t;++r)n.indexOf(r)===-1&&e.push(r);return n.forEach(function(a){return e.push(a)}),e}function Tu(n){return n.map(function(t,e){return[e,t]}).sort(function(t,e){return t[1]-e[1]}).map(function(t){return t[0]})}function Zn(n,t){for(var e=[],r=t-n;r<t;++r)e.push(r);return e}function ux(n,t){var e=n[0].length;n.forEach(function(a,o){V(a.length===e,function(){return"Error in concat"+e+"D: rank of tensors["+o+"] must be the same as the rank of the rest ("+e+")"})}),V(t>=0&&t<e,function(){return"Error in concat"+e+"D: axis must be between 0 and "+(e-1)+"."});var r=n[0];n.forEach(function(a,o){for(var i=0;i<e;i++)V(i===t||a[i]===r[i],function(){return"Error in concat"+e+"D: Shape of tensors["+o+"] ("+a+") does not match the shape of the rest ("+r+") along the non-concatenated axis "+o+"."})})}function Ta(n,t){for(var e=n[0].slice(),r=1;r<n.length;r++)e[t]+=n[r][t];return e}function U(n){var t=Object.keys(n);if(t.length!==1)throw new Error("Please provide an object with a single key (operation name) mapping to a function. Got an object with "+t.length+" keys.");var e=t[0],r=n[e];e.endsWith("_")&&(e=e.substring(0,e.length-1));var a=function(){for(var o=[],i=0;i<arguments.length;i++)o[i]=arguments[i];W.startScope(e);try{var s=r.apply(void 0,o);return s instanceof Promise&&console.error("Cannot return a Promise inside of tidy."),W.endScope(s),s}catch(u){throw W.endScope(null),u}};return Object.defineProperty(a,"name",{value:e,configurable:!0}),a}Ee.registerFlag("HAS_WEBGL",function(){return Ee.getNumber("WEBGL_VERSION")>0}),Ee.registerFlag("WEBGL_VERSION",function(){return mc(2)?2:mc(1)?1:0}),Ee.registerFlag("WEBGL_BUFFER_SUPPORTED",function(){return Ee.get("WEBGL_VERSION")===2}),Ee.registerFlag("WEBGL_CPU_FORWARD",function(){return!0}),Ee.registerFlag("WEBGL_FORCE_F16_TEXTURES",function(){return!1}),Ee.registerFlag("WEBGL_PACK",function(){return Ee.getBool("HAS_WEBGL")}),Ee.registerFlag("WEBGL_PACK_NORMALIZATION",function(){return Ee.getBool("WEBGL_PACK")}),Ee.registerFlag("WEBGL_PACK_CLIP",function(){return Ee.getBool("WEBGL_PACK")}),Ee.registerFlag("WEBGL_PACK_DEPTHWISECONV",function(){return!1}),Ee.registerFlag("WEBGL_PACK_BINARY_OPERATIONS",function(){return Ee.getBool("WEBGL_PACK")}),Ee.registerFlag("WEBGL_PACK_UNARY_OPERATIONS",function(){return Ee.getBool("WEBGL_PACK")}),Ee.registerFlag("WEBGL_PACK_ARRAY_OPERATIONS",function(){return Ee.getBool("WEBGL_PACK")}),Ee.registerFlag("WEBGL_PACK_IMAGE_OPERATIONS",function(){return Ee.getBool("WEBGL_PACK")}),Ee.registerFlag("WEBGL_PACK_REDUCE",function(){return Ee.getBool("WEBGL_PACK")}),Ee.registerFlag("WEBGL_LAZILY_UNPACK",function(){return Ee.getBool("WEBGL_PACK")}),Ee.registerFlag("WEBGL_CONV_IM2COL",function(){return Ee.getBool("WEBGL_PACK")}),Ee.registerFlag("WEBGL_MAX_TEXTURE_SIZE",function(){return ex(Ee.getNumber("WEBGL_VERSION"))}),Ee.registerFlag("WEBGL_MAX_TEXTURES_IN_SHADER",function(){return tx(Ee.getNumber("WEBGL_VERSION"))}),Ee.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION",function(){var n=Ee.getNumber("WEBGL_VERSION");return n===0?0:nx(n)}),Ee.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE",function(){return Ee.getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0&&(n=navigator.userAgent||navigator.vendor||window.opera,!(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(n)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(n.substr(0,4))));var n}),Ee.registerFlag("WEBGL_RENDER_FLOAT32_CAPABLE",function(){return rx(Ee.getNumber("WEBGL_VERSION"))}),Ee.registerFlag("WEBGL_RENDER_FLOAT32_ENABLED",function(){return!Ee.getBool("WEBGL_FORCE_F16_TEXTURES")&&Ee.getBool("WEBGL_RENDER_FLOAT32_CAPABLE")}),Ee.registerFlag("WEBGL_DOWNLOAD_FLOAT_ENABLED",function(){return ax(Ee.getNumber("WEBGL_VERSION"))}),Ee.registerFlag("WEBGL_FENCE_API_ENABLED",function(){return ox(Ee.getNumber("WEBGL_VERSION"))}),Ee.registerFlag("WEBGL_SIZE_UPLOAD_UNIFORM",function(){return Ee.getBool("WEBGL_RENDER_FLOAT32_ENABLED")?4:0}),Gd=Yd;var At=U({complex_:function(n,t){var e=O(n,"real","complex"),r=O(t,"imag","complex");return je(e.shape,r.shape,"real and imag shapes, "+e.shape+" and "+r.shape+", must match in call to tf.complex()."),W.runKernelFunc(function(a){return a.complex(e,r)},{$real:e,$imag:r})}}),_n=U({real_:function(n){var t=O(n,"input","real");return W.runKernelFunc(function(e){return e.real(t)},{$input:t})}}),zn=U({imag_:function(n){var t=O(n,"input","imag");return W.runKernelFunc(function(e){return e.imag(t)},{$input:t})}});function Ot(n,t,e){return Br(n,t,Lr(n,e),e)}function Br(n,t,e,r){if(r==null&&(r=xo(n)),r==="complex64")throw new Error("Cannot construct a complex64 tensor directly. Please use tf.complex(real, imag).");if(!Hn(n)&&!Array.isArray(n)&&typeof n!="number"&&typeof n!="boolean"&&typeof n!="string")throw new Error("values passed to tensor(values) must be a number/boolean/string or an array of numbers/booleans/strings, or a TypedArray");if(t!=null){$d(t);var a=ge(t),o=ge(e);V(a===o,function(){return"Based on the provided shape, ["+t+"], the tensor should have "+a+" values but has "+o});for(var i=0;i<e.length;++i){var s=e[i],u=i!==e.length-1||s!==ge(t.slice(i));V(e[i]===t[i]||!u,function(){return"Error creating a new Tensor. Inferred shape ("+e+") does not match the provided shape ("+t+"). "})}}return Hn(n)||Array.isArray(n)||(n=[n]),t=t||e,n=r!=="string"?qd(n,r,J().getBool("DEBUG")):Da(n,[],!0),W.makeTensor(n,t,r)}function ce(n,t){if((Hn(n)&&t!=="string"||Array.isArray(n))&&t!=="complex64")throw new Error("Error creating a new Scalar: value must be a primitive (number|boolean|string)");if(t==="string"&&Hn(n)&&!(n instanceof Uint8Array))throw new Error("When making a scalar from encoded string, the value must be `Uint8Array`.");return Br(n,[],[],t)}function yt(n,t){Va(n);var e=Lr(n,t);if(e.length!==1)throw new Error("tensor1d() requires values to be a flat/TypedArray");return Br(n,null,e,t)}function Nr(n,t,e){if(Va(n),t!=null&&t.length!==2)throw new Error("tensor2d() requires shape to have two numbers");var r=Lr(n,e);if(r.length!==2&&r.length!==1)throw new Error("tensor2d() requires values to be number[][] or flat/TypedArray");if(r.length===1&&t==null)throw new Error("tensor2d() requires shape to be provided when `values` are a flat/TypedArray");return Br(n,t,r,e)}function Nu(n,t,e){if(Va(n),t!=null&&t.length!==3)throw new Error("tensor3d() requires shape to have three numbers");var r=Lr(n,e);if(r.length!==3&&r.length!==1)throw new Error("tensor3d() requires values to be number[][][] or flat/TypedArray");if(r.length===1&&t==null)throw new Error("tensor3d() requires shape to be provided when `values` are a flat array");return Br(n,t,r,e)}function en(n,t,e){if(Va(n),t!=null&&t.length!==4)throw new Error("tensor4d() requires shape to have four numbers");var r=Lr(n,e);if(r.length!==4&&r.length!==1)throw new Error("tensor4d() requires values to be number[][][][] or flat/TypedArray");if(r.length===1&&t==null)throw new Error("tensor4d() requires shape to be provided when `values` are a flat array");return Br(n,t,r,e)}function lx(n,t,e){if(Va(n),t!=null&&t.length!==5)throw new Error("tensor5d() requires shape to have five numbers");var r=Lr(n,e);if(r.length!==5&&r.length!==1)throw new Error("tensor5d() requires values to be number[][][][][] or flat/TypedArray");if(r.length===1&&t==null)throw new Error("tensor5d() requires shape to be provided when `values` are a flat array");return Br(n,t,r,e)}function cx(n,t,e){if(Va(n),t!=null&&t.length!==6)throw new Error("tensor6d() requires shape to have six numbers");var r=Lr(n,e);if(r.length!==6&&r.length!==1)throw new Error("tensor6d() requires values to be number[][][][][][] or flat/TypedArray");if(r.length===1&&t==null)throw new Error("tensor6d() requires shape to be provided when `values` are a flat array");return Br(n,t=t||r,r,e)}function dx(n,t,e,r){return t===void 0&&(t=!0),W.makeVariable(n,t,e,r)}function La(n,t){if(t===void 0&&(t="float32"),t==="complex64"){var e=La(n,"float32"),r=et(n,"float32");return At(e,r)}var a=zd(ge(n),t);return W.makeTensor(a,n,t)}function et(n,t){if(t===void 0&&(t="float32"),t==="complex64"){var e=et(n,"float32"),r=et(n,"float32");return At(e,r)}var a=bo(ge(n),t);return W.makeTensor(a,n,t)}function jn(n,t,e){return W.runKernelFunc(function(r){return r.fill(n,t,e)},{})}function px(n,t,e){if(e<=0)throw new Error("The number of values should be positive.");return W.runKernelFunc(function(r){return r.linspace(n,t,e)},{})}function hi(n,t,e,r){if(e===void 0&&(e=1),r===void 0&&(r="float32"),e===0)throw new Error("Cannot have a step of zero");if(n===t||n<t&&e<0||t<n&&e>1)return et([0],r);var a=bo(Math.abs(Math.ceil((t-n)/e)),r);t<n&&e===1&&(e=-1),a[0]=n;for(var o=1;o<a.length;o++)a[o]=a[o-1]+e;return yt(a,r)}var Jd=U({onesLike_:function(n){var t=O(n,"x","onesLike");if(t.dtype==="complex64"){var e=Jd(_n(t)),r=qe(zn(t));return At(e,r)}return W.runKernelFunc(function(a){return a.onesLike(t)},{$x:t},function(a,o){return{$x:function(){return qe(a)}}})}}),qe=U({zerosLike_:function(n){var t=O(n,"x","zerosLike");return W.runKernelFunc(function(e){return e.zerosLike(t)},{$x:t},function(e,r){return{$x:function(){return qe(e)}}})}}),_t=U({concat_:function(n,t){t===void 0&&(t=0),V(n.length>=1,function(){return"Pass at least one tensor to concat"});var e=fi(n,"tensors","concat");e[0].dtype==="complex64"&&e.forEach(function(s){if(s.dtype!=="complex64")throw new Error(`Cannot concatenate complex64 tensors with a tensor
          with dtype `+s.dtype+". ")}),t=Ct(t,e[0].shape)[0];var r=Ta(e.map(function(s){return s.shape}),t);if(ge(r)===0)return Ot([],r);if((e=e.filter(function(s){return s.size>0})).length===1)return e[0];var a=e.map(function(s){return s.shape});ux(a,t);var o=e,i={axis:t};return W.runKernelFunc(function(s){return s.concat(e,t)},o,function(s){var u=a.map(function(l){return l[t]});return Ru(s,u,t).map(function(l){return function(){return l}})},"Concat",i)}}),fx=U({concat1d_:function(n){return _t(n,0)}}),hx=U({concat2d_:function(n,t){return _t(n,t)}}),vx=U({concat3d_:function(n,t){return _t(n,t)}}),mx=U({concat4d_:function(n,t){return _t(n,t)}}),Ru=U({split_:function(n,t,e){e===void 0&&(e=0);var r,a=O(n,"x","split");return e=Ct(e,a.shape)[0],typeof t=="number"?(V(a.shape[e]%t==0,function(){return"Number of splits must evenly divide the axis."}),r=new Array(t).fill(a.shape[e]/t)):(V(a.shape[e]===t.reduce(function(o,i){return o+i}),function(){return"The sum of sizes must match the size of the axis dimension."}),r=t),W.runKernelFunc(function(o){return o.split(a,r,e)},{$x:a},function(o){return{$x:function(){return _t(o,e)}}})}});function ra(n,t){return n(t={exports:{}},t.exports),t.exports}var gx=ra(function(n){(function(t,e,r){function a(s){var u,l=this,c=(u=4022871197,function(p){p=p.toString();for(var f=0;f<p.length;f++){var d=.02519603282416938*(u+=p.charCodeAt(f));d-=u=d>>>0,u=(d*=u)>>>0,u+=4294967296*(d-=u)}return 23283064365386963e-26*(u>>>0)});l.next=function(){var p=2091639*l.s0+23283064365386963e-26*l.c;return l.s0=l.s1,l.s1=l.s2,l.s2=p-(l.c=0|p)},l.c=1,l.s0=c(" "),l.s1=c(" "),l.s2=c(" "),l.s0-=c(s),l.s0<0&&(l.s0+=1),l.s1-=c(s),l.s1<0&&(l.s1+=1),l.s2-=c(s),l.s2<0&&(l.s2+=1),c=null}function o(s,u){return u.c=s.c,u.s0=s.s0,u.s1=s.s1,u.s2=s.s2,u}function i(s,u){var l=new a(s),c=u&&u.state,p=l.next;return p.int32=function(){return 4294967296*l.next()|0},p.double=function(){return p()+11102230246251565e-32*(2097152*p()|0)},p.quick=p,c&&(typeof c=="object"&&o(c,l),p.state=function(){return o(l,{})}),p}e&&e.exports?e.exports=i:this.alea=i})(0,n)}),yx=ra(function(n){(function(t,e,r){function a(s){var u=this,l="";u.x=0,u.y=0,u.z=0,u.w=0,u.next=function(){var p=u.x^u.x<<11;return u.x=u.y,u.y=u.z,u.z=u.w,u.w^=u.w>>>19^p^p>>>8},s===(0|s)?u.x=s:l+=s;for(var c=0;c<l.length+64;c++)u.x^=0|l.charCodeAt(c),u.next()}function o(s,u){return u.x=s.x,u.y=s.y,u.z=s.z,u.w=s.w,u}function i(s,u){var l=new a(s),c=u&&u.state,p=function(){return(l.next()>>>0)/4294967296};return p.double=function(){do var f=((l.next()>>>11)+(l.next()>>>0)/4294967296)/2097152;while(f===0);return f},p.int32=l.next,p.quick=p,c&&(typeof c=="object"&&o(c,l),p.state=function(){return o(l,{})}),p}e&&e.exports?e.exports=i:this.xor128=i})(0,n)}),xx=ra(function(n){(function(t,e,r){function a(s){var u=this,l="";u.next=function(){var p=u.x^u.x>>>2;return u.x=u.y,u.y=u.z,u.z=u.w,u.w=u.v,(u.d=u.d+362437|0)+(u.v=u.v^u.v<<4^p^p<<1)|0},u.x=0,u.y=0,u.z=0,u.w=0,u.v=0,s===(0|s)?u.x=s:l+=s;for(var c=0;c<l.length+64;c++)u.x^=0|l.charCodeAt(c),c==l.length&&(u.d=u.x<<10^u.x>>>4),u.next()}function o(s,u){return u.x=s.x,u.y=s.y,u.z=s.z,u.w=s.w,u.v=s.v,u.d=s.d,u}function i(s,u){var l=new a(s),c=u&&u.state,p=function(){return(l.next()>>>0)/4294967296};return p.double=function(){do var f=((l.next()>>>11)+(l.next()>>>0)/4294967296)/2097152;while(f===0);return f},p.int32=l.next,p.quick=p,c&&(typeof c=="object"&&o(c,l),p.state=function(){return o(l,{})}),p}e&&e.exports?e.exports=i:this.xorwow=i})(0,n)}),bx=ra(function(n){(function(t,e,r){function a(s){var u=this;u.next=function(){var l,c,p=u.x,f=u.i;return l=p[f],c=(l^=l>>>7)^l<<24,c^=(l=p[f+1&7])^l>>>10,c^=(l=p[f+3&7])^l>>>3,c^=(l=p[f+4&7])^l<<7,l=p[f+7&7],c^=(l^=l<<13)^l<<9,p[f]=c,u.i=f+1&7,c},function(l,c){var p,f=[];if(c===(0|c))f[0]=c;else for(c=""+c,p=0;p<c.length;++p)f[7&p]=f[7&p]<<15^c.charCodeAt(p)+f[p+1&7]<<13;for(;f.length<8;)f.push(0);for(p=0;p<8&&f[p]===0;++p);for(p==8?f[7]=-1:f[p],l.x=f,l.i=0,p=256;p>0;--p)l.next()}(u,s)}function o(s,u){return u.x=s.x.slice(),u.i=s.i,u}function i(s,u){s==null&&(s=+new Date);var l=new a(s),c=u&&u.state,p=function(){return(l.next()>>>0)/4294967296};return p.double=function(){do var f=((l.next()>>>11)+(l.next()>>>0)/4294967296)/2097152;while(f===0);return f},p.int32=l.next,p.quick=p,c&&(c.x&&o(c,l),p.state=function(){return o(l,{})}),p}e&&e.exports?e.exports=i:this.xorshift7=i})(0,n)}),_x=ra(function(n){(function(t,e,r){function a(s){var u=this;u.next=function(){var l,c,p=u.w,f=u.X,d=u.i;return u.w=p=p+1640531527|0,c=f[d+34&127],l=f[d=d+1&127],c^=c<<13,l^=l<<17,c^=c>>>15,l^=l>>>12,c=f[d]=c^l,u.i=d,c+(p^p>>>16)|0},function(l,c){var p,f,d,h,v,g=[],m=128;for(c===(0|c)?(f=c,c=null):(c+="\0",f=0,m=Math.max(m,c.length)),d=0,h=-32;h<m;++h)c&&(f^=c.charCodeAt((h+32)%c.length)),h===0&&(v=f),f^=f<<10,f^=f>>>15,f^=f<<4,f^=f>>>13,h>=0&&(v=v+1640531527|0,d=(p=g[127&h]^=f+v)==0?d+1:0);for(d>=128&&(g[127&(c&&c.length||0)]=-1),d=127,h=512;h>0;--h)f=g[d+34&127],p=g[d=d+1&127],f^=f<<13,p^=p<<17,f^=f>>>15,p^=p>>>12,g[d]=f^p;l.w=v,l.X=g,l.i=d}(u,s)}function o(s,u){return u.i=s.i,u.w=s.w,u.X=s.X.slice(),u}function i(s,u){s==null&&(s=+new Date);var l=new a(s),c=u&&u.state,p=function(){return(l.next()>>>0)/4294967296};return p.double=function(){do var f=((l.next()>>>11)+(l.next()>>>0)/4294967296)/2097152;while(f===0);return f},p.int32=l.next,p.quick=p,c&&(c.X&&o(c,l),p.state=function(){return o(l,{})}),p}e&&e.exports?e.exports=i:this.xor4096=i})(0,n)}),wx=ra(function(n){(function(t,e,r){function a(s){var u=this,l="";u.next=function(){var p=u.b,f=u.c,d=u.d,h=u.a;return p=p<<25^p>>>7^f,f=f-d|0,d=d<<24^d>>>8^h,h=h-p|0,u.b=p=p<<20^p>>>12^f,u.c=f=f-d|0,u.d=d<<16^f>>>16^h,u.a=h-p|0},u.a=0,u.b=0,u.c=-1640531527,u.d=1367130551,s===Math.floor(s)?(u.a=s/4294967296|0,u.b=0|s):l+=s;for(var c=0;c<l.length+20;c++)u.b^=0|l.charCodeAt(c),u.next()}function o(s,u){return u.a=s.a,u.b=s.b,u.c=s.c,u.d=s.d,u}function i(s,u){var l=new a(s),c=u&&u.state,p=function(){return(l.next()>>>0)/4294967296};return p.double=function(){do var f=((l.next()>>>11)+(l.next()>>>0)/4294967296)/2097152;while(f===0);return f},p.int32=l.next,p.quick=p,c&&(typeof c=="object"&&o(c,l),p.state=function(){return o(l,{})}),p}e&&e.exports?e.exports=i:this.tychei=i})(0,n)}),zr=ra(function(n){(function(t,e){var r,a=this,o=256,i=6,s="random",u=e.pow(o,i),l=e.pow(2,52),c=2*l,p=o-1;function f(m,x,y){var w=[],E=v(function S(_,b){var N,T=[],P=typeof _;if(b&&P=="object")for(N in _)try{T.push(S(_[N],b-1))}catch{}return T.length?T:P=="string"?_:_+"\0"}((x=x==1?{entropy:!0}:x||{}).entropy?[m,g(t)]:m??function(){try{var S;return r&&(S=r.randomBytes)?S=S(o):(S=new Uint8Array(o),(a.crypto||a.msCrypto).getRandomValues(S)),g(S)}catch{var _=a.navigator,b=_&&_.plugins;return[+new Date,a,b,a.screen,g(t)]}}(),3),w),D=new d(w),k=function(){for(var S=D.g(i),_=u,b=0;S<l;)S=(S+b)*o,_*=o,b=D.g(1);for(;S>=c;)S/=2,_/=2,b>>>=1;return(S+b)/_};return k.int32=function(){return 0|D.g(4)},k.quick=function(){return D.g(4)/4294967296},k.double=k,v(g(D.S),t),(x.pass||y||function(S,_,b,N){return N&&(N.S&&h(N,D),S.state=function(){return h(D,{})}),b?(e[s]=S,_):S})(k,E,"global"in x?x.global:this==e,x.state)}function d(m){var x,y=m.length,w=this,E=0,D=w.i=w.j=0,k=w.S=[];for(y||(m=[y++]);E<o;)k[E]=E++;for(E=0;E<o;E++)k[E]=k[D=p&D+m[E%y]+(x=k[E])],k[D]=x;(w.g=function(S){for(var _,b=0,N=w.i,T=w.j,P=w.S;S--;)_=P[N=p&N+1],b=b*o+P[p&(P[N]=P[T=p&T+_])+(P[T]=_)];return w.i=N,w.j=T,b})(o)}function h(m,x){return x.i=m.i,x.j=m.j,x.S=m.S.slice(),x}function v(m,x){for(var y,w=m+"",E=0;E<w.length;)x[p&E]=p&(y^=19*x[p&E])+w.charCodeAt(E++);return g(x)}function g(m){return String.fromCharCode.apply(0,m)}if(e["seed"+s]=f,v(e.random(),t),n.exports){n.exports=f;try{r=require("crypto")}catch{}}})([],Math)});zr.alea=gx,zr.xor128=yx,zr.xorwow=xx,zr.xorshift7=bx,zr.xor4096=_x,zr.tychei=wx;var Ui=zr.alea,Au=function(){function n(t,e,r,a,o){this.mean=t,this.stdDev=e,this.dtype=r,this.nextVal=NaN,this.truncated=a,this.truncated&&(this.upper=this.mean+2*this.stdDev,this.lower=this.mean-2*this.stdDev);var i=o||Math.random();this.random=Ui(i.toString())}return n.prototype.nextValue=function(){if(!isNaN(this.nextVal)){var t=this.nextVal;return this.nextVal=NaN,t}for(var e,r,a=!1;!a;){var o=void 0,i=void 0,s=void 0;do s=(o=2*this.random()-1)*o+(i=2*this.random()-1)*i;while(s>=1||s===0);var u=Math.sqrt(-2*Math.log(s)/s);e=this.mean+this.stdDev*o*u,r=this.mean+this.stdDev*i*u,this.truncated&&!this.isValidTruncated(e)||(a=!0)}return this.truncated&&!this.isValidTruncated(r)||(this.nextVal=this.convertValue(r)),this.convertValue(e)},n.prototype.convertValue=function(t){return this.dtype==null||this.dtype==="float32"?t:Math.round(t)},n.prototype.isValidTruncated=function(t){return t<=this.upper&&t>=this.lower},n}(),Ex=function(){function n(t,e,r,a){this.alpha=t,this.beta=1/e,this.dtype=r;var o=a||Math.random();this.randu=Ui(o.toString()),this.randn=new Au(0,1,r,!1,this.randu()),this.d=t<1?t+2/3:t-1/3,this.c=1/Math.sqrt(9*this.d)}return n.prototype.nextValue=function(){for(var t,e,r,a,o,i;;){do a=this.randn.nextValue(),i=1+this.c*a;while(i<=0);if(i*=i*i,e=1-.331*(t=a*a)*t,r=.5*t+this.d*(1-i+Math.log(i)),(o=this.randu())<e||Math.log(o)<r)break}return i=1/this.beta*this.d*i,this.alpha<1&&(i*=Math.pow(this.randu(),1/this.alpha)),this.convertValue(i)},n.prototype.convertValue=function(t){return this.dtype==="float32"?t:Math.round(t)},n}(),Sx=function(){function n(t,e,r,a){var o=this;if(t===void 0&&(t=0),e===void 0&&(e=1),this.canReturnFloat=function(){return o.dtype==null||o.dtype==="float32"},this.min=t,this.range=e-t,this.dtype=r,a==null&&(a=Math.random()),typeof a=="number"&&(a=a.toString()),!this.canReturnFloat()&&this.range<=1)throw new Error("The difference between "+t+" - "+e+" <= 1 and dtype is not float");this.random=Ui(a)}return n.prototype.convertValue=function(t){return this.canReturnFloat()?t:Math.round(t)},n.prototype.nextValue=function(){return this.convertValue(this.min+this.range*this.random())},n}();function Ne(n,t,e){return t===void 0&&(t="float32"),t=t||"float32",$d(n),new oo(n,t,e)}function Cx(n,t){t===void 0&&(t=!1),console.log(n.toString(t))}var Qd=U({batchToSpaceND_:function(n,t,e){var r=O(n,"x","batchToSpaceND"),a=t.reduce(function(o,i){return o*i});return V(r.rank>=1+t.length,function(){return"input rank is "+r.rank+" but should be > than blockShape.length "+t.length}),V(e.length===t.length,function(){return"crops.length is "+e.length+" but should be equal to blockShape.length  "+t.length}),V(r.shape[0]%a==0,function(){return"input tensor batch is "+r.shape[0]+" but is not divisible by the product of the elements of blockShape "+t.join(" * ")+" === "+a}),W.runKernelFunc(function(o){return o.batchToSpaceND(r,t,e)},{$x:r},function(o){return{$x:function(){return o.spaceToBatchND(t,e)}}})}}),Ix=U({broadcastTo_:function(n,t){var e=O(n,"broadcastTo","x"),r=e.shape;if(t.some(function(u){return!(u>0)||u%1!=0}))throw new Error("broadcastTo(): Invalid broadcast shape ["+t+"].");if(t.length<e.rank)throw new Error("broadcastTo(): shape.length="+t.length+" < input.rank="+e.rank+".");if(t.length>e.rank){for(var a=e.shape.slice();a.length<t.length;)a.unshift(1);e=e.reshape(a)}for(var o=Array.from(t),i=t.length-1;i>=0;i--)if(e.shape[i]===t[i])o[i]=1;else if(e.shape[i]!==1)throw new Error("broadcastTo(): ["+r+"] cannot be broadcast to ["+t+"].");var s=o.map(function(u,l){return u>1?l:-1}).filter(function(u){return u>=0});return s.length===0?e.clone():W.runKernelFunc(function(u){return u.tile(e,o)},{input:e},function(u){return{input:function(){return u.sum(s,!0)}}})}}),Dx=U({cast_:function(n,t){var e=O(n,"x","cast");if(!xy(t))throw new Error("Failed to cast to unknown dtype "+t);if(t==="string"&&e.dtype!=="string"||t!=="string"&&e.dtype==="string")throw new Error("Only strings can be casted to strings");var r={dtype:t};return W.runKernelFunc(function(a){return a.cast(e,t)},{x:e},function(a){return{x:function(){return a.clone()}}},"Cast",r)}}),kx=U({clone_:function(n){var t=O(n,"x","clone",null);return W.runKernelFunc(function(){return W.makeTensorFromDataId(t.dataId,t.shape,t.dtype)},{$x:t},function(e){return{$x:function(){return e.toFloat()}}})}}),Tx=U({cumsum_:function(n,t,e,r){t===void 0&&(t=0),e===void 0&&(e=!1),r===void 0&&(r=!1);var a=O(n,"x","cumsum"),o=Qn([t|=0],a.rank),i=a;o!=null&&(i=a.transpose(o));var s=Zn(1,a.rank)[0],u=W.runKernelFunc(function(l){return l.cumsum(i,s,e,r)},{permutedX:i},function(l){return{permutedX:function(){return l.cumsum(t,e,!r)}}});return o!=null&&(u=u.transpose(o)),u}}),Nx=U({depthToSpace_:function(n,t,e){e===void 0&&(e="NHWC");var r=O(n,"x","depthToSpace"),a=e==="NHWC"?r.shape[1]:r.shape[2],o=e==="NHWC"?r.shape[2]:r.shape[3],i=e==="NHWC"?r.shape[3]:r.shape[1];return V(a*t>=0,function(){return`Negative dimension size caused by overflow when multiplying
      `+a+" and "+t+`  for depthToSpace with input shape
      `+r.shape}),V(o*t>=0,function(){return`Negative dimension size caused by overflow when multiplying
      `+o+" and "+t+` for depthToSpace with input shape
          `+r.shape}),V(i%(t*t)==0,function(){return"Dimension size must be evenly divisible by "+t*t+" but is "+i+" for depthToSpace with input shape "+r.shape}),W.runKernelFunc(function(s){return s.depthToSpace(r,t,e)},{$x:r})}}),bn=U({expandDims_:function(n,t){t===void 0&&(t=0);var e=O(n,"x","expandDims",null);V(t<=e.rank,function(){return"Axis must be <= rank of the tensor"});var r=e.shape.slice();return t<0&&(V(-(e.rank+1)<=t,function(){return"Axis must be in the interval ["+-(e.rank+1)+", "+e.rank+"]"}),t=e.rank+t+1),r.splice(t,0,1),Nn(e,r)}}),Zd=U({eye_:function(n,t,e,r){r===void 0&&(r="float32"),t==null&&(t=n);for(var a=Ne([n,t],r),o=n<=t?n:t,i=0;i<o;++i)a.set(1,i,i);var s=a.toTensor().as2D(n,t);if(e==null)return s;if(e.length===1)return xa(bn(s,0),[e[0],1,1]);if(e.length===2)return xa(bn(bn(s,0),0),[e[0],e[1],1,1]);if(e.length===3)return xa(bn(bn(bn(s,0),0),0),[e[0],e[1],e[2],1,1]);throw new Error("eye() currently supports only 1D and 2D batchShapes, but received "+e.length+"D.")}}),Rx=U({multinomial_:function(n,t,e,r){r===void 0&&(r=!1);var a=O(n,"logits","multinomial"),o=a.size,i=a.rank;if(o<2)throw new Error("Error in multinomial: you need at least 2 outcomes, but got "+o+".");if(i>2)throw new Error("Rank of probabilities must be 1 or 2, but is "+i);e=e||Math.random();var s=i===1?a.as2D(1,-1):a,u=W.runKernelFunc(function(l){return l.multinomial(s,r,t,e)},{logits2D:s});return i===1?u.as1D():u}}),iu=U({oneHot_:function(n,t,e,r){if(e===void 0&&(e=1),r===void 0&&(r=0),t<2)throw new Error("Error in oneHot: depth must be >=2, but it is "+t);var a=O(n,"indices","oneHot","int32"),o=a.shape.concat([t]);return a=a.flatten(),W.runKernelFunc(function(i){return i.oneHot(a,t,e,r)},{$indices:a},function(i){return{$indices:function(){return et(a.shape,"float32")}}}).reshape(o)}}),aa=U({pad_:function(n,t,e){e===void 0&&(e=0);var r=O(n,"x","pad");if(r.rank===0)throw new Error("pad(scalar) is not defined. Pass non-scalar to pad");var a={paddings:t,constantValue:e};return W.runKernelFunc(function(o){return o.pad(r,t,e)},{x:r},function(o){var i=t.map(function(s){return s[0]});return{x:function(){return o.slice(i,r.shape)}}},"PadV2",a)}}),Ax=U({pad1d_:function(n,t,e){return e===void 0&&(e=0),V(t.length===2,function(){return"Invalid number of paddings. Must be length of 2."}),aa(n,[t],e)}}),Px=U({pad2d_:function(n,t,e){return e===void 0&&(e=0),V(t.length===2&&t[0].length===2&&t[1].length===2,function(){return"Invalid number of paddings. Must be length of 2 each."}),aa(n,t,e)}}),Ox=U({pad3d_:function(n,t,e){return e===void 0&&(e=0),V(t.length===3&&t[0].length===2&&t[1].length===2&&t[2].length===2,function(){return"Invalid number of paddings. Must be length of 2 each."}),aa(n,t,e)}}),Mx=U({pad4d_:function(n,t,e){return e===void 0&&(e=0),V(t.length===4&&t[0].length===2&&t[1].length===2&&t[2].length===2&&t[3].length===2,function(){return"Invalid number of paddings. Must be length of 2 each."}),aa(n,t,e)}}),Fx=U({rand_:function(n,t,e){var r=ge(n),a=null;if(e==null||e==="float32")a=new Float32Array(r);else if(e==="int32")a=new Int32Array(r);else{if(e!=="bool")throw new Error("Unknown data type "+e);a=new Uint8Array(r)}for(var o=0;o<r;o++)a[o]=t();return W.makeTensor(a,n,e)}}),Vx=U({randomNormal_:function(n,t,e,r,a){if(t===void 0&&(t=0),e===void 0&&(e=1),r!=null&&r==="bool")throw new Error("Unsupported data type "+r);for(var o=new Au(t,e,r,!1,a),i=Ne(n,r),s=0;s<i.values.length;s++)i.values[s]=o.nextValue();return i.toTensor()}}),Lx=U({randomGamma_:function(n,t,e,r,a){if(e===void 0&&(e=1),r===void 0&&(r="float32"),e==null&&(e=1),r==null&&(r="float32"),r!=="float32"&&r!=="int32")throw new Error("Unsupported data type "+r);for(var o=new Ex(t,e,r,a),i=Ne(n,r),s=0;s<i.values.length;s++)i.values[s]=o.nextValue();return i.toTensor()}}),ep=U({randomUniform_:function(n,t,e,r,a){t===void 0&&(t=0),e===void 0&&(e=1),r===void 0&&(r="float32");for(var o=Ne(n,r),i=new Sx(t,e,null,a),s=0;s<o.values.length;s++)o.values[s]=i.nextValue();return o.toTensor()}}),Nn=U({reshape_:function(n,t){var e=O(n,"x","reshape",null);t=gy(t,e.size),V(e.size===ge(t),function(){return"new shape and old shape must have the same number of elements."});var r={shape:t};return W.runKernelFunc(function(a){return a.reshape(e,t)},{x:e},function(a){return{x:function(){return a.reshape(e.shape)}}},"Reshape",r)}}),tp=U({spaceToBatchND_:function(n,t,e){var r=O(n,"x","spaceToBatchND");return V(r.rank>=1+t.length,function(){return"input rank "+r.rank+" should be > than [blockShape] "+t.length}),V(e.length===t.length,function(){return"paddings.shape[0] "+e.length+" must be equal to [blockShape] "+t.length}),V(r.shape.reduce(function(a,o,i){return i>0&&i<=t.length?a&&(o+e[i-1][0]+e[i-1][1])%t[i-1]==0:a},!0),function(){return"input spatial dimensions "+r.shape.slice(1)+" with paddings "+e.toString()+" must be divisible by blockShapes "+t.toString()}),W.runKernelFunc(function(a){return a.spaceToBatchND(r,t,e)},{$x:r},function(a){return{$x:function(){return a.batchToSpaceND(t,e)}}})}}),np=U({squeeze_:function(n,t){var e=O(n,"x","squeeze");return Nn(e,Hr(e.shape,t).newShape)}}),vn=U({stack_:function(n,t){t===void 0&&(t=0);var e=fi(n,"tensors","stack");if(V(e.length>=1,function(){return"Pass at least one tensor to tf.stack"}),e.length===1)return e[0].expandDims(t);var r=e[0].rank,a=e[0].shape,o=e[0].dtype;V(t<=r,function(){return"Axis must be <= rank of the tensor"}),e.forEach(function(s){je(a,s.shape,"All tensors passed to stack must have matching shapes")}),e.forEach(function(s){V(o===s.dtype,function(){return"All tensors passed to stack must have matching dtypes"})});var i=e.map(function(s){return s.expandDims(t)});return _t(i,t)}}),xa=U({tile_:function(n,t){var e=O(n,"x","tile",null);V(e.rank===t.length,function(){return"Error in transpose: rank of input "+e.rank+" must match length of reps "+t+"."});var r=[e],a={reps:t};return W.runKernelFunc(function(o,i){var s=o.tile(e,t);return i([e]),s},{x:e},function(o,i){var s=i[0];return{x:function(){var u=qe(s);if(s.rank===1)for(var l=0;l<t[0];++l)u=u.add(o.slice([l*s.shape[0]],[s.shape[0]]));else if(s.rank===2)for(l=0;l<t[0];++l)for(var c=0;c<t[1];++c)u=u.add(o.slice([l*s.shape[0],c*s.shape[1]],[s.shape[0],s.shape[1]]));else if(s.rank===3)for(l=0;l<t[0];++l)for(c=0;c<t[1];++c)for(var p=0;p<t[2];++p)u=u.add(o.slice([l*s.shape[0],c*s.shape[1],p*s.shape[2]],[s.shape[0],s.shape[1],s.shape[2]]));else{if(s.rank!==4)throw new Error("Gradient for tile operation is not implemented for rank-"+s.rank+" tensors yet.");for(l=0;l<t[0];++l)for(c=0;c<t[1];++c)for(p=0;p<t[2];++p)for(var f=0;f<t[3];++f)u=u.add(o.slice([l*s.shape[0],c*s.shape[1],p*s.shape[2],f*s.shape[3]],[s.shape[0],s.shape[1],s.shape[2],s.shape[3]]))}return u}}},"Tile",a,r)}}),Bx=U({truncatedNormal_:function(n,t,e,r,a){if(t===void 0&&(t=0),e===void 0&&(e=1),r!=null&&r==="bool")throw new Error("Unsupported data type "+r);for(var o=new Au(t,e,r,!0,a),i=Ne(n,r),s=0;s<i.values.length;s++)i.values[s]=o.nextValue();return i.toTensor()}}),wt=U({unstack_:function(n,t){t===void 0&&(t=0),t=t||0;var e=O(n,"x","unstack");V(t>=-e.shape.length&&t<e.shape.length,function(){return"Axis = "+t+" is not in [-"+e.shape.length+", "+e.shape.length+")"}),t<0&&(t+=e.shape.length);var r={axis:t};return W.runKernelFunc(function(a){return a.unstack(e,t)},{x:e},function(a){return{x:function(){return vn(a,t)}}},"Unpack",r)}}),Ux=function(n,t){return he(this,void 0,void 0,function(){var e,r,a,o,i,s,u,l,c,p;return ve(this,function(f){switch(f.label){case 0:return e=O(n,"x","setdiff1d"),r=O(t,"y","setdiff1d"),V(e.dtype===r.dtype,function(){return"x and y should have the same dtype, but got x ("+e.dtype+") and y ("+r.dtype+")."}),V(e.rank===1,function(){return"x should be 1D tensor, but got x ("+e.shape+")."}),V(r.rank===1,function(){return"y should be 1D tensor, but got y ("+r.shape+")."}),[4,e.data()];case 1:return a=f.sent(),[4,r.data()];case 2:for(o=f.sent(),i=new Set(o),s=0,c=0;c<a.length;c++)i.has(a[c])||s++;for(u=new oo([s],e.dtype),l=new oo([s],"int32"),c=0,p=0;c<a.length;c++)i.has(a[c])||(u.values[p]=a[c],l.values[p]=c,p++);return[2,[u.toTensor(),l.toTensor()]]}})})};function vi(n,t,e,r){r===void 0&&(r=!0);var a=[];if(r)(a=a.concat(t.slice(0))).push(n[0]/e),a=a.concat(n.slice(1));else{a=a.concat(n[0]);for(var o=t.length,i=0;i<o;++i)a=a.concat([n[i+1]/t[i],t[i]]);a=a.concat(n.slice(o+1))}return a}function mi(n,t,e){e===void 0&&(e=!0);var r=[];if(e){r.push(t);for(var a=t+1;a<n;++a)a<=2*t?(r.push(a),r.push(a-(t+1))):r.push(a)}else{var o=[],i=[];for(a=1;a<n;++a)a>=2*t+1||a%2==1?i.push(a):o.push(a);r.push.apply(r,o),r.push(0),r.push.apply(r,i)}return r}function gi(n,t,e,r){r===void 0&&(r=!0);var a=[];r?a.push(n[0]/e):a.push(n[0]*e);for(var o=1;o<n.length;++o)o<=t.length?r?a.push(t[o-1]*n[o]):a.push(n[o]/t[o-1]):a.push(n[o]);return a}function rp(n,t){for(var e=[0],r=0;r<t;++r)e.push(n[r][0]);return e}function ap(n,t,e){for(var r=n.slice(0,1),a=0;a<e;++a)r.push(n[a+1]-t[a][0]-t[a][1]);return r}function op(n,t){if(n.rank<1)throw new Error("tf.gatherND() expects the input to be rank 1 or higher, but the rank was "+n.rank+".");if(t.rank<1)throw new Error("tf.gatherND() expects the indices to be rank 1 or higher, but the rank was "+t.rank+".");if(t.dtype!=="int32")throw new Error("tf.gatherND() expects the indices to be int32 type, but the dtype was "+t.dtype+".");if(t.shape[t.rank-1]>n.rank)throw new Error("index innermost dimension length must be <= tensor rank; saw: "+t.shape[t.rank-1]+" vs. "+n.rank);if(n.size===0)throw new Error("Requested more than 0 entries, but input is empty. Input shape: "+n.shape+".");for(var e=t.shape,r=e[e.length-1],a=1,o=0;o<e.length-1;++o)a*=e[o];var i=n.shape,s=e.slice();s.pop();var u=1;for(o=r;o<n.rank;++o)u*=i[o],s.push(i[o]);var l=Gn(n.shape).map(function(c){return c/u}).concat([1]).slice(0,r);return[s,a,u,l]}var ip=30;function ks(n){return n<=ip?n:eu(n,Math.floor(Math.sqrt(n)))}function Wx(n,t,e){var r=t.rank>1?t.shape[t.rank-1]:1,a=t.rank>1?t.rank-1:1,o="Must have updates.shape = indices.shape[:batchDim] + shape[sliceDim:], got updates.shape: "+e.shape+", indices.shape: "+t.shape+", shape: "+n+", sliceDim: "+r+", and batchDim: "+a+".";if(e.rank<a)throw new Error(o+" update.rank < "+a+". ");if(n.length<r+(e.rank-a))throw new Error(o+" Output shape length < "+(r+(e.rank-a)));if(e.rank!==a+n.length-r)throw new Error(o+" update.rank != "+(a+n.length-r));for(var i=0;i<a;++i)if(e.shape[i]!==t.shape[i])throw new Error(o+" updates.shape["+i+"] ("+e.shape[i]+") != indices.shape["+i+"] ("+t.shape[i]+").");for(i=0;i<e.rank-a;++i)if(e.shape[i+a]!==n[i+r])throw new Error(o+" updates.shape["+(i+a)+"] ("+e.shape[i+a]+") != shape["+(i+a)+"] ("+n[i+a]+")")}function qx(n,t,e){if(t.rank<1)throw new Error("tf.scatterND() expects the indices to be rank 1 or higher, but the rank was "+t.rank+".");if(n.rank<1)throw new Error("tf.scatterND() expects the updates to be rank 1 or higher, but the rank was "+n.rank+".");if(t.dtype!=="int32")throw new Error("The dtype of 'indices' should be int32, but got dtype: "+t.dtype);if(e.length<1)throw new Error("Output rank must be greater or equal to 1, but got shape: "+e);if(e.length===0){if(t.size===0)throw new Error("Indices specified for empty output. indices shape: "+t.shape);if(n.size===0)throw new Error("Updates specified for empty output. updates shape: "+n.shape)}Wx(e,t,n)}function yi(n,t,e){for(var r=t.shape.length,a=r>1?t.shape[r-1]:1,o=e.length,i=1,s=a;s<o;++s)i*=e[s];var u=a<1?1:a;return{sliceRank:a,numUpdates:ge(t.shape)/u,sliceSize:i,strides:Gn(e.slice(0,a)).concat([1]),outputSize:ge(e)}}function zx(n,t,e){V(n.rank===t.length,function(){return"Error in slice"+n.rank+"D: Length of begin "+t+" must match the rank of the array ("+n.rank+")."}),V(n.rank===e.length,function(){return"Error in slice"+n.rank+"D: Length of size "+e+" must match the rank of the array ("+n.rank+")."});for(var r=function(o){V(t[o]+e[o]<=n.shape[o],function(){return"Error in slice"+n.rank+"D: begin["+o+"] + size["+o+"] ("+(t[o]+e[o])+") would overflow input.shape["+o+"] ("+n.shape[o]+")"})},a=0;a<n.rank;++a)r(a)}function yc(n){for(var t=[],e=0;n>0;)1&n&&t.push(e),n/=2,e++;return t}function Pu(n,t,e){for(var r=[],a=0;a<n.length;a++)r[a]=Math.ceil((t[a]-n[a])/e[a]);return r}function $x(n,t,e,r,a){var o=t[a],i=e[a]||1;(n&1<<a||o==null)&&(o=i>0?Number.MIN_SAFE_INTEGER:Number.MAX_SAFE_INTEGER);var s=r[a];return o<0&&(o+=s),o=Js(0,o,s-1)}function Hx(n,t,e,r,a){var o=t[a],i=e[a]||1;(n&1<<a||o==null)&&(o=i>0?Number.MAX_SAFE_INTEGER:Number.MIN_SAFE_INTEGER);var s=r[a];return o<0&&(o+=s),o=i>0?Js(0,o,s):Js(-1,o,s-1)}function sp(n,t,e){for(var r=e.length,a=0;a<e.length;a++)if(e[a]>1){r=a;break}for(a=r+1;a<e.length;a++)if(t[a]>0||e[a]!==n[a])return!1;return!0}function up(n,t){for(var e=n.length>0?n[n.length-1]:1,r=0;r<n.length-1;r++)e+=n[r]*t[r];return e}function Gx(n,t){V(Zs(n),function(){return"The f passed in variableGrads(f) must be a function"}),V(t==null||Array.isArray(t)&&t.every(function(c){return c instanceof ka}),function(){return"The varList passed in variableGrads(f, varList) must be an array of variables"});var e=t!=null;if(!e)for(var r in t=[],W.registeredVariables)t.push(W.registeredVariables[r]);var a=e?t.filter(function(c){return!c.trainable}):null,o=t.length;V((t=t.filter(function(c){return c.trainable})).length>0,function(){return"variableGrads() expects at least one of the input variables to be trainable, but none of the "+o+" variables is trainable."});var i=W.gradients(n,t,null,!0),s=i.value,u=i.grads;V(u.some(function(c){return c!=null}),function(){return"Cannot find a connection between any variable and the result of the loss function y=f(x). Please make sure the operations that use variables are inside the function f passed to minimize()."}),V(s.rank===0,function(){return"The f passed in variableGrads(f) must return a scalar, but it returned a rank-"+s.rank+" tensor"});var l={};return t.forEach(function(c,p){u[p]!=null&&(l[c.name]=u[p])}),a?.forEach(function(c){return l[c.name]=null}),{value:s,grads:l}}function Wi(n){return W.customGrad(n)}var fr=U({softmax_:function(n,t){t===void 0&&(t=-1);var e=O(n,"logits","softmax","float32");if(t===-1&&(t=e.rank-1),t!==e.rank-1)throw Error("Softmax along a non-last dimension is not yet supported. Logits was rank "+e.rank+" and dim was "+t);return W.runKernelFunc(function(r,a){var o=r.softmax(e,t);return a([o]),o},{logits:e},function(r,a){var o=a[0],i=r.mul(o);return{logits:function(){return i.sub(i.sum([t],!0).mul(o))}}},"Softmax",{dim:t},[],[!0])}}),jx=U({logSoftmax_:function(n,t){t===void 0&&(t=-1);var e=O(n,"logits","logSoftmax");if(t===-1&&(t=e.rank-1),t!==e.rank-1)throw Error("Log Softmax along a non-last dimension is not yet supported. Logits was rank "+e.rank+" and axis was "+t);return Wi(function(r,a){var o=r.max(t,!0),i=r.sub(o),s=i.toFloat().sub(i.exp().sum(t,!0).log());return a([s]),{value:s,gradFunc:function(u,l){var c=l[0].exp();return u.sub(u.sum(t,!0).mul(c))}}})(e)}}),lp=function(){function n(t,e){this.backend=t,this.dataMover=e,this.data=new WeakMap,this.dataIdsCount=0}return n.prototype.get=function(t){return this.data.has(t)||this.dataMover.moveData(this.backend,t),this.data.get(t)},n.prototype.set=function(t,e){this.dataIdsCount++,this.data.set(t,e)},n.prototype.has=function(t){return this.data.has(t)},n.prototype.delete=function(t){return this.dataIdsCount--,this.data.delete(t)},n.prototype.numDataIds=function(){return this.dataIdsCount},n}(),cp=function(){function n(){}return n.prototype.time=function(t){return j("time")},n.prototype.read=function(t){return j("read")},n.prototype.readSync=function(t){return j("readSync")},n.prototype.numDataIds=function(){return j("numDataIds")},n.prototype.disposeData=function(t){return j("disposeData")},n.prototype.write=function(t,e,r){return j("write")},n.prototype.move=function(t,e,r,a){return j("move")},n.prototype.memory=function(){return j("memory")},n.prototype.floatPrecision=function(){return j("floatPrecision")},n.prototype.epsilon=function(){return this.floatPrecision()===32?1e-7:1e-4},n.prototype.batchMatMul=function(t,e,r,a){return j("batchMatMul")},n.prototype.fusedBatchMatMul=function(t){return t.a,t.b,t.transposeA,t.transposeB,t.bias,t.activation,t.preluActivationWeights,j("fusedBatchMatMul")},n.prototype.slice=function(t,e,r){return j("slice")},n.prototype.stridedSlice=function(t,e,r,a){return j("stridedSlice")},n.prototype.unstack=function(t,e){return j("unstack")},n.prototype.reverse=function(t,e){return j("reverse")},n.prototype.concat=function(t,e){return j("concat")},n.prototype.neg=function(t){return j("neg")},n.prototype.add=function(t,e){return j("add")},n.prototype.addN=function(t){return j("addN")},n.prototype.subtract=function(t,e){return j("subtract")},n.prototype.multiply=function(t,e){return j("multiply")},n.prototype.realDivide=function(t,e){return j("realDivide")},n.prototype.floorDiv=function(t,e){return j("floorDiv")},n.prototype.sum=function(t,e){return j("sum")},n.prototype.prod=function(t,e){return j("prod")},n.prototype.unsortedSegmentSum=function(t,e,r){return j("unsortedSegmentSum")},n.prototype.argMin=function(t,e){return j("argMin")},n.prototype.argMax=function(t,e){return j("argMax")},n.prototype.equal=function(t,e){return j("equal")},n.prototype.notEqual=function(t,e){return j("notEqual")},n.prototype.less=function(t,e){return j("less")},n.prototype.lessEqual=function(t,e){return j("lessEqual")},n.prototype.greater=function(t,e){return j("greater")},n.prototype.greaterEqual=function(t,e){return j("greaterEqual")},n.prototype.logicalNot=function(t){return j("logicalNot")},n.prototype.logicalAnd=function(t,e){return j("logicalAnd")},n.prototype.logicalOr=function(t,e){return j("logicalOr")},n.prototype.where=function(t){return j("where")},n.prototype.select=function(t,e,r){return j("select")},n.prototype.topk=function(t,e,r){return j("topk")},n.prototype.min=function(t,e){return j("min")},n.prototype.minimum=function(t,e){return j("minimum")},n.prototype.mod=function(t,e){return j("mod")},n.prototype.max=function(t,e){return j("max")},n.prototype.maximum=function(t,e){return j("maximum")},n.prototype.all=function(t,e){return j("all")},n.prototype.any=function(t,e){return j("any")},n.prototype.squaredDifference=function(t,e){return j("squaredDifference")},n.prototype.ceil=function(t){return j("ceil")},n.prototype.floor=function(t){return j("floor")},n.prototype.round=function(t){return j("round")},n.prototype.sign=function(t){return j("sign")},n.prototype.isNaN=function(t){return j("isNaN")},n.prototype.isInf=function(t){return j("isInf")},n.prototype.isFinite=function(t){return j("isFinite")},n.prototype.pow=function(t,e){return j("pow")},n.prototype.exp=function(t){return j("exp")},n.prototype.expm1=function(t){return j("expm1")},n.prototype.softmax=function(t,e){return j("softmax")},n.prototype.log=function(t){return j("log")},n.prototype.log1p=function(t){return j("log1p")},n.prototype.sqrt=function(t){return j("sqrt")},n.prototype.rsqrt=function(t){return j("rsqrt")},n.prototype.square=function(t){return j("square")},n.prototype.reciprocal=function(t){return j("reciprocal")},n.prototype.relu=function(t){return j("relu")},n.prototype.relu6=function(t){return j("relu6")},n.prototype.prelu=function(t,e){return j("prelu")},n.prototype.elu=function(t){return j("elu")},n.prototype.eluDer=function(t,e){return j("eluDer")},n.prototype.selu=function(t){return j("selu")},n.prototype.int=function(t){return j("int")},n.prototype.clip=function(t,e,r){return j("clip")},n.prototype.abs=function(t){return j("abs")},n.prototype.complexAbs=function(t){return j("complexAbs")},n.prototype.sigmoid=function(t){return j("sigmoid")},n.prototype.softplus=function(t){return j("softplus")},n.prototype.sin=function(t){return j("sin")},n.prototype.cos=function(t){return j("cos")},n.prototype.tan=function(t){return j("tan")},n.prototype.asin=function(t){return j("asin")},n.prototype.acos=function(t){return j("acos")},n.prototype.atan=function(t){return j("atan")},n.prototype.atan2=function(t,e){return j("atan2")},n.prototype.sinh=function(t){return j("sinh")},n.prototype.cosh=function(t){return j("cosh")},n.prototype.tanh=function(t){return j("tanh")},n.prototype.asinh=function(t){return j("asinh")},n.prototype.acosh=function(t){return j("acosh")},n.prototype.atanh=function(t){return j("atanh")},n.prototype.erf=function(t){return j("erf")},n.prototype.step=function(t,e){return j("step")},n.prototype.fusedConv2d=function(t){return t.input,t.filter,t.convInfo,t.bias,t.activation,t.preluActivationWeights,j("fusedConv2d")},n.prototype.conv2d=function(t,e,r){return j("conv2d")},n.prototype.conv2dDerInput=function(t,e,r){return j("conv2dDerInput")},n.prototype.conv2dDerFilter=function(t,e,r){return j("conv2dDerFilter")},n.prototype.fusedDepthwiseConv2D=function(t){return t.input,t.filter,t.convInfo,t.bias,t.activation,t.preluActivationWeights,j("fusedDepthwiseConv2D")},n.prototype.depthwiseConv2D=function(t,e,r){return j("depthwiseConv2D")},n.prototype.depthwiseConv2DDerInput=function(t,e,r){return j("depthwiseConv2DDerInput")},n.prototype.depthwiseConv2DDerFilter=function(t,e,r){return j("depthwiseConv2DDerFilter")},n.prototype.conv3d=function(t,e,r){return j("conv3d")},n.prototype.conv3dDerInput=function(t,e,r){return j("conv3dDerInput")},n.prototype.conv3dDerFilter=function(t,e,r){return j("conv3dDerFilter")},n.prototype.maxPool=function(t,e){return j("maxPool")},n.prototype.maxPoolBackprop=function(t,e,r,a){return j("maxPoolBackprop")},n.prototype.avgPool=function(t,e){return j("avgPool")},n.prototype.avgPoolBackprop=function(t,e,r){return j("avgPoolBackprop")},n.prototype.avgPool3d=function(t,e){return j("avgPool3d")},n.prototype.avgPool3dBackprop=function(t,e,r){return j("avgPool3dBackprop")},n.prototype.maxPool3d=function(t,e){return j("maxPool3d")},n.prototype.maxPool3dBackprop=function(t,e,r,a){return j("maxPool3dBackprop")},n.prototype.reshape=function(t,e){return j("reshape")},n.prototype.cast=function(t,e){return j("cast")},n.prototype.tile=function(t,e){return j("tile")},n.prototype.pad=function(t,e,r){return j("pad")},n.prototype.transpose=function(t,e){return j("transpose")},n.prototype.gather=function(t,e,r){return j("gather")},n.prototype.gatherND=function(t,e){return j("gatherND")},n.prototype.scatterND=function(t,e,r){return j("scatterND")},n.prototype.batchToSpaceND=function(t,e,r){return j("batchToSpaceND")},n.prototype.spaceToBatchND=function(t,e,r){return j("spaceToBatchND")},n.prototype.resizeBilinear=function(t,e,r,a){return j("resizeBilinear")},n.prototype.resizeBilinearBackprop=function(t,e,r){return j("resizeBilinearBackprop")},n.prototype.resizeNearestNeighbor=function(t,e,r,a){return j("resizeNearestNeighbor")},n.prototype.resizeNearestNeighborBackprop=function(t,e,r){return j("resizeNearestNeighborBackprop")},n.prototype.batchNormalization=function(t,e,r,a,o,i){return j("batchNormalization")},n.prototype.localResponseNormalization4D=function(t,e,r,a,o){return j("localResponseNormalization4D")},n.prototype.LRNGrad=function(t,e,r,a,o,i,s){return j("LRNGrad")},n.prototype.multinomial=function(t,e,r,a){return j("multinomial")},n.prototype.oneHot=function(t,e,r,a){return j("oneHot")},n.prototype.cumsum=function(t,e,r,a){return j("cumsum")},n.prototype.nonMaxSuppression=function(t,e,r,a,o){return j("nonMaxSuppression")},n.prototype.fft=function(t){return j("fft")},n.prototype.ifft=function(t){return j("ifft")},n.prototype.complex=function(t,e){return j("complex")},n.prototype.real=function(t){return j("real")},n.prototype.imag=function(t){return j("imag")},n.prototype.cropAndResize=function(t,e,r,a,o,i){return j("cropAndResize")},n.prototype.depthToSpace=function(t,e,r){return j("depthToSpace")},n.prototype.split=function(t,e,r){return j("split")},n.prototype.sparseToDense=function(t,e,r,a){return j("sparseToDense")},n.prototype.diag=function(t){return j("diag")},n.prototype.fill=function(t,e,r){return j("fill")},n.prototype.onesLike=function(t){return j("onesLike")},n.prototype.zerosLike=function(t){return j("zerosLike")},n.prototype.linspace=function(t,e,r){return j("linspace")},n.prototype.dispose=function(){return j("dispose")},n}();function j(n){throw new Error("'"+n+"' not yet implemented or not found in the registry. Did you forget to import the kernel?")}function Ir(n,t){for(var e=n.length,r=[],a=0;a<e;a++){var o=e-1-a,i=n[o]||1;(t[t.length-1-a]||1)>1&&i===1&&r.unshift(o)}return r}function Et(n,t){for(var e=[],r=0;r<t.length;r++){var a=n[n.length-r-1],o=t.length-r-1,i=t[o];(a==null||a===1&&i>1)&&e.unshift(o)}return e}function Le(n,t){for(var e=[],r=Math.max(n.length,t.length),a=0;a<r;a++){var o=n[n.length-a-1];o==null&&(o=1);var i=t[t.length-a-1];if(i==null&&(i=1),o===1)e.unshift(i);else if(i===1)e.unshift(o);else{if(o!==i)throw Error("Operands could not be broadcast together with shapes "+n+" and "+t+".");e.unshift(o)}}return e}function so(n,t,e,r,a,o,i){i===void 0&&(i="channelsLast");var s,u=_i(t),l=u[0],c=u[1];if(i==="channelsLast")s=[l,c,n[3],n[3]];else{if(i!=="channelsFirst")throw new Error("Unknown dataFormat "+i);s=[l,c,n[1],n[1]]}return oa(n,s,e,r,a,o,!1,i)}function xi(n,t,e,r,a,o,i){i===void 0&&(i="NDHWC");var s,u,l=su(t),c=l[0],p=l[1],f=l[2];if(i==="NDHWC")u="channelsLast",s=[c,p,f,n[4],n[4]];else{if(i!=="NCDHW")throw new Error("Unknown dataFormat "+i);u="channelsFirst",s=[c,p,f,n[1],n[1]]}return bi(n,s,e,r,a,!1,u,o)}function oa(n,t,e,r,a,o,i,s){i===void 0&&(i=!1),s===void 0&&(s="channelsLast");var u=[-1,-1,-1,-1],l=u[0],c=u[1],p=u[2],f=u[3];if(s==="channelsLast")l=n[0],c=n[1],p=n[2],f=n[3];else{if(s!=="channelsFirst")throw new Error("Unknown dataFormat "+s);l=n[0],f=n[1],c=n[2],p=n[3]}var d,h=t[0],v=t[1],g=t[3],m=_i(e),x=m[0],y=m[1],w=_i(r),E=w[0],D=w[1],k=ba(h,E),S=ba(v,D),_=function(F,M,L,A,$,q,z,K){var re,ae,Se;if(typeof F=="number"){re={top:F,bottom:F,left:F,right:F,type:F===0?"VALID":"NUMBER"};var Ce=function(Ie,$e,ze,Qe,Xe){Qe==null&&(Qe=dp(Ie,$e,ze));var Ze=Ie[0],mn=Ie[1],gn=to((Ze-$e+2*Qe)/ze+1,Xe);V(mt(gn),function(){return"The output # of rows ("+gn+") must be an integer. Change the stride and/or zero pad parameters"});var Nt=to((mn-$e+2*Qe)/ze+1,Xe);return V(mt(Nt),function(){return"The output # of columns ("+Nt+") must be an integer. Change the stride and/or zero pad parameters"}),[gn,Nt]}([M,L],q,A,F,K);ae=Ce[0],Se=Ce[1]}else if(F==="same"){ae=Math.ceil(M/A),Se=Math.ceil(L/$);var Pe=Math.max(0,(ae-1)*A+q-M),Me=Math.max(0,(Se-1)*$+z-L),ie=Math.floor(Pe/2),ee=Pe-ie,ue=Math.floor(Me/2);re={top:ie,bottom:ee,left:ue,right:Me-ue,type:"SAME"}}else{if(F!=="valid")throw Error("Unknown padding parameter: "+F);re={top:0,bottom:0,left:0,right:0,type:"VALID"},ae=Math.ceil((M-q+1)/A),Se=Math.ceil((L-z+1)/$)}return{padInfo:re,outHeight:ae,outWidth:Se}}(a,c,p,x,y,k,S,o),b=_.padInfo,N=_.outHeight,T=_.outWidth,P=i?g*f:g;return s==="channelsFirst"?d=[l,P,N,T]:s==="channelsLast"&&(d=[l,N,T,P]),{batchSize:l,dataFormat:s,inHeight:c,inWidth:p,inChannels:f,outHeight:N,outWidth:T,outChannels:P,padInfo:b,strideHeight:x,strideWidth:y,filterHeight:h,filterWidth:v,effectiveFilterHeight:k,effectiveFilterWidth:S,dilationHeight:E,dilationWidth:D,inShape:n,outShape:d,filterShape:t}}function bi(n,t,e,r,a,o,i,s){o===void 0&&(o=!1),i===void 0&&(i="channelsLast");var u=[-1,-1,-1,-1,-1],l=u[0],c=u[1],p=u[2],f=u[3],d=u[4];if(i==="channelsLast")l=n[0],c=n[1],p=n[2],f=n[3],d=n[4];else{if(i!=="channelsFirst")throw new Error("Unknown dataFormat "+i);l=n[0],d=n[1],c=n[2],p=n[3],f=n[4]}var h,v=t[0],g=t[1],m=t[2],x=t[4],y=su(e),w=y[0],E=y[1],D=y[2],k=su(r),S=k[0],_=k[1],b=k[2],N=ba(v,S),T=ba(g,_),P=ba(m,b),F=function(z,K,re,ae,Se,Ce,Pe,Me,ie,ee,ue){var Ie,$e,ze,Qe;if(typeof z=="number"){Ie={top:z,bottom:z,left:z,right:z,front:z,back:z,type:z===0?"VALID":"NUMBER"};var Xe=function(xr,Dn,Wa,br,xn,qa){xn==null&&(xn=dp(xr,Dn,br));var Vn=xr[0],za=xr[1],Oo=xr[2],_r=to((Vn-Dn+2*xn)/br+1,qa);V(mt(_r),function(){return"The output # of depths ("+_r+") must be an integer. Change the stride and/or zero pad parameters"});var $a=to((za-Dn+2*xn)/br+1,qa);V(mt($a),function(){return"The output # of rows ("+$a+") must be an integer. Change the stride and/or zero pad parameters"});var Ha=to((Oo-Dn+2*xn)/br+1,qa);return V(mt(Ha),function(){return"The output # of columns ("+Ha+") must be an integer. Change the stride and/or zero pad parameters"}),[_r,$a,Ha,Wa]}([K,re,ae,1],Me,1,Se,z,ue);$e=Xe[0],ze=Xe[1],Qe=Xe[2]}else if(z==="same"){$e=Math.ceil(K/Se),ze=Math.ceil(re/Ce),Qe=Math.ceil(ae/Pe);var Ze=($e-1)*Se+Me-K,mn=(ze-1)*Ce+ie-re,gn=(Qe-1)*Pe+ee-ae,Nt=Math.floor(Ze/2),yr=Ze-Nt,yn=Math.floor(mn/2),Fn=mn-yn,In=Math.floor(gn/2);Ie={top:yn,bottom:Fn,left:In,right:gn-In,front:Nt,back:yr,type:"SAME"}}else{if(z!=="valid")throw Error("Unknown padding parameter: "+z);Ie={top:0,bottom:0,left:0,right:0,front:0,back:0,type:"VALID"},$e=Math.ceil((K-Me+1)/Se),ze=Math.ceil((re-ie+1)/Ce),Qe=Math.ceil((ae-ee+1)/Pe)}return{padInfo:Ie,outDepth:$e,outHeight:ze,outWidth:Qe}}(a,c,p,f,w,E,D,N,T,P,s),M=F.padInfo,L=F.outDepth,A=F.outHeight,$=F.outWidth,q=o?x*d:x;return i==="channelsFirst"?h=[l,q,L,A,$]:i==="channelsLast"&&(h=[l,L,A,$,q]),{batchSize:l,dataFormat:i,inDepth:c,inHeight:p,inWidth:f,inChannels:d,outDepth:L,outHeight:A,outWidth:$,outChannels:q,padInfo:M,strideDepth:w,strideHeight:E,strideWidth:D,filterDepth:v,filterHeight:g,filterWidth:m,effectiveFilterDepth:N,effectiveFilterHeight:T,effectiveFilterWidth:P,dilationDepth:S,dilationHeight:_,dilationWidth:b,inShape:n,outShape:h,filterShape:t}}function dp(n,t,e,r){r===void 0&&(r=1);var a=ba(t,r);return Math.floor((n[0]*(e-1)-e+a)/2)}function _i(n){return typeof n=="number"?[n,n,n]:n.length===2?[n[0],n[1],1]:n}function su(n){return typeof n=="number"?[n,n,n]:n}function ba(n,t){return t<=1?n:n+(n-1)*(t-1)}function to(n,t){if(!t)return n;switch(t){case"round":return Math.round(n);case"ceil":return Math.ceil(n);case"floor":return Math.floor(n);default:throw new Error("Unknown roundingMode "+t)}}function Na(n){var t=_i(n),e=t[0],r=t[1],a=t[2];return e===1&&r===1&&a===1}function sn(n,t){return Na(n)||Na(t)}function Ou(n){if(n==="NHWC")return"channelsLast";if(n==="NCHW")return"channelsFirst";throw new Error("Unknown dataFormat "+n)}function pp(n,t,e){if(t==="complex64"){if(n.dtype==="complex64")return n.clone();var r=et(n.shape),a=n.toFloat(),o=e.complex(a,r);return r.dispose(),a.dispose(),o}if(!by(n.dtype,t))return W.makeTensorFromDataId(n.dataId,n.shape,t);if(n.dtype==="complex64"){var i=e.real(n);return o=i.cast(t),i.dispose(),o}if(t==="int32")return e.int(n);if(t==="bool"){var s=ce(0,n.dtype);return o=e.notEqual(n,s),s.dispose(),o}throw new Error("Error in Cast: failed to cast "+n.dtype+" to "+t)}function uu(n,t){return W.makeTensorFromDataId(n.dataId,t,n.dtype)}function fp(n,t,e){var r=(t-n)/(e-1),a=bo(e,"float32");a[0]=n;for(var o=1;o<a.length;o++)a[o]=a[o-1]+r;return yt(a,"float32")}function lu(n,t){if(n.length!==t.length)throw new Error("Cannot merge real and imag arrays of different lengths. real:"+n.length+", imag: "+t.length+".");for(var e=new Float32Array(2*n.length),r=0;r<e.length;r+=2)e[r]=n[r/2],e[r+1]=t[r/2];return e}function xc(n,t){return{real:n[2*t],imag:n[2*t+1]}}function Xx(n,t,e,r){n[2*r]=t,n[2*r+1]=e}function Yx(n,t,e){var r=(e?2:-2)*Math.PI*(n/t);return{real:Math.cos(r),imag:Math.sin(r)}}function Kx(n,t,e){var r=function(o,i,s){return function(u,l,c){for(var p=0,f=u.length,d=0,h=!1;p<f;){var v=c(l,u[d=p+(f-p>>>1)]);v>0?p=d+1:(f=d,h=!v)}return h?p:-p-1}(o,i,s||Jx)}(n,t,e),a=r<0?-(r+1):r;n.splice(a,0,t)}function Jx(n,t){return n>t?1:n<t?-1:0}function Mu(n,t,e,r,a){return hp(n,t,e,r,a,0).selectedIndices}function Fu(n,t,e,r,a,o){var i=hp(n,t,e,r,a,o);return i.numValidOutputs.dispose(),{selectedIndices:i.selectedIndices,selectedScores:i.selectedScores}}function hp(n,t,e,r,a,o,i,s){s===void 0&&(s=!1);for(var u=Array.from(t).map(function(w,E){return{score:w,boxIndex:E,suppressBeginIndex:0}}).filter(function(w){return w.score>a}).sort(bc),l=o>0?-.5/o:0,c=[],p=[];c.length<e&&u.length>0;){var f=u.pop(),d=f.score,h=f.boxIndex,v=f.suppressBeginIndex;if(d<a)break;for(var g=!1,m=c.length-1;m>=v;--m){var x=Qx(n,h,c[m]);if(x>=r){g=!0;break}if(f.score=f.score*Zx(r,l,x),f.score<=a)break}f.suppressBeginIndex=c.length,g||(f.score===d?(c.push(h),p.push(f.score)):f.score>a&&Kx(u,f,bc))}var y=c.length;return s&&(c.fill(0,y),p.fill(0,y)),{selectedIndices:yt(c,"int32"),selectedScores:yt(p,"float32"),numValidOutputs:ce(y,"int32")}}function Qx(n,t,e){var r=n.subarray(4*t,4*t+4),a=n.subarray(4*e,4*e+4),o=Math.min(r[0],r[2]),i=Math.min(r[1],r[3]),s=Math.max(r[0],r[2]),u=Math.max(r[1],r[3]),l=Math.min(a[0],a[2]),c=Math.min(a[1],a[3]),p=Math.max(a[0],a[2]),f=Math.max(a[1],a[3]),d=(s-o)*(u-i),h=(p-l)*(f-c);if(d<=0||h<=0)return 0;var v=Math.max(o,l),g=Math.max(i,c),m=Math.min(s,p),x=Math.min(u,f),y=Math.max(m-v,0)*Math.max(x-g,0);return y/(d+h-y)}function Zx(n,t,e){var r=Math.exp(t*e*e);return e<=n?r:0}function bc(n,t){return n.score-t.score||n.score===t.score&&t.boxIndex-n.boxIndex}function vp(n,t,e){var r=new Array(n.rank).fill(0),a=n.shape.slice();return t.map(function(o){a[e]=o;var i=n.slice(r,a);return r[e]+=o,i})}function mp(n,t){for(var e=new Array(n.rank),r=0;r<e.length;r++)e[r]=n.shape[r]*t[r];var a=Ne(e,n.dtype);for(r=0;r<a.values.length;++r){for(var o=a.indexToLoc(r),i=new Array(n.rank),s=0;s<i.length;s++)i[s]=o[s]%n.shape[s];var u=n.locToIndex(i);a.values[r]=n.values[u]}return a.toTensor()}function gp(n,t,e,r,a){for(var o=t[t.length-1],i=[n.length/o,o],s=i[0],u=i[1],l=ao(e,s*r),c=ao("int32",s*r),p=0;p<s;p++){for(var f=p*u,d=n.subarray(f,f+u),h=[],v=0;v<d.length;v++)h.push({value:d[v],index:v});h.sort(function(w,E){return E.value-w.value});var g=p*r,m=l.subarray(g,g+r),x=c.subarray(g,g+r);for(v=0;v<r;v++)m[v]=h[v].value,x[v]=h[v].index}var y=t.slice();return y[y.length-1]=r,[Ot(l,y,e),Ot(c,y,"int32")]}function Vu(n,t){for(var e=[],r=0;r<t.length;r++)t[r]&&e.push(r);var a=Ne(n,"int32"),o=Ne([e.length,n.length],"int32");for(r=0;r<e.length;r++){var i=a.indexToLoc(e[r]),s=r*n.length;o.values.set(i,s)}return o.toTensor()}var e1=function(n,t){this.outputShape=[],this.outputShape=n,this.variableNames=t.map(function(a,o){return"T"+o});var e=[];this.variableNames.forEach(function(a){e.push("float v"+a+" = get"+a+"AtOutCoords();")});var r=this.variableNames.map(function(a){return"v"+a}).join(" + ");this.userCode=`
      void main() {
        `+e.join(`
        `)+`

        float result = `+r+`;
        setOutput(result);
      }
    `},t1=function(n,t){this.outputShape=[],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=n,this.variableNames=t.map(function(a,o){return"T"+o});var e=[];this.variableNames.forEach(function(a){e.push("vec4 v"+a+" = get"+a+"AtOutCoords();")});var r=this.variableNames.map(function(a){return"v"+a}).join(" + ");this.userCode=`
      void main() {
        `+e.join(`
        `)+`

        vec4 result = `+r+`;
        setOutput(result);
      }
    `},n1=function(n,t,e){this.variableNames=["A"];var r=n.windowSize,a=n.batchSize,o=n.inSize,i=Math.ceil(o/r);e||this.variableNames.push("bestIndicesA"),this.outputShape=[a,i];var s=t==="max"?">":"<",u=e?"inOffset + i;":"round(getBestIndicesA(batch, inOffset + i));";this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = outIdx * `+r+`;

        int bestIndex = inOffset;
        float bestValue = getA(batch, bestIndex);

        for (int i = 0; i < `+r+`; i++) {
          int inIdx = `+u+`;
          float candidate = getA(batch, inIdx);
          if (candidate `+s+` bestValue) {
            bestValue = candidate;
            bestIndex = inIdx;
          }
        }
        setOutput(float(bestIndex));
      }
    `};function yp(n,t){return["x","y","z","w","u","v"].slice(0,t).map(function(e){return n+"."+e})}function tn(n,t){return t===1?[n]:yp(n,t)}function qt(){var n,t,e,r,a,o,i,s,u,l;return J().getNumber("WEBGL_VERSION")===2?(n="#version 300 es",t="in",e="out",r="in",a="texture",o="outputColor",i="out vec4 outputColor;",s=`
      bool isnan_custom(float val) {
        return (val > 0.0 || val < 0.0) ? false : val != 0.0;
      }

      bvec4 isnan_custom(vec4 val) {
        return bvec4(isnan_custom(val.x),
          isnan_custom(val.y), isnan_custom(val.z), isnan_custom(val.w));
      }

      #define isnan(value) isnan_custom(value)
    `,u="",l=`
      #define round(value) newRound(value)
      int newRound(float value) {
        return int(floor(value + 0.5));
      }

      ivec4 newRound(vec4 value) {
        return ivec4(floor(value + vec4(0.5)));
      }
    `):(n="",t="attribute",e="varying",r="varying",a="texture2D",o="gl_FragColor",i="",s=`
      #define isnan(value) isnan_custom(value)
      bool isnan_custom(float val) {
        return (val > 0. || val < 1. || val == 0.) ? false : true;
      }
      bvec4 isnan_custom(vec4 val) {
        return bvec4(isnan(val.x), isnan(val.y), isnan(val.z), isnan(val.w));
      }
    `,u=`
      uniform float INFINITY;

      bool isinf(float val) {
        return abs(val) == INFINITY;
      }
      bvec4 isinf(vec4 val) {
        return equal(abs(val), vec4(INFINITY));
      }
    `,l=`
      int round(float value) {
        return int(floor(value + 0.5));
      }

      ivec4 round(vec4 value) {
        return ivec4(floor(value + vec4(0.5)));
      }
    `),{version:n,attribute:t,varyingVs:e,varyingFs:r,texture2D:a,output:o,defineOutput:i,defineSpecialNaN:s,defineSpecialInf:u,defineRound:l}}function Gr(n,t,e){e===void 0&&(e="index");var r=Gn(t);return r.map(function(a,o){return"int "+n[o]+" = "+e+" / "+a+"; "+(o===r.length-1?"int "+n[o+1]+" = "+e+" - "+n[o]+" * "+a:"index -= "+n[o]+" * "+a)+";"}).join("")}function Lu(n){var t=Gn(n).map(function(e){return e.toString()});return`
  int getFlatIndex(ivec3 coords) {
    return coords.x * `+t[0]+" + coords.y * "+t[1]+` + coords.z;
  }
`}var xp=`
  const float FLOAT_MAX = 1.70141184e38;
  const float FLOAT_MIN = 1.17549435e-38;

  lowp vec4 encode_float(highp float v) {
    if (isnan(v)) {
      return vec4(255, 255, 255, 255);
    }

    highp float av = abs(v);

    if(av < FLOAT_MIN) {
      return vec4(0.0, 0.0, 0.0, 0.0);
    } else if(v > FLOAT_MAX) {
      return vec4(0.0, 0.0, 128.0, 127.0) / 255.0;
    } else if(v < -FLOAT_MAX) {
      return vec4(0.0, 0.0,  128.0, 255.0) / 255.0;
    }

    highp vec4 c = vec4(0,0,0,0);

    highp float e = floor(log2(av));
    highp float m = exp2(fract(log2(av))) - 1.0;

    c[2] = floor(128.0 * m);
    m -= c[2] / 128.0;
    c[1] = floor(32768.0 * m);
    m -= c[1] / 32768.0;
    c[0] = floor(8388608.0 * m);

    highp float ebias = e + 127.0;
    c[3] = floor(ebias / 2.0);
    ebias -= c[3] * 2.0;
    c[2] += floor(ebias) * 128.0;

    c[3] += 128.0 * step(0.0, -v);

    return c / 255.0;
  }
`;function r1(n,t,e,r){var a=[];n.forEach(function(d){var h=ge(d.shapeInfo.logicalShape);d.shapeInfo.isUniform?a.push("uniform float "+d.name+(h>1?"["+h+"]":"")+";"):(a.push("uniform sampler2D "+d.name+";"),a.push("uniform int offset"+d.name+";"))});var o,i,s=a.join(`
`),u=n.map(function(d){return function(h,v,g){g===void 0&&(g=!1);var m="";m+=g?bp(h):fa(h);var x=h.shapeInfo.logicalShape,y=v.logicalShape;return x.length<=y.length&&(m+=g?function(w,E){var D,k=w.name,S=k.charAt(0).toUpperCase()+k.slice(1),_="get"+S+"AtOutCoords",b=w.shapeInfo.logicalShape.length,N=E.logicalShape.length,T=Ir(w.shapeInfo.logicalShape,E.logicalShape),P=Je(N),F=N-b,M=["x","y","z","w","u","v"];D=b===0?"":N<2&&T.length>=1?"coords = 0;":T.map(function(re){return"coords."+M[re+F]+" = 0;"}).join(`
`);var L="";L=N<2&&b>0?"coords":w.shapeInfo.logicalShape.map(function(re,ae){return"coords."+M[ae+F]}).join(", ");var A="return outputValue;",$=ge(w.shapeInfo.logicalShape)===1,q=ge(E.logicalShape)===1;if(b!==1||$||q){if($&&!q)A=N===1?`
        return vec4(outputValue.x, outputValue.x, 0., 0.);
      `:`
        return vec4(outputValue.x);
      `;else if(T.length){var z=b-2,K=b-1;T.indexOf(z)>-1&&T.indexOf(K)>-1?A="return vec4(outputValue.x);":T.indexOf(z)>-1?A="return vec4(outputValue.x, outputValue.y, outputValue.x, outputValue.y);":T.indexOf(K)>-1&&(A="return vec4(outputValue.xx, outputValue.zz);")}}else A=`
      return vec4(outputValue.xy, outputValue.xy);
    `;return`
    vec4 `+_+`() {
      `+P+` coords = getOutputCoords();
      `+D+`
      vec4 outputValue = get`+S+"("+L+`);
      `+A+`
    }
  `}(h,v):function(w,E){var D=w.name,k=D.charAt(0).toUpperCase()+D.slice(1),S="get"+k+"AtOutCoords",_=E.texShape,b=w.shapeInfo.texShape,N=w.shapeInfo.logicalShape.length,T=E.logicalShape.length;if(!w.shapeInfo.isUniform&&N===T&&w.shapeInfo.flatOffset==null&&kt(b,_))return`
      float `+S+`() {
        return sampleTexture(`+D+`, resultUV);
      }
    `;var P,F=Je(T),M=Ir(w.shapeInfo.logicalShape,E.logicalShape),L=T-N,A=["x","y","z","w","u","v"];P=N===0?"":T<2&&M.length>=1?"coords = 0;":M.map(function(q){return"coords."+A[q+L]+" = 0;"}).join(`
`);var $="";return $=T<2&&N>0?"coords":w.shapeInfo.logicalShape.map(function(q,z){return"coords."+A[z+L]}).join(", "),`
    float `+S+`() {
      `+F+` coords = getOutputCoords();
      `+P+`
      return get`+k+"("+$+`);
    }
  `}(h,v)),m}(d,t,r)}).join(`
`),l=t.texShape,c=qt(),p=function(d){return`
    float sampleTexture(sampler2D textureSampler, vec2 uv) {
      return `+d.texture2D+`(textureSampler, uv).r;
    }
  `}(c),f=function(d){return d.version+`
    precision highp float;
    precision highp int;
    precision highp sampler2D;
    `+d.varyingFs+` vec2 resultUV;
    `+d.defineOutput+`
    const vec2 halfCR = vec2(0.5, 0.5);

    struct ivec5
    {
      int x;
      int y;
      int z;
      int w;
      int u;
    };

    struct ivec6
    {
      int x;
      int y;
      int z;
      int w;
      int u;
      int v;
    };

    uniform float NAN;
    `+d.defineSpecialNaN+`
    `+d.defineSpecialInf+`
    `+d.defineRound+`

    int imod(int x, int y) {
      return x - y * (x / y);
    }

    int idiv(int a, int b, float sign) {
      int res = a / b;
      int mod = imod(a, b);
      if (sign < 0. && mod != 0) {
        res -= 1;
      }
      return res;
    }

    //Based on the work of Dave Hoskins
    //https://www.shadertoy.com/view/4djSRW
    #define HASHSCALE1 443.8975
    float random(float seed){
      vec2 p = resultUV * seed;
      vec3 p3  = fract(vec3(p.xyx) * HASHSCALE1);
      p3 += dot(p3, p3.yzx + 19.19);
      return fract((p3.x + p3.y) * p3.z);
    }

    `+a1+`
    `+o1+`
    `+i1+`
  `}(c);return t.isPacked?(o=function(d,h){switch(d.length){case 0:return`
    int getOutputCoords() {
      return 0;
    }
  `;case 1:return function(w,E){var D=[Math.ceil(E[0]/2),Math.ceil(E[1]/2)];return D[0]===1?`
      int getOutputCoords() {
        return 2 * int(resultUV.x * `+D[1]+`.0);
      }
    `:D[1]===1?`
      int getOutputCoords() {
        return 2 * int(resultUV.y * `+D[0]+`.0);
      }
    `:`
    int getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`+D[0]+", "+D[1]+`));
      return 2 * (resTexRC.x * `+D[1]+` + resTexRC.y);
    }
  `}(0,h);case 2:return function(w,E){var D=[Math.ceil(E[0]/2),Math.ceil(E[1]/2)];if(kt(w,E))return`
      ivec2 getOutputCoords() {
        return 2 * ivec2(resultUV.yx * vec2(`+D[0]+", "+D[1]+`));
      }
    `;var k=Math.ceil(w[1]/2);return`
    ivec2 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`+D[0]+", "+D[1]+`));

      int index = resTexRC.x * `+D[1]+` + resTexRC.y;
      int r = 2 * (index / `+k+`);
      int c = imod(index, `+k+`) * 2;

      return ivec2(r, c);
    }
  `}(d,h);case 3:return v=d,g=h,m=[Math.ceil(g[0]/2),Math.ceil(g[1]/2)],x=Math.ceil(v[2]/2),y=x*Math.ceil(v[1]/2),`
    ivec3 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`+m[0]+", "+m[1]+`));
      int index = resTexRC.x * `+m[1]+` + resTexRC.y;

      int b = index / `+y+`;
      index -= b * `+y+`;

      int r = 2 * (index / `+x+`);
      int c = imod(index, `+x+`) * 2;

      return ivec3(b, r, c);
    }
  `;default:return function(w,E){for(var D=[Math.ceil(E[0]/2),Math.ceil(E[1]/2)],k=Math.ceil(w[w.length-1]/2),S=k*Math.ceil(w[w.length-2]/2),_=S,b="",N="b, r, c",T=2;T<w.length-1;T++)_*=w[w.length-T-1],b=`
      int b`+T+" = index / "+_+`;
      index -= b`+T+" * "+_+`;
    `+b,N="b"+T+", "+N;return`
    ivec`+w.length+` getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`+D[0]+", "+D[1]+`));
      int index = resTexRC.x * `+D[1]+` + resTexRC.y;

      `+b+`

      int b = index / `+S+`;
      index -= b * `+S+`;

      int r = 2 * (index / `+k+`);
      int c = imod(index, `+k+`) * 2;

      return ivec`+w.length+"("+N+`);
    }
  `}(d,h)}var v,g,m,x,y}(t.logicalShape,l),i=function(d){return`
    void setOutput(vec4 val) {
      `+d.output+` = val;
    }
  `}(c)):(o=function(d,h){switch(d.length){case 0:return`
    int getOutputCoords() {
      return 0;
    }
  `;case 1:return function(m,x){return x[0]===1?`
      int getOutputCoords() {
        return int(resultUV.x * `+x[1]+`.0);
      }
    `:x[1]===1?`
      int getOutputCoords() {
        return int(resultUV.y * `+x[0]+`.0);
      }
    `:`
    int getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`+x[0]+", "+x[1]+`));
      return resTexRC.x * `+x[1]+` + resTexRC.y;
    }
  `}(0,h);case 2:return function(m,x){return kt(m,x)?`
      ivec2 getOutputCoords() {
        return ivec2(resultUV.yx * vec2(`+x[0]+", "+x[1]+`));
      }
    `:m[1]===1?`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(`+x[0]+", "+x[1]+`));
        int index = resTexRC.x * `+x[1]+` + resTexRC.y;
        return ivec2(index, 0);
      }
    `:m[0]===1?`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(`+x[0]+", "+x[1]+`));
        int index = resTexRC.x * `+x[1]+` + resTexRC.y;
        return ivec2(0, index);
      }
    `:`
    ivec2 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`+x[0]+", "+x[1]+`));
      int index = resTexRC.x * `+x[1]+` + resTexRC.y;
      int r = index / `+m[1]+`;
      int c = index - r * `+m[1]+`;
      return ivec2(r, c);
    }
  `}(d,h);case 3:return v=h,g=Gr(["r","c","d"],d),`
    ivec3 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`+v[0]+", "+v[1]+`));
      int index = resTexRC.x * `+v[1]+` + resTexRC.y;
      `+g+`
      return ivec3(r, c, d);
    }
  `;case 4:return function(m,x){var y=Gr(["r","c","d","d2"],m);return`
    ivec4 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
        vec2(`+x[0]+", "+x[1]+`));
      int index = resTexRC.x * `+x[1]+` + resTexRC.y;
      `+y+`
      return ivec4(r, c, d, d2);
    }
  `}(d,h);case 5:return function(m,x){var y=Gr(["r","c","d","d2","d3"],m);return`
    ivec5 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx * vec2(`+x[0]+`,
                             `+x[1]+`));

      int index = resTexRC.x * `+x[1]+` + resTexRC.y;

      `+y+`

      ivec5 outShape = ivec5(r, c, d, d2, d3);
      return outShape;
    }
  `}(d,h);case 6:return function(m,x){var y=Gr(["r","c","d","d2","d3","d4"],m);return`
    ivec6 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
        vec2(`+x[0]+", "+x[1]+`));
      int index = resTexRC.x * `+x[1]+` + resTexRC.y;

      `+y+`

      ivec6 result = ivec6(r, c, d, d2, d3, d4);
      return result;
    }
  `}(d,h);default:throw new Error(d.length+"-D output sampling is not yet supported")}var v,g}(t.logicalShape,l),i=function(d){return`
    void setOutput(float val) {
      `+d.output+` = vec4(val, 0, 0, 0);
    }
  `}(c)),r&&(f+=s1),[f,p,i,s,o,u,e].join(`
`)}function fa(n){var t=n.shapeInfo.logicalShape;switch(t.length){case 0:return function(e){var r=e.name,a="get"+r.charAt(0).toUpperCase()+r.slice(1);if(e.shapeInfo.isUniform)return"float "+a+"() {return "+r+";}";var o=e.shapeInfo.texShape,i=o[0],s=o[1];if(i===1&&s===1)return`
      float `+a+`() {
        return sampleTexture(`+r+`, halfCR);
      }
    `;var u=e.shapeInfo.texShape,l=u[0],c=u[1],p=Wr(r);return`
    float `+a+`() {
      vec2 uv = uvFromFlat(`+l+", "+c+", "+p+`);
      return sampleTexture(`+r+`, uv);
    }
  `}(n);case 1:return function(e){var r=e.name,a="get"+r.charAt(0).toUpperCase()+r.slice(1);if(e.shapeInfo.isUniform)return`
      float `+a+`(int index) {
        `+ua(e)+`
      }
    `;var o=e.shapeInfo.texShape,i=o[0],s=o[1];if(s===1&&i===1)return`
      float `+a+`(int index) {
        return sampleTexture(`+r+`, halfCR);
      }
    `;var u=Wr(r);return s===1?`
      float `+a+`(int index) {
        vec2 uv = vec2(0.5, (float(index + `+u+") + 0.5) / "+i+`.0);
        return sampleTexture(`+r+`, uv);
      }
    `:i===1?`
      float `+a+`(int index) {
        vec2 uv = vec2((float(index + `+u+") + 0.5) / "+s+`.0, 0.5);
        return sampleTexture(`+r+`, uv);
      }
    `:`
    float `+a+`(int index) {
      vec2 uv = uvFromFlat(`+i+", "+s+", index + "+u+`);
      return sampleTexture(`+r+`, uv);
    }
  `}(n);case 2:return function(e){var r=e.shapeInfo.logicalShape,a=e.name,o="get"+a.charAt(0).toUpperCase()+a.slice(1),i=e.shapeInfo.texShape;if(i!=null&&kt(r,i)){var s=i[0],u=i[1];return`
    float `+o+`(int row, int col) {
      vec2 uv = (vec2(col, row) + halfCR) / vec2(`+u+".0, "+s+`.0);
      return sampleTexture(`+a+`, uv);
    }
  `}var l=Hr(r),c=l.newShape,p=l.keptDims,f=c;if(f.length<r.length){var d=ha(e,f);return`
      `+fa(d)+`
      float `+o+`(int row, int col) {
        return `+o+"("+va(["row","col"],p)+`);
      }
    `}if(e.shapeInfo.isUniform)return`
      float `+o+`(int row, int col) {
        int index = round(dot(vec2(row, col), vec2(`+r[1]+`, 1)));
        `+ua(e)+`
      }
    `;var h=i[0],v=i[1],g=Wr(a);return v===1?`
    float `+o+`(int row, int col) {
      float index = dot(vec3(row, col, `+g+"), vec3("+r[1]+`, 1, 1));
      vec2 uv = vec2(0.5, (index + 0.5) / `+h+`.0);
      return sampleTexture(`+a+`, uv);
    }
  `:h===1?`
    float `+o+`(int row, int col) {
      float index = dot(vec3(row, col, `+g+"), vec3("+r[1]+`, 1, 1));
      vec2 uv = vec2((index + 0.5) / `+v+`.0, 0.5);
      return sampleTexture(`+a+`, uv);
    }
  `:`
  float `+o+`(int row, int col) {
    // Explicitly use integer operations as dot() only works on floats.
    int index = row * `+r[1]+" + col + "+g+`;
    vec2 uv = uvFromFlat(`+h+", "+v+`, index);
    return sampleTexture(`+a+`, uv);
  }
`}(n);case 3:return function(e){var r=e.shapeInfo.logicalShape,a=e.name,o="get"+a.charAt(0).toUpperCase()+a.slice(1),i=r[1]*r[2],s=r[2],u=Hr(r),l=u.newShape,c=u.keptDims,p=l;if(p.length<r.length){var f=ha(e,p);return`
        `+fa(f)+`
        float `+o+`(int row, int col, int depth) {
          return `+o+"("+va(["row","col","depth"],c)+`);
        }
      `}if(e.shapeInfo.isUniform)return`
      float `+o+`(int row, int col, int depth) {
        int index = round(dot(vec3(row, col, depth),
                          vec3(`+i+", "+s+`, 1)));
        `+ua(e)+`
      }
    `;var d=e.shapeInfo.texShape,h=d[0],v=d[1],g=e.shapeInfo.flatOffset;if(v===i&&g==null)return`
        float `+o+`(int row, int col, int depth) {
          float texR = float(row);
          float texC = dot(vec2(col, depth), vec2(`+s+`, 1));
          vec2 uv = (vec2(texC, texR) + halfCR) /
                     vec2(`+v+".0, "+h+`.0);
          return sampleTexture(`+a+`, uv);
        }
      `;if(v===s&&g==null)return`
    float `+o+`(int row, int col, int depth) {
      float texR = dot(vec2(row, col), vec2(`+r[1]+`, 1));
      float texC = float(depth);
      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(`+v+".0, "+h+`.0);
      return sampleTexture(`+a+`, uv);
    }
  `;var m=Wr(a);return`
      float `+o+`(int row, int col, int depth) {
        // Explicitly use integer operations as dot() only works on floats.
        int index = row * `+i+" + col * "+s+" + depth + "+m+`;
        vec2 uv = uvFromFlat(`+h+", "+v+`, index);
        return sampleTexture(`+a+`, uv);
      }
  `}(n);case 4:return function(e){var r=e.shapeInfo.logicalShape,a=e.name,o="get"+a.charAt(0).toUpperCase()+a.slice(1),i=r[3],s=r[2]*i,u=r[1]*s,l=Hr(r),c=l.newShape,p=l.keptDims;if(c.length<r.length){var f=ha(e,c);return`
      `+fa(f)+`
      float `+o+`(int row, int col, int depth, int depth2) {
        return `+o+"("+va(["row","col","depth","depth2"],p)+`);
      }
    `}if(e.shapeInfo.isUniform)return`
      float `+o+`(int row, int col, int depth, int depth2) {
        int index = round(dot(vec4(row, col, depth, depth2),
                          vec4(`+u+", "+s+", "+i+`, 1)));
        `+ua(e)+`
      }
    `;var d=e.shapeInfo.flatOffset,h=e.shapeInfo.texShape,v=h[0],g=h[1];if(g===u&&d==null)return`
      float `+o+`(int row, int col, int depth, int depth2) {
        float texR = float(row);
        float texC =
            dot(vec3(col, depth, depth2),
                vec3(`+s+", "+i+`, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(`+g+".0, "+v+`.0);
        return sampleTexture(`+a+`, uv);
      }
    `;if(g===i&&d==null)return`
      float `+o+`(int row, int col, int depth, int depth2) {
        float texR = dot(vec3(row, col, depth),
                         vec3(`+r[1]*r[2]+", "+r[2]+`, 1));
        float texC = float(depth2);
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(`+g+".0, "+v+`.0);
        return sampleTexture(`+a+`, uv);
      }
    `;var m=Wr(a);return`
    float `+o+`(int row, int col, int depth, int depth2) {
      // Explicitly use integer operations as dot() only works on floats.
      int index = row * `+u+" + col * "+s+` +
          depth * `+i+` + depth2;
      vec2 uv = uvFromFlat(`+v+", "+g+", index + "+m+`);
      return sampleTexture(`+a+`, uv);
    }
  `}(n);case 5:return function(e){var r=e.shapeInfo.logicalShape,a=e.name,o="get"+a.charAt(0).toUpperCase()+a.slice(1),i=r[4],s=r[3]*i,u=r[2]*s,l=r[1]*u,c=Hr(r),p=c.newShape,f=c.keptDims;if(p.length<r.length){var d=ha(e,p);return`
      `+fa(d)+`
      float `+o+`(int row, int col, int depth, int depth2, int depth3) {
        return `+o+"("+va(["row","col","depth","depth2","depth3"],f)+`);
      }
    `}if(e.shapeInfo.isUniform)return`
      float `+o+`(int row, int col, int depth, int depth2, int depth3) {
        float index = dot(
          vec4(row, col, depth, depth2),
          vec4(`+l+", "+u+", "+s+", "+i+`)) +
          depth3;
        `+ua(e)+`
      }
    `;var h=e.shapeInfo.flatOffset,v=e.shapeInfo.texShape,g=v[0],m=v[1];if(m===l&&h==null)return`
      float `+o+`(int row, int col, int depth, int depth2, int depth3) {
        int texR = row;
        float texC = dot(vec4(col, depth, depth2, depth3),
                         vec4(`+u+", "+s+", "+i+`, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(`+m+".0, "+g+`.0);
        return sampleTexture(`+a+`, uv);
      }
    `;if(m===i&&h==null)return`
      float `+o+`(int row, int col, int depth, int depth2, int depth3) {
        float texR = dot(
          vec4(row, col, depth, depth2),
          vec4(`+r[1]*r[2]*r[3]+`,
               `+r[2]*r[3]+", "+r[3]+`, 1));
        int texC = depth3;
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(`+m+".0, "+g+`.0);
        return sampleTexture(`+a+`, uv);
      }
    `;var x=Wr(a);return`
    float `+o+`(int row, int col, int depth, int depth2, int depth3) {
      // Explicitly use integer operations as dot() only works on floats.
      int index = row * `+l+" + col * "+u+" + depth * "+s+` +
          depth2 * `+i+" + depth3 + "+x+`;
      vec2 uv = uvFromFlat(`+g+", "+m+`, index);
      return sampleTexture(`+a+`, uv);
    }
  `}(n);case 6:return function(e){var r=e.shapeInfo.logicalShape,a=e.name,o="get"+a.charAt(0).toUpperCase()+a.slice(1),i=Hr(r),s=i.newShape,u=i.keptDims;if(s.length<r.length){var l=ha(e,s);return`
      `+fa(l)+`
      float `+o+`(int row, int col, int depth,
                    int depth2, int depth3, int depth4) {
        return `+o+"("+va(["row","col","depth","depth2","depth3","depth4"],u)+`);
      }
    `}var c=r[5],p=r[4]*c,f=r[3]*p,d=r[2]*f,h=r[1]*d;if(e.shapeInfo.isUniform)return`
      float `+o+`(int row, int col, int depth,
                  int depth2, int depth3, int depth4) {
        int index = round(dot(
          vec4(row, col, depth, depth2),
          vec4(`+h+", "+d+", "+f+", "+p+`)) +
          dot(
            vec2(depth3, depth4),
            vec2(`+c+`, 1)));
        `+ua(e)+`
      }
    `;var v=e.shapeInfo.flatOffset,g=e.shapeInfo.texShape,m=g[0],x=g[1];if(x===h&&v==null)return`
      float `+o+`(int row, int col, int depth,
                    int depth2, int depth3, int depth4) {
        int texR = row;
        float texC = dot(vec4(col, depth, depth2, depth3),
          vec4(`+d+", "+f+", "+p+", "+c+`)) +
               float(depth4);
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(`+x+".0, "+m+`.0);
        return sampleTexture(`+a+`, uv);
      }
    `;if(x===c&&v==null)return`
      float `+o+`(int row, int col, int depth,
                    int depth2, int depth3, int depth4) {
        float texR = dot(vec4(row, col, depth, depth2),
          vec4(`+r[1]*r[2]*r[3]*r[4]+`,
               `+r[2]*r[3]*r[4]+`,
               `+r[3]*r[4]+`,
               `+r[4]+`)) + float(depth3);
        int texC = depth4;
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(`+x+".0, "+m+`.0);
        return sampleTexture(`+a+`, uv);
      }
    `;var y=Wr(a);return`
    float `+o+`(int row, int col, int depth,
                  int depth2, int depth3, int depth4) {
      // Explicitly use integer operations as dot() only works on floats.
      int index = row * `+h+" + col * "+d+" + depth * "+f+` +
          depth2 * `+p+" + depth3 * "+c+" + depth4 + "+y+`;
      vec2 uv = uvFromFlat(`+m+", "+x+`, index);
      return sampleTexture(`+a+`, uv);
    }
  `}(n);default:throw new Error(t.length+"-D input sampling is not yet supported")}}function bp(n){var t,e,r;switch(n.shapeInfo.logicalShape.length){case 0:return t=n.name,e="get"+t.charAt(0).toUpperCase()+t.slice(1),r=qt(),`
    vec4 `+e+`() {
      return `+r.texture2D+"("+t+`, halfCR);
    }
  `;case 1:return function(a){var o=a.name,i="get"+o.charAt(0).toUpperCase()+o.slice(1),s=a.shapeInfo.texShape,u=[Math.ceil(s[0]/2),Math.ceil(s[1]/2)],l=qt();return`
    vec4 `+i+`(int index) {
      vec2 uv = packedUVfrom1D(
        `+u[0]+", "+u[1]+`, index);
      return `+l.texture2D+"("+o+`, uv);
    }
  `}(n);case 2:return function(a){var o=a.shapeInfo.logicalShape,i=a.name,s="get"+i.charAt(0).toUpperCase()+i.slice(1),u=a.shapeInfo.texShape,l=u[0],c=u[1],p=qt();if(u!=null&&kt(o,u))return`
      vec4 `+s+`(int row, int col) {
        vec2 uv = (vec2(col, row) + halfCR) / vec2(`+c+".0, "+l+`.0);

        return `+p.texture2D+"("+i+`, uv);
      }
    `;var f=[Math.ceil(u[0]/2),Math.ceil(u[1]/2)],d=Math.ceil(o[1]/2);return`
    vec4 `+s+`(int row, int col) {
      vec2 uv = packedUVfrom2D(`+d+", "+f[0]+", "+f[1]+`, row, col);
      return `+p.texture2D+"("+i+`, uv);
    }
  `}(n);case 3:return function(a){var o=a.shapeInfo.logicalShape,i=a.name,s="get"+i.charAt(0).toUpperCase()+i.slice(1),u=a.shapeInfo.texShape,l=[Math.ceil(u[0]/2),Math.ceil(u[1]/2)];if(o[0]===1){var c=o.slice(1),p=ha(a,c);return`
        `+bp(p)+`
        vec4 `+s+`(int b, int row, int col) {
          return `+s+"("+va(["b","row","col"],[1,2])+`);
        }
      `}var f=l[0],d=l[1],h=Math.ceil(o[2]/2),v=h*Math.ceil(o[1]/2),g=qt();return`
    vec4 `+s+`(int b, int row, int col) {
      vec2 uv = packedUVfrom3D(
        `+f+", "+d+", "+v+", "+h+`, b, row, col);
      return `+g.texture2D+"("+i+`, uv);
    }
  `}(n);default:return function(a){for(var o=a.shapeInfo.logicalShape,i=o.length,s=a.name,u="get"+s.charAt(0).toUpperCase()+s.slice(1),l=a.shapeInfo.texShape,c=[Math.ceil(l[0]/2),Math.ceil(l[1]/2)],p=c[0],f=c[1],d=Math.ceil(o[i-1]/2),h=d*Math.ceil(o[i-2]/2),v="int b, int row, int col",g="b * "+h+" + (row / 2) * "+d+" + (col / 2)",m=2;m<i-1;m++)v="int b"+m+", "+v,h*=o[i-m-1],g="b"+m+" * "+h+" + "+g;var x=qt();return`
    vec4 `+u+"("+v+`) {
      int index = `+g+`;
      int texR = index / `+f+`;
      int texC = index - texR * `+f+`;
      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(`+f+", "+p+`);
      return `+x.texture2D+"("+s+`, uv);
    }
  `}(n)}}var a1=`
vec2 uvFromFlat(int texNumR, int texNumC, int index) {
  int texR = index / texNumC;
  int texC = index - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
vec2 packedUVfrom1D(int texNumR, int texNumC, int index) {
  int texelIndex = index / 2;
  int texR = texelIndex / texNumC;
  int texC = texelIndex - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
`,o1=`
vec2 packedUVfrom2D(int texelsInLogicalRow, int texNumR,
  int texNumC, int row, int col) {
  int texelIndex = (row / 2) * texelsInLogicalRow + (col / 2);
  int texR = texelIndex / texNumC;
  int texC = texelIndex - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
`,i1=`
vec2 packedUVfrom3D(int texNumR, int texNumC,
    int texelsInBatch, int texelsInLogicalRow, int b,
    int row, int col) {
  int index = b * texelsInBatch + (row / 2) * texelsInLogicalRow + (col / 2);
  int texR = index / texNumC;
  int texC = index - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
`,s1=`
  float getChannel(vec4 frag, vec2 innerDims) {
    vec2 modCoord = mod(innerDims, 2.);
    return modCoord.x == 0. ?
      (modCoord.y == 0. ? frag.r : frag.g) :
      (modCoord.y == 0. ? frag.b : frag.a);
  }
  float getChannel(vec4 frag, int dim) {
    float modCoord = mod(float(dim), 2.);
    return modCoord == 0. ? frag.r : frag.g;
  }
`;function Wr(n){return"offset"+n}function ua(n){var t=n.name,e=ge(n.shapeInfo.logicalShape);return e<2?"return "+t+";":`
    for (int i = 0; i < `+e+`; i++) {
      if (i == index) {
        return `+t+`[i];
      }
    }
  `}function Je(n){if(n<=1)return"int";if(n===2)return"ivec2";if(n===3)return"ivec3";if(n===4)return"ivec4";if(n===5)return"ivec5";if(n===6)return"ivec6";throw Error("GPU for rank "+n+" is not yet supported")}function ha(n,t){var e=JSON.parse(JSON.stringify(n));return e.shapeInfo.logicalShape=t,e}function va(n,t){return t.map(function(e){return n[e]}).join(", ")}var u1=function(n,t,e,r){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,V(n.length>2,function(){return"Packed arg"+(e.charAt(0).toUpperCase()+e.slice(1))+" supports only inputs with rank above 2."});var a=n[n.length-1],o=Math.ceil(a/t);this.outputShape=n.slice(0,-1),o>1&&this.outputShape.push(o),r||this.variableNames.push("bestIndicesA");var i,s,u=this.outputShape,l=u.length,c=Je(l),p=tn("coords",l);if(o===1){var f=Je(s=l+1);i=`
        `+f+" sourceLocR = "+f+"("+p.join()+`, 0);
        ++`+p[l-1]+`;
        `+f+" sourceLocG = "+f+"("+p.join()+`, 0);
        ++`+p[l-2]+`;
        `+f+" sourceLocA = "+f+"("+p.join()+`, 0);
        --`+p[l-1]+`;
        `+f+" sourceLocB = "+f+"("+p.join()+`, 0);
        --`+p[l-2]+";"}else s=l,i=`
        `+c+` sourceLocR = coords;
        ++`+p[l-1]+`;
        `+c+` sourceLocG = coords;
        ++`+p[l-2]+`;
        `+c+` sourceLocA = coords;
        --`+p[l-1]+`;
        `+c+` sourceLocB = coords;
        --`+p[l-2]+";";var d=["x","y","z","w","u","v"].slice(0,s),h="."+d[s-1],v=d.map(function(S){return"int "+S}),g=tn("sourceLocR",s-1).concat("inIdx.r"),m=tn("sourceLocG",s-1).concat("inIdx.g"),x=tn("sourceLocB",s-1).concat("inIdx.b"),y=tn("sourceLocA",s-1).concat("inIdx.a"),w=e==="max"?"greaterThan":"lessThan",E=r?"":`
          inIdx = round(vec4(getBestIndicesAChannel(`+g.join()+`),
                             getBestIndicesAChannel(`+m.join()+`),
                             getBestIndicesAChannel(`+x.join()+`),
                             getBestIndicesAChannel(`+y.join()+")));",D=`vec4(
            getAChannel(`+g.join()+`),
            hasNextCol ? getAChannel(`+m.join()+`) : 0.,
            hasNextRow ? getAChannel(`+x.join()+`) : 0.,
            hasNextRow && hasNextCol ? getAChannel(`+y.join()+") : 0.)",k=r?"":`
      float getBestIndicesAChannel(`+v.join()+`) {
        return getChannel(getBestIndicesA(`+d.join()+`),
                                          vec2(`+d.slice(-2).join()+`));
      }`;this.userCode=`
      float getAChannel(`+v.join()+`) {
        return getChannel(getA(`+d.join()+`),
                               vec2(`+d.slice(-2).join()+`));
      }
      `+k+`
      void main() {
        `+c+` coords = getOutputCoords();
        bool hasNextCol = `+p[l-1]+" < "+(u[l-1]-1)+`;
        bool hasNextRow = `+p[l-2]+" < "+(u[l-2]-1)+`;
        `+i+`
        ivec4 srcIdx = ivec4(sourceLocR`+h+", sourceLocG"+h+`,
          sourceLocB`+h+", sourceLocA"+h+") * "+t+`;
        ivec4 inIdx = srcIdx;
        vec4 bestIndex = vec4(inIdx);
        vec4 bestValue = `+D+`;

        for (int i = 0; i < `+t+`; i++) {
          inIdx = srcIdx;
          `+E+`
          vec4 candidate = `+D+`;
          bvec4 nan = isnan(candidate);
          bvec4 replace = bvec4(
            vec4(`+w+`(candidate, bestValue)) * (vec4(1.0) - vec4(nan)));

          bestValue = vec4(replace.x  ? candidate.x : bestValue.x,
                           replace.y  ? candidate.y : bestValue.y,
                           replace.z  ? candidate.z : bestValue.z,
                           replace.w  ? candidate.w : bestValue.w);
          bestIndex = mix(bestIndex, vec4(inIdx), vec4(replace));
          srcIdx++;
        }
        setOutput(bestIndex);
      }
    `},l1=function(n){this.variableNames=["dy"],this.outputShape=n.inShape;var t=n.filterHeight,e=n.filterWidth,r=n.strideHeight,a=n.strideWidth,o=n.dilationHeight,i=n.dilationWidth,s=n.effectiveFilterHeight,u=n.effectiveFilterWidth,l=s-1-n.padInfo.top,c=u-1-n.padInfo.left,p=1/(t*e);this.userCode=`
      const ivec2 pads = ivec2(`+l+", "+c+`);
      const float avgMultiplier = float(`+p+`);

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];

        ivec2 dyRCCorner = coords.yz - pads;
        int dyRCorner = dyRCCorner.x;
        int dyCCorner = dyRCCorner.y;

        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < `+s+`;
            wR += `+o+`) {
          float dyR = float(dyRCorner + wR) / `+r+`.0;

          if (dyR < 0.0 || dyR >= `+n.outHeight+`.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          for (int wC = 0; wC < `+u+`;
            wC+= `+i+`) {
            float dyC = float(dyCCorner + wC) / `+a+`.0;

            if (dyC < 0.0 || dyC >= `+n.outWidth+`.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            float dyValue = getDy(b, idyR, idyC, d);

            dotProd += dyValue * avgMultiplier;
          }
        }
        setOutput(dotProd);
      }
    `},c1=function(n){this.variableNames=["dy"],this.outputShape=n.inShape;var t=n.filterDepth,e=n.filterHeight,r=n.filterWidth,a=n.strideDepth,o=n.strideHeight,i=n.strideWidth,s=n.dilationDepth,u=n.dilationHeight,l=n.dilationWidth,c=n.effectiveFilterDepth,p=n.effectiveFilterHeight,f=n.effectiveFilterWidth,d=c-1-n.padInfo.front,h=p-1-n.padInfo.top,v=f-1-n.padInfo.left,g=1/(t*e*r);this.userCode=`
      const ivec3 pads = ivec3(`+d+", "+h+", "+v+`);
      const float avgMultiplier = float(`+g+`);

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int ch = coords.u;

        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;
        int dyDCorner = dyCorner.x;
        int dyRCorner = dyCorner.y;
        int dyCCorner = dyCorner.z;

        // Convolve dy(?, ?, ?, d) with pos mask(:, :, :, ch) to get
        // dx(xD, xR, xC, ch).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;

        for (int wD = 0; wD < `+c+`;
            wD += `+s+`) {
          float dyD = float(dyDCorner + wD) / `+a+`.0;

          if (dyD < 0.0 || dyD >= `+n.outDepth+`.0 || fract(dyD) > 0.0) {
            continue;
          }
          int idyD = int(dyD);

          for (int wR = 0; wR < `+p+`;
              wR += `+u+`) {
            float dyR = float(dyRCorner + wR) / `+o+`.0;

            if (dyR < 0.0 || dyR >= `+n.outHeight+`.0 ||
                fract(dyR) > 0.0) {
              continue;
            }
            int idyR = int(dyR);

            for (int wC = 0; wC < `+f+`;
                wC += `+l+`) {
              float dyC = float(dyCCorner + wC) / `+i+`.0;

              if (dyC < 0.0 || dyC >= `+n.outWidth+`.0 ||
                  fract(dyC) > 0.0) {
                continue;
              }
              int idyC = int(dyC);

              float dyValue = getDy(batch, idyD, idyR, idyC, ch);

              dotProd += dyValue * avgMultiplier;
            }
          }
        }
        setOutput(dotProd);
      }
    `},d1=function(n,t,e,r,a,o){this.outputShape=[],this.variableNames=["x","mean","variance"],Le(n,t),Le(n,e);var i="0.0";r!=null&&(Le(n,r),this.variableNames.push("offset"),i="getOffsetAtOutCoords()");var s="1.0";a!=null&&(Le(n,a),this.variableNames.push("scale"),s="getScaleAtOutCoords()"),this.outputShape=n,this.userCode=`
      void main() {
        float x = getXAtOutCoords();
        float mean = getMeanAtOutCoords();
        float variance = getVarianceAtOutCoords();
        float offset = `+i+`;
        float scale = `+s+`;
        float inv = scale * inversesqrt(variance + float(`+o+`));
        setOutput(dot(vec3(x, -mean, offset), vec3(inv, inv, 1)));
      }
    `},p1=function(n,t,e,r,a,o){this.packedInputs=!0,this.packedOutput=!0,this.variableNames=["x","mean","variance"],Le(n,t),Le(n,e);var i="vec4(0.0)";r!=null&&(Le(n,r),this.variableNames.push("offset"),i="getOffsetAtOutCoords()");var s="vec4(1.0)";a!=null&&(Le(n,a),this.variableNames.push("scale"),s="getScaleAtOutCoords()"),this.outputShape=n,this.userCode=`
      void main() {
        vec4 offset = `+i+`;
        vec4 scale = `+s+`;

        vec4 x = getXAtOutCoords();
        vec4 mean = getMeanAtOutCoords();
        vec4 variance = getVarianceAtOutCoords();

        vec4 inv = scale * inversesqrt(variance + vec4(`+o+`));

        setOutput((x - mean) * inv + offset);
      }
    `},f1="return areal * breal - aimag * bimag;",h1="return areal * bimag + aimag * breal;",_c=function(n,t,e){this.variableNames=["AReal","AImag","BReal","BImag"],this.outputShape=Le(t,e),this.userCode=`
      float binaryOpComplex(
          float areal, float aimag, float breal, float bimag) {
        `+n+`
      }

      void main() {
        float areal = getARealAtOutCoords();
        float aimag = getAImagAtOutCoords();
        float breal = getBRealAtOutCoords();
        float bimag = getBImagAtOutCoords();
        setOutput(binaryOpComplex(areal, aimag, breal, bimag));
      }
    `},Ts="return a + b;",Ns="return a - b;",wc="return a * b;",_p="return (a < 0.) ? b * a : a;",ut=function(n,t,e){this.variableNames=["A","B"],this.outputShape=Le(t,e),this.userCode=`
      float binaryOperation(float a, float b) {
        `+n+`
      }

      void main() {
        float a = getAAtOutCoords();
        float b = getBAtOutCoords();
        setOutput(binaryOperation(a, b));
      }
    `},wp=`
  vec4 aLessThanZero = vec4(lessThan(a, vec4(0.)));
  return (aLessThanZero * (b * a)) + ((vec4(1.0) - aLessThanZero) * a);
`,rr=function(n,t,e,r){r===void 0&&(r=!1),this.variableNames=["A","B"],this.supportsBroadcasting=!0,this.packedInputs=!0,this.packedOutput=!0,this.outputShape=Le(t,e);var a=this.outputShape.length,o="";if(r)if(a===0||ge(this.outputShape)===1)o=`
          result.y = 0.;
          result.z = 0.;
          result.w = 0.;
        `;else if(o=`
          `+Je(a)+` coords = getOutputCoords();
        `,a===1)o+=`
            result.y = (coords + 1) >= `+this.outputShape[0]+` ? 0. : result.y;
            result.z = 0.;
            result.w = 0.;
          `;else{var i=tn("coords",a);o+=`
            bool nextRowOutOfBounds =
              (`+i[a-2]+" + 1) >= "+this.outputShape[a-2]+`;
            bool nextColOutOfBounds =
              (`+i[a-1]+" + 1) >= "+this.outputShape[a-1]+`;
            result.y = nextColOutOfBounds ? 0. : result.y;
            result.z = nextRowOutOfBounds ? 0. : result.z;
            result.w = nextColOutOfBounds || nextRowOutOfBounds ? 0. : result.w;
          `}this.userCode=`
      vec4 binaryOperation(vec4 a, vec4 b) {
        `+n+`
      }

      void main() {
        vec4 a = getAAtOutCoords();
        vec4 b = getBAtOutCoords();

        vec4 result = binaryOperation(a, b);
        `+o+`

        setOutput(result);
      }
    `},v1=function(){function n(t){this.variableNames=["A"],this.outputShape=t,this.userCode=`
      uniform float minVal;
      uniform float maxVal;

      void main() {
        float value = getAAtOutCoords();
        if (isnan(value)) {
          setOutput(value);
          return;
        }

        setOutput(clamp(value, minVal, maxVal));
      }
    `}return n.prototype.getCustomSetupFunc=function(t,e){var r=this;return function(a,o){r.minLoc==null&&(r.minLoc=a.getUniformLocationNoThrow(o,"minVal"),r.maxLoc=a.getUniformLocationNoThrow(o,"maxVal")),a.gl.uniform1f(r.minLoc,t),a.gl.uniform1f(r.maxLoc,e)}},n}(),m1=function(){function n(t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=t,this.userCode=`
      uniform float minVal;
      uniform float maxVal;

      void main() {
        vec4 value = getAAtOutCoords();

        if (any(isnan(value))) {
          setOutput(value);
          return;
        }

        setOutput(clamp(value, vec4(minVal), vec4(maxVal)));
      }
    `}return n.prototype.getCustomSetupFunc=function(t,e){var r=this;return function(a,o){r.minLoc==null&&(r.minLoc=a.getUniformLocationNoThrow(o,"minVal"),r.maxLoc=a.getUniformLocationNoThrow(o,"maxVal")),a.gl.uniform1f(r.minLoc,t),a.gl.uniform1f(r.maxLoc,e)}},n}(),g1=function(n){this.variableNames=["real","imag"],this.outputShape=n,this.userCode=`
      void main() {
        float re = abs(getRealAtOutCoords());
        float im = abs(getImagAtOutCoords());
        float mx = max(re, im);

        // sadly the length function in glsl is not underflow-safe
        // (at least not on Intel GPUs). So the safe solution is
        // to ensure underflow-safety in all cases.
        setOutput(
          mx == 0.0 ? 0.0 : mx * length(vec2(1, min(re, im)/mx))
        );
      }
    `},y1=function(n){this.outputShape=[],this.outputShape=Ta(n,1),this.variableNames=n.map(function(s,u){return"T"+u});var t=new Array(n.length-1);t[0]=n[0][1];for(var e=1;e<t.length;e++)t[e]=t[e-1]+n[e][1];var r=["if (yC < "+t[0]+") setOutput(getT0(yR, yC));"];for(e=1;e<t.length;e++){var a=t[e-1];r.push("else if (yC < "+t[e]+") setOutput(getT"+e+"(yR, yC-"+a+"));")}var o=t.length,i=t[t.length-1];r.push("else setOutput(getT"+o+"(yR, yC-"+i+"));"),this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int yR = coords.x;
        int yC = coords.y;

        `+r.join(`
        `)+`
      }
    `},x1=function(n,t){this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[],this.outputShape=Ta(n,t);var e=this.outputShape,r=e.length,a=Je(r),o=tn("coords",r),i=["x","y","z","w","u","v"].slice(0,r);this.variableNames=n.map(function(g,m){return"T"+m});var s=new Array(n.length-1);s[0]=n[0][t];for(var u=1;u<s.length;u++)s[u]=s[u-1]+n[u][t];var l=i[t],c=i.slice(-2),p=i.join(),f="if ("+l+" < "+s[0]+`) {
        return getChannel(
            getT0(`+p+"), vec2("+c.join()+`));
        }`;for(u=1;u<s.length;u++){var d=s[u-1];f+=`
        if (`+l+" < "+s[u]+"  && "+l+" >= "+s[u-1]+`) {
          return getChannel(
            getT`+u+"("+Uo(i,l,d)+`),
            vec2(`+Uo(c,l,d)+`));
        }`}var h=s.length,v=s[s.length-1];f+=`
        return getChannel(
          getT`+h+"("+Uo(i,l,v)+`),
          vec2(`+Uo(c,l,v)+"));",this.userCode=`
      float getValue(`+i.map(function(g){return"int "+g})+`) {
        `+f+`
      }

      void main() {
        `+a+` coords = getOutputCoords();
        vec4 result = vec4(getValue(`+o+`), 0., 0., 0.);

        `+o[r-1]+" = "+o[r-1]+` + 1;
        if (`+o[r-1]+" < "+e[r-1]+`) {
          result.g = getValue(`+o+`);
        }

        `+o[r-2]+" = "+o[r-2]+` + 1;
        if (`+o[r-2]+" < "+e[r-2]+`) {
          result.a = getValue(`+o+`);
        }

        `+o[r-1]+" = "+o[r-1]+` - 1;
        if (`+o[r-2]+" < "+e[r-2]+` &&
            `+o[r-1]+" < "+e[r-1]+`) {
          result.b = getValue(`+o+`);
        }
        setOutput(result);
      }
    `};function Uo(n,t,e){var r=n.indexOf(t);return n.map(function(a,o){return o===r?a+" - "+e:a}).join()}var b1=function(n){this.variableNames=["x","dy"],this.outputShape=n.filterShape;var t=n.strideHeight,e=n.strideWidth,r=n.padInfo.top,a=n.padInfo.left,o=n.dataFormat==="channelsLast";this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int wR = coords.x;
        int wC = coords.y;
        int d1 = coords.z;
        int d2 = coords.w;

        // Convolve x(?, ?, d1) with dy(:, :, d2) to get dw(wR, wC, d1, d2).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;

        for (int b = 0; b < `+n.batchSize+`; b++) {
          for (int yR = 0; yR < `+n.outHeight+`; yR++) {
            int xR = wR + yR * `+t+" - "+r+`;

            if (xR < 0 || xR >= `+n.inHeight+`) {
              continue;
            }

            for (int yC = 0; yC < `+n.outWidth+`; yC++) {
              int xC = wC + yC * `+e+" - "+a+`;

              if (xC < 0 || xC >= `+n.inWidth+`) {
                continue;
              }

              if (`+o+`) {
                float dyValue = getDy(b, yR, yC, d2);
                float xValue = getX(b, xR, xC, d1);
                dotProd += (xValue * dyValue);
              } else {
                float dyValue = getDy(b, d2, yR, yC);
                float xValue = getX(b, d1, xR, xC);
                dotProd += (xValue * dyValue);
              }

            }
          }
        }
        setOutput(dotProd);
      }
    `},_1=function(n){this.variableNames=["dy","W"],this.outputShape=n.inShape;var t=n.filterHeight,e=n.filterWidth,r=n.strideHeight,a=n.strideWidth,o=n.dataFormat==="channelsLast",i=t-1-n.padInfo.top,s=e-1-n.padInfo.left,u=o?1:2,l=o?2:3,c=o?3:1;this.userCode=`
      const ivec2 pads = ivec2(`+i+", "+s+`);

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d1 = coords[`+c+`];

        ivec2 dyCorner = ivec2(coords[`+u+"], coords["+l+`]) - pads;
        int dyRCorner = dyCorner.x;
        int dyCCorner = dyCorner.y;

        // Convolve dy(?, ?, d2) with w(:, :, d1, d2) to compute dx(xR, xC, d1).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < `+t+`; wR++) {
          float dyR = float(dyRCorner + wR) / `+r+`.0;

          if (dyR < 0.0 || dyR >= `+n.outHeight+`.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          int wRPerm = `+t+` - 1 - wR;

          for (int wC = 0; wC < `+e+`; wC++) {
            float dyC = float(dyCCorner + wC) / `+a+`.0;

            if (dyC < 0.0 || dyC >= `+n.outWidth+`.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            int wCPerm = `+e+` - 1 - wC;

            for (int d2 = 0; d2 < `+n.outChannels+`; d2++) {

              if (`+o+`) {
                float xValue = getDy(batch, idyR, idyC, d2);
                float wValue = getW(wRPerm, wCPerm, d1, d2);
                dotProd += xValue * wValue;
              } else {
                float xValue = getDy(batch, d2, idyR, idyC);
                float wValue = getW(wRPerm, wCPerm, d1, d2);
                dotProd += xValue * wValue;
              }

            }
          }
        }
        setOutput(dotProd);
      }
    `},w1=function(n){this.variableNames=["x","dy"],this.outputShape=n.filterShape;var t=n.strideDepth,e=n.strideHeight,r=n.strideWidth,a=n.padInfo.front,o=n.padInfo.top,i=n.padInfo.left;this.userCode=`
      void main() {
        ivec5 coords = getOutputCoords();
        int wF = coords.x;
        int wR = coords.y;
        int wC = coords.z;
        int d1 = coords.w;
        int d2 = coords.u;

        float dotProd = 0.0;

        for (int b = 0; b < `+n.batchSize+`; b++) {
          for (int yF = 0; yF < `+n.outDepth+`; yF++) {
            int xF = wF + yF * `+t+" - "+a+`;

            if (xF < 0 || xF >= `+n.inDepth+`) {
              continue;
            }

            for (int yR = 0; yR < `+n.outHeight+`; yR++) {
              int xR = wR + yR * `+e+" - "+o+`;

              if (xR < 0 || xR >= `+n.inHeight+`) {
                continue;
              }

              for (int yC = 0; yC < `+n.outWidth+`; yC++) {
                int xC = wC + yC * `+r+" - "+i+`;

                if (xC < 0 || xC >= `+n.inWidth+`) {
                  continue;
                }

                float dyValue = getDy(b, yF, yR, yC, d2);
                float xValue = getX(b, xF, xR, xC, d1);
                dotProd += (xValue * dyValue);
              }
            }
          }
        }
        setOutput(dotProd);
      }
    `},E1=function(n){this.variableNames=["dy","W"],this.outputShape=n.inShape;var t=n.filterDepth,e=n.filterHeight,r=n.filterWidth,a=n.strideDepth,o=n.strideHeight,i=n.strideWidth,s=t-1-n.padInfo.front,u=e-1-n.padInfo.top,l=r-1-n.padInfo.left;this.userCode=`
      const ivec3 pads = ivec3(`+s+", "+u+", "+l+`);

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int d1 = coords.u;


        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;
        int dyFCorner = dyCorner.x;
        int dyRCorner = dyCorner.y;
        int dyCCorner = dyCorner.z;

        float dotProd = 0.0;
        for (int wF = 0; wF < `+t+`; wF++) {
          float dyF = float(dyFCorner + wF) / `+a+`.0;

          if (dyF < 0.0 || dyF >= `+n.outDepth+`.0 || fract(dyF) > 0.0) {
            continue;
          }
          int idyF = int(dyF);

          int wFPerm = `+t+` - 1 - wF;

          for (int wR = 0; wR < `+e+`; wR++) {
            float dyR = float(dyRCorner + wR) / `+o+`.0;

            if (dyR < 0.0 || dyR >= `+n.outHeight+`.0 ||
              fract(dyR) > 0.0) {
              continue;
            }
            int idyR = int(dyR);

            int wRPerm = `+e+` - 1 - wR;

            for (int wC = 0; wC < `+r+`; wC++) {
              float dyC = float(dyCCorner + wC) / `+i+`.0;

              if (dyC < 0.0 || dyC >= `+n.outWidth+`.0 ||
                  fract(dyC) > 0.0) {
                continue;
              }
              int idyC = int(dyC);

              int wCPerm = `+r+` - 1 - wC;

              for (int d2 = 0; d2 < `+n.outChannels+`; d2++) {
                float xValue = getDy(batch, idyF, idyR, idyC, d2);
                float wValue = getW(wFPerm, wRPerm, wCPerm, d1, d2);
                dotProd += xValue * wValue;
              }
            }
          }
        }
        setOutput(dotProd);
      }
    `},S1=function(n){this.variableNames=["x","dy"],this.outputShape=n.filterShape;var t=n.strideHeight,e=n.strideWidth,r=n.padInfo.top,a=n.padInfo.left,o=n.outChannels/n.inChannels;this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int wR = coords.x;
        int wC = coords.y;
        int d1 = coords.z;
        int dm = coords.w;
        int d2 = d1 * `+o+` + dm;

        float dotProd = 0.0;

        // TO DO: Vec4 over the batch size
        for (int b = 0; b < `+n.batchSize+`; b++) {
          for (int yR = 0; yR < `+n.outHeight+`; yR++) {
            int xR = wR + yR * `+t+" - "+r+`;

            if (xR < 0 || xR >= `+n.inHeight+`) {
              continue;
            }

            for (int yC = 0; yC < `+n.outWidth+`; yC++) {
              int xC = wC + yC * `+e+" - "+a+`;

              if (xC < 0 || xC >= `+n.inWidth+`) {
                continue;
              }

              float dyValue = getDy(b, yR, yC, d2);
              float xValue = getX(b, xR, xC, d1);
              dotProd += (xValue * dyValue);
            }
          }
        }
        setOutput(dotProd);
      }
    `},C1=function(n){this.variableNames=["dy","W"],this.outputShape=n.inShape;var t=n.filterHeight,e=n.filterWidth,r=n.strideHeight,a=n.strideWidth,o=t-1-n.padInfo.top,i=e-1-n.padInfo.left,s=n.outChannels/n.inChannels;this.userCode=`
      const ivec2 pads = ivec2(`+o+", "+i+`);

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d1 = coords[3];
        ivec2 dyCorner = coords.yz - pads;
        int dyRCorner = dyCorner.x;
        int dyCCorner = dyCorner.y;

        float dotProd = 0.0;

        for (int wR = 0; wR < `+t+`; wR++) {
          float dyR = float(dyRCorner + wR) / `+r+`.0;

          if (dyR < 0.0 || dyR >= `+n.outHeight+`.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          int wRPerm = `+t+` - 1 - wR;

          for (int wC = 0; wC < `+e+`; wC++) {
            float dyC = float(dyCCorner + wC) / `+a+`.0;

            if (dyC < 0.0 || dyC >= `+n.outWidth+`.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            int wCPerm = `+e+` - 1 - wC;

            // TO DO: Vec4 over the channelMul
            for (int dm = 0; dm < `+s+`; dm++) {
              int d2 = d1 * `+s+` + dm;
              float xValue = getDy(batch, idyR, idyC, d2);
              float wValue = getW(wRPerm, wCPerm, d1, dm);
              dotProd += xValue * wValue;
            }
          }
        }
        setOutput(dotProd);
      }
    `},Ec=function(n,t,e,r){t===void 0&&(t=!1),e===void 0&&(e=null),r===void 0&&(r=!1),this.variableNames=["x","W"],this.outputShape=n.outShape;var a=n.padInfo.top,o=n.padInfo.left,i=n.strideHeight,s=n.strideWidth,u=n.dilationHeight,l=n.dilationWidth,c=n.filterHeight,p=n.filterWidth,f=4*Math.floor(n.inChannels/4),d=n.inChannels%4,h=n.dataFormat==="channelsLast",v=h?1:2,g=h?2:3,m=h?3:1,x="",y="";e&&(x=r?`float activation(float a) {
          float b = getPreluActivationWeightsAtOutCoords();
          `+e+`
        }`:`
          float activation(float x) {
            `+e+`
          }
        `,y="result = activation(result);");var w=t?"result += getBiasAtOutCoords();":"";t&&this.variableNames.push("bias"),r&&this.variableNames.push("preluActivationWeights"),this.userCode=`
      `+x+`

      const ivec2 strides = ivec2(`+i+", "+s+`);
      const ivec2 pads = ivec2(`+a+", "+o+`);

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d2 = coords[`+m+`];

        ivec2 xRCCorner =
            ivec2(coords[`+v+"], coords["+g+`]) * strides - pads;
        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        // Convolve x(?, ?, d1) with w(:, :, d1, d2) to get y(yR, yC, d2).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < `+c+`; wR++) {
          int xR = xRCorner + wR * `+u+`;

          if (xR < 0 || xR >= `+n.inHeight+`) {
            continue;
          }

          for (int wC = 0; wC < `+p+`; wC++) {
            int xC = xCCorner + wC * `+l+`;

            if (xC < 0 || xC >= `+n.inWidth+`) {
              continue;
            }

            for (int d1 = 0; d1 < `+f+`; d1 += 4) {
              vec4 wValues = vec4(
                getW(wR, wC, d1, d2),
                getW(wR, wC, d1 + 1, d2),
                getW(wR, wC, d1 + 2, d2),
                getW(wR, wC, d1 + 3, d2)
              );

              if (`+h+`) {
                vec4 xValues = vec4(
                  getX(batch, xR, xC, d1),
                  getX(batch, xR, xC, d1 + 1),
                  getX(batch, xR, xC, d1 + 2),
                  getX(batch, xR, xC, d1 + 3)
                );
                dotProd += dot(xValues, wValues);
              } else {
                vec4 xValues = vec4(
                  getX(batch, d1, xR, xC),
                  getX(batch, d1 + 1, xR, xC),
                  getX(batch, d1 + 2, xR, xC),
                  getX(batch, d1 + 3, xR, xC)
                );
                dotProd += dot(xValues, wValues);
              }
            }

            if (`+(d===1)+`) {

              if (`+h+`) {
                dotProd +=
                    getX(batch, xR, xC, `+f+`) *
                    getW(wR, wC, `+f+`, d2);
              } else {
                dotProd +=
                    getX(batch, `+f+`, xR, xC) *
                    getW(wR, wC, `+f+`, d2);
              }

            } else if (`+(d===2)+`) {
              vec2 wValues = vec2(
                getW(wR, wC, `+f+`, d2),
                getW(wR, wC, `+f+` + 1, d2)
              );

              if (`+h+`) {
                vec2 xValues = vec2(
                  getX(batch, xR, xC, `+f+`),
                  getX(batch, xR, xC, `+f+` + 1)
                );
                dotProd += dot(xValues, wValues);
              } else {
                vec2 xValues = vec2(
                  getX(batch, `+f+`, xR, xC),
                  getX(batch, `+f+` + 1, xR, xC)
                );
                dotProd += dot(xValues, wValues);
              }

            } else if (`+(d===3)+`) {
              vec3 wValues = vec3(
                getW(wR, wC, `+f+`, d2),
                getW(wR, wC, `+f+` + 1, d2),
                getW(wR, wC, `+f+` + 2, d2)
              );

              if (`+h+`) {
                vec3 xValues = vec3(
                  getX(batch, xR, xC, `+f+`),
                  getX(batch, xR, xC, `+f+` + 1),
                  getX(batch, xR, xC, `+f+` + 2)
                );
                dotProd += dot(xValues, wValues);
              } else {
                vec3 xValues = vec3(
                  getX(batch, `+f+`, xR, xC),
                  getX(batch, `+f+` + 1, xR, xC),
                  getX(batch, `+f+` + 2, xR, xC)
                );
                dotProd += dot(xValues, wValues);
              }

            }
          }
        }

        float result = dotProd;
        `+w+`
        `+y+`
        setOutput(result);
      }
    `},I1=function(n){this.variableNames=["x","W"],this.outputShape=n.outShape;var t=n.padInfo.front,e=n.padInfo.top,r=n.padInfo.left,a=n.strideDepth,o=n.strideHeight,i=n.strideWidth,s=n.dilationDepth,u=n.dilationHeight,l=n.dilationWidth,c=n.filterDepth,p=n.filterHeight,f=n.filterWidth,d=4*Math.floor(n.inChannels/4),h=n.inChannels%4;this.userCode=`
      const ivec3 strides = ivec3(`+a+", "+o+", "+i+`);
      const ivec3 pads = ivec3(`+t+", "+e+", "+r+`);

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int d2 = coords.u;

        ivec3 xFRCCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;
        int xFCorner = xFRCCorner.x;
        int xRCorner = xFRCCorner.y;
        int xCCorner = xFRCCorner.z;

        // Convolve x(?, ?, ?, d1) with w(:, :, :, d1, d2) to get
        // y(yF, yR, yC, d2). ? = to be determined. : = across all
        // values in that axis.
        float dotProd = 0.0;
        for (int wF = 0; wF < `+c+`; wF++) {
          int xF = xFCorner + wF * `+s+`;

          if (xF < 0 || xF >= `+n.inDepth+`) {
            continue;
          }

          for (int wR = 0; wR < `+p+`; wR++) {
            int xR = xRCorner + wR * `+u+`;

            if (xR < 0 || xR >= `+n.inHeight+`) {
              continue;
            }

            for (int wC = 0; wC < `+f+`; wC++) {
              int xC = xCCorner + wC * `+l+`;

              if (xC < 0 || xC >= `+n.inWidth+`) {
                continue;
              }

              for (int d1 = 0; d1 < `+d+`; d1 += 4) {
                vec4 xValues = vec4(
                  getX(batch, xF, xR, xC, d1),
                  getX(batch, xF, xR, xC, d1 + 1),
                  getX(batch, xF, xR, xC, d1 + 2),
                  getX(batch, xF, xR, xC, d1 + 3)
                );
                vec4 wValues = vec4(
                  getW(wF, wR, wC, d1, d2),
                  getW(wF, wR, wC, d1 + 1, d2),
                  getW(wF, wR, wC, d1 + 2, d2),
                  getW(wF, wR, wC, d1 + 3, d2)
                );

                dotProd += dot(xValues, wValues);
              }

              if (`+(h===1)+`) {
                dotProd +=
                  getX(batch, xF, xR, xC, `+d+`) *
                  getW(wF, wR, wC, `+d+`, d2);
              } else if (`+(h===2)+`) {
                vec2 xValues = vec2(
                  getX(batch, xF, xR, xC, `+d+`),
                  getX(batch, xF, xR, xC, `+d+` + 1)
                );
                vec2 wValues = vec2(
                  getW(wF, wR, wC, `+d+`, d2),
                  getW(wF, wR, wC, `+d+` + 1, d2)
                );
                dotProd += dot(xValues, wValues);
              } else if (`+(h===3)+`) {
                vec3 xValues = vec3(
                  getX(batch, xF, xR, xC, `+d+`),
                  getX(batch, xF, xR, xC, `+d+` + 1),
                  getX(batch, xF, xR, xC, `+d+` + 2)
                );
                vec3 wValues = vec3(
                  getW(wF, wR, wC, `+d+`, d2),
                  getW(wF, wR, wC, `+d+` + 1, d2),
                  getW(wF, wR, wC, `+d+` + 2, d2)
                );
                dotProd += dot(xValues, wValues);
              }
            }
          }
        }
        setOutput(dotProd);
      }
    `},Sc=function(n,t,e,r){t===void 0&&(t=!1),e===void 0&&(e=null),r===void 0&&(r=!1),this.variableNames=["x","W"],this.outputShape=n.outShape;var a=n.inHeight,o=n.inWidth,i=n.padInfo.top,s=n.padInfo.left,u=n.strideHeight,l=n.strideWidth,c=n.dilationHeight,p=n.dilationWidth,f=n.filterHeight,d=n.filterWidth,h=n.outChannels/n.inChannels,v="",g="";e&&(v=r?`float activation(float a) {
          float b = getPreluActivationWeightsAtOutCoords();
          `+e+`
        }`:`
          float activation(float x) {
            `+e+`
          }
        `,g="result = activation(result);");var m=t?"result += getBiasAtOutCoords();":"";t&&this.variableNames.push("bias"),r&&this.variableNames.push("preluActivationWeights"),this.userCode=`
      `+v+`

      const ivec2 strides = ivec2(`+u+", "+l+`);
      const ivec2 pads = ivec2(`+i+", "+s+`);

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords.x;
        ivec2 xRCCorner = coords.yz * strides - pads;
        int d2 = coords.w;
        int d1 = d2 / `+h+`;
        int q = d2 - d1 * `+h+`;

        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        // Convolve x(?, ?, d1) with w(:, :, d1, q) to get y(yR, yC, d2).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        // TO DO(dsmilkov): Flatten the two for loops and vec4 the operations.
        for (int wR = 0; wR < `+f+`; wR++) {
          int xR = xRCorner + wR * `+c+`;

          if (xR < 0 || xR >= `+a+`) {
            continue;
          }

          for (int wC = 0; wC < `+d+`; wC++) {
            int xC = xCCorner + wC * `+p+`;

            if (xC < 0 || xC >= `+o+`) {
              continue;
            }

            float xVal = getX(batch, xR, xC, d1);
            float wVal = getW(wR, wC, d1, q);
            dotProd += xVal * wVal;
          }
        }

        float result = dotProd;
        `+m+`
        `+g+`
        setOutput(result);
      }
    `},Cc=function(n,t,e,r){t===void 0&&(t=!1),e===void 0&&(e=null),r===void 0&&(r=!1),this.variableNames=["x","W"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=n.outShape;for(var a=n.inHeight,o=n.inWidth,i=n.padInfo.top,s=n.padInfo.left,u=n.strideHeight,l=n.strideWidth,c=n.dilationHeight,p=n.dilationWidth,f=n.filterHeight,d=n.filterWidth,h=d,v="int xR; int xC; int xCOffset;",g=0;g<f;g++)for(var m=0;m<d;m++)v+=`
          vec4 xTexelR`+g+"C"+2*m+` = vec4(0.);
          vec4 wR`+g+"C"+m+` = vec4(0.);
          vec4 xR`+g+"C"+m+" = vec4(0.);";for(g=0;g<f;g++)for(var x=0;x<h;x++){if(v+=`
          xR = xRCorner + `+g*c+`;
          xC = xCCorner + `+(m=2*x)*p+`;
        `,l===1){if(m<d&&(v+=s%2==1?`
                xCOffset = xC + 1;
                if(xR >= 0 && xR < `+a+" && xCOffset >= 0 && xCOffset < "+o+`) {
                  xTexelR`+g+"C"+m+` = getX(batch, xR, xCOffset, d1);

                  // Need to manually clear unused channels in case
                  // we're reading from recycled texture.
                  if(xCOffset + 1 >= `+o+`) {
                    xTexelR`+g+"C"+m+`.zw = vec2(0.);
                  }
                } else {
                  xTexelR`+g+"C"+m+` = vec4(0.);
                }

                xCOffset = xC + 1 - 2;
                if(xR >= 0 && xR < `+a+" && xCOffset >= 0 && xCOffset < "+o+`) {
                  vec4 previous = getX(batch, xR, xCOffset, d1);

                  // Need to manually clear unused channels in case
                  // we're reading from recycled texture.
                  if(xCOffset + 1 >= `+o+`) {
                    previous.zw = vec2(0.);
                  }

                  xR`+g+"C"+m+" = vec4(previous.zw, xTexelR"+g+"C"+m+`.xy);
                } else {
                  xR`+g+"C"+m+" = vec4(0, 0, xTexelR"+g+"C"+m+`.xy);
                }
              `:`
                if(xR >= 0 && xR < `+a+" && xC >= 0 && xC < "+o+`) {
                  xTexelR`+g+"C"+m+` = getX(batch, xR, xC, d1);
                } else {
                  xTexelR`+g+"C"+m+` = vec4(0.);
                }

                xR`+g+"C"+m+" = xTexelR"+g+"C"+m+`;
              `,m+1<d)){var y=s%2==0?Ud(p):p;p%2==0&&s%2==1||p%2!=0&&s%2!=1?(v+=`
                  xCOffset = xC + `+s%2+" + "+y+`;

                  if(xR >= 0 && xR < `+a+` &&
                    xCOffset >= 0 && xCOffset < `+o+`) {
                    xTexelR`+g+"C"+(m+2)+` = getX(batch, xR, xCOffset, d1);
                  }
                `,p>1&&(v+=`
                    xCOffset -= 2;
                    if(xR >= 0 && xR < `+a+` &&
                      xCOffset >= 0 && xCOffset < `+o+`) {
                      xTexelR`+g+"C"+m+` = getX(batch, xR, xCOffset, d1);
                    } else {
                      xTexelR`+g+"C"+m+` = vec4(0.);
                    }
                  `),v+=`
                  xR`+g+"C"+(m+1)+` = vec4(
                    xTexelR`+g+"C"+m+".zw, xTexelR"+g+"C"+(m+2)+`.xy);
                `):v+=`
                  xCOffset = xC + `+y+`;

                  if(xR >= 0 && xR < `+a+` &&
                    xCOffset >= 0 && xCOffset < `+o+`) {
                    xTexelR`+g+"C"+(m+2)+` = getX(batch, xR, xCOffset, d1);
                  }

                  xR`+g+"C"+(m+1)+" = xTexelR"+g+"C"+(m+2)+`;
                `}}else m<d&&(v+=`
              if(xR >= 0 && xR < `+a+`) {
            `,s%2==1?(v+=`
                xCOffset = xC + 1 - `+l+`;
                if(xCOffset >= 0 && xCOffset < `+o+`) {
                  xTexelR`+g+"C"+m+` = getX(batch, xR, xCOffset, d1);
                } else {
                  xTexelR`+g+"C"+m+` = vec4(0.);
                }

                if(xC + 1 >= 0 && xC + 1 < `+o+`) {
                  xTexelR`+g+"C"+(m+2)+` = getX(batch, xR, xC + 1, d1);
                } else {
                  xTexelR`+g+"C"+(m+2)+` = vec4(0.);
                }

                xR`+g+"C"+m+` = vec4(
                  xTexelR`+g+"C"+m+".zw, xTexelR"+g+"C"+(m+2)+`.zw);
              `,m+1<d&&(v+=`
                  vec4 final = vec4(0.);
                  xCOffset = xC + 1 + `+l+`;
                  if(xCOffset >= 0 && xCOffset < `+o+`) {
                    final = getX(batch, xR, xCOffset, d1);
                  }
                  xR`+g+"C"+(m+1)+" = vec4(xTexelR"+g+"C"+(m+2)+`.xy, final.xy);
                `)):(v+=`
                if(xC >= 0 && xC < `+o+`) {
                  xTexelR`+g+"C"+m+` = getX(batch, xR, xC, d1);
                } else {
                  xTexelR`+g+"C"+m+` = vec4(0.);
                }

                xCOffset = xC + `+l+`;
                if(xCOffset >= 0 && xCOffset < `+o+`) {
                  xTexelR`+g+"C"+(m+2)+` = getX(batch, xR, xCOffset, d1);
                } else {
                  xTexelR`+g+"C"+(m+2)+` = vec4(0.);
                }

                xR`+g+"C"+m+` = vec4(
                  xTexelR`+g+"C"+m+".xy, xTexelR"+g+"C"+(m+2)+`.xy);
              `,m+1<d&&(v+=`
                  xR`+g+"C"+(m+1)+` = vec4(
                    xTexelR`+g+"C"+m+".zw, xTexelR"+g+"C"+(m+2)+`.zw);
                `)),v+="}");m<d&&(v+=`
            vec4 wTexelR`+g+"C"+m+" = getW("+g+", "+m+`, d1, q);
            wR`+g+"C"+m+" = vec4(wTexelR"+g+"C"+m+".xz, wTexelR"+g+"C"+m+`.xz);
          `,m+1<d&&(v+=`
              vec4 wTexelR`+g+"C"+(m+1)+" = getW("+g+", "+(m+1)+`, d1, q);
              wR`+g+"C"+(m+1)+` =
                vec4(wTexelR`+g+"C"+(m+1)+".xz, wTexelR"+g+"C"+(m+1)+".xz);"))}for(g=0;g<f;g++)for(m=0;m<d;m++)v+="dotProd += xR"+g+"C"+m+" * wR"+g+"C"+m+";";var w="",E="";e&&(w=r?`vec4 activation(vec4 a) {
          vec4 b = getPreluActivationWeightsAtOutCoords();
          `+e+`
        }`:`vec4 activation(vec4 x) {
          `+e+`
        }`,E="result = activation(result);");var D=t?"result += getBiasAtOutCoords();":"";t&&this.variableNames.push("bias"),r&&this.variableNames.push("preluActivationWeights"),this.userCode=`
      `+w+`

      const ivec2 strides = ivec2(`+u+", "+l+`);
      const ivec2 pads = ivec2(`+i+", "+s+`);

      void main() {

        ivec4 coords = getOutputCoords();
        int batch = coords.x;
        ivec2 xRCCorner = coords.yz * strides - pads;
        int d2 = coords.w;
        int d1 = d2;
        int q = 0;
        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        vec4 dotProd = vec4(0.);

        `+v+`

        vec4 result = dotProd;
        `+D+`
        `+E+`
        setOutput(result);
      }
    `},D1=function(n,t,e,r,a){this.variableNames=["Image","Boxes","BoxInd"],this.outputShape=[];var o=n[0],i=n[1],s=n[2],u=n[3],l=t[0],c=e[0],p=e[1];this.outputShape=[l,c,p,u];var f=r==="bilinear"?1:0,d=[i-1+".0",s-1+".0"],h=d[0],v=d[1],g=c>1?[""+(i-1)/(c-1),"(y2-y1) * height_ratio","y1*"+h+" + float(y)*(height_scale)"]:["0.0","0.0","0.5 * (y1+y2) * "+h],m=g[0],x=g[1],y=g[2],w=p>1?[""+(s-1)/(p-1),"(x2-x1) * width_ratio","x1*"+v+" + float(x)*(width_scale)"]:["0.0","0.0","0.5 * (x1+x2) * "+v],E=w[0],D=w[1],k=w[2];this.userCode=`
      const float height_ratio = float(`+m+`);
      const float width_ratio = float(`+E+`);
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int y = coords[1];
        int x = coords[2];
        int d = coords[3];

        // get box vals
        float y1 = getBoxes(b,0);
        float x1 = getBoxes(b,1);
        float y2 = getBoxes(b,2);
        float x2 = getBoxes(b,3);

        // get image in batch index
        int bInd = round(getBoxInd(b));
        if(bInd < 0 || bInd >= `+o+`) {
          return;
        }

        float height_scale = `+x+`;
        float width_scale = `+D+`;

        float in_y = `+y+`;
        if( in_y < 0.0 || in_y > `+h+` ) {
          setOutput(float(`+a+`));
          return;
        }
        float in_x = `+k+`;
        if( in_x < 0.0 || in_x > `+v+` ) {
          setOutput(float(`+a+`));
          return;
        }

        vec2 sourceFracIndexCR = vec2(in_x,in_y);
        if(`+f+` == 1) {
          // Compute the four integer indices.
          ivec2 sourceFloorCR = ivec2(sourceFracIndexCR);
          ivec2 sourceCeilCR = ivec2(ceil(sourceFracIndexCR));

          float topLeft = getImage(b, sourceFloorCR.y, sourceFloorCR.x, d);
          float bottomLeft = getImage(b, sourceCeilCR.y, sourceFloorCR.x, d);
          float topRight = getImage(b, sourceFloorCR.y, sourceCeilCR.x, d);
          float bottomRight = getImage(b, sourceCeilCR.y, sourceCeilCR.x, d);

          vec2 fracCR = sourceFracIndexCR - vec2(sourceFloorCR);

          float top = topLeft + (topRight - topLeft) * fracCR.x;
          float bottom = bottomLeft + (bottomRight - bottomLeft) * fracCR.x;
          float newValue = top + (bottom - top) * fracCR.y;
          setOutput(newValue);
        } else {
          // Compute the coordinators of nearest neighbor point.
          ivec2 sourceNearestCR = ivec2(floor(
            sourceFracIndexCR + vec2(0.5,0.5)));
          float newValue = getImage(b, sourceNearestCR.y, sourceNearestCR.x, d);
          setOutput(newValue);
        }
      }
    `},k1=function(n,t,e){this.variableNames=["x"],this.outputShape=n;var r=n.length,a=n[n.length-1],o=e?"<":">";this.userCode=`
      int getIndex(int i) {
        `+(e?"return "+a+" -i - 1;":"return i;")+`
      }

      void main() {
        `+Je(r)+` coords = getOutputCoords();
        int end = `+Ic(r,"coords")+`;
        float val = 0.0;
        for (int i = `+a+` - 1; i >= 0; i -= 1) {
          int idx = getIndex(i);
          if (idx `+o+` end) {
            continue;
          }
          if (idx == end && `+t+`) {
            continue;
          }
          `+Ic(r,"coords")+` = idx;
          val += getX(`+function(i,s){if(i===1)return""+s;if(i===2)return s+".x, "+s+".y";if(i===3)return s+".x, "+s+".y, "+s+".z";if(i===4)return s+".x, "+s+".y, "+s+".z, "+s+".w";throw Error("Cumulative sum for rank "+i+" is not yet supported")}(r,"coords")+`);
        }
        setOutput(val);
      }
    `};function Ic(n,t){if(n===1)return""+t;if(n===2)return t+".y";if(n===3)return t+".z";if(n===4)return t+".w";throw Error("Cumulative sum for rank "+n+" is not yet supported")}var T1=function(n){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.outPackingScheme=io.DENSE;var t=eo(n),e=qt();this.outputShape=n,this.userCode=`
      ivec3 outCoordsFromFlatIndex(int index) {
        `+Gr(["r","c","d"],n)+`
        return ivec3(r, c, d);
      }

      void main() {
        ivec2 resTexRC = ivec2(resultUV.yx *
          vec2(`+t[0]+", "+t[1]+`));
        int index = 4 * (resTexRC.x * `+t[1]+` + resTexRC.y);

        vec4 result = vec4(0.);

        for (int i=0; i<4; i++) {
          int flatIndex = index + i;
          ivec3 rc = outCoordsFromFlatIndex(flatIndex);
          result[i] = getA(rc.x, rc.y, rc.z);
        }

        `+e.output+` = result;
      }
    `},N1=function(n){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outPackingScheme=io.DENSE;var t=eo(n),e=qt();this.outputShape=n,this.userCode=`
      ivec3 outCoordsFromFlatIndex(int index) {
        `+Gr(["r","c","d"],n)+`
        return ivec3(r, c, d);
      }

      void main() {
        ivec2 resTexRC = ivec2(resultUV.yx *
          vec2(`+t[0]+", "+t[1]+`));
        int index = 4 * (resTexRC.x * `+t[1]+` + resTexRC.y);

        vec4 result = vec4(0.);

        for (int i=0; i<4; i++) {
          int flatIndex = index + i;
          ivec3 rc = outCoordsFromFlatIndex(flatIndex);
          result[i] = getChannel(getA(rc.x, rc.y, rc.z), vec2(rc.y, rc.z));
        }

        `+e.output+` = result;
      }
    `},R1=function(){function n(t,e,r){this.variableNames=["x"],this.outputShape=[],this.outputShape=t,this.blockSize=e,this.dataFormat=r,this.userCode=`
    void main() {
      ivec4 coords = getOutputCoords();
      int b = coords[0];
      int h = `+this.getHeightCoordString()+`;
      int w = `+this.getWidthCoordString()+`;
      int d = `+this.getDepthCoordString()+`;

      int in_h = h / `+e+`;
      int offset_h = imod(h, `+e+`);
      int in_w = w / `+e+`;
      int offset_w = imod(w, `+e+`);
      int offset_d = (offset_h * `+e+` + offset_w) *
        `+this.getOutputDepthSize()+`;
      int in_d = d + offset_d;

      float result = `+this.getInputSamplingString()+`;
      setOutput(result);
    }
  `}return n.prototype.getHeightCoordString=function(){return this.dataFormat==="NHWC"?"coords[1]":"coords[2]"},n.prototype.getWidthCoordString=function(){return this.dataFormat==="NHWC"?"coords[2]":"coords[3]"},n.prototype.getDepthCoordString=function(){return this.dataFormat==="NHWC"?"coords[3]":"coords[1]"},n.prototype.getOutputDepthSize=function(){return this.dataFormat==="NHWC"?this.outputShape[3]:this.outputShape[1]},n.prototype.getInputSamplingString=function(){return this.dataFormat==="NHWC"?"getX(b, in_h, in_w, in_d)":"getX(b, in_d, in_h, in_w)"},n}(),A1=function(n){this.variableNames=["X"],this.outputShape=[n,n],this.userCode=`
      void main() {
          ivec2 coords = getOutputCoords();
          float val = coords[0] == coords[1] ? getX(coords[0]) : 0.0;
          setOutput(val);
      }
    `},P1=function(n){this.variableNames=["A"],this.outTexUsage=dn.DOWNLOAD;var t=qt();this.outputShape=n,this.userCode=`
      `+xp+`

      void main() {
        float x = getAAtOutCoords();
        `+t.output+` = encode_float(x);
      }
    `},O1=function(n){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!1,this.outTexUsage=dn.DOWNLOAD;var t=qt();this.outputShape=n,this.userCode=`
      `+xp+`

      void main() {
        ivec3 coords = getOutputCoords();
        float x = getChannel(getAAtOutCoords(), vec2(coords.y, coords.z));
        `+t.output+` = encode_float(x);
      }
    `},M1=function(n,t,e){e===void 0&&(e=!1),this.variableNames=["A"];var r=qt(),a=t[0],o=t[1];this.outputShape=n;var i="result";e&&(i="floor(result * 255. + 0.5)"),this.userCode=`
      `+Lu(n)+`

      void main() {
        ivec3 coords = getOutputCoords();

        int flatIndex = getFlatIndex(coords);
        int offset = imod(flatIndex, 4);

        flatIndex = idiv(flatIndex, 4, 1.);
        
        int r = flatIndex / `+o+`;
        int c = imod(flatIndex, `+o+`);
        vec2 uv = (vec2(c, r) + halfCR) / vec2(`+o+".0, "+a+`.0);
        vec4 values = `+r.texture2D+`(A, uv);

        float result;

        if(offset == 0) {
          result = values[0];
        } else if(offset == 1) {
          result = values[1];
        } else if(offset == 2) {
          result = values[2];
        } else {
          result = values[3];
        }

        `+r.output+" = vec4("+i+`, 0., 0., 0.);
      }
    `},F1=function(n,t,e){e===void 0&&(e=!1),this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0;var r=qt(),a=t[0],o=t[1];this.outputShape=n;var i="",s="result";e&&(s="floor(result * 255. + 0.5)");for(var u=0;u<=1;u++)for(var l=0;l<=1;l++){var c=2*u+l;i+=`
          localCoords = coords;
          if(localCoords[2] + `+l+" < "+n[2]+`) {
            localCoords[2] += `+l+`;
            if(localCoords[1] + `+u+" < "+n[1]+`) {
              localCoords[1] += `+u+`;

              flatIndex = getFlatIndex(localCoords);
              offset = imod(flatIndex, 4);

              flatIndex = idiv(flatIndex, 4, 1.);

              r = flatIndex / `+o+`;
              c = imod(flatIndex, `+o+`);
              uv = (vec2(c, r) + halfCR) / vec2(`+o+".0, "+a+`.0);
              values = `+r.texture2D+`(A, uv);

              if(offset == 0) {
                result[`+c+`] = values[0];
              } else if(offset == 1) {
                result[`+c+`] = values[1];
              } else if(offset == 2) {
                result[`+c+`] = values[2];
              } else {
                result[`+c+`] = values[3];
              }
            }
          }
        `}this.userCode=`
      `+Lu(n)+`

      void main() {
        ivec3 coords = getOutputCoords();

        vec4 result = vec4(0.);
        int flatIndex, r, c, offset;
        ivec3 localCoords;
        vec2 uv;
        vec4 values;

        `+i+`

        `+r.output+" = "+s+`;
      }
    `},V1="return real * expR - imag * expI;",L1="return real * expI + imag * expR;",Dc=function(n,t,e){this.variableNames=["real","imag"];var r=t[1];this.outputShape=t;var a=e?"2.0 * "+Math.PI:"-2.0 * "+Math.PI,o=e?r+".0":"1.0";this.userCode=`
      const float exponentMultiplier = `+a+`;

      float unaryOpComplex(float real, float expR, float imag, float expI) {
        `+n+`
      }

      float mulMatDFT(int batch, int index) {
        float indexRatio = float(index) / float(`+r+`);
        float exponentMultiplierTimesIndexRatio =
            exponentMultiplier * indexRatio;

        float result = 0.0;

        for (int i = 0; i < `+r+`; i++) {
          // x = (-2|2 * PI / N) * index * i;
          float x = exponentMultiplierTimesIndexRatio * float(i);
          float expR = cos(x);
          float expI = sin(x);
          float real = getReal(batch, i);
          float imag = getImag(batch, i);

          result +=
              unaryOpComplex(real, expR, imag, expI) / `+o+`;
        }

        return result;
      }

      void main() {
        ivec2 coords = getOutputCoords();
        setOutput(mulMatDFT(coords[0], coords[1]));
      }
    `},B1=function(){function n(t,e){this.outputShape=[],this.variableNames=["x"],this.outputShape=t,this.userCode=`
      uniform float value;
      void main() {
        // Input can be obtained from uniform value.
        setOutput(value);
      }
    `}return n.prototype.getCustomSetupFunc=function(t){var e=this;return function(r,a){e.valueLoc==null&&(e.valueLoc=r.getUniformLocationNoThrow(a,"value")),r.gl.uniform1f(e.valueLoc,t)}},n}(),U1=function(n,t,e){this.variableNames=["A","indices"];var r=n.slice();r[e]=t,this.outputShape=r,this.rank=r.length;var a=Je(this.rank),o=function(i,s){var u=i.length;if(u>4)throw Error("Gather for rank "+u+" is not yet supported");if(u===1)return"int(getIndices(resRC))";for(var l=["resRC.x","resRC.y","resRC.z","resRC.w"],c=[],p=0;p<i.length;p++)p===s?c.push("int(getIndices("+l[p]+"))"):c.push(""+l[p]);return c.join()}(n,e);this.userCode=`
      void main() {
        `+a+` resRC = getOutputCoords();
        setOutput(getA(`+o+`));
      }
    `},W1=function(n,t,e){this.sliceDim=n,this.strides=t,this.variableNames=["x","indices"],this.outputShape=e;var r=Je(t.length),a=Je(e.length),o=this.sliceDim>1?"strides[j]":"strides";this.userCode=`
        `+r+" strides = "+r+"("+this.strides+`);
         void main() {
          `+a+` coords = getOutputCoords();
          int flattenIndex = 0;
          for (int j = 0; j < `+this.sliceDim+`; j++) {
            int index = round(getIndices(coords[0], j));
            flattenIndex += index * `+o+`;
          }
          setOutput(getX(flattenIndex, coords[1]));
        }
      `};function q1(n,t){var e=qt();return Vy(n,t,e.version+`
    precision highp float;
    `+e.attribute+` vec3 clipSpacePos;
    `+e.attribute+` vec2 uv;
    `+e.varyingVs+` vec2 resultUV;

    void main() {
      gl_Position = vec4(clipSpacePos, 1);
      resultUV = uv;
    }`)}function z1(n,t){return qy(n,t,new Float32Array([-1,1,0,0,1,-1,-1,0,0,0,1,1,0,1,1,1,-1,0,1,0]))}function $1(n,t){return zy(n,t,new Uint16Array([0,1,2,2,1,3]))}function wo(n,t,e,r,a,o,i){Hy(e,r);var s=$y(n,t),u=n.TEXTURE_2D;return ye(n,t,function(){return n.bindTexture(u,s)}),ye(n,t,function(){return n.texParameteri(u,n.TEXTURE_WRAP_S,n.CLAMP_TO_EDGE)}),ye(n,t,function(){return n.texParameteri(u,n.TEXTURE_WRAP_T,n.CLAMP_TO_EDGE)}),ye(n,t,function(){return n.texParameteri(u,n.TEXTURE_MIN_FILTER,n.NEAREST)}),ye(n,t,function(){return n.texParameteri(u,n.TEXTURE_MAG_FILTER,n.NEAREST)}),ye(n,t,function(){return n.texImage2D(u,0,a,e,r,0,o,i,null)}),ye(n,t,function(){return n.bindTexture(n.TEXTURE_2D,null)}),s}function H1(n,t,e,r,a){var o=Bi(e,r);return wo(n,t,o[0],o[1],a.internalFormatFloat,a.textureFormatFloat,n.FLOAT)}function G1(n,t,e,r,a){var o=Bi(e,r);return wo(n,t,o[0],o[1],a.internalFormatHalfFloat,a.textureFormatFloat,a.textureTypeHalfFloat)}function j1(n,t,e,r,a){var o=Bi(e,r);return wo(n,t,o[0],o[1],n.RGBA,n.RGBA,n.UNSIGNED_BYTE)}function X1(n,t,e,r,a){var o=_o(e,r);return wo(n,t,o[0],o[1],a.internalFormatPackedFloat,n.RGBA,n.FLOAT)}function Y1(n,t,e,r,a){var o=_o(e,r);return wo(n,t,o[0],o[1],a.internalFormatPackedHalfFloat,n.RGBA,a.textureTypeHalfFloat)}function K1(n,t,e,r){return ye(n,t,function(){return n.bindBuffer(n.ARRAY_BUFFER,r)}),hc(n,t,e,"clipSpacePos",r,3,20,0)&&hc(n,t,e,"uv",r,2,20,12)}function J1(n,t,e,r,a,o,i){var s,u,l;ye(n,t,function(){return n.bindTexture(n.TEXTURE_2D,e)}),o instanceof Uint8Array?(s=new Uint8Array(r*a*4),u=n.UNSIGNED_BYTE,l=n.RGBA):(s=new Float32Array(r*a*4),u=n.FLOAT,l=i.internalFormatPackedFloat),s.set(o),ye(n,t,function(){return n.texImage2D(n.TEXTURE_2D,0,l,r,a,0,n.RGBA,u,s)}),ye(n,t,function(){return n.bindTexture(n.TEXTURE_2D,null)})}function Q1(n,t,e,r){ye(n,t,function(){return n.bindTexture(n.TEXTURE_2D,e)}),r.data instanceof Uint8Array?ye(n,t,function(){return n.texImage2D(n.TEXTURE_2D,0,n.RGBA,r.width,r.height,0,n.RGBA,n.UNSIGNED_BYTE,r.data)}):ye(n,t,function(){return n.texImage2D(n.TEXTURE_2D,0,n.RGBA,n.RGBA,n.UNSIGNED_BYTE,r)}),ye(n,t,function(){return n.bindTexture(n.TEXTURE_2D,null)})}function Z1(n,t,e,r,a){var o=n.createBuffer();ye(n,t,function(){return n.bindBuffer(n.PIXEL_PACK_BUFFER,o)});var i=16*e*r;return ye(n,t,function(){return n.bufferData(n.PIXEL_PACK_BUFFER,i,n.STREAM_READ)}),ye(n,t,function(){return n.readPixels(0,0,r,e,n.RGBA,n.FLOAT,0)}),ye(n,t,function(){return n.bindBuffer(n.PIXEL_PACK_BUFFER,null)}),o}function e0(n,t,e){var r=n,a=new Float32Array(e);return r.bindBuffer(r.PIXEL_PACK_BUFFER,t),r.getBufferSubData(r.PIXEL_PACK_BUFFER,0,a),r.bindBuffer(r.PIXEL_PACK_BUFFER,null),a}function t0(n,t,e,r,a){var o=Bi(e,r),i=o[0],s=o[1],u=new Uint8Array(e*r*4);return ye(n,t,function(){return n.readPixels(0,0,i,s,a.downloadTextureFormat,n.UNSIGNED_BYTE,u)}),new Float32Array(u.buffer)}function n0(n,t,e,r,a,o,i,s){var u=n,l=new Float32Array(function(c,p){var f=_o(c,p);return f[0]*f[1]*4}(o,i));return u.bindBuffer(u.PIXEL_PACK_BUFFER,t),u.getBufferSubData(u.PIXEL_PACK_BUFFER,0,l),u.bindBuffer(u.PIXEL_PACK_BUFFER,null),l}function r0(n,t,e,r){var a=new Float32Array(e*r*4);return ye(n,t,function(){return n.readPixels(0,0,r,e,n.RGBA,n.FLOAT,a)}),a}var a0=function(){function n(t){this.outputTexture=null,this.program=null,this.disposed=!1,this.vertexAttrsAreBound=!1,this.itemsToPoll=[];var e=J().getNumber("WEBGL_VERSION");t!=null?(this.gl=t,Ay(e,t)):this.gl=Jn(e);var r="WEBGL_color_buffer_float";if(J().getNumber("WEBGL_VERSION")===1){if(this.textureFloatExtension=Fo(this.gl,this.debug,"OES_texture_float"),wn(this.gl,"OES_texture_half_float"))this.textureHalfFloatExtension=Fo(this.gl,this.debug,"OES_texture_half_float");else if(J().get("WEBGL_FORCE_F16_TEXTURES"))throw new Error("GL context does not support half float textures, yet the environment flag WEBGL_FORCE_F16_TEXTURES is set to true.");if(this.colorBufferFloatExtension=this.gl.getExtension(r),wn(this.gl,"EXT_color_buffer_half_float"))this.colorBufferHalfFloatExtension=Fo(this.gl,this.debug,"EXT_color_buffer_half_float");else if(J().get("WEBGL_FORCE_F16_TEXTURES"))throw new Error("GL context does not support color renderable half floats, yet the environment flag WEBGL_FORCE_F16_TEXTURES is set to true.")}else if(r="EXT_color_buffer_float",wn(this.gl,r))this.colorBufferFloatExtension=this.gl.getExtension(r);else{if(!wn(this.gl,"EXT_color_buffer_half_float"))throw new Error("GL context does not support color renderable floats");this.colorBufferHalfFloatExtension=this.gl.getExtension("EXT_color_buffer_half_float")}this.vertexBuffer=z1(this.gl,this.debug),this.indexBuffer=$1(this.gl,this.debug),this.framebuffer=Gy(this.gl,this.debug),this.textureConfig=ku(this.gl,this.textureHalfFloatExtension)}return Object.defineProperty(n.prototype,"debug",{get:function(){return J().getBool("DEBUG")},enumerable:!0,configurable:!0}),n.prototype.dispose=function(){var t=this;if(!this.disposed){this.program!=null&&console.warn("Disposing a GPGPUContext that still has a bound WebGLProgram. This is probably a resource leak, delete the program with GPGPUContext.deleteProgram before disposing."),this.outputTexture!=null&&console.warn("Disposing a GPGPUContext that still has a bound output matrix texture.  This is probably a resource leak, delete the output matrix texture with GPGPUContext.deleteMatrixTexture before disposing.");var e=this.gl;ye(e,this.debug,function(){return e.finish()}),ye(e,this.debug,function(){return e.bindFramebuffer(e.FRAMEBUFFER,null)}),ye(e,this.debug,function(){return e.deleteFramebuffer(t.framebuffer)}),ye(e,this.debug,function(){return e.bindBuffer(e.ARRAY_BUFFER,null)}),ye(e,this.debug,function(){return e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,null)}),ye(e,this.debug,function(){return e.deleteBuffer(t.indexBuffer)}),this.disposed=!0}},n.prototype.createFloat32MatrixTexture=function(t,e){return this.throwIfDisposed(),H1(this.gl,this.debug,t,e,this.textureConfig)},n.prototype.createFloat16MatrixTexture=function(t,e){return this.throwIfDisposed(),G1(this.gl,this.debug,t,e,this.textureConfig)},n.prototype.createUnsignedBytesMatrixTexture=function(t,e){return this.throwIfDisposed(),j1(this.gl,this.debug,t,e,this.textureConfig)},n.prototype.uploadPixelDataToTexture=function(t,e){this.throwIfDisposed(),Q1(this.gl,this.debug,t,e)},n.prototype.uploadDenseMatrixToTexture=function(t,e,r,a){this.throwIfDisposed(),J1(this.gl,this.debug,t,e,r,a,this.textureConfig)},n.prototype.createFloat16PackedMatrixTexture=function(t,e){return this.throwIfDisposed(),Y1(this.gl,this.debug,t,e,this.textureConfig)},n.prototype.createPackedMatrixTexture=function(t,e){return this.throwIfDisposed(),X1(this.gl,this.debug,t,e,this.textureConfig)},n.prototype.deleteMatrixTexture=function(t){var e=this;this.throwIfDisposed(),this.outputTexture===t&&(vc(this.gl,this.debug,this.framebuffer),this.outputTexture=null),ye(this.gl,this.debug,function(){return e.gl.deleteTexture(t)})},n.prototype.downloadByteEncodedFloatMatrixFromOutputTexture=function(t,e,r){var a=this;return this.downloadMatrixDriver(t,function(){return t0(a.gl,a.debug,e,r,a.textureConfig)})},n.prototype.downloadPackedMatrixFromBuffer=function(t,e,r,a,o,i){return n0(this.gl,t,0,0,0,o,i,this.textureConfig)},n.prototype.downloadFloat32MatrixFromBuffer=function(t,e){return e0(this.gl,t,e)},n.prototype.createBufferFromTexture=function(t,e,r){this.bindTextureToFrameBuffer(t);var a=Z1(this.gl,this.debug,e,r,this.textureConfig);return this.unbindTextureToFrameBuffer(),a},n.prototype.createAndWaitForFence=function(){var t=this.createFence(this.gl);return this.pollFence(t)},n.prototype.createFence=function(t){var e,r,a=this;if(J().getBool("WEBGL_FENCE_API_ENABLED")){var o=t,i=o.fenceSync(o.SYNC_GPU_COMMANDS_COMPLETE,0);t.flush(),r=function(){var s=o.clientWaitSync(i,0,0);return s===o.ALREADY_SIGNALED||s===o.CONDITION_SATISFIED},e=i}else J().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0?(e=this.beginQuery(),this.endQuery(),r=function(){return a.isQueryAvailable(e,J().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))}):r=function(){return!0};return{query:e,isFencePassed:r}},n.prototype.downloadMatrixFromPackedTexture=function(t,e,r){var a=this;return this.downloadMatrixDriver(t,function(){return r0(a.gl,a.debug,e,r)})},n.prototype.createProgram=function(t){this.throwIfDisposed();var e=this.gl,r=Ly(e,this.debug,t),a=q1(e,this.debug),o=Uy(e,this.debug);return ye(e,this.debug,function(){return e.attachShader(o,a)}),ye(e,this.debug,function(){return e.attachShader(o,r)}),Wy(e,this.debug,o),this.debug&&Cs(e,this.debug,o),this.vertexAttrsAreBound||(this.setProgram(o),this.vertexAttrsAreBound=K1(e,this.debug,this.program,this.vertexBuffer)),o},n.prototype.deleteProgram=function(t){var e=this;this.throwIfDisposed(),t===this.program&&(this.program=null),t!=null&&ye(this.gl,this.debug,function(){return e.gl.deleteProgram(t)})},n.prototype.setProgram=function(t){var e=this;this.throwIfDisposed(),this.program=t,this.program!=null&&this.debug&&Cs(this.gl,this.debug,this.program),ye(this.gl,this.debug,function(){return e.gl.useProgram(t)})},n.prototype.getUniformLocation=function(t,e,r){return r===void 0&&(r=!0),this.throwIfDisposed(),r?Xy(this.gl,this.debug,t,e):Yy(this.gl,t,e)},n.prototype.getAttributeLocation=function(t,e){var r=this;return this.throwIfDisposed(),ye(this.gl,this.debug,function(){return r.gl.getAttribLocation(t,e)})},n.prototype.getUniformLocationNoThrow=function(t,e){return this.throwIfDisposed(),this.gl.getUniformLocation(t,e)},n.prototype.setInputMatrixTexture=function(t,e,r){this.throwIfDisposed(),this.throwIfNoProgram(),Ky(this.gl,this.debug,this.program,t,e,r)},n.prototype.setOutputMatrixTexture=function(t,e,r){this.setOutputMatrixTextureDriver(t,r,e)},n.prototype.setOutputPackedMatrixTexture=function(t,e,r){this.throwIfDisposed();var a=_o(e,r),o=a[0],i=a[1];this.setOutputMatrixTextureDriver(t,o,i)},n.prototype.setOutputMatrixWriteRegion=function(t,e,r,a){this.setOutputMatrixWriteRegionDriver(r,t,a,e)},n.prototype.setOutputPackedMatrixWriteRegion=function(t,e,r,a){throw new Error("setOutputPackedMatrixWriteRegion not implemented.")},n.prototype.debugValidate=function(){this.program!=null&&Cs(this.gl,this.debug,this.program),Vo(this.gl)},n.prototype.executeProgram=function(){this.throwIfDisposed(),this.throwIfNoProgram();var t=this.gl;this.debug&&this.debugValidate(),ye(t,this.debug,function(){return t.drawElements(t.TRIANGLES,6,t.UNSIGNED_SHORT,0)})},n.prototype.blockUntilAllProgramsCompleted=function(){var t=this;this.throwIfDisposed(),ye(this.gl,this.debug,function(){return t.gl.finish()})},n.prototype.getQueryTimerExtension=function(){return this.disjointQueryTimerExtension==null&&(this.disjointQueryTimerExtension=Fo(this.gl,this.debug,J().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")===2?"EXT_disjoint_timer_query_webgl2":"EXT_disjoint_timer_query")),this.disjointQueryTimerExtension},n.prototype.getQueryTimerExtensionWebGL2=function(){return this.getQueryTimerExtension()},n.prototype.getQueryTimerExtensionWebGL1=function(){return this.getQueryTimerExtension()},n.prototype.beginQuery=function(){if(J().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")===2){var t=this.gl,e=this.getQueryTimerExtensionWebGL2(),r=t.createQuery();return t.beginQuery(e.TIME_ELAPSED_EXT,r),r}var a=this.getQueryTimerExtensionWebGL1(),o=a.createQueryEXT();return a.beginQueryEXT(a.TIME_ELAPSED_EXT,o),o},n.prototype.endQuery=function(){if(J().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")!==2){var t=this.getQueryTimerExtensionWebGL1();t.endQueryEXT(t.TIME_ELAPSED_EXT)}else{var e=this.gl,r=this.getQueryTimerExtensionWebGL2();e.endQuery(r.TIME_ELAPSED_EXT)}},n.prototype.waitForQueryAndGetTime=function(t){return he(this,void 0,void 0,function(){var e=this;return ve(this,function(r){switch(r.label){case 0:return[4,uc(function(){return e.disposed||e.isQueryAvailable(t,J().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))})];case 1:return r.sent(),[2,this.getQueryTime(t,J().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))]}})})},n.prototype.getQueryTime=function(t,e){if(e===0)return null;if(e===2){var r=this.gl;return r.getQueryParameter(t,r.QUERY_RESULT)/1e6}var a=this.getQueryTimerExtensionWebGL1();return a.getQueryObjectEXT(t,a.QUERY_RESULT_EXT)/1e6},n.prototype.isQueryAvailable=function(t,e){if(e===0)return!0;if(e===2){var r=this.gl,a=this.getQueryTimerExtensionWebGL2(),o=r.getQueryParameter(t,r.QUERY_RESULT_AVAILABLE);return this.disjoint==null&&(this.disjoint=this.gl.getParameter(a.GPU_DISJOINT_EXT)),o&&!this.disjoint}return o=(a=this.getQueryTimerExtensionWebGL1()).getQueryObjectEXT(t,a.QUERY_RESULT_AVAILABLE_EXT),this.disjoint==null&&(this.disjoint=this.gl.getParameter(a.GPU_DISJOINT_EXT)),o&&!this.disjoint},n.prototype.pollFence=function(t){var e=this;return new Promise(function(r){e.addItemToPoll(function(){return t.isFencePassed()},function(){return r()})})},n.prototype.pollItems=function(){for(var t=function(r){for(var a=0;a<r.length&&r[a]();++a);return a-1}(this.itemsToPoll.map(function(r){return r.isDoneFn})),e=0;e<=t;++e)(0,this.itemsToPoll[e].resolveFn)();this.itemsToPoll=this.itemsToPoll.slice(t+1)},n.prototype.addItemToPoll=function(t,e){var r=this;this.itemsToPoll.push({isDoneFn:t,resolveFn:e}),this.itemsToPoll.length>1||uc(function(){return r.pollItems(),r.itemsToPoll.length===0})},n.prototype.bindTextureToFrameBuffer=function(t){this.throwIfDisposed(),Is(this.gl,this.debug,t,this.framebuffer),this.debug&&Vo(this.gl)},n.prototype.unbindTextureToFrameBuffer=function(){this.outputTexture!=null?(Is(this.gl,this.debug,this.outputTexture,this.framebuffer),this.debug&&Vo(this.gl)):vc(this.gl,this.debug,this.framebuffer)},n.prototype.downloadMatrixDriver=function(t,e){this.bindTextureToFrameBuffer(t);var r=e();return this.unbindTextureToFrameBuffer(),r},n.prototype.setOutputMatrixTextureDriver=function(t,e,r){this.throwIfDisposed();var a=this.gl;Is(a,this.debug,t,this.framebuffer),this.debug&&Vo(a),this.outputTexture=t,ye(a,this.debug,function(){return a.viewport(0,0,e,r)}),ye(a,this.debug,function(){return a.scissor(0,0,e,r)})},n.prototype.setOutputMatrixWriteRegionDriver=function(t,e,r,a){var o=this;this.throwIfDisposed(),ye(this.gl,this.debug,function(){return o.gl.scissor(t,e,r,a)})},n.prototype.throwIfDisposed=function(){if(this.disposed)throw new Error("Attempted to use disposed GPGPUContext.")},n.prototype.throwIfNoProgram=function(){if(this.program==null)throw new Error("No GPU program is currently set.")},n}();function kc(n,t){if(n.length!==t.length)throw Error("Binary was compiled with "+n.length+" inputs, but was executed with "+t.length+" inputs");n.forEach(function(e,r){var a=e.logicalShape,o=t[r],i=o.shape;if(!kt(a,i))throw Error("Binary was compiled with different shapes than the current args. Shapes "+a+" and "+i+" must match");if(!e.isUniform||!o.isUniform){var s=e.texShape,u=o.isUniform?null:o.texData.texShape;if(!kt(s,u))throw Error("Binary was compiled with different texture shapes than the current args. Shape "+s+" and "+u+" must match")}})}var o0=function(n,t,e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=n;for(var r=e.filterWidth,a=e.inChannels,o=e.strideWidth,i=e.strideHeight,s=e.padInfo,u=e.outWidth,l=e.dilationWidth,c=e.dilationHeight,p=e.dataFormat,f=s.left,d=s.top,h=a*r,v=qt(),g=p==="channelsLast",m=g?0:1,x=g?1:2,y="",w=0;w<=1;w++)for(var E=0;E<=1;E++)y+=`
          blockIndex = rc.y + `+E+`;
          pos = rc.x + `+w+`;

          if(blockIndex < `+n[1]+" && pos < "+n[0]+`) {
            offsetY = int(blockIndex / (`+u+")) * "+i+" - "+d+`;
            d0 = offsetY + `+c+" * (pos / "+h+`);

            if(d0 < `+t[m]+` && d0 >= 0) {

              offsetX = int(mod(float(blockIndex), `+u+".) * "+o+". - "+f+`.);
              d1 = offsetX + `+l+" * (int(mod(float(pos), "+h+".) / "+a+`.));

              if(d1 < `+t[x]+` && d1 >= 0) {

                ch = int(mod(float(pos), `+a+`.));

                if (`+g+`) {
                  innerDims = vec2(d1, ch);
                  result[`+(2*w+E)+`] = getChannel(
                    getA(d0, int(innerDims.x),
                    int(innerDims.y)), innerDims);
                } else {
                  innerDims = vec2(d0, d1);
                  result[`+(2*w+E)+`] = getChannel(
                    getA(ch, int(innerDims.x),
                    int(innerDims.y)), innerDims);
                }
              }
            }
          }
        `;this.userCode=`
      void main() {
        ivec2 rc = getOutputCoords();

        vec4 result = vec4(0);

        int blockIndex, pos, offsetY, d0, offsetX, d1, ch;
        vec2 innerDims;

        `+y+`

        `+v.output+` = result;
      }
    `},i0=function(n,t,e,r,a){this.variableNames=["x"],this.outputShape=[];var o,i=t,s=n[3]-1;this.outputShape=n;var u="float("+e+") + float("+r+") * sum";o=a===.5?"inversesqrt("+u+")":a===1?"1.0/("+u+")":"exp(log("+u+") * float(-"+a+"));",this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int r = coords[1];
        int c = coords[2];
        int d = coords[3];
        float x = getX(b, r, c, d);
        float sum = 0.0;
        for (int j = -`+i+"; j <= "+i+`; j++) {
          int idx = d + j;
          if (idx >= 0 && idx <=  `+s+`) {
            float z = getX(b, r, c, idx);
            sum += z * z;
          }
        }
        float val = x * `+o+`;
        setOutput(val);
      }
    `},s0=function(n,t,e,r,a){this.variableNames=["inputImage","outputImage","dy"],this.outputShape=[],this.outputShape=n,this.depth=n[3],this.depthRadius=t,this.bias=e,this.alpha=r,this.beta=a,this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int r = coords[1];
        int c = coords[2];

        float result = 0.0;
        for (int d = 0; d < `+this.depth+`; ++d) {
          int depthBegin = int(max(0.0, float(d - `+t+`)));
          int depthEnd = int(min(float(`+this.depth+`),
              float(d + `+t+` + 1)));

          const int MIN_DEPTH_BEGIN = 0;
          const int MAX_DEPTH_END = `+this.depth+`;

          float norm = 0.0;
          for (int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k) {
            if (k < depthBegin){
              continue;
            }
            else if (k >= depthBegin && k < depthEnd) {
              norm += getInputImage(b, r, c, k) * getInputImage(b, r, c, k);
            }
            else {
              break;
            }
          }

          norm = float(`+r+") * norm + float("+e+`);

          for(int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k){
            if (k < depthBegin){
              continue;
            }
            else if (k >= depthBegin && k < depthEnd){
              float dyi = -2.0 * float(`+r+`)
                * float(`+a+`)
                * getInputImage(b ,r ,c, k) * getOutputImage(b, r, c, d)
                / norm;
              if (k == d) {
                dyi += pow(norm, -1.0 * `+a+`);
              }
              if (k == coords[3]) {
                dyi *= getDy(b, r, c, d);
                result += dyi;
              }
            }
            else {
              break;
            }
          }
      }
      setOutput(result);
      }
    `},u0=function(n,t,e,r,a){this.variableNames=["x"],this.outputShape=[],this.packedInputs=!0,this.packedOutput=!0;var o,i=t,s=n[3]-1;this.outputShape=n;var u="float("+e+") + float("+r+") * sum";o=a===.5?"inversesqrt("+u+")":a===1?"1.0/("+u+")":"exp(log("+u+") * float(-"+a+"));",this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords.x;
        int r = coords.y;
        int c = coords.z;
        int d = coords.w;

        bool hasNextCol = d < `+this.outputShape[3]+`;
        bool hasNextRow = c < `+this.outputShape[2]+`;

        vec4 sum = vec4(0.);
        vec4 xFragAtOutputCoords = getX(b, r, c, d);

        vec4 xAtOutputCoords = vec4(
          getChannel(xFragAtOutputCoords, vec2(c, d)),
          hasNextCol ?
            getChannel(xFragAtOutputCoords, vec2(c, d + 1)) : 0.0,
          hasNextRow ?
            getChannel(xFragAtOutputCoords , vec2(c + 1, d)) : 0.0,
          (hasNextRow && hasNextCol) ?
            getChannel(xFragAtOutputCoords, vec2(c + 1, d + 1)) : 0.0
        );

        int firstChannel = d - `+i+`;
        vec2 cache = vec2(0.);
        if(firstChannel >= 0){
          vec4 firstChannelFrag = getX(b, r, c, firstChannel);
          cache.x = getChannel(firstChannelFrag, vec2(c, firstChannel));
            if(hasNextRow){
              cache.y = getChannel(firstChannelFrag, vec2(c + 1, firstChannel));
            }
        }

        ivec2 depth = ivec2(d, d + 1);
        for (int j = - `+i+"; j <= "+i+`; j++) {
          ivec2 idx = depth + j;
          bvec2 aboveLowerBound = greaterThanEqual(idx, ivec2(0));
          bvec2 belowUpperBound = lessThanEqual(idx, ivec2(`+s+`));

          bool depthInRange = aboveLowerBound.x && belowUpperBound.x;
          bool depthPlusOneInRange = aboveLowerBound.y && belowUpperBound.y;

          if(depthInRange || depthPlusOneInRange){
            vec4 z = vec4(0.);
            vec4 xFragAtCurrentDepth;
            z.xz = cache.xy;
            if(depthPlusOneInRange && hasNextCol){
              xFragAtCurrentDepth = idx.y != d ?
                getX(b, r, c, idx.y) : xFragAtOutputCoords;
              z.y = getChannel(xFragAtCurrentDepth, vec2(c, idx.y));
              if(hasNextRow){
                z.w = getChannel(xFragAtCurrentDepth, vec2(c + 1, idx.y));
              }
            }
            cache.xy = z.yw;
            sum += z * z;
          }
        }
        vec4 result = xAtOutputCoords * `+o+`;
        setOutput(result);
      }
    `},l0=function(n){this.variableNames=["dy","maxPos"],this.outputShape=n.inShape;var t=n.strideHeight,e=n.strideWidth,r=n.dilationHeight,a=n.effectiveFilterHeight,o=n.effectiveFilterWidth,i=a-1-n.padInfo.top,s=o-1-n.padInfo.left,u=a*o-1;this.userCode=`
      const ivec2 pads = ivec2(`+i+", "+s+`);

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];

        ivec2 dyRCCorner = coords.yz - pads;
        int dyRCorner = dyRCCorner.x;
        int dyCCorner = dyRCCorner.y;

        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < `+a+`;
          wR += `+r+`) {
          float dyR = float(dyRCorner + wR) / `+t+`.0;

          if (dyR < 0.0 || dyR >= `+n.outHeight+`.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          for (int wC = 0; wC < `+o+`; wC++) {
            float dyC = float(dyCCorner + wC) / `+e+`.0;

            if (dyC < 0.0 || dyC >= `+n.outWidth+`.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            float dyValue = getDy(b, idyR, idyC, d);
            int maxPosValue = `+u+` - int(getMaxPos(b, idyR, idyC, d));

            // Get the current value, check it against the value from the
            // position matrix.
            int curPosValue = wR * `+o+` + wC;
            float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);

            dotProd += dyValue * mask;
          }
        }
        setOutput(dotProd);
      }
    `},c0=function(n){this.variableNames=["dy","maxPos"],this.outputShape=n.inShape;var t=n.strideDepth,e=n.strideHeight,r=n.strideWidth,a=n.dilationDepth,o=n.dilationHeight,i=n.dilationWidth,s=n.effectiveFilterDepth,u=n.effectiveFilterHeight,l=n.effectiveFilterWidth,c=s-1-n.padInfo.front,p=u-1-n.padInfo.top,f=l-1-n.padInfo.left,d=s*u*l-1;this.userCode=`
      const ivec3 pads = ivec3(`+c+", "+p+", "+f+`);

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int ch = coords.u;

        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;
        int dyDCorner = dyCorner.x;
        int dyRCorner = dyCorner.y;
        int dyCCorner = dyCorner.z;

        // Convolve dy(?, ?, ?, ch) with pos mask(:, :, :, d) to get
        // dx(xD, xR, xC, ch).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;

        for (int wD = 0; wD < `+s+`;
           wD += `+a+`) {
          float dyD = float(dyDCorner + wD) / `+t+`.0;

          if (dyD < 0.0 || dyD >= `+n.outDepth+`.0 || fract(dyD) > 0.0) {
            continue;
          }
          int idyD = int(dyD);

          for (int wR = 0; wR < `+u+`;
              wR += `+o+`) {
            float dyR = float(dyRCorner + wR) / `+e+`.0;

            if (dyR < 0.0 || dyR >= `+n.outHeight+`.0 ||
                fract(dyR) > 0.0) {
              continue;
            }
            int idyR = int(dyR);

            for (int wC = 0; wC < `+l+`;
                wC += `+i+`) {
              float dyC = float(dyCCorner + wC) / `+r+`.0;

              if (dyC < 0.0 || dyC >= `+n.outWidth+`.0 ||
                  fract(dyC) > 0.0) {
                continue;
              }
              int idyC = int(dyC);

              float dyValue = getDy(batch, idyD, idyR, idyC, ch);
              int maxPosValue = `+d+` -
                  int(getMaxPos(batch, idyD, idyR, idyC, ch));

              // Get the current value, check it against the value from the
              // position matrix.
              int curPosValue =
                  wD * `+u+" * "+l+` +
                  wR * `+l+` + wC;
              float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);

              dotProd += dyValue * mask;
            }
          }
        }
        setOutput(dotProd);
      }
    `},Rs=function(n,t,e,r,a,o,i){e===void 0&&(e=!1),r===void 0&&(r=!1),a===void 0&&(a=!1),o===void 0&&(o=null),i===void 0&&(i=!1),this.variableNames=["matrixA","matrixB"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=t;var s=e?n[1]:n[2],u=Math.ceil(s/2),l=e?"i * 2, rc.y":"rc.y, i * 2",c=r?"rc.z, i * 2":"i * 2, rc.z",p=e?["a.xxyy","a.zzww"]:["a.xxzz","a.yyww"],f=r?["b.xzxz","b.ywyw"]:["b.xyxy","b.zwzw"],d="",h="";o&&(d=i?`vec4 activation(vec4 a) {
          vec4 b = getPreluActivationWeightsAtOutCoords();
          `+o+`
        }`:`vec4 activation(vec4 x) {
          `+o+`
        }`,h="result = activation(result);");var v=a?"result += getBiasAtOutCoords();":"";a&&this.variableNames.push("bias"),i&&this.variableNames.push("preluActivationWeights"),this.userCode=`
      `+d+`

      const float sharedDimension = `+u+`.0;

      vec4 dot2x2ARowBCol(ivec3 rc) {
        vec4 result = vec4(0);
        for (int i = 0; i < `+u+`; i++) {
          vec4 a = getMatrixA(rc.x, `+l+`);
          vec4 b = getMatrixB(rc.x, `+c+`);

          // These swizzled products need to be separately added.
          // See: https://github.com/tensorflow/tfjs/issues/1735
          result += (`+p[0]+" * "+f[0]+`);
          result += (`+p[1]+" * "+f[1]+`);
        }
        return result;
      }

      void main() {
        ivec3 rc = getOutputCoords();
        vec4 result = dot2x2ARowBCol(rc);

        `+v+`

        `+h+`

        setOutput(result);
      }
    `},d0=function(){function n(t,e,r){this.variableNames=["probs"],this.outputShape=[t,r],this.userCode=`
      uniform float seed;

      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];

        float r = random(seed);
        float cdf = 0.0;

        for (int i = 0; i < `+(e-1)+`; i++) {
          cdf += getProbs(batch, i);

          if (r < cdf) {
            setOutput(float(i));
            return;
          }
        }

        // If no other event happened, last event happened.
        setOutput(float(`+(e-1)+`));
      }
    `}return n.prototype.getCustomSetupFunc=function(t){var e=this;return function(r,a){e.seedLoc==null&&(e.seedLoc=r.getUniformLocation(a,"seed")),r.gl.uniform1f(e.seedLoc,t)}},n}(),p0=function(n,t,e,r){this.variableNames=["indices"],this.outputShape=[n,t],this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int index = round(getIndices(coords.x));
        setOutput(mix(float(`+r+"), float("+e+`),
                      float(index == coords.y)));
      }
    `},f0=function(n){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.outputShape=n;var t=n.length;if(t===0)this.userCode=`
        void main() {
          setOutput(vec4(getA(), 0., 0., 0.));
        }
      `;else{var e=tn("rc",t),r=Je(t),a=function(s,u,l){if(s===1)return"rc > "+u[0];for(var c="",p=s-2;p<s;p++)c+=l[p]+" >= "+u[p],p<s-1&&(c+="||");return c}(t,n,e),o=function(s,u,l,c){if(s===1)return"";var p=c.slice(-2);return`
    int r = `+p[0]+`;
    int c = `+p[1]+`;
    int rp1 = r + 1;
    int cp1 = c + 1;

    bool cEdge = cp1 >= `+u+`;
    bool rEdge = rp1 >= `+l+`;
  `}(t,n[n.length-1],n[n.length-2],e),i=function(s,u){var l=s.length,c=function(p,f){for(var d=[],h=0;h<=1;h++)for(var v=0;v<=1;v++){for(var g=(h===0?"r":"rp1")+", "+(v===0?"c":"cp1"),m=2;m<p;m++)g=f[f.length-1-m]+","+g;d.push(g)}return d}(l,u);return l===1?`getA(rc),
            rc + 1 >= `+s[0]+` ? 0. : getA(rc + 1),
            0, 0`:"getA("+c[0]+`),
          cEdge ? 0. : getA(`+c[1]+`),
          rEdge ? 0. : getA(`+c[2]+`),
          rEdge || cEdge ? 0. : getA(`+c[3]+")"}(n,e);this.userCode=`
        void main() {
          `+r+` rc = getOutputCoords();

          if(`+a+`) {
            setOutput(vec4(0));
          } else {
            `+o+`

            setOutput(vec4(`+i+`));
          }
        }
      `}},h0=function(n,t,e){this.variableNames=["x"],this.outputShape=t.map(function(u,l){return u[0]+n[l]+u[1]});var r=n.length,a=Je(r),o=t.map(function(u){return u[0]}).join(","),i=t.map(function(u,l){return u[0]+n[l]}).join(","),s=["coords[0]","coords[1]","coords[2]","coords[3]"].slice(0,r);this.userCode=r!==1?`
      `+a+" start = "+a+"("+o+`);
      `+a+" end = "+a+"("+i+`);

      void main() {
        `+a+` outC = getOutputCoords();
        if (any(lessThan(outC, start)) || any(greaterThanEqual(outC, end))) {
          setOutput(float(`+e+`));
        } else {
          `+a+` coords = outC - start;
          setOutput(getX(`+s+`));
        }
      }
    `:`
        int start = `+o+`;
        int end = `+i+`;

        void main() {
          int outC = getOutputCoords();
          if (outC < start || outC >= end) {
            setOutput(float(`+e+`));
          } else {
            setOutput(getX(outC - start));
          }
        }
      `},v0=function(n,t,e){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=t.map(function(g,m){return g[0]+n[m]+g[1]});for(var r=n.length,a=Je(r),o=t.map(function(g){return g[0]}).join(","),i=t.map(function(g,m){return g[0]+n[m]}).join(","),s=tn("rc",r),u=tn("source",r),l=s[r-1]+" < "+this.outputShape[r-1],c=r===1?"source":"vec2("+u.slice(-2).join()+")",p=[a+" rc = outputLoc;",s[r-1]+` += 1;
       if(`+l+`) {
      `,r===1?"":`}
       rc = outputLoc;
       `+s[r-2]+` += 1;
       if(`+s[r-2]+" < "+this.outputShape[r-2]+") {",r===1?"":"  "+s[r-1]+` += 1;
         if(`+l+") {"],f=r===1?"rc < start || rc >= end":"any(lessThan(rc, start)) || any(greaterThanEqual(rc, end))",d="",h=0,v=r===1?2:4;h<v;h++)d+=`
        `+p[h]+`
        if (`+f+`) {
          result[`+h+"] = float("+e+`);
        } else {
          `+a+` source = rc - start;
          result[`+h+"] = getChannel(getX("+u.join()+"), "+c+`);
        }
      `;d+=r===1?"} ":"}}",this.userCode=`
      const `+a+" start = "+a+"("+o+`);
      const `+a+" end = "+a+"("+i+`);

      void main() {
        `+a+` outputLoc = getOutputCoords();
        vec4 result = vec4(0.);
        `+d+`
        setOutput(result);
      }
    `},As=function(n,t,e){if(this.variableNames=["x"],t==="avg"&&e)throw new Error("Cannot compute positions for average pool.");var r=n.filterWidth,a=n.strideHeight,o=n.strideWidth,i=n.dilationHeight,s=n.dilationWidth,u=n.effectiveFilterHeight,l=n.effectiveFilterWidth,c=n.padInfo.top,p=n.padInfo.left;this.outputShape=n.outShape;var f=t==="avg",d="0.0";if(f||(d="-1.0 / 1e-20"),e)this.userCode=`
        const ivec2 strides = ivec2(`+a+", "+o+`);
        const ivec2 pads = ivec2(`+c+", "+p+`);

        void main() {
          ivec4 coords = getOutputCoords();
          int batch = coords[0];
          int d = coords[3];

          ivec2 xRCCorner = coords.yz * strides - pads;
          int xRCorner = xRCCorner.x;
          int xCCorner = xRCCorner.y;

          // max/min x(?, ?, d) to get y(yR, yC, d).
          // ? = to be determined
          float minMaxValue = 0.0;
          float minMaxValueFound = 0.0;
          int minMaxPosition = 0;
          float avgValue = 0.0;

          for (int wR = 0; wR < `+u+`;
              wR += `+i+`) {
            int xR = xRCorner + wR;

            if (xR < 0 || xR >= `+n.inHeight+`) {
              continue;
            }

            for (int wC = 0; wC < `+l+`;
                wC += `+s+`) {
              int xC = xCCorner + wC;

              if (xC < 0 || xC >= `+n.inWidth+`) {
                continue;
              }

              float value = getX(batch, xR, xC, d);

              // If a min / max value has already been found, use it. If not,
              // use the current value.
              float currMinMaxValue = mix(
                  value, minMaxValue, minMaxValueFound);
              if (value >= currMinMaxValue) {
                minMaxValue = value;
                minMaxValueFound = 1.0;
                minMaxPosition = wR * `+l+` + wC;
              }
            }
          }
          setOutput(float(minMaxPosition));
        }
      `;else{var h=t+"("+t+"("+t+"(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])";t==="avg"&&(h="avgValue / count");var v=4*Math.floor(r/4),g=r%4,m=`
      if (`+f+`) {
        avgValue += dot(values, ones);
      } else {
        minMaxValue = max(values, minMaxValue);
      }
    `;this.userCode=`
      const ivec2 strides = ivec2(`+a+", "+o+`);
      const ivec2 pads = ivec2(`+c+", "+p+`);
      const float initializationValue = `+d+`;
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float count = 0.0;

      float getValue(int batch, int xR, int xC, int d) {
        if (xC < 0 || xC >= `+n.inWidth+`) {
          return initializationValue;
        }
        count += 1.0;
        return getX(batch, xR, xC, d);
      }

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d = coords[3];

        ivec2 xRCCorner = coords.yz * strides - pads;
        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        // max/min x(?, ?, d) to get y(yR, yC, d).
        // ? = to be determined
        vec4 minMaxValue = vec4(`+d+`);
        float avgValue = 0.0;
        count = 0.0;

        for (int wR = 0; wR < `+u+`;
            wR += `+i+`) {
          int xR = xRCorner + wR;

          if (xR < 0 || xR >= `+n.inHeight+`) {
            continue;
          }

          for (int wC = 0; wC < `+v+`; wC += 4) {
            int xC = xCCorner + wC * `+s+`;

            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              getValue(batch, xR, xC + `+s+`, d),
              getValue(batch, xR, xC + 2 * `+s+`, d),
              getValue(batch, xR, xC + 3 * `+s+`, d)
            );

            `+m+`
          }

          int xC = xCCorner + `+v+`;
          if (`+(g===1)+`) {
            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              initializationValue,
              initializationValue,
              initializationValue
            );

            `+m+`
          } else if (`+(g===2)+`) {
            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              getValue(batch, xR, xC + `+s+`, d),
              initializationValue,
              initializationValue
            );

            `+m+`
          } else if (`+(g===3)+`) {
            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              getValue(batch, xR, xC + `+s+`, d),
              getValue(batch, xR, xC + 2 * `+s+`, d),
              initializationValue
            );

            `+m+`
          }
        }
        setOutput(`+h+`);
      }
    `}},Ps=function(n,t,e){if(this.variableNames=["x"],t==="avg"&&e)throw new Error("Cannot compute positions for average pool.");var r=n.filterWidth,a=n.strideDepth,o=n.strideHeight,i=n.strideWidth,s=n.dilationDepth,u=n.dilationHeight,l=n.dilationWidth,c=n.effectiveFilterDepth,p=n.effectiveFilterHeight,f=n.effectiveFilterWidth,d=n.padInfo.front,h=n.padInfo.top,v=n.padInfo.left;this.outputShape=n.outShape;var g=t==="avg",m="0.0";if(g||(m="-1.0 / 1e-20"),e)this.userCode=`
        const ivec3 strides =
            ivec3(`+a+", "+o+", "+i+`);
        const ivec3 pads = ivec3(`+d+", "+h+", "+v+`);

        void main() {
          ivec5 coords = getOutputCoords();
          int batch = coords.x;
          int ch = coords.u;

          ivec3 xCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;
          int xDCorner = xCorner.x;
          int xRCorner = xCorner.y;
          int xCCorner = xCorner.z;

          // max/min x(?, ?, ?, ch) to get y(yD, yR, yC, ch).
          // ? = to be determined
          float minMaxValue = 0.0;
          float minMaxValueFound = 0.0;
          int minMaxPosition = 0;

          for (int wD = 0; wD < `+c+`;
              wD += `+s+`) {
            int xD = xDCorner + wD;

            if (xD < 0 || xD >= `+n.inDepth+`) {
              continue;
            }

            for (int wR = 0; wR < `+p+`;
                wR += `+u+`) {
              int xR = xRCorner + wR;

              if (xR < 0 || xR >= `+n.inHeight+`) {
                continue;
              }

              for (int wC = 0; wC < `+f+`;
                  wC += `+l+`) {
                int xC = xCCorner + wC;

                if (xC < 0 || xC >= `+n.inWidth+`) {
                  continue;
                }

                float value = getX(batch, xD, xR, xC, ch);

                // If a min / max value has already been found, use it. If not,
                // use the current value.
                float currMinMaxValue = mix(
                    value, minMaxValue, minMaxValueFound);
                if (value >= currMinMaxValue) {
                  minMaxValue = value;
                  minMaxValueFound = 1.0;
                  minMaxPosition =
                      wD * `+p+" * "+f+` +
                      wR * `+f+` + wC;;
                }
              }
            }
          }
          setOutput(float(minMaxPosition));
        }
      `;else{var x=t+"("+t+"("+t+"(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])";t==="avg"&&(x="avgValue / count");var y=4*Math.floor(r/4),w=r%4,E=`
      if (`+g+`) {
        avgValue += dot(values, ones);
      } else {
        minMaxValue = max(values, minMaxValue);
      }
    `;this.userCode=`
      const ivec3 strides =
        ivec3(`+a+", "+o+", "+i+`);
      const ivec3 pads = ivec3(`+d+", "+h+", "+v+`);
      const float initializationValue = `+m+`;
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float count = 0.0;

      float getValue(int batch, int xD, int xR, int xC, int ch) {
        if (xC < 0 || xC >= `+n.inWidth+`) {
          return initializationValue;
        }
        count += 1.0;
        return getX(batch, xD, xR, xC, ch);
      }

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int ch = coords.u;

        ivec3 xCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;
        int xDCorner = xCorner.x;
        int xRCorner = xCorner.y;
        int xCCorner = xCorner.z;

        // max/min x(?, ?, ?, d) to get y(yD, yR, yC, ch).
        // ? = to be determined
        vec4 minMaxValue = vec4(`+m+`);
        float avgValue = 0.0;
        count = 0.0;

        for (int wD = 0; wD < `+c+`;
            wD += `+s+`) {
          int xD = xDCorner + wD;

          if (xD < 0 || xD >= `+n.inDepth+`) {
            continue;
          }

          for (int wR = 0; wR < `+p+`;
            wR += `+u+`) {
            int xR = xRCorner + wR;

            if (xR < 0 || xR >= `+n.inHeight+`) {
              continue;
            }

            for (int wC = 0; wC < `+y+`; wC += 4) {
              int xC = xCCorner + wC * `+l+`;

              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                getValue(batch, xD, xR, xC + `+l+`, ch),
                getValue(batch, xD, xR, xC + 2 * `+l+`, ch),
                getValue(batch, xD, xR, xC + 3 * `+l+`, ch)
              );

              `+E+`
            }

            int xC = xCCorner + `+y+`;
            if (`+(w===1)+`) {
              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                initializationValue,
                initializationValue,
                initializationValue
              );

              `+E+`
            } else if (`+(w===2)+`) {
              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                getValue(batch, xD, xR, xC + `+l+`, ch),
                initializationValue,
                initializationValue
              );

              `+E+`
            } else if (`+(w===3)+`) {
              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                getValue(batch, xD, xR, xC + `+l+`, ch),
                getValue(batch, xD, xR, xC + 2 * `+l+`, ch),
                initializationValue
              );

              `+E+`
            }
          }
          setOutput(`+x+`);
        }
      }
    `}},m0=function(n,t){this.variableNames=["x"];var e=n.windowSize,r=n.batchSize,a=n.inSize,o=Math.ceil(a/e);this.outputShape=[r,o];var i="0.0",s="";t==="prod"?i="1.0":t==="min"?(i="1.0 / 1e-20",s="min"):t==="max"&&(i="-1.0 / 1e-20",s="max");var u=t+"("+t+"("+t+"(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])";t==="sum"?u="sumValue":t==="prod"?u="prodValue":t==="all"?u="allValue":t==="any"&&(u="anyValue");var l=4*Math.floor(e/4),c=e%4,p=`
      if (`+(t==="sum")+`) {
        sumValue += dot(values, ones);
      } else if (`+(t==="prod")+`) {
        vec2 tmp = vec2(values[0], values[1]) * vec2(values[2], values[3]);
        prodValue *= tmp[0] * tmp[1];
      } else {
        minMaxValue = `+s+`(values, minMaxValue);
      }
    `,f="vec4";t==="all"?(i="1.0",p=`
        bool reducedAllValue = all(values);
        float floatedReducedAllValue = float(reducedAllValue);
        allValue = float(allValue >= 1.0 && floatedReducedAllValue >= 1.0);
      `,f="bvec4"):t==="any"&&(i="0.0",p=`
        bool reducedAnyValue = any(values);
        float floatedReducedAnyValue = float(reducedAnyValue);
        anyValue = float(anyValue >= 1.0 || floatedReducedAnyValue >= 1.0);
      `,f="bvec4");var d="";a%e>0&&(d=`
        if (inIdx < 0 || inIdx >= `+a+`) {
          return initializationValue;
        }
      `),this.userCode=`
      const float initializationValue = `+i+`;
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float getValue(int batch, int inIdx) {
        `+d+`
        return getX(batch, inIdx);
      }

      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = outIdx * `+e+`;

        vec4 minMaxValue = vec4(`+i+`);
        float prodValue = 1.0;
        float sumValue = 0.0;
        float allValue = 1.0;
        float anyValue = 0.0;

        for (int i = 0; i < `+l+`; i += 4) {
          int inIdx = inOffset + i;
          `+f+" values = "+f+`(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            getValue(batch, inIdx + 3)
          );

          `+p+`
        }

        int inIdx = inOffset + `+l+`;
        if (`+(c===1)+`) {
          `+f+" values = "+f+`(
            getValue(batch, inIdx),
            initializationValue,
            initializationValue,
            initializationValue
          );

          `+p+`
        } else if (`+(c===2)+`) {
          `+f+" values = "+f+`(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            initializationValue,
            initializationValue
          );

          `+p+`
        } else if (`+(c===3)+`) {
          `+f+" values = "+f+`(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            initializationValue
          );

          `+p+`
        }
        setOutput(`+u+`);
      }
    `},g0=function(n,t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=n;for(var e="",r=0;r<4;r++){var a="thisRC = rc;";r%2==1&&(a+="thisRC.z += 1;"),r>1&&(a+="thisRC.y += 1;"),e+=`
        `+a+`
        `+(r>0?"if(thisRC.y < rows && thisRC.z < cols){":"")+`
          int flatIndex = getFlatIndex(thisRC);

          ivec3 inputRC = inputCoordsFromReshapedOutCoords(flatIndex);
          vec2 inputRCInnerDims = vec2(float(inputRC.y),float(inputRC.z));

          result[`+r+`] =
            getChannel(getA(inputRC.x, inputRC.y, inputRC.z), inputRCInnerDims);
        `+(r>0?"}":"")+`
      `}this.userCode=`
      
    ivec3 inputCoordsFromReshapedOutCoords(int index) {
      `+Gr(["r","c","d"],t)+`
      return ivec3(r, c, d);
    }
  
      `+Lu(n)+`

      void main() {
        ivec3 rc = getOutputCoords();

        vec4 result = vec4(0.);

        ivec3 thisRC;
        int rows = `+n[1]+`;
        int cols = `+n[2]+`;

        `+e+`

        setOutput(result);
      }
    `},y0=function(n,t,e){this.variableNames=["dy"],this.outputShape=[],this.outputShape=t.shape;var r=t.shape,a=r[1],o=r[2],i=n.shape,s=i[1],u=i[2],l=[e&&s>1?a-1:a,e&&u>1?o-1:o],c=[e&&s>1?s-1:s,e&&u>1?u-1:u],p=l[0]/c[0],f=l[1]/c[1],d=1/p,h=1/f,v=2*Math.ceil(d)+2,g=2*Math.ceil(h)+2;this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        int r = coords[1];
        int c = coords[2];

        float accumulator = 0.0;

        const float heightScale = float(`+p+`);
        const float widthScale = float(`+f+`);

        const float invHeightScale = float(`+d+`);
        const float invWidthScale = float(`+h+`);

        const int winHeight = int(`+v+`);
        const int winWidth = int(`+g+`);

        // Compute bounds for where in dy we will look
        float startRLerp = floor(float(r) * invHeightScale);
        int startDyR = int(startRLerp - float(winHeight / 2));

        float startCLerp = floor(float(c) * invWidthScale);
        int startDyC = int(startCLerp - float(winWidth / 2));

        // Loop over dy
        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {
          int dyR = dyROffset + startDyR;

          // Guard against the window exceeding the bounds of dy
          if (dyR < 0 || dyR >= `+s+`) {
            continue;
          }

          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {
            int dyC = dyCOffset + startDyC;

            // Guard against the window exceeding the bounds of dy
            if (dyC < 0 || dyC >= `+u+`) {
              continue;
            }

            float dxR = float(dyR) * heightScale;
            int topDxRIndex = int(floor(dxR));
            int bottomDxRIndex = int(min(ceil(dxR), `+(a-1)+`.0));
            float dxRLerp = dxR - float(topDxRIndex);
            float inverseDxRLerp = 1.0 - dxRLerp;

            float dxC = float(dyC) * widthScale;
            int leftDxCIndex = int(floor(dxC));
            int rightDxCIndex = int(min(ceil(dxC), `+(o-1)+`.0));
            float dxCLerp = dxC - float(leftDxCIndex);
            float inverseDxCLerp = 1.0 - dxCLerp;

            if (r == topDxRIndex && c == leftDxCIndex) {
              // topLeft
              accumulator +=
                getDy(b, dyR, dyC, d) * inverseDxRLerp * inverseDxCLerp;
            }

            if (r == topDxRIndex && c == rightDxCIndex) {
              // topRight
              accumulator += getDy(b, dyR, dyC, d) * inverseDxRLerp * dxCLerp;
            }

            if (r == bottomDxRIndex && c == leftDxCIndex) {
              // bottomLeft
              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * inverseDxCLerp;
            }

            if (r == bottomDxRIndex && c == rightDxCIndex) {
              // bottomRight
              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * dxCLerp;
            }
          }
        }
        // End loop over dy

        setOutput(accumulator);
      }
    `},x0=function(n,t,e,r){this.variableNames=["A"],this.outputShape=[];var a=n[0],o=n[1],i=n[2],s=n[3];this.outputShape=[a,t,e,s];var u=[r&&t>1?o-1:o,r&&e>1?i-1:i],l=[r&&t>1?t-1:t,r&&e>1?e-1:e];this.userCode=`
      const vec2 effectiveInputOverOutputRatioRC = vec2(
          `+u[0]/l[0]+`,
          `+u[1]/l[1]+`);
      const vec2 inputShapeRC = vec2(`+o+".0, "+i+`.0);

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        ivec2 yRC = coords.yz;

        // Fractional source index.
        vec2 sourceFracIndexRC = vec2(yRC) * effectiveInputOverOutputRatioRC;

        // Compute the four integer indices.
        ivec2 sourceFloorRC = ivec2(sourceFracIndexRC);
        ivec2 sourceCeilRC = ivec2(
          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));

        float topLeft = getA(b, sourceFloorRC.x, sourceFloorRC.y, d);
        float bottomLeft = getA(b, sourceCeilRC.x, sourceFloorRC.y, d);
        float topRight = getA(b, sourceFloorRC.x, sourceCeilRC.y, d);
        float bottomRight = getA(b, sourceCeilRC.x, sourceCeilRC.y, d);

        vec2 fracRC = sourceFracIndexRC - vec2(sourceFloorRC);

        float top = topLeft + (topRight - topLeft) * fracRC.y;
        float bottom = bottomLeft + (bottomRight - bottomLeft) * fracRC.y;
        float newValue = top + (bottom - top) * fracRC.x;

        setOutput(newValue);
      }
    `},b0=function(n,t,e,r){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[];var a=n[0],o=n[1],i=n[2],s=n[3];this.outputShape=[a,t,e,s];var u=[r&&t>1?o-1:o,r&&e>1?i-1:i],l=[r&&t>1?t-1:t,r&&e>1?e-1:e];this.userCode=`
      const vec3 effectiveInputOverOutputRatioRC = vec3(
          `+u[0]/l[0]+`,
          `+u[1]/l[1]+`,
          `+u[1]/l[1]+`);
      const vec3 inputShapeRC = vec3(`+o+".0, "+i+`.0,
                                     `+i+`.0);

      float getAValue(int b, int r, int c, int d) {
        return getChannel(getA(b, r, c, d), vec2(c, d));
      }

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        // Calculate values for next column in yRC.z.
        ivec3 yRC = coords.yzz + ivec3(0, 0, 1);

        // Fractional source index.
        vec3 sourceFracIndexRC = vec3(yRC) * effectiveInputOverOutputRatioRC;

        // Compute the four integer indices.
        ivec3 sourceFloorRC = ivec3(sourceFracIndexRC);
        ivec3 sourceCeilRC = ivec3(
          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));

        // Should we calculate next column and row elements in 2x2 packed cell.
        bool hasNextCol = d < `+(s-1)+`;
        bool hasNextRow = coords.z < `+(e-1)+`;

        // In parallel, construct four corners for all four components in
        // packed 2x2 cell.
        vec4 topLeft = vec4(
          getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d),
          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d + 1) : 0.0);

        vec4 bottomLeft = vec4(
          getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d),
          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d + 1) : 0.0);

        vec4 topRight = vec4(
          getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d),
          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d + 1) : 0.0);

        vec4 bottomRight = vec4(
          getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d),
          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d + 1) : 0.0);

        vec3 fracRC = sourceFracIndexRC - vec3(sourceFloorRC);

        vec4 top = mix(topLeft, topRight, fracRC.yyzz);
        vec4 bottom = mix(bottomLeft, bottomRight, fracRC.yyzz);
        vec4 newValue = mix(top, bottom, fracRC.x);

        setOutput(newValue);
      }
    `},_0=function(n,t,e){this.variableNames=["dy"],this.outputShape=[],this.outputShape=t.shape;var r=t.shape,a=r[1],o=r[2],i=n.shape,s=i[1],u=i[2],l=[e&&s>1?a-1:a,e&&u>1?o-1:o],c=[e&&s>1?s-1:s,e&&u>1?u-1:u],p=l[0]/c[0],f=l[1]/c[1],d=1/p,h=1/f,v=2*Math.ceil(d)+2,g=2*Math.ceil(h)+2;this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        int r = coords[1];
        int c = coords[2];

        float accumulator = 0.0;

        const float heightScale = float(`+p+`);
        const float widthScale = float(`+f+`);

        const float invHeightScale = float(`+d+`);
        const float invWidthScale = float(`+h+`);

        const int winHeight = int(`+v+`);
        const int winWidth = int(`+g+`);

        // Compute bounds for where in dy we will look
        float startRLerp = floor(float(r) * invHeightScale);
        int startDyR = int(floor(startRLerp - float(winHeight / 2)));

        float startCLerp = floor(float(c) * invWidthScale);
        int startDyC = int(floor(startCLerp - float(winWidth / 2)));

        // Loop over dy
        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {
          int dyR = dyROffset + startDyR;

          // Guard against the window exceeding the bounds of dy
          if (dyR < 0 || dyR >= `+s+`) {
            continue;
          }

          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {
            int dyC = dyCOffset + startDyC;

            // Guard against the window exceeding the bounds of dy
            if (dyC < 0 || dyC >= `+u+`) {
              continue;
            }

            float sourceFracRow =
              float(`+l[0]+`) *
                (float(dyR) / float(`+c[0]+`));

            float sourceFracCol =
                float(`+l[1]+`) *
                  (float(dyC) / float(`+c[1]+`));

            int sourceNearestRow = int(min(
                float(int(`+a+`) - 1),
                `+e+` ? float(round(sourceFracRow)) :
                                  float(floor(sourceFracRow))));

            int sourceNearestCol = int(min(
                float(int(`+o+`) - 1),
                `+e+` ? float(round(sourceFracCol)) :
                                  float(floor(sourceFracCol))));

            if (r == sourceNearestRow && c == sourceNearestCol) {
              accumulator += getDy(b, dyR, dyC, d);
            }
          }
        }
        // End loop over dy

        setOutput(accumulator);
      }
    `},w0=function(n,t,e,r){this.variableNames=["A"],this.outputShape=[];var a=n[0],o=n[1],i=n[2],s=n[3];this.outputShape=[a,t,e,s];var u=[r&&t>1?o-1:o,r&&e>1?i-1:i],l=[r&&t>1?t-1:t,r&&e>1?e-1:e],c=r?"0.5":"0.0";this.userCode=`
      const vec2 effectiveInputOverOutputRatioRC = vec2(
          `+u[0]/l[0]+`,
          `+u[1]/l[1]+`);
      const vec2 inputShapeRC = vec2(`+o+".0, "+i+`.0);

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        ivec2 yRC = coords.yz;

        // Fractional source index.
        vec2 sourceFracIndexRC = vec2(yRC) * effectiveInputOverOutputRatioRC;

        // Compute the coordinators of nearest neighbor point.
        ivec2 sourceNearestRC = ivec2(
          min(inputShapeRC - 1.0, floor(sourceFracIndexRC + `+c+`)));

        float newValue = getA(b, sourceNearestRC.x, sourceNearestRC.y, d);

        setOutput(newValue);
      }
    `},E0=function(n,t){this.variableNames=["x"];var e=n.length;if(e>4)throw new Error("WebGL backend: Reverse of rank-"+e+" tensor is not yet supported");if(this.outputShape=n,e!==1){var r=n.map(function(o,i){return function(s){return t.indexOf(s)!==-1&&n[s]!==1?n[s]+" - coords["+s+"] - 1":"coords["+s+"]"}(i)}).join(","),a=Je(e);this.userCode=`
      void main() {
        `+a+` coords = getOutputCoords();
        setOutput(getX(`+r+`));
      }
    `}else this.userCode=`
        void main() {
          int coord = getOutputCoords();
          setOutput(getX(`+n[0]+` - coord - 1));
        }
      `},S0=function(n,t){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0;var e=n.length;if(e>4)throw new Error("WebGL backend: Reverse of rank-"+e+" tensor is not yet supported");this.outputShape=n;var r=tn("rc",e),a=r[e-1]+" + 1 < "+this.outputShape[e-1],o=r[e-2]+" + 1 < "+this.outputShape[e-2],i=Je(e);function s(u){var l=n.map(function(c,p){return function(f,d){return t.indexOf(f)!==-1&&n[f]!==1?n[f]+" - "+d[f]+" - 1":""+d[f]}(p,u)});return"getChannel(getX("+l.join(",")+"), vec2("+l.slice(-2).join(",")+"))"}this.userCode=e===1?`
        void main(){
          int rc = getOutputCoords();
          vec4 result = vec4(0.);
          result.r = getChannel(getX(`+n[0]+` - rc - 1),
            `+n[0]+` - rc - 1);
          if(`+a+`){
              result.g = getChannel(getX(`+n[0]+` - (rc  + 1) - 1),
                `+n[0]+` - (rc  + 1) - 1);
          }
          setOutput(result);
        }
      `:`
        void main() {
          `+i+` rc = getOutputCoords();
          vec4 result = vec4(0.);
          result.r = `+function(u){return s(u)}(r.slice())+`;
          if(`+a+`){
            result.g = `+function(u){return u[e-1]="("+u[e-1]+" + 1)",s(u)}(r.slice())+`;
          }
          if(`+o+`) {
            result.b = `+function(u){return u[e-2]="("+u[e-2]+" + 1)",s(u)}(r.slice())+`;
            if(`+a+`) {
              result.a = `+function(u){return u[e-1]="("+u[e-1]+" + 1)",u[e-2]="("+u[e-2]+" + 1)",s(u)}(r.slice())+`;
            }
          }
          setOutput(result);
        }
    `},Tc=function(n,t,e,r,a,o,i){this.variableNames=["updates","indices","defaultValue"],this.outputShape=o;var s=Je(a.length),u=Je(o.length),l="";e===1?l="i":e===2&&(l="i, j");var c="getIndices("+l+")",p="";r===1?p="i":r===2&&(p="i, coords[1]");var f="getUpdates("+p+")",d=t>1?"strides[j]":"strides";this.userCode=`
        `+s+" strides = "+s+"("+a+`);

        void main() {
          `+u+` coords = getOutputCoords();
          float sum = 0.0;
          bool found = false;
          for (int i = 0; i < `+n+`; i++) {
            int flattenedIndex = 0;
            for (int j = 0; j < `+t+`; j++) {
              int index = round(`+c+`);
              flattenedIndex += index * `+d+`;
            }
            if (flattenedIndex == coords[0]) {
              sum += `+f+`;
              found = true;
            }
          }
          setOutput(mix(getDefaultValue(), sum, float(found)));
        }
      `},C0=function(n,t){this.variableNames=["x","segmentIds"];var e=n.windowSize,r=n.batchSize,a=n.inSize,o=n.numSegments,i=o*Math.ceil(a/e);this.outputShape=[r,i];var s=4*Math.floor(e/4),u=e%4,l=`
        sumValue += dot(values, segFilter);
    `,c="";a%e>0&&(c=`
        if (inIdx < 0 || inIdx >= `+a+`) {
          return initializationValue;
        }
      `);var p="";a%e>0&&(p=`
        if (inIdx < 0 || inIdx >= `+a+`) {
          return -1.0;
        }
      `),this.userCode=`
      const float initializationValue = 0.0;

      float getValue(int batch, int inIdx) {
        `+c+`
        return getX(batch, inIdx);
      }

      float getSegmentIdAtIndex(int inIdx) {
        `+p+`
        return getSegmentIds(inIdx);
      }

      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = int(floor(float(outIdx) / float(
          `+o+")) * float("+e+`));
        int currentSeg = int(mod(float(outIdx), float(`+o+`)));

        float sumValue = 0.0;

        for (int i = 0; i < `+s+`; i += 4) {
          int inIdx = inOffset + i;
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            getValue(batch, inIdx + 3)
          );

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 3)) == currentSeg ? 1 : 0
          );

          `+l+`
        }

        int inIdx = inOffset + `+s+`;
        if (`+(u===1)+`) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            initializationValue,
            initializationValue,
            initializationValue
          );

          int inIdxSeg = int(getSegmentIdAtIndex(inIdx));

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            0,
            0,
            0
          );

          `+l+`
        } else if (`+(u===2)+`) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            initializationValue,
            initializationValue
          );

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,
              0,
              0
          );

          `+l+`
        } else if (`+(u===3)+`) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            initializationValue
          );

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,
            0
          );

          `+l+`
        }
        setOutput(sumValue);
      }
    `},I0=function(n,t,e){var r,a;if(this.variableNames=["c","a","b"],this.outputShape=t,e>4)throw Error("Where for rank "+e+" is not yet supported");if(e===1)a="resRC",r="resRC";else{for(var o=["resRC.x","resRC.y","resRC.z","resRC.w"],i=[],s=[],u=0;u<t.length;u++)s.push(""+o[u]),u<n&&i.push(""+o[u]);r=i.join(),a=s.join()}var l=Je(e);this.userCode=`
      void main() {
        `+l+` resRC = getOutputCoords();
        float cVal = getC(`+r+`);
        if (cVal >= 1.0) {
          setOutput(getA(`+a+`));
        } else {
          setOutput(getB(`+a+`));
        }
      }
    `},D0=function(){function n(t){this.variableNames=["source"],this.outputShape=t,this.rank=t.length;var e,r=Je(this.rank),a="uniform int start["+this.rank+"];",o=function(i){if(i===1)return"sourceLoc";if(i<=6)return Os.slice(0,i).map(function(s){return"sourceLoc."+s}).join(",");throw Error("Slicing for rank "+i+" is not yet supported")}(this.rank);e=`
        `+r+` sourceLoc;
        `+r+` coords = getOutputCoords();
        `+t.map(function(i,s){return"sourceLoc."+Os[s]+" = start["+s+"] + coords."+Os[s]+";"}).join(`
`)+`
      `,this.userCode=`
      `+a+`
      void main() {
        `+e+`
        setOutput(getSource(`+o+`));
      }
    `}return n.prototype.getCustomSetupFunc=function(t){var e=this;if(t.length!==this.rank)throw Error("The rank ("+this.rank+") of the program must match the length of start ("+t.length+")");return function(r,a){e.startLoc==null&&(e.startLoc=r.getUniformLocationNoThrow(a,"start"),e.startLoc==null)||r.gl.uniform1iv(e.startLoc,t)}},n}(),Os=["x","y","z","w","u","v"],k0=function(){function n(t){this.variableNames=["source"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=t,this.rank=t.length;var e=Je(this.rank),r=tn("coords",this.rank),a=tn("sourceLoc",this.rank),o=this.rank===1?"sourceLoc":"vec2("+a.slice(-2).join()+")",i="getChannel(getSource("+a.join()+"), "+o+")",s=`
      result.x = `+i+`;
      if (++`+r[this.rank-1]+" < "+t[this.rank-1]+`) {
        ++`+a[this.rank-1]+`;
        result.y = `+i+`;
        --`+a[this.rank-1]+`;
      }
    `,u=this.rank===1?"":`
      --`+r[this.rank-1]+`;
      if (++`+r[this.rank-2]+" < "+t[this.rank-2]+`) {
        ++`+a[this.rank-2]+`;
        result.z = `+i+`;
        if (++`+r[this.rank-1]+" < "+t[this.rank-1]+`) {
          ++`+a[this.rank-1]+`;
          result.w = `+i+`;
        }
      }
    `,l=this.rank<=4?`sourceLoc = coords +
            `+e+"("+t.map(function(c,p){return"start["+p+"]"}).join()+");":t.map(function(c,p){return a[p]+" = "+r[p]+" + start["+p+"];"}).join(`
`);this.userCode=`
      uniform int start[`+this.rank+`];
      void main() {
        `+e+` coords = getOutputCoords();
        `+e+` sourceLoc;
        `+l+`
        vec4 result = vec4(0.);
        `+s+`
        `+u+`
        setOutput(result);
      }
    `}return n.prototype.getCustomSetupFunc=function(t){var e=this;if(t.length!==this.rank)throw Error("The rank ("+this.rank+") of the program must match the length of start ("+t.length+")");return function(r,a){e.startLoc==null&&(e.startLoc=r.getUniformLocationNoThrow(a,"start"),e.startLoc==null)||r.gl.uniform1iv(e.startLoc,t)}},n}(),T0=function(n,t,e){this.variableNames=["x"],this.outputShape=e;var r=e.length,a=Je(e.length),o=Je(e.length),i="";if(r===1)i="coords * strides + begin";else{var s=0;i=e.map(function(u,l){return s++,e.length===1?"coords * strides["+l+"] + begin["+l+"]":"coords["+(s-1)+"] * strides["+l+"] + begin["+l+"]"}).join(",")}this.userCode=`
      `+a+" begin = "+a+"("+n+`);
      `+a+" strides = "+a+"("+t+`);

      void main() {
        `+o+` coords = getOutputCoords();
        setOutput(getX(`+i+`));
      }
    `},N0=function(){function n(t){this.gpgpu=t,this.numUsedTextures=0,this.numFreeTextures=0,this.freeTextures={},this.logEnabled=!1,this.usedTextures={}}return n.prototype.acquireTexture=function(t,e,r){var a,o=Nc(e,r),i=Rc(t,o,r);if(i in this.freeTextures||(this.freeTextures[i]=[]),i in this.usedTextures||(this.usedTextures[i]=[]),this.freeTextures[i].length>0){this.numFreeTextures--,this.numUsedTextures++,this.log();var s=this.freeTextures[i].shift();return this.usedTextures[i].push(s),s}return this.numUsedTextures++,this.log(),o===cn.PACKED_2X2_FLOAT32?a=this.gpgpu.createPackedMatrixTexture(t[0],t[1]):o===cn.PACKED_2X2_FLOAT16?a=this.gpgpu.createFloat16PackedMatrixTexture(t[0],t[1]):o===cn.UNPACKED_FLOAT32?a=this.gpgpu.createFloat32MatrixTexture(t[0],t[1]):o===cn.UNPACKED_FLOAT16?a=this.gpgpu.createFloat16MatrixTexture(t[0],t[1]):o===cn.PACKED_4X1_UNSIGNED_BYTE&&(a=this.gpgpu.createUnsignedBytesMatrixTexture(t[0],t[1])),this.usedTextures[i].push(a),a},n.prototype.releaseTexture=function(t,e,r,a){if(this.freeTextures!=null){var o=Rc(e,Nc(r,a),a);o in this.freeTextures||(this.freeTextures[o]=[]),this.freeTextures[o].push(t),this.numFreeTextures++,this.numUsedTextures--;var i=this.usedTextures[o],s=i.indexOf(t);if(s<0)throw new Error("Cannot release a texture that was never provided by this texture manager");i.splice(s,1),this.log()}},n.prototype.log=function(){if(this.logEnabled){var t=this.numFreeTextures+this.numUsedTextures;console.log("Free/Used",this.numFreeTextures+" / "+this.numUsedTextures,"("+t+")")}},n.prototype.getNumUsedTextures=function(){return this.numUsedTextures},n.prototype.getNumFreeTextures=function(){return this.numFreeTextures},n.prototype.dispose=function(){var t=this;if(this.freeTextures!=null){for(var e in this.freeTextures)this.freeTextures[e].forEach(function(r){t.gpgpu.deleteMatrixTexture(r)});for(var e in this.usedTextures)this.usedTextures[e].forEach(function(a){t.gpgpu.deleteMatrixTexture(a)});this.freeTextures=null,this.usedTextures=null,this.numUsedTextures=0,this.numFreeTextures=0}},n}();function Nc(n,t){if(n===dn.UPLOAD)return cn.PACKED_2X2_FLOAT32;if(n===dn.RENDER||n==null)return function(e){return J().getBool("WEBGL_RENDER_FLOAT32_ENABLED")?e?cn.PACKED_2X2_FLOAT32:cn.UNPACKED_FLOAT32:e?cn.PACKED_2X2_FLOAT16:cn.UNPACKED_FLOAT16}(t);if(n===dn.DOWNLOAD||n===dn.PIXELS)return cn.PACKED_4X1_UNSIGNED_BYTE;throw new Error("Unknown logical texture type "+n)}function Rc(n,t,e){return n[0]+"_"+n[1]+"_"+t+"_"+e}var R0=function(n,t){this.variableNames=["A"];for(var e=new Array(n.length),r=0;r<e.length;r++)e[r]=n[r]*t[r];this.outputShape=e,this.rank=e.length;var a=Je(this.rank),o=function(i){var s=i.length;if(s>5)throw Error("Tile for rank "+s+" is not yet supported");if(s===1)return"imod(resRC, "+i[0]+")";for(var u=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u"],l=[],c=0;c<i.length;c++)l.push("imod("+u[c]+", "+i[c]+")");return l.join()}(n);this.userCode=`
      void main() {
        `+a+` resRC = getOutputCoords();
        setOutput(getA(`+o+`));
      }
    `},A0=function(n,t){this.variableNames=["A"];for(var e=new Array(n.length),r=0;r<e.length;r++)e[r]=n[t[r]];this.outputShape=e,this.rank=e.length;var a=Je(this.rank),o=function(i){var s=i.length;if(s>6)throw Error("Transpose for rank "+s+" is not yet supported");for(var u=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u","resRC.v"],l=new Array(s),c=0;c<i.length;c++)l[i[c]]=u[c];return l.join()}(t);this.userCode=`
    void main() {
      `+a+` resRC = getOutputCoords();
      setOutput(getA(`+o+`));
    }
    `},P0=function(n,t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0;for(var e=new Array(n.length),r=0;r<e.length;r++)e[r]=n[t[r]];if(this.outputShape=e,this.rank=e.length,this.rank>6)throw Error("Packed transpose for rank "+this.rank+" is not yet supported.");var a=Je(this.rank),o=yp("rc",this.rank),i=new Array(this.rank);for(r=0;r<t.length;r++)i[t[r]]=o[r];var s="vec2("+i.slice(-2).join()+")",u="++"+o[this.rank-1]+" < "+e[this.rank-1],l="getChannel(getA("+i.join()+"), "+s+")";this.userCode=`
    void main() {
      `+a+` rc = getOutputCoords();
      vec4 result = vec4(0.);
      result[0] = `+l+`;
      if(`+u+`) {
        result[1] = `+l+`;
      }
      --`+o[this.rank-1]+`;
      if(++`+o[this.rank-2]+" < "+e[this.rank-2]+`) {
        result[2] = `+l+`;
        if(`+u+`) {
          result[3] = `+l+`;
        }
      }
      setOutput(result);
    }
    `},Bu=1.7580993408473768,Uu=1.0507009873554805,Oe=function(n,t){this.variableNames=["A"],this.outputShape=n,this.userCode=`
      float unaryOperation(float x) {
        `+t+`
      }

      void main() {
        float x = getAAtOutCoords();
        float y = unaryOperation(x);

        setOutput(y);
      }
    `},Mn="if (isnan(x)) return x;",O0="return x;",Ac="return abs(x);",Ep=Mn+`
  return (x < 0.0) ? 0.0 : x;
`,Sp=Mn+`
  return (x < 0.0) ? 0.0 : min(6.0, x);
`,Cp="return (x >= 0.0) ? x : (exp(x) - 1.0);",M0=`
  // Stable and Attracting Fixed Point (0, 1) for Normalized Weights.
  // see: https://arxiv.org/abs/1706.02515
  float scaleAlpha = `+Bu+`;
  float scale = `+Uu+`;
  return (x >= 0.0) ? scale * x : scaleAlpha * (exp(x) - 1.0);
`,Pc="return -x;",Oc="return ceil(x);",Mc="return floor(x);",Fc="return exp(x);",Vc="return exp(x) - 1.0;",F0=Mn+`
  return sin(x);
`,V0=Mn+`
  return cos(x);
`,L0=Mn+`
  if (abs(x) > 1.) {
    return NAN;
  }
  return asin(x);
`,B0=Mn+`
  if (abs(x) > 1.) {
    return NAN;
  }
  return acos(x);
`,U0=Mn+`
  return atan(x);
`,W0=Mn+"return log(x + sqrt(x * x + 1.0));",q0=Mn+`
  if (x < 1.0) return NAN;
  return log(x + sqrt(x * x - 1.0));`,z0=Mn+`
  if ((x < -1.0) || (x > 1.0)) return NAN;
  return (log(1.0 + x) - log(1.0 - x)) / 2.0;`,Wo="return x;",$0="return x;",Ip=`
  vec4 result = x * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,Dp=`
  vec4 result = min(x, vec4(6.)) * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,kp=`
  vec4 result;

  result.r = (x.r >= 0.0) ? x.r : (exp(x.r) - 1.0);
  result.g = (x.g >= 0.0) ? x.g : (exp(x.g) - 1.0);
  result.b = (x.b >= 0.0) ? x.b : (exp(x.b) - 1.0);
  result.a = (x.a >= 0.0) ? x.a : (exp(x.a) - 1.0);

  return result;
`,Ya=function(n,t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=n,this.userCode=`
      vec4 unaryOperation(vec4 x) {
        `+t+`
      }

      void main() {
        vec4 x = getAAtOutCoords();
        vec4 y = unaryOperation(x);

        setOutput(y);
      }
    `},H0=function(n){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!1,this.outputShape=n;var t=n.length,e=tn("rc",t),r=Je(t),a=function(s,u){if(s===1)return"rc";for(var l="",c=0;c<s;c++)l+=u[c],c<s-1&&(l+=",");return l}(t,e),o=e.slice(-2),i=t<=1?"rc":"vec2("+o.join(",")+")";this.userCode=`
      void main() {
        `+r+` rc = getOutputCoords();
        vec4 packedInput = getA(`+a+`);

        setOutput(getChannel(packedInput, `+i+`));
      }
    `},qo={};function zo(n,t){if(t===void 0&&(t=!1),n==="linear")return t?$0:O0;if(n==="relu")return t?Ip:Ep;if(n==="elu")return t?kp:Cp;if(n==="relu6")return t?Dp:Sp;if(n==="prelu")return t?wp:_p;throw new Error("Activation "+n+" has not been implemented for the WebGL backend.")}var G0=600,j0=function(n){function t(e){var r,a=n.call(this)||this;if(a.pendingRead=new WeakMap,a.pendingDisposal=new WeakSet,a.dataRefCount=new WeakMap,a.numBytesInGPU=0,a.uploadWaitMs=0,a.downloadWaitMs=0,a.warnedAboutMemory=!1,a.pendingDeletes=0,a.disposed=!1,!J().getBool("HAS_WEBGL"))throw new Error("WebGL is not supported on this device");if(e==null){var o=Jn(J().getNumber("WEBGL_VERSION"));a.binaryCache=((r=J().getNumber("WEBGL_VERSION"))in qo||(qo[r]={}),qo[r]),a.gpgpu=new a0(o),a.canvas=o.canvas,a.gpgpuCreatedLocally=!0}else a.gpgpu=e,a.binaryCache={},a.gpgpuCreatedLocally=!1,a.canvas=e.gl.canvas;return a.textureManager=new N0(a.gpgpu),a.numMBBeforeWarning=J().global.screen==null?1024:J().global.screen.height*J().global.screen.width*window.devicePixelRatio*G0/1024/1024,a.texData=new lp(a,W),a}return On(t,n),t.prototype.numDataIds=function(){return this.texData.numDataIds()+(this.cpuBackend?this.cpuBackend.numDataIds():0)-this.pendingDeletes},t.prototype.write=function(e,r,a){if(J().getBool("DEBUG")&&this.checkNumericalProblems(e),a==="complex64"&&e!=null)throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");var o={};return this.texData.set(o,{shape:r,dtype:a,values:e,usage:dn.UPLOAD}),o},t.prototype.move=function(e,r,a,o){if(J().getBool("DEBUG")&&this.checkNumericalProblems(r),o==="complex64")throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");this.texData.set(e,{shape:a,dtype:o,values:r,usage:dn.UPLOAD})},t.prototype.readSync=function(e){var r=this.texData.get(e),a=r.values,o=r.dtype,i=r.complexTensors,s=r.slice,u=r.shape,l=r.isPacked;if(s!=null){var c=void 0;c=l?new Ya(u,Wo):new Oe(u,Wo);var p=this.runWebGLProgram(c,[{dataId:e,shape:u,dtype:o}],o),f=this.readSync(p.dataId);return this.disposeData(p.dataId),f}if(a!=null)return this.convertAndCacheOnCPU(e);if(o==="string")return a;var d,h,v=this.activeTimers!=null;return v&&(d=Wn()),o==="complex64"?h=lu(i.real.dataSync(),i.imag.dataSync()):h=this.getValuesFromTexture(e),v&&(this.downloadWaitMs+=Wn()-d),this.convertAndCacheOnCPU(e,h)},t.prototype.read=function(e){return he(this,void 0,void 0,function(){var r,a,o,i,s,u,l,c,p,f,d,h,v,g,m,x,y,w,E,D,k,S;return ve(this,function(_){switch(_.label){case 0:if(this.pendingRead.has(e))return r=this.pendingRead.get(e),[2,new Promise(function(b){return r.push(b)})];if(a=this.texData.get(e),o=a.values,i=a.shape,s=a.slice,u=a.dtype,l=a.complexTensors,c=a.isPacked,s!=null)return p=void 0,p=c?new Ya(i,Wo):new Oe(i,Wo),f=this.runWebGLProgram(p,[{dataId:e,shape:i,dtype:u}],u),d=this.read(f.dataId),this.disposeData(f.dataId),[2,d];if(o!=null)return[2,this.convertAndCacheOnCPU(e)];if(!J().getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")&&J().getNumber("WEBGL_VERSION")===2)throw new Error("tensor.data() with WEBGL_DOWNLOAD_FLOAT_ENABLED=false and WEBGL_VERSION=2 not yet supported.");return h=null,u!=="complex64"&&J().get("WEBGL_BUFFER_SUPPORTED")&&(v=this.decode(e),g=this.texData.get(v.dataId),h=(S=this.gpgpu).createBufferFromTexture.apply(S,[g.texture].concat(eo(i)))),this.pendingRead.set(e,[]),u==="complex64"?[3,2]:[4,this.gpgpu.createAndWaitForFence()];case 1:_.sent(),_.label=2;case 2:return u!=="complex64"?[3,4]:[4,Promise.all([l.real.data(),l.imag.data()])];case 3:return x=_.sent(),y=x[0],w=x[1],m=lu(y,w),[3,5];case 4:h==null?m=this.getValuesFromTexture(e):(E=ge(i),m=this.gpgpu.downloadFloat32MatrixFromBuffer(h,E)),_.label=5;case 5:return v!=null&&this.disposeData(v.dataId),D=this.convertAndCacheOnCPU(e,m),k=this.pendingRead.get(e),this.pendingRead.delete(e),k.forEach(function(b){return b(D)}),this.pendingDisposal.has(e)&&(this.pendingDisposal.delete(e),this.disposeData(e),this.pendingDeletes--),[2,D]}})})},t.prototype.checkNumericalProblems=function(e){if(e!=null)for(var r=0;r<e.length;r++){var a=e[r];if(!My(a))throw J().getBool("WEBGL_RENDER_FLOAT32_CAPABLE")?Error("The value "+a+" cannot be represented with your current settings. Consider enabling float32 rendering: 'tf.env().set('WEBGL_RENDER_FLOAT32_ENABLED', true);'"):Error("The value "+a+" cannot be represented on this device.")}},t.prototype.getValuesFromTexture=function(e){var r,a=this.texData.get(e),o=a.shape,i=a.dtype,s=a.isPacked,u=ge(o);if(J().getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")){var l=this.decode(e),c=this.texData.get(l.dataId),p=(r=this.gpgpu).downloadMatrixFromPackedTexture.apply(r,[c.texture].concat(eo(o))).subarray(0,u);return this.disposeData(l.dataId),p}var f=J().getBool("WEBGL_PACK")&&s===!0,d=f?Ds(o):o,h=f?new O1(d):new P1(d),v=this.runWebGLProgram(h,[{shape:d,dtype:i,dataId:e}],"float32"),g=this.texData.get(v.dataId),m=this.gpgpu.downloadByteEncodedFloatMatrixFromOutputTexture(g.texture,g.texShape[0],g.texShape[1]).subarray(0,u);return this.disposeData(v.dataId),m},t.prototype.time=function(e){return he(this,void 0,void 0,function(){var r,a,o,i,s,u,l;return ve(this,function(c){switch(c.label){case 0:return r=this.activeTimers,a=[],o=!1,this.programTimersStack==null?(this.programTimersStack=a,o=!0):this.activeTimers.push(a),this.activeTimers=a,e(),i=Da(this.activeTimers.map(function(p){return p.query})).filter(function(p){return p!=null}),s=Da(this.activeTimers.map(function(p){return p.name})).filter(function(p){return p!=null}),this.activeTimers=r,o&&(this.programTimersStack=null),u={uploadWaitMs:this.uploadWaitMs,downloadWaitMs:this.downloadWaitMs,kernelMs:null,wallMs:null},J().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?[4,Promise.all(i)]:[3,2];case 1:return l=c.sent(),u.kernelMs=vy(l),u.getExtraProfileInfo=function(){return l.map(function(p,f){return{name:s[f],ms:p}}).map(function(p){return p.name+": "+p.ms}).join(", ")},[3,3];case 2:u.kernelMs={error:"WebGL query timers are not supported in this environment."},c.label=3;case 3:return this.uploadWaitMs=0,this.downloadWaitMs=0,[2,u]}})})},t.prototype.memory=function(){return{unreliable:!1,numBytesInGPU:this.numBytesInGPU}},t.prototype.startTimer=function(){return J().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?this.gpgpu.beginQuery():{startMs:Wn(),endMs:null}},t.prototype.endTimer=function(e){return J().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?(this.gpgpu.endQuery(),e):(e.endMs=Wn(),e)},t.prototype.getQueryTime=function(e){return he(this,void 0,void 0,function(){var r;return ve(this,function(a){return J().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?[2,this.gpgpu.waitForQueryAndGetTime(e)]:[2,(r=e).endMs-r.startMs]})})},t.prototype.disposeData=function(e){if(!this.pendingDisposal.has(e)){if(this.pendingRead.has(e))return this.pendingDisposal.add(e),void this.pendingDeletes++;if(this.texData.has(e)){this.releaseGPUData(e);var r=this.texData.get(e).complexTensors;r!=null&&(r.real.dispose(),r.imag.dispose()),this.texData.delete(e)}}},t.prototype.releaseGPUData=function(e){var r=this.texData.get(e),a=r.texture,o=r.dtype,i=r.texShape,s=r.usage,u=r.isPacked,l=r.slice,c=l&&l.origDataId||e,p=this.dataRefCount.get(c);p>1?this.dataRefCount.set(c,p-1):(this.dataRefCount.delete(c),a!=null&&(this.numBytesInGPU-=this.computeBytes(i,o),this.textureManager.releaseTexture(a,i,s,u)));var f=this.texData.get(e);f.texture=null,f.texShape=null,f.isPacked=!1,f.slice=null},t.prototype.getTexture=function(e){return this.uploadToGPU(e),this.texData.get(e).texture},t.prototype.getDataInfo=function(e){return this.texData.get(e)},t.prototype.getCPUBackend=function(){return J().getBool("WEBGL_CPU_FORWARD")?(this.cpuBackend==null&&(this.cpuBackend=W.findBackend("cpu")),this.cpuBackend):null},t.prototype.shouldExecuteOnCPU=function(e,r){var a=this;return r===void 0&&(r=128),this.getCPUBackend()!=null&&e.every(function(o){return a.texData.get(o.dataId).texture==null&&o.size<r})},t.prototype.getGPGPUContext=function(){return this.gpgpu},t.prototype.complex=function(e,r){var a=this.makeOutput(e.shape,"complex64");return this.texData.get(a.dataId).complexTensors={real:W.keep(e.clone()),imag:W.keep(r.clone())},a},t.prototype.real=function(e){return this.texData.get(e.dataId).complexTensors.real.clone()},t.prototype.imag=function(e){return this.texData.get(e.dataId).complexTensors.imag.clone()},t.prototype.slice=function(e,r,a){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.slice(e,r,a);if(ge(a)===0)return Ot([],a,e.dtype);var o=this.texData.get(e.dataId).isPacked,i=sp(e.shape,r,a);if(o||!i){var s=J().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new k0(a):new D0(a),u=s.getCustomSetupFunc(r);return this.compileAndRun(s,[e],null,u)}return this.uploadToGPU(e.dataId),this.shallowSlice(e,r,a)},t.prototype.shallowSlice=function(e,r,a){var o=this.texData.get(e.dataId),i=this.makeOutput(a,e.dtype),s=this.texData.get(i.dataId);Object.assign(s,o),s.shape=a,s.dtype=e.dtype;var u=up(r,e.strides);o.slice&&(u+=o.slice.flatOffset),s.slice={flatOffset:u,origDataId:o.slice&&o.slice.origDataId||e.dataId};var l=this.dataRefCount.get(s.slice.origDataId)||1;return this.dataRefCount.set(s.slice.origDataId,l+1),i},t.prototype.stridedSlice=function(e,r,a,o){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.stridedSlice(e,r,a,o);var i=Pu(r,a,o);if(i.some(function(u){return u===0}))return Ot([],i);var s=new T0(r,o,i);return this.compileAndRun(s,[e])},t.prototype.reverse=function(e,r){var a=J().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new S0(e.shape,r):new E0(e.shape,r);return this.compileAndRun(a,[e])},t.prototype.concat=function(e,r){if(e[0].dtype==="complex64"){var a=e.map(function(d){return _n(d)}),o=e.map(function(d){return zn(d)});return At(this.concat(a,r),this.concat(o,r))}if(this.shouldExecuteOnCPU(e))return this.cpuBackend.concat(e,r);if(e.length===1)return e[0];if(e.length>J().getNumber("WEBGL_MAX_TEXTURES_IN_SHADER")){var i=Math.floor(e.length/2),s=this.concat(e.slice(0,i),r),u=this.concat(e.slice(i),r);return this.concat([s,u],r)}if(J().getBool("WEBGL_PACK_ARRAY_OPERATIONS")&&e[0].rank>1){var l=new x1(e.map(function(d){return d.shape}),r);return this.compileAndRun(l,e)}var c=Ta(e.map(function(d){return d.shape}),r),p=e.map(function(d){return d.as2D(-1,ge(d.shape.slice(r)))}),f=new y1(p.map(function(d){return d.shape}));return this.compileAndRun(f,p).reshape(c)},t.prototype.neg=function(e){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.neg(e);if(J().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(e,Pc,e.dtype);var r=new Oe(e.shape,Pc);return this.compileAndRun(r,[e])},t.prototype.batchMatMul=function(e,r,a,o){var i=a?e.shape[2]:e.shape[1],s=o?r.shape[1]:r.shape[2],u=a?e.shape[1]:e.shape[2],l=e.shape[0];if((i===1||s===1)&&u>1e3){a&&(e=e.transpose([0,2,1])),o&&(r=r.transpose([0,2,1]));var c=s===1?e:e.as3D(l,u,1),p=s===1?2:1,f=s===1?r.as3D(l,1,u):r;return this.multiply(c,f).sum(p,!0)}var d=Pt(e.dtype,r.dtype),h=new Rs(e.shape,[l,i,s],a,o);return this.compileAndRun(h,[e,r],d)},t.prototype.fusedBatchMatMul=function(e){var r=e.a,a=e.b,o=e.transposeA,i=e.transposeB,s=e.bias,u=e.activation,l=e.preluActivationWeights,c=o?r.shape[2]:r.shape[1],p=i?a.shape[1]:a.shape[2],f=r.shape[0],d=Pt(r.dtype,a.dtype),h=s!=null,v=l!=null,g=u?zo(u,!0):null,m=new Rs(r.shape,[f,c,p],o,i,h,g,v),x=[r,a];return s&&x.push(s),l&&x.push(l),this.compileAndRun(m,x,d)},t.prototype.multiply=function(e,r){if(e.dtype==="complex64"){var a=this.texData.get(e.dataId),o=this.texData.get(r.dataId),i=new _c(f1,e.shape,r.shape),s=new _c(h1,e.shape,r.shape),u=[this.makeComplexComponentTensorInfo(e,a.complexTensors.real),this.makeComplexComponentTensorInfo(e,a.complexTensors.imag),this.makeComplexComponentTensorInfo(r,o.complexTensors.real),this.makeComplexComponentTensorInfo(r,o.complexTensors.imag)],l=this.compileAndRun(i,u),c=this.compileAndRun(s,u),p=this.complex(l,c);return l.dispose(),c.dispose(),p}if(this.shouldExecuteOnCPU([e,r]))return this.cpuBackend.multiply(e,r);if(J().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,r,wc,e.dtype);var f=new ut(wc,e.shape,r.shape);return this.compileAndRun(f,[e,r],e.dtype)},t.prototype.batchNormalization=function(e,r,a,o,i,s){var u=[e,r,a],l=null;s!=null&&(l=s.shape,u.push(s));var c=null;if(i!=null&&(c=i.shape,u.push(i)),J().getBool("WEBGL_PACK_NORMALIZATION")){var p=new p1(e.shape,r.shape,a.shape,l,c,o);return this.compileAndRun(p,u)}var f=new d1(e.shape,r.shape,a.shape,l,c,o);return this.compileAndRun(f,u)},t.prototype.localResponseNormalization4D=function(e,r,a,o,i){var s=J().getBool("WEBGL_PACK_NORMALIZATION")?new u0(e.shape,r,a,o,i):new i0(e.shape,r,a,o,i);return this.compileAndRun(s,[e])},t.prototype.LRNGrad=function(e,r,a,o,i,s,u){var l=new s0(r.shape,o,i,s,u);return this.compileAndRun(l,[r,a,e])},t.prototype.tile=function(e,r){if(e.dtype==="string"){var a=this.readSync(e.dataId).map(function(i){return li(i)});return mp(Ne(e.shape,e.dtype,a),r)}var o=new R0(e.shape,r);return this.compileAndRun(o,[e])},t.prototype.pad=function(e,r,a){var o=J().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new v0(e.shape,r,a):new h0(e.shape,r,a);return this.compileAndRun(o,[e])},t.prototype.transpose=function(e,r){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.transpose(e,r);var a=J().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new P0(e.shape,r):new A0(e.shape,r);return this.compileAndRun(a,[e])},t.prototype.gather=function(e,r,a){if(this.shouldExecuteOnCPU([e,r]))return this.cpuBackend.gather(e,r,a);var o=new U1(e.shape,r.size,a);return this.compileAndRun(o,[e,r])},t.prototype.batchToSpaceND=function(e,r,a){V(e.rank<=4,function(){return"batchToSpaceND for rank > 4 with a WebGL backend not implemented yet"});var o=r.reduce(function(p,f){return p*f}),i=vi(e.shape,r,o),s=mi(i.length,r.length),u=gi(e.shape,r,o),l=rp(a,r.length),c=ap(u,a,r.length);return e.reshape(i).transpose(s).reshape(u).slice(l,c)},t.prototype.spaceToBatchND=function(e,r,a){V(e.rank<=4,function(){return"spaceToBatchND for rank > 4 with a WebGL backend not implemented yet"});var o=r.reduce(function(f,d){return f*d}),i=[[0,0]];i.push.apply(i,a);for(var s=1+r.length;s<e.shape.length;++s)i.push([0,0]);var u=e.pad(i),l=vi(u.shape,r,o,!1),c=mi(l.length,r.length,!1),p=gi(u.shape,r,o,!1);return u.reshape(l).transpose(c).reshape(p)},t.prototype.reduce=function(e,r,a){var o=e.shape[0],i=e.shape[1],s=ks(i),u=new m0({windowSize:s,inSize:i,batchSize:o},r),l=this.compileAndRun(u,[e],a);return l.shape[1]===1?l:this.reduce(l,r,a)},t.prototype.argReduce=function(e,r,a){a===void 0&&(a=null);var o=e.shape[0],i=e.shape[1];a!=null&&(o=a.shape[0],i=a.shape[1]);var s=ks(i),u=new n1({windowSize:s,inSize:i,batchSize:o},r,a==null),l=[e];a!=null&&l.push(a);var c=this.compileAndRun(u,l,"int32");return c.shape[1]===1?c:this.argReduce(e,r,c)},t.prototype.argReducePacked=function(e,r,a){a===void 0&&(a=null);var o=a!=null?a.shape:e.shape,i=ks(o[o.length-1]),s=new u1(o,i,r,a==null),u=a==null?[e]:[e,a],l=this.compileAndRun(s,u,"int32");return l.rank===e.rank?this.argReducePacked(e,r,l):l},t.prototype.sum=function(e,r){ln("sum",r,e.rank);var a=Bt(e.shape,r),o=a[0],i=ge(a[1]),s=e.as2D(-1,i),u=bs(e.dtype);return this.reduce(s,"sum",u).reshape(o)},t.prototype.prod=function(e,r){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.prod(e,r);var a=Bt(e.shape,r),o=a[0],i=ge(a[1]),s=e.as2D(-1,i),u=bs(e.dtype);return this.reduce(s,"prod",u).reshape(o)},t.prototype.unsortedSegmentSum=function(e,r,a){var o=0,i=Qn([o],e.rank),s=e;i!=null&&(s=e.transpose(i),o=Zn(1,e.rank)[0]);var u=function(d,h,v){for(var g=[],m=d.length,x=0;x<m;x++)x!==h?g.push(d[x]):g.push(v);return g}(s.shape,o,a),l=ge([s.shape[o]]),c=s.as2D(-1,l),p=bs(e.dtype),f=this.segOpCompute(c,"unsortedSegmentSum",r,p,a).reshape(u);return i!=null&&(f=f.transpose(Tu(i))),f},t.prototype.segOpCompute=function(e,r,a,o,i){var s=e.shape[0],u=e.shape[1],l=function(f,d){var h,v=!1;for(f<=ip?(h=f,v=!0):h=eu(f,Math.floor(Math.sqrt(f)));!v;)h>d||h===f?v=!0:h=eu(f,h+1);return h}(u,i),c=new C0({windowSize:l,inSize:u,batchSize:s,numSegments:i}),p=this.compileAndRun(c,[e,a],o);return p.shape[1]===i?p:(a=hi(0,i).tile([u/l]),this.segOpCompute(p,r,a,o,i))},t.prototype.argMinMaxReduce=function(e,r,a){var o=[r];if(ln("arg"+a.charAt(0).toUpperCase()+a.slice(1),o,e.rank),!J().getBool("WEBGL_PACK_REDUCE")||e.rank<=2){var i=Bt(e.shape,o),s=i[0],u=ge(i[1]),l=e.as2D(-1,u);return this.argReduce(l,a).reshape(s)}return this.argReducePacked(e,a)},t.prototype.argMin=function(e,r){return this.argMinMaxReduce(e,r,"min")},t.prototype.argMax=function(e,r){return this.argMinMaxReduce(e,r,"max")},t.prototype.cumsum=function(e,r,a,o){if(r!==e.rank-1)throw new Error("WebGL cumsum shader expects an inner-most axis="+(e.rank-1)+" but got axis="+r);var i=new k1(e.shape,a,o);return this.compileAndRun(i,[e])},t.prototype.equal=function(e,r){if(J().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,r,`
  return vec4(equal(a, b));
`,"bool");var a=new ut("return float(a == b);",e.shape,r.shape);return this.compileAndRun(a,[e,r],"bool")},t.prototype.notEqual=function(e,r){if(J().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,r,`
  return vec4(notEqual(a, b));
`,"bool");var a=new ut("return float(a != b);",e.shape,r.shape);return this.compileAndRun(a,[e,r],"bool")},t.prototype.less=function(e,r){if(this.shouldExecuteOnCPU([e,r]))return this.cpuBackend.less(e,r);if(J().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,r,`
  return vec4(lessThan(a, b));
`,"bool");var a=new ut("return float(a < b);",e.shape,r.shape);return this.compileAndRun(a,[e,r],"bool")},t.prototype.lessEqual=function(e,r){if(J().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,r,`
  return vec4(lessThanEqual(a, b));
`,"bool");var a=new ut("return float(a <= b);",e.shape,r.shape);return this.compileAndRun(a,[e,r],"bool")},t.prototype.greater=function(e,r){if(this.shouldExecuteOnCPU([e,r]))return this.cpuBackend.greater(e,r);if(J().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,r,`
  return vec4(greaterThan(a, b));
`,"bool");var a=new ut("return float(a > b);",e.shape,r.shape);return this.compileAndRun(a,[e,r],"bool")},t.prototype.greaterEqual=function(e,r){if(J().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,r,`
  return vec4(greaterThanEqual(a, b));
`,"bool");var a=new ut("return float(a >= b);",e.shape,r.shape);return this.compileAndRun(a,[e,r],"bool")},t.prototype.logicalNot=function(e){var r=new Oe(e.shape,"return float(!(x >= 1.0));");return this.compileAndRun(r,[e])},t.prototype.logicalAnd=function(e,r){if(J().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,r,`
  return vec4(
    vec4(greaterThanEqual(a, vec4(1.0))) *
    vec4(greaterThanEqual(b, vec4(1.0))));
`,"bool");var a=new ut("return float(a >= 1.0 && b >= 1.0);",e.shape,r.shape);return this.compileAndRun(a,[e,r],"bool")},t.prototype.logicalOr=function(e,r){if(J().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,r,`
  return min(
    vec4(greaterThanEqual(a, vec4(1.0))) +
    vec4(greaterThanEqual(b, vec4(1.0))),
    vec4(1.0));
`,"bool");var a=new ut("return float(a >= 1.0 || b >= 1.0);",e.shape,r.shape);return this.compileAndRun(a,[e,r],"bool")},t.prototype.select=function(e,r,a){var o=new I0(e.rank,r.shape,r.rank);return this.compileAndRun(o,[e,r,a],Pt(r.dtype,a.dtype))},t.prototype.where=function(e){pi("tf.where() in webgl locks the UI thread. Call tf.whereAsync() instead");var r=e.dataSync();return Vu(e.shape,r)},t.prototype.topk=function(e,r,a){return gp(e.dataSync(),e.shape,e.dtype,r)},t.prototype.min=function(e,r){ln("min",r,e.rank);var a=Bt(e.shape,r),o=a[0],i=ge(a[1]),s=e.as2D(-1,i);return this.reduce(s,"min",s.dtype).reshape(o)},t.prototype.minimum=function(e,r){if(this.shouldExecuteOnCPU([e,r]))return this.cpuBackend.minimum(e,r);var a=J().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new rr(`
  vec4 result = vec4(min(a, b));
  vec4 isNaN = min(vec4(isnan(a)) + vec4(isnan(b)), vec4(1.0));
  
  result.r = isNaN.r > 0. ? NAN : result.r;
  result.g = isNaN.g > 0. ? NAN : result.g;
  result.b = isNaN.b > 0. ? NAN : result.b;
  result.a = isNaN.a > 0. ? NAN : result.a;

  return result;
`,e.shape,r.shape):new ut(`
  if (isnan(a)) return a;
  if (isnan(b)) return b;

  return min(a, b);
`,e.shape,r.shape);return this.compileAndRun(a,[e,r])},t.prototype.mod=function(e,r){var a=J().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new rr(`
  vec4 result = mod(a, b);
  vec4 isNaN = vec4(equal(b, vec4(0.0)));
  
  result.r = isNaN.r > 0. ? NAN : result.r;
  result.g = isNaN.g > 0. ? NAN : result.g;
  result.b = isNaN.b > 0. ? NAN : result.b;
  result.a = isNaN.a > 0. ? NAN : result.a;

  return result;
`,e.shape,r.shape):new ut(`if (b == 0.0) return NAN;
  return mod(a, b);`,e.shape,r.shape);return this.compileAndRun(a,[e,r])},t.prototype.max=function(e,r){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.max(e,r);ln("max",r,e.rank);var a=Bt(e.shape,r),o=a[0],i=ge(a[1]),s=e.as2D(-1,i);return this.reduce(s,"max",s.dtype).reshape(o)},t.prototype.maximum=function(e,r){if(this.shouldExecuteOnCPU([e,r]))return this.cpuBackend.maximum(e,r);var a=J().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new rr(`
  vec4 result = vec4(max(a, b));
  vec4 isNaN = min(vec4(isnan(a)) + vec4(isnan(b)), vec4(1.0));
  
  result.r = isNaN.r > 0. ? NAN : result.r;
  result.g = isNaN.g > 0. ? NAN : result.g;
  result.b = isNaN.b > 0. ? NAN : result.b;
  result.a = isNaN.a > 0. ? NAN : result.a;

  return result;
`,e.shape,r.shape):new ut(`
  if (isnan(a)) return a;
  if (isnan(b)) return b;

  return max(a, b);
`,e.shape,r.shape);return this.compileAndRun(a,[e,r])},t.prototype.all=function(e,r){ln("all",r,e.rank);var a=Bt(e.shape,r),o=a[0],i=ge(a[1]),s=e.as2D(-1,i);return this.reduce(s,"all",s.dtype).reshape(o)},t.prototype.any=function(e,r){ln("any",r,e.rank);var a=Bt(e.shape,r),o=a[0],i=ge(a[1]),s=e.as2D(-1,i);return this.reduce(s,"any",s.dtype).reshape(o)},t.prototype.realDivide=function(e,r){if(J().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,r,`
  // vec4 one = vec4(equal(a, b));
  // return one + (vec4(1.0) - one) * a / b;
  vec4 result = a / b;
  if(a.x == b.x) {
    result.x = 1.;
  }
  if(a.y == b.y) {
    result.y = 1.;
  }
  if(a.z == b.z) {
    result.z = 1.;
  }
  if(a.w == b.w) {
    result.w = 1.;
  }

  return result;
`,"float32",!0);var a=new ut(`
if (a == b) {
  return 1.0;
};
return a / b;`,e.shape,r.shape);return this.compileAndRun(a,[e,r],"float32")},t.prototype.floorDiv=function(e,r){if(J().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,r,`
  ivec4 ia = round(a);
  ivec4 ib = round(b);
  bvec4 cond = notEqual(ib, ivec4(0));
  ivec4 result = ivec4(0);
  vec4 s = sign(a) * sign(b);

  // Windows (D3D) wants guaranteed non-zero int division at compile-time.
  if (cond[0]) {
    result[0] = idiv(ia[0], ib[0], s[0]);
  }
  if (cond[1]) {
    result[1] = idiv(ia[1], ib[1], s[1]);
  }
  if (cond[2]) {
    result[2] = idiv(ia[2], ib[2], s[2]);
  }
  if (cond[3]) {
    result[3] = idiv(ia[3], ib[3], s[3]);
  }
  return vec4(result);
`,"int32");var a=new ut(`
  float s = sign(a) * sign(b);
  int ia = round(a);
  int ib = round(b);
  if (ib != 0) {
    // Windows (D3D) wants guaranteed non-zero int division at compile-time.
    return float(idiv(ia, ib, s));
  } else {
    return NAN;
  }
`,e.shape,r.shape);return this.compileAndRun(a,[e,r],"int32")},t.prototype.add=function(e,r){if(e.dtype==="complex64"&&r.dtype==="complex64")return this.complexSeparableBinaryOp(e,r,Ts);if(this.shouldExecuteOnCPU([e,r]))return this.cpuBackend.add(e,r);var a=Pt(e.dtype,r.dtype);if(J().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,r,Ts,a);var o=new ut(Ts,e.shape,r.shape);return this.compileAndRun(o,[e,r],a)},t.prototype.packedUnaryOp=function(e,r,a){var o=new Ya(e.shape,r);return this.compileAndRun(o,[e],a)},t.prototype.packedBinaryOp=function(e,r,a,o,i){i===void 0&&(i=!1);var s=new rr(a,e.shape,r.shape,i);return this.compileAndRun(s,[e,r],o)},t.prototype.complexSeparableBinaryOp=function(e,r,a){var o=this,i=this.texData.get(e.dataId),s=this.texData.get(r.dataId),u=[[i.complexTensors.real,s.complexTensors.real],[i.complexTensors.imag,s.complexTensors.imag]].map(function(f){var d=f[0],h=f[1],v=o.makeComplexComponentTensorInfo(e,d),g=o.makeComplexComponentTensorInfo(r,h),m=new ut(a,e.shape,r.shape);return o.compileAndRun(m,[v,g],Pt(d.dtype,h.dtype))}),l=u[0],c=u[1],p=this.complex(l,c);return l.dispose(),c.dispose(),p},t.prototype.makeComplexComponentTensorInfo=function(e,r){return{dataId:r.dataId,dtype:r.dtype,shape:e.shape}},t.prototype.addN=function(e){if(e.length===1)return e[0];if(e.length>J().get("WEBGL_MAX_TEXTURES_IN_SHADER")){var r=Math.floor(e.length/2),a=this.addN(e.slice(0,r)),o=this.addN(e.slice(r));return this.addN([a,o])}var i=e.map(function(l){return l.dtype}).reduce(function(l,c){return Pt(l,c)}),s=e.map(function(l){return l.shape}),u=J().getBool("WEBGL_PACK")?new t1(e[0].shape,s):new e1(e[0].shape,s);return this.compileAndRun(u,e,i)},t.prototype.subtract=function(e,r){if(e.dtype==="complex64"&&r.dtype==="complex64")return this.complexSeparableBinaryOp(e,r,Ns);if(this.shouldExecuteOnCPU([e,r]))return this.cpuBackend.subtract(e,r);var a=Pt(e.dtype,r.dtype);if(J().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,r,Ns,e.dtype);var o=new ut(Ns,e.shape,r.shape);return this.compileAndRun(o,[e,r],a)},t.prototype.pow=function(e,r){var a=J().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new rr(`
  // isModRound1 has 1 for components with round(mod(b, 2.0)) == 1, 0 otherwise.
  vec4 isModRound1 = vec4(equal(round(mod(b, 2.0)), ivec4(1)));
  vec4 multiplier = sign(a) * isModRound1 + (vec4(1.0) - isModRound1);
  vec4 result = multiplier * pow(abs(a), b);

  // Ensure that a^0 = 1, including 0^0 = 1 as this correspond to TF and JS
  bvec4 isExpZero = equal(b, vec4(0.0));
  result.r = isExpZero.r ? 1.0 : result.r;
  result.g = isExpZero.g ? 1.0 : result.g;
  result.b = isExpZero.b ? 1.0 : result.b;
  result.a = isExpZero.a ? 1.0 : result.a;

  vec4 isNaN = vec4(lessThan(a, vec4(0.0))) * vec4(lessThan(floor(b), b));
  
  result.r = isNaN.r > 0. ? NAN : result.r;
  result.g = isNaN.g > 0. ? NAN : result.g;
  result.b = isNaN.b > 0. ? NAN : result.b;
  result.a = isNaN.a > 0. ? NAN : result.a;

  return result;
`,e.shape,r.shape):new ut(`
if(a < 0.0 && floor(b) < b){
  return NAN;
}
if (b == 0.0) {
  return 1.0;
}
return (round(mod(b, 2.0)) != 1) ?
    pow(abs(a), b) : sign(a) * pow(abs(a), b);
`,e.shape,r.shape),o=Pt(e.dtype,r.dtype);return this.compileAndRun(a,[e,r],o)},t.prototype.ceil=function(e){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.ceil(e);if(J().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(e,Oc,e.dtype);var r=new Oe(e.shape,Oc);return this.compileAndRun(r,[e])},t.prototype.floor=function(e){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.floor(e);if(J().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(e,Mc,e.dtype);var r=new Oe(e.shape,Mc);return this.compileAndRun(r,[e])},t.prototype.sign=function(e){var r=new Oe(e.shape,`
  if (isnan(x)) { return 0.0; }
  return sign(x);
`);return this.compileAndRun(r,[e])},t.prototype.isNaN=function(e){var r=new Oe(e.shape,"return float(isnan(x));");return this.compileAndRun(r,[e],"bool")},t.prototype.isInf=function(e){var r=new Oe(e.shape,"return float(isinf(x));");return this.compileAndRun(r,[e],"bool")},t.prototype.isFinite=function(e){var r=new Oe(e.shape,"return float(!isnan(x) && !isinf(x));");return this.compileAndRun(r,[e],"bool")},t.prototype.round=function(e){var r=new Oe(e.shape,`
  // OpenGL ES does not support round function.
  // The algorithm is based on banker's rounding.
  float base = floor(x);
  if ((x - base) < 0.5) {
    return floor(x);
  } else if ((x - base) > 0.5) {
    return ceil(x);
  } else {
    if (mod(base, 2.0) == 0.0) {
      return base;
    } else {
      return base + 1.0;
    }
  }
`);return this.compileAndRun(r,[e])},t.prototype.exp=function(e){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.exp(e);if(J().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(e,Fc,e.dtype);var r=new Oe(e.shape,Fc);return this.compileAndRun(r,[e])},t.prototype.expm1=function(e){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.expm1(e);if(J().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(e,Vc,e.dtype);var r=new Oe(e.shape,Vc);return this.compileAndRun(r,[e])},t.prototype.softmax=function(e,r){var a=Ct([r],e.shape),o=this.max(e,a),i=on(o.shape,a),s=this.subtract(e,o.reshape(i)),u=this.exp(s),l=this.sum(u,a).reshape(i);return this.realDivide(u,l)},t.prototype.log=function(e){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.log(e);if(J().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(e,`
  vec4 result = log(x);
  vec4 isNaN = vec4(lessThan(x, vec4(0.0)));
  result.r = isNaN.r == 1.0 ? NAN : result.r;
  result.g = isNaN.g == 1.0 ? NAN : result.g;
  result.b = isNaN.b == 1.0 ? NAN : result.b;
  result.a = isNaN.a == 1.0 ? NAN : result.a;

  return result;
`,e.dtype);var r=new Oe(e.shape,`if (x < 0.0) return NAN;
  return log(x);`);return this.compileAndRun(r,[e])},t.prototype.log1p=function(e){var r=new Oe(e.shape,"return log(1.0 + x);");return this.compileAndRun(r,[e])},t.prototype.sqrt=function(e){var r=new Oe(e.shape,"return sqrt(x);");return this.compileAndRun(r,[e])},t.prototype.rsqrt=function(e){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.rsqrt(e);var r=new Oe(e.shape,"return inversesqrt(x);");return this.compileAndRun(r,[e])},t.prototype.reciprocal=function(e){var r=new Oe(e.shape,"return 1.0 / x;");return this.compileAndRun(r,[e])},t.prototype.relu=function(e){var r;return r=J().getBool("WEBGL_PACK")?new Ya(e.shape,Ip):new Oe(e.shape,Ep),this.compileAndRun(r,[e])},t.prototype.relu6=function(e){var r;return r=J().getBool("WEBGL_PACK")?new Ya(e.shape,Dp):new Oe(e.shape,Sp),this.compileAndRun(r,[e])},t.prototype.prelu=function(e,r){var a=J().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new rr(wp,e.shape,r.shape):new ut(_p,e.shape,r.shape);return this.compileAndRun(a,[e,r])},t.prototype.elu=function(e){if(J().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(e,kp,e.dtype);var r=new Oe(e.shape,Cp);return this.compileAndRun(r,[e])},t.prototype.eluDer=function(e,r){var a=J().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new rr(`
  vec4 bGTEZero = vec4(greaterThanEqual(b, vec4(0.)));
  return (bGTEZero * a) + ((vec4(1.0) - bGTEZero) * (a * (b + vec4(1.0))));
`,e.shape,r.shape):new ut("return (b >= 1.0) ? a : a * (b + 1.0);",e.shape,r.shape);return this.compileAndRun(a,[e,r])},t.prototype.selu=function(e){var r=new Oe(e.shape,M0);return this.compileAndRun(r,[e])},t.prototype.int=function(e){var r=new Oe(e.shape,"return float(int(x));");return this.compileAndRun(r,[e],"int32")},t.prototype.clip=function(e,r,a){var o,i=(o=J().getBool("WEBGL_PACK_CLIP")?new m1(e.shape):new v1(e.shape)).getCustomSetupFunc(r,a);return this.compileAndRun(o,[e],null,i)},t.prototype.abs=function(e){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.abs(e);if(J().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(e,Ac,e.dtype);var r=new Oe(e.shape,Ac);return this.compileAndRun(r,[e])},t.prototype.complexAbs=function(e){var r=this.texData.get(e.dataId),a=new g1(e.shape),o=[this.makeComplexComponentTensorInfo(e,r.complexTensors.real),this.makeComplexComponentTensorInfo(e,r.complexTensors.imag)];return this.compileAndRun(a,o)},t.prototype.sigmoid=function(e){var r=new Oe(e.shape,"return 1.0 / (1.0 + exp(-1.0 * x));");return this.compileAndRun(r,[e])},t.prototype.softplus=function(e){var r=new Oe(e.shape,`
  float epsilon = 1.1920928955078125e-7;
  float threshold = log(epsilon) + 2.0;

  bool too_large = x > -threshold;
  bool too_small = x < threshold;

  float result;
  float exp_x = exp(x);

  if (too_large){
    result = x;
  }
  else if (too_small){
    result = exp_x;
  }
  else{
    result = log(exp_x + 1.0);
  }
  return result;
`);return this.compileAndRun(r,[e])},t.prototype.sin=function(e){var r=new Oe(e.shape,F0);return this.compileAndRun(r,[e])},t.prototype.cos=function(e){var r=new Oe(e.shape,V0);return this.compileAndRun(r,[e])},t.prototype.tan=function(e){var r=new Oe(e.shape,"return tan(x);");return this.compileAndRun(r,[e])},t.prototype.asin=function(e){var r=new Oe(e.shape,L0);return this.compileAndRun(r,[e])},t.prototype.acos=function(e){var r=new Oe(e.shape,B0);return this.compileAndRun(r,[e])},t.prototype.atan=function(e){var r=new Oe(e.shape,U0);return this.compileAndRun(r,[e])},t.prototype.atan2=function(e,r){var a=J().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new rr(`
  vec4 result = atan(a, b);
  vec4 isNaN = min(vec4(isnan(a)) + vec4(isnan(b)), vec4(1.0));
  
  result.r = isNaN.r > 0. ? NAN : result.r;
  result.g = isNaN.g > 0. ? NAN : result.g;
  result.b = isNaN.b > 0. ? NAN : result.b;
  result.a = isNaN.a > 0. ? NAN : result.a;

  return result;
`,e.shape,r.shape):new ut(`
  if (isnan(a)) return a;
  if (isnan(b)) return b;

  return atan(a, b);
`,e.shape,r.shape);return this.compileAndRun(a,[e,r])},t.prototype.sinh=function(e){var r=new Oe(e.shape,`
  float e2x = exp(x);
  return (e2x - 1.0 / e2x) / 2.0;
`);return this.compileAndRun(r,[e])},t.prototype.cosh=function(e){var r=new Oe(e.shape,`
  float e2x = exp(-x);
  return (e2x + 1.0 / e2x) / 2.0;
`);return this.compileAndRun(r,[e])},t.prototype.tanh=function(e){var r=new Oe(e.shape,`
  float e2x = exp(-2.0 * abs(x));
  return sign(x) * (1.0 - e2x) / (1.0 + e2x);
`);return this.compileAndRun(r,[e])},t.prototype.asinh=function(e){var r=new Oe(e.shape,W0);return this.compileAndRun(r,[e])},t.prototype.acosh=function(e){var r=new Oe(e.shape,q0);return this.compileAndRun(r,[e])},t.prototype.atanh=function(e){var r=new Oe(e.shape,z0);return this.compileAndRun(r,[e])},t.prototype.erf=function(e){var r=new Oe(e.shape,`
  // Error function is calculated approximately with elementary function.
  // See "Handbook of Mathematical Functions with Formulas,
  // Graphs, and Mathematical Tables", Abramowitz and Stegun.
  float p = 0.3275911;
  float a1 = 0.254829592;
  float a2 = -0.284496736;
  float a3 = 1.421413741;
  float a4 = -1.453152027;
  float a5 = 1.061405429;

  float sign = sign(x);
  x = abs(x);
  float t = 1.0 / (1.0 + p * x);
  return sign * (1.0 - (((((a5*t + a4)*t) + a3)*t + a2)*t + a1)*t*exp(-x*x));
`);return this.compileAndRun(r,[e])},t.prototype.step=function(e,r){var a=new Oe(e.shape,function(o){return o===void 0&&(o=0),Mn+`
    return x > 0.0 ? 1.0 : float(`+o+`);
  `}(r));return this.compileAndRun(a,[e])},t.prototype.conv2dByMatMul=function(e,r,a,o,i,s){var u=e.shape,l=this.texData.get(e.dataId),c=a.inChannels,p=u[0]*u[1]*u[2],f=a.outChannels,d=a.dataFormat==="channelsLast",h=(p===1||f===1)&&c>1e3,v=u[2]%2!=0&&!!l.isPacked;if(h||!J().getBool("WEBGL_LAZILY_UNPACK")||!J().getBool("WEBGL_PACK_BINARY_OPERATIONS")||!v){var g=d?u[0]*u[1]*u[2]:u[0]*u[2]*u[3],m=this.reshape(e,[1,g,a.inChannels]),x=this.reshape(r,[1,a.inChannels,a.outChannels]);return this.reshape(this.fusedBatchMatMul({a:m,b:x,transposeA:!1,transposeB:!1,bias:o,activation:i,preluActivationWeights:s}),a.outShape)}var y=d?u[0]*u[1]*(u[2]+1):u[0]*u[2]*(u[3]+1),w={dataId:e.dataId,shape:[1,y,a.inChannels],dtype:e.dtype},E=l.shape;l.shape=l.shape.slice(),l.shape[l.shape.length-2]++,V(Bo(l.shape,w.shape),function(){return"packed reshape "+l.shape+" to "+w.shape+" isn't free"});var D=this.reshape(r,[1,a.inChannels,a.outChannels]),k=this.fusedBatchMatMul({a:w,b:D,transposeA:!1,transposeB:!1,bias:o,activation:i,preluActivationWeights:s}),S=this.texData.get(k.dataId);return V(S.isPacked,function(){return"batchMatMul result is expected to be packed"}),l.shape=E,S.shape=a.outShape,W.makeTensorFromDataId(k.dataId,a.outShape,k.dtype)},t.prototype.conv2dWithIm2Row=function(e,r,a,o,i,s){var u=a.filterWidth,l=a.filterHeight,c=a.inChannels,p=a.outWidth,f=a.outHeight,d=a.dataFormat==="channelsLast",h=u*l*c,v=f*p,g=[h,v],m=e.squeeze([0]),x=r.reshape([1,h,-1]),y=new o0(g,m.shape,a),w=this.compileAndRun(y,[m]).reshape([1,g[0],g[1]]),E=o!=null,D=s!=null,k=i?zo(i,!0):null,S=new Rs(w.shape,[1,v,a.outChannels],!0,!1,E,k,D),_=[w,x];o&&_.push(o),D&&_.push(s);var b=this.compileAndRun(S,_);return d?b.reshape([1,f,p,a.outChannels]):b.reshape([1,a.outChannels,f,p])},t.prototype.fusedConv2d=function(e){var r=e.input,a=e.filter,o=e.convInfo,i=e.bias,s=e.activation,u=e.preluActivationWeights;if(o.filterHeight===1&&o.filterWidth===1&&o.dilationHeight===1&&o.dilationWidth===1&&o.strideHeight===1&&o.strideWidth===1&&(o.padInfo.type==="SAME"||o.padInfo.type==="VALID"))return this.conv2dByMatMul(r,a,o,i,s,u);if(J().getBool("WEBGL_CONV_IM2COL")&&r.shape[0]===1)return this.conv2dWithIm2Row(r,a,o,i,s,u);var l=i!=null,c=u!=null,p=s?zo(s,!1):null,f=new Ec(o,l,p,c),d=[r,a];return i&&d.push(i),u&&d.push(u),this.compileAndRun(f,d)},t.prototype.conv2d=function(e,r,a){if(a.filterHeight===1&&a.filterWidth===1&&a.dilationHeight===1&&a.dilationWidth===1&&a.strideHeight===1&&a.strideWidth===1&&(a.padInfo.type==="SAME"||a.padInfo.type==="VALID"))return this.conv2dByMatMul(e,r,a);if(J().getBool("WEBGL_CONV_IM2COL")&&e.shape[0]===1)return this.conv2dWithIm2Row(e,r,a);var o=new Ec(a);return this.compileAndRun(o,[e,r])},t.prototype.conv2dDerInput=function(e,r,a){var o=new _1(a);return this.compileAndRun(o,[e,r])},t.prototype.conv2dDerFilter=function(e,r,a){var o=new b1(a);return this.compileAndRun(o,[e,r])},t.prototype.fusedDepthwiseConv2D=function(e){var r,a=e.input,o=e.filter,i=e.convInfo,s=e.bias,u=e.activation,l=e.preluActivationWeights,c=J().getBool("WEBGL_PACK_DEPTHWISECONV")&&i.strideWidth<=2&&i.outChannels/i.inChannels==1,p=u?zo(u,c):null,f=[a,o],d=s!=null,h=l!=null;return d&&f.push(s),h&&f.push(l),c?(r=new Cc(i,d,p,h),this.compileAndRun(r,f)):(r=new Sc(i,d,p,h),this.compileAndRun(r,f))},t.prototype.depthwiseConv2D=function(e,r,a){var o;return J().getBool("WEBGL_PACK_DEPTHWISECONV")&&a.strideWidth<=2&&a.outChannels/a.inChannels==1?(o=new Cc(a),this.compileAndRun(o,[e,r])):(o=new Sc(a),this.compileAndRun(o,[e,r]))},t.prototype.depthwiseConv2DDerInput=function(e,r,a){var o=new C1(a);return this.compileAndRun(o,[e,r])},t.prototype.depthwiseConv2DDerFilter=function(e,r,a){var o=new S1(a);return this.compileAndRun(o,[e,r])},t.prototype.conv3d=function(e,r,a){var o=new I1(a);return this.compileAndRun(o,[e,r])},t.prototype.conv3dDerInput=function(e,r,a){var o=new E1(a);return this.compileAndRun(o,[e,r])},t.prototype.conv3dDerFilter=function(e,r,a){var o=new w1(a);return this.compileAndRun(o,[e,r])},t.prototype.maxPool=function(e,r){var a=new As(r,"max",!1);return this.compileAndRun(a,[e])},t.prototype.avgPool=function(e,r){var a=new As(r,"avg",!1);return this.compileAndRun(a,[e],"float32")},t.prototype.maxPoolBackprop=function(e,r,a,o){var i=new As(o,"max",!0),s=this.compileAndRun(i,[r]),u=new l0(o),l=this.compileAndRun(u,[e,s],r.dtype);return s.dispose(),l},t.prototype.avgPoolBackprop=function(e,r,a){var o=new l1(a);return this.compileAndRun(o,[e],r.dtype)},t.prototype.cast=function(e,r){return pp(e,r,this)},t.prototype.unstack=function(e,r){for(var a=e.shape[r],o=new Array(e.rank-1),i=0,s=0;s<e.rank;s++)s!==r&&(o[i++]=e.shape[s]);var u=new Array(e.rank).fill(0),l=e.shape.slice();l[r]=1;var c=new Array(a);for(s=0;s<c.length;s++)u[r]=s,c[s]=this.slice(e,u,l).reshape(o);return c},t.prototype.avgPool3d=function(e,r){var a=new Ps(r,"avg",!1);return this.compileAndRun(a,[e],"float32")},t.prototype.avgPool3dBackprop=function(e,r,a){var o=new c1(a);return this.compileAndRun(o,[e],r.dtype)},t.prototype.maxPool3d=function(e,r){var a=new Ps(r,"max",!1);return this.compileAndRun(a,[e],"float32")},t.prototype.maxPool3dBackprop=function(e,r,a,o){var i=new Ps(o,"max",!0),s=this.compileAndRun(i,[r]),u=new c0(o),l=this.compileAndRun(u,[e,s],r.dtype);return s.dispose(),l},t.prototype.reshape=function(e,r){var a=this.texData.get(e.dataId);if(a.isPacked&&!Bo(e.shape,r)&&(a.texture===null||!Bo(a.shape,r))){var o=this.packedReshape(e,r);return W.makeTensorFromDataId(o.dataId,o.shape,o.dtype)}return uu(e,r)},t.prototype.resizeBilinear=function(e,r,a,o){var i=J().getBool("WEBGL_PACK_IMAGE_OPERATIONS")?new b0(e.shape,r,a,o):new x0(e.shape,r,a,o);return this.compileAndRun(i,[e],"float32")},t.prototype.resizeBilinearBackprop=function(e,r,a){var o=new y0(e,r,a);return this.compileAndRun(o,[e])},t.prototype.resizeNearestNeighbor=function(e,r,a,o){var i=new w0(e.shape,r,a,o);return this.compileAndRun(i,[e])},t.prototype.resizeNearestNeighborBackprop=function(e,r,a){var o=new _0(e,r,a);return this.compileAndRun(o,[e])},t.prototype.multinomial=function(e,r,a,o){var i=r?e:fr(e),s=i.shape[0],u=i.shape[1],l=new d0(s,u,a),c=l.getCustomSetupFunc(o);return this.compileAndRun(l,[i],"int32",c)},t.prototype.oneHot=function(e,r,a,o){var i=new p0(e.size,r,a,o);return this.compileAndRun(i,[e])},t.prototype.diag=function(e){var r=new A1(e.size);return this.compileAndRun(r,[e])},t.prototype.nonMaxSuppression=function(e,r,a,o,i){return pi("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead"),Mu(e.dataSync(),r.dataSync(),a,o,i)},t.prototype.cropAndResize=function(e,r,a,o,i,s){var u=new D1(e.shape,r.shape,o,i,s);return this.compileAndRun(u,[e,r,a],"float32")},t.prototype.depthToSpace=function(e,r,a){V(r>1,function(){return"blockSize should be > 1 for depthToSpace, but was: "+r});var o=e.shape[0],i=a==="NHWC"?e.shape[1]:e.shape[2],s=a==="NHWC"?e.shape[2]:e.shape[3],u=a==="NHWC"?e.shape[3]:e.shape[1],l=i*r,c=s*r,p=u/(r*r),f=new R1(a==="NHWC"?[o,l,c,p]:[o,p,l,c],r,a);return this.compileAndRun(f,[e])},t.prototype.split=function(e,r,a){return vp(e,r,a)},t.prototype.scatterND=function(e,r,a){var o=yi(0,e,a),i=o.sliceRank,s=o.numUpdates,u=o.sliceSize,l=o.strides,c=o.outputSize,p=[c/u,u],f=e.reshape([s,i]),d=r.reshape([s,u]);if(c===0)return uu(Ot([]),a);var h=ce(0),v=new Tc(s,i,f.rank,d.rank,l,p);return this.compileAndRun(v,[d,f,h]).reshape(a)},t.prototype.sparseToDense=function(e,r,a,o){var i=yi(0,e,a),s=i.sliceRank,u=i.numUpdates,l=i.strides,c=i.outputSize,p=new Tc(u,s,e.rank,r.rank,l,[c,1]);return this.compileAndRun(p,[r,e,o]).reshape(a)},t.prototype.fft=function(e){return this.fftImpl(e,!1)},t.prototype.ifft=function(e){return this.fftImpl(e,!0)},t.prototype.fftImpl=function(e,r){var a=this.texData.get(e.dataId),o=new Dc(V1,e.shape,r),i=new Dc(L1,e.shape,r),s=[this.makeComplexComponentTensorInfo(e,a.complexTensors.real),this.makeComplexComponentTensorInfo(e,a.complexTensors.imag)],u=this.compileAndRun(o,s),l=this.compileAndRun(i,s),c=this.complex(u,l).as2D(e.shape[0],e.shape[1]);return u.dispose(),l.dispose(),c},t.prototype.gatherND=function(e,r){var a=r.shape,o=a[a.length-1],i=op(e,r),s=i[0],u=i[1],l=i[2],c=i[3],p=r.reshape([u,o]),f=e.reshape([e.size/l,l]),d=new W1(o,c,[u,l]);return this.compileAndRun(d,[f,p]).reshape(s)},t.prototype.fill=function(e,r,a){if((a=a||xo(r))==="string"){var o=ui(a,ge(e));return o.fill(r),W.makeTensor(o,e,a,this)}var i=new B1(e,r),s=i.getCustomSetupFunc(r);return this.compileAndRun(i,[],a,s)},t.prototype.onesLike=function(e){if(e.dtype==="string")throw new Error("onesLike is not supported under string dtype");return this.fill(e.shape,1,e.dtype)},t.prototype.zerosLike=function(e){return this.fill(e.shape,e.dtype==="string"?"":0,e.dtype)},t.prototype.linspace=function(e,r,a){return fp(e,r,a)},t.prototype.makeTensorInfo=function(e,r){var a=this.write(null,e,r);return this.texData.get(a).usage=null,{dataId:a,shape:e,dtype:r}},t.prototype.makeOutput=function(e,r){var a=this.makeTensorInfo(e,r).dataId;return W.makeTensorFromDataId(a,e,r,this)},t.prototype.unpackTensor=function(e){var r=new H0(e.shape);return this.runWebGLProgram(r,[e],e.dtype)},t.prototype.packTensor=function(e){var r=new f0(e.shape);return this.runWebGLProgram(r,[e],e.dtype,null,!0)},t.prototype.packedReshape=function(e,r){var a=[ci(e.shape)].concat(di(e.shape)),o={dtype:e.dtype,shape:a,dataId:e.dataId},i=[ci(r)].concat(di(r)),s=new g0(i,a),u=this.runWebGLProgram(s,[o],e.dtype,null,!0);return{dataId:u.dataId,shape:r,dtype:u.dtype}},t.prototype.decode=function(e){var r,a=this.texData.get(e),o=a.isPacked,i=a.shape,s=a.dtype,u=Ds(i);return r=o?new N1(u):new T1(u),{dtype:s,shape:i,dataId:this.runWebGLProgram(r,[{shape:u,dtype:s,dataId:e}],s,null,!0).dataId}},t.prototype.runWebGLProgram=function(e,r,a,o,i){var s=this;i===void 0&&(i=!1);var u=this.makeTensorInfo(e.outputShape,a),l=this.texData.get(u.dataId);if(e.packedOutput&&(l.isPacked=!0),e.outPackingScheme===io.DENSE){var c=eo(e.outputShape);l.texShape=c.map(function(y){return 2*y})}if(e.outTexUsage!=null&&(l.usage=e.outTexUsage),ge(u.shape)===0)return l.values=ao(u.dtype,0),u;var p=[],f=r.map(function(y){if(y.dtype==="complex64")throw new Error("GPGPUProgram does not support complex64 input. For complex64 dtypes, please separate the program into real and imaginary parts.");var w=s.texData.get(y.dataId);if(w.texture==null){if(!e.packedInputs&&ge(y.shape)<=J().getNumber("WEBGL_SIZE_UPLOAD_UNIFORM"))return{shape:y.shape,texData:null,isUniform:!0,uniformValues:w.values};e.packedInputs&&(w.isPacked=!0,w.shape=y.shape)}else if(!!w.isPacked!=!!e.packedInputs)y=w.isPacked?s.unpackTensor(y):s.packTensor(y),p.push(y),w=s.texData.get(y.dataId);else if(w.isPacked&&!Bo(w.shape,y.shape)){var E=y,D=y.shape;y.shape=w.shape,y=s.packedReshape(y,D),p.push(y),w=s.texData.get(y.dataId),E.shape=D}return s.uploadToGPU(y.dataId),{shape:y.shape,texData:w,isUniform:!1}});this.uploadToGPU(u.dataId);var d,h={shape:u.shape,texData:l,isUniform:!1},v=function(y,w,E){var D="";w.concat(E).forEach(function(_){var b=_.texData!=null&&_.texData.slice!=null&&_.texData.slice.flatOffset>0,N=_.isUniform?"uniform":_.texData.texShape;D+=_.shape+"_"+N+"_"+b});var k=y.userCode,S=y.constructor.name;return S+="_"+D+"_"+k}(e,f,h),g=this.getAndSaveBinary(v,function(){return function(y,w,E,D){var k=w.userCode,S=E.map(function($,q){var z={logicalShape:$.shape,texShape:$.isUniform?null:$.texData.texShape,isUniform:$.isUniform,isPacked:!$.isUniform&&$.texData.isPacked,flatOffset:null};return $.texData!=null&&$.texData.slice!=null&&$.texData.slice.flatOffset>0&&(z.flatOffset=$.texData.slice.flatOffset),{name:w.variableNames[q],shapeInfo:z}}),_=S.map(function($){return $.shapeInfo}),b={logicalShape:D.shape,texShape:D.texData.texShape,isUniform:!1,isPacked:D.texData.isPacked,flatOffset:null},N=r1(S,b,k,w.packedInputs),T=y.createProgram(N),P=null,F=y.getUniformLocation(T,"NAN",!1);J().getNumber("WEBGL_VERSION")===1&&(P=y.getUniformLocation(T,"INFINITY",!1));for(var M={},L=0;L<w.variableNames.length;L++){var A=w.variableNames[L];M[A]=y.getUniformLocation(T,A,!1),M["offset"+A]=y.getUniformLocation(T,"offset"+A,!1)}return{program:w,source:N,webGLProgram:T,uniformLocations:M,inShapeInfos:_,outShapeInfo:b,infLoc:P,nanLoc:F}}(s.gpgpu,e,f,h)}),m=this.activeTimers!=null;if(m&&(d=this.startTimer()),function(y,w,E,D,k){kc(w.inShapeInfos,E),kc([w.outShapeInfo],[D]);var S=D.texData.texture,_=D.texData.texShape;D.texData.isPacked?y.setOutputPackedMatrixTexture(S,_[0],_[1]):y.setOutputMatrixTexture(S,_[0],_[1]),y.setProgram(w.webGLProgram),J().getNumber("WEBGL_VERSION")===1&&w.infLoc!==null&&y.gl.uniform1f(w.infLoc,1/0),w.nanLoc!==null&&y.gl.uniform1f(w.nanLoc,NaN),E.forEach(function(b,N){var T=w.program.variableNames[N],P=w.uniformLocations[T],F=w.uniformLocations["offset"+T];if(P!=null)if(b.isUniform)if(ge(b.shape)<2)y.gl.uniform1f(P,b.uniformValues[0]);else{var M=b.uniformValues;M instanceof Float32Array||(M=new Float32Array(M)),y.gl.uniform1fv(P,M)}else b.texData.slice!=null&&F!=null&&y.gl.uniform1i(F,b.texData.slice.flatOffset),y.setInputMatrixTexture(b.texData.texture,P,N)}),k?.(y,w.webGLProgram),y.executeProgram()}(this.gpgpu,g,f,h,o),p.forEach(function(y){return s.disposeData(y.dataId)}),m&&(d=this.endTimer(d),this.activeTimers.push({name:e.constructor.name,query:this.getQueryTime(d)})),!J().getBool("WEBGL_LAZILY_UNPACK")&&l.isPacked&&i===!1){var x=this.unpackTensor(u);return this.disposeData(u.dataId),x}return u},t.prototype.compileAndRun=function(e,r,a,o,i){i===void 0&&(i=!1),a=a||r[0].dtype;var s=this.runWebGLProgram(e,r,a,o,i);return W.makeTensorFromDataId(s.dataId,s.shape,s.dtype)},t.prototype.getAndSaveBinary=function(e,r){return e in this.binaryCache||(this.binaryCache[e]=r()),this.binaryCache[e]},t.prototype.getTextureManager=function(){return this.textureManager},t.prototype.dispose=function(){var e=this;this.disposed||(J().getBool("IS_TEST")||Object.keys(this.binaryCache).forEach(function(r){e.gpgpu.deleteProgram(e.binaryCache[r].webGLProgram),delete e.binaryCache[r]}),this.textureManager.dispose(),this.canvas!=null&&typeof HTMLCanvasElement<"u"&&this.canvas instanceof HTMLCanvasElement?this.canvas.remove():this.canvas=null,this.gpgpuCreatedLocally&&(this.gpgpu.program=null,this.gpgpu.dispose()),this.disposed=!0)},t.prototype.floatPrecision=function(){var e=this;return this.floatPrecisionValue==null&&(this.floatPrecisionValue=fe(function(){if(!J().get("WEBGL_RENDER_FLOAT32_ENABLED")){var r=J().getBool("DEBUG");J().set("DEBUG",!1);var a=e.abs(ce(1e-8)).dataSync()[0];if(J().set("DEBUG",r),a>0)return 32}return 16})),this.floatPrecisionValue},t.prototype.epsilon=function(){return this.floatPrecision()===32?1e-7:1e-4},t.prototype.uploadToGPU=function(e){var r,a=this.texData.get(e),o=a.shape,i=a.dtype,s=a.values,u=a.texture,l=a.usage,c=a.isPacked;if(u==null){var p,f=this.activeTimers!=null;f&&(p=Wn());var d=a.texShape;if(d==null&&(d=Zy(o,c),a.texShape=d),s!=null){var h=Ds(o),v=void 0,g=d[1],m=d[0],x=s instanceof Uint8Array;c?(g=(r=_o(d[0],d[1]))[0],m=r[1],v=new F1(h,[m,g],x)):v=new M1(h,[m,g],x);var y=this.makeTensorInfo([m,g],i);this.texData.get(y.dataId).usage=x?dn.PIXELS:dn.UPLOAD,this.gpgpu.uploadDenseMatrixToTexture(this.getTexture(y.dataId),g,m,s);var w=this.runWebGLProgram(v,[y],i,null,!0),E=this.texData.get(w.dataId);a.texture=E.texture,a.texShape=E.texShape,a.isPacked=E.isPacked,a.usage=E.usage,this.disposeData(y.dataId),this.texData.delete(w.dataId),a.values=null,f&&(this.uploadWaitMs+=Wn()-p)}else{var D=this.acquireTexture(d,l,i,c);a.texture=D}}},t.prototype.convertAndCacheOnCPU=function(e,r){var a=this.texData.get(e),o=a.dtype;return this.releaseGPUData(e),r!=null&&(a.values=function(i,s){if(s==="float32"||s==="complex64")return i;if(s==="int32"||s==="bool"){for(var u=s==="int32"?new Int32Array(i.length):new Uint8Array(i.length),l=0;l<u.length;++l)u[l]=Math.round(i[l]);return u}throw new Error("Unknown dtype "+s)}(r,o)),a.values},t.prototype.acquireTexture=function(e,r,a,o){if(this.numBytesInGPU+=this.computeBytes(e,a),!this.warnedAboutMemory&&this.numBytesInGPU>1024*this.numMBBeforeWarning*1024){var i=(this.numBytesInGPU/1024/1024).toFixed(2);this.warnedAboutMemory=!0,console.warn("High memory usage in GPU: "+i+" MB, most likely due to a memory leak")}return this.textureManager.acquireTexture(e,r,o)},t.prototype.computeBytes=function(e,r){return e[0]*e[1]*Wd(r)},t}(cp);Xd()&&W.registerBackend("webgl",function(){return new j0},2);var X0=U({square_:function(n){var t=O(n,"x","square"),e=[t];return W.runKernelFunc(function(r,a){return a([t]),r.square(t)},{x:t},null,"Square",{},e,[])}}),uo="SquaredDifference",Tp=U({squaredDifference_:function(n,t){var e,r=O(n,"a","squaredDifference"),a=O(t,"b","squaredDifference");e=st(r,a),r=e[0],a=e[1],Le(r.shape,a.shape);var o={a:r,b:a},i=[r,a];return W.runKernelFunc(function(s,u){var l=s.squaredDifference(r,a);return u([r,a]),l},o,function(s,u){var l=u[0],c=u[1],p=ce(2);return{a:function(){return s.mul(l.sub(c).mul(p))},b:function(){return s.mul(c.sub(l).mul(p))}}},uo,{},i,[])}}),Y0=U({abs_:function(n){var t=O(n,"x","abs");return t.dtype==="complex64"?W.runKernelFunc(function(e){return e.complexAbs(t)},{$x:t}):W.runKernelFunc(function(e,r){var a=e.abs(t);return r([t]),a},{x:t},function(e,r){var a=r[0];return{x:function(){return e.mul(a.toFloat().step(-1))}}},"Abs")}}),K0=U({acos_:function(n){var t=O(n,"x","acos");return W.runKernelFunc(function(e,r){var a=e.acos(t);return r([t]),a},{$x:t},function(e,r){var a=r[0];return{$x:function(){return e.divStrict(ce(1).sub(a.toFloat().square()).sqrt()).neg()}}})}}),J0=U({acosh_:function(n){var t=O(n,"x","acosh");return W.runKernelFunc(function(e,r){var a=e.acosh(t);return r([t]),a},{$x:t},function(e,r){var a=r[0];return{$x:function(){return e.divStrict(a.toFloat().square().sub(1).sqrt())}}})}}),Q0=U({asin_:function(n){var t=O(n,"x","asin");return W.runKernelFunc(function(e,r){var a=e.asin(t);return r([t]),a},{$x:t},function(e,r){var a=r[0];return{$x:function(){return e.divStrict(ce(1).sub(a.toFloat().square()).sqrt())}}})}}),Z0=U({asinh_:function(n){var t=O(n,"x","asinh");return W.runKernelFunc(function(e,r){var a=e.asinh(t);return r([t]),a},{$x:t},function(e,r){var a=r[0];return{$x:function(){return e.divStrict(ce(1).add(a.toFloat().square()).sqrt())}}})}}),eb=U({atan_:function(n){var t=O(n,"x","atan");return W.runKernelFunc(function(e,r){var a=e.atan(t);return r([t]),a},{$x:t},function(e,r){var a=r[0];return{$x:function(){return e.div(a.toFloat().square().add(1))}}})}}),tb=U({atanh_:function(n){var t=O(n,"x","atanh");return W.runKernelFunc(function(e,r){var a=e.atanh(t);return r([t]),a},{$x:t},function(e,r){var a=r[0];return{$x:function(){return e.div(ce(1).sub(a.toFloat().square()))}}})}}),nb=U({ceil_:function(n){var t=O(n,"x","ceil");return W.runKernelFunc(function(e){return e.ceil(t)},{$x:t},function(e){return{$x:function(){return qe(e)}}})}}),Wu=U({clipByValue_:function(n,t,e){var r=O(n,"x","clipByValue");V(t<=e,function(){return"Error in clip: min ("+t+") must be less than or equal to max ("+e+")."});var a=[r],o={min:t,max:e};return W.runKernelFunc(function(i,s){var u=i.clip(r,t,e);return s([r]),u},{x:r},function(i,s){var u=s[0];return{x:function(){return i.where(u.greaterEqual(t).logicalAnd(u.lessEqual(e)),qe(i))}}},"ClipByValue",o,a)}}),rb=U({cos_:function(n){var t=O(n,"x","cos"),e=[t];return W.runKernelFunc(function(r,a){var o=r.cos(t);return a([t]),o},{x:t},function(r,a){var o=a[0];return{x:function(){return o.toFloat().sin().neg().mul(r)}}},"Cos",{},e)}}),ab=U({cosh_:function(n){var t=O(n,"x","cosh");return W.runKernelFunc(function(e,r){var a=e.cosh(t);return r([t]),a},{$x:t},function(e,r){var a=r[0];return{$x:function(){return a.toFloat().sinh().mulStrict(e)}}})}}),ob=U({erf_:function(n){var t=O(n,"x","erf");return V(t.dtype==="int32"||t.dtype==="float32",function(){return"Input dtype must be `int32` or `float32`."}),t.dtype==="int32"&&(t=t.toFloat()),W.runKernelFunc(function(e,r){var a=e.erf(t);return r([t]),a},{$x:t},function(e,r){var a=r[0];return{$x:function(){return e.mul(a.square().neg().exp().mul(2/Math.sqrt(Math.PI)))}}})}}),cu=U({exp_:function(n){var t=O(n,"x","exp");return W.runKernelFunc(function(e,r){var a=e.exp(t);return r([a]),a},{x:t},function(e,r){return{x:function(){return e.mulStrict(r[0])}}},"Exp",{},[],[!0])}}),ib=U({expm1_:function(n){var t=O(n,"x","expm1");return W.runKernelFunc(function(e,r){var a=e.expm1(t);return r([t]),a},{$x:t},function(e,r){var a=r[0];return{$x:function(){return e.mul(a.exp())}}})}}),sb=U({floor_:function(n){var t=O(n,"x","floor");return W.runKernelFunc(function(e){return e.floor(t)},{$x:t},function(e){return{$x:function(){return qe(e)}}})}}),ub=U({log_:function(n){var t=O(n,"x","log"),e=[t];return W.runKernelFunc(function(r,a){var o=r.log(t);return a([t]),o},{x:t},function(r,a){var o=a[0];return{x:function(){return r.div(o.toFloat())}}},"Log",{},e)}}),lb=U({log1p_:function(n){var t=O(n,"x","log1p");return W.runKernelFunc(function(e,r){var a=e.log1p(t);return r([t]),a},{$x:t},function(e,r){var a=r[0];return{$x:function(){return e.div(a.add(1))}}})}}),cb=U({logSigmoid_:function(n){var t=O(n,"x","logSigmoid");return W.runKernelFunc(function(e,r){var a=e.softplus(t.neg()).neg();return r([t]),a},{$x:t},function(e,r){var a=r[0];return{$x:function(){return e.mul(a.neg().sigmoid())}}})}}),wi=U({neg_:function(n){var t=O(n,"x","neg"),e=[t];return W.runKernelFunc(function(r){return r.neg(t)},{x:t},function(r){return{x:function(){return r.neg()}}},"Neg",{},e)}}),db=U({reciprocal_:function(n){var t=O(n,"x","reciprocal");return W.runKernelFunc(function(e,r){var a=e.reciprocal(t);return r([t]),a},{$x:t},function(e,r){var a=r[0];return{$x:function(){return e.div(a.square().neg())}}})}}),pb=U({round_:function(n){var t=O(n,"x","round");return W.runKernelFunc(function(e){return e.round(t)},{$x:t},function(e){return{$x:function(){return qe(e)}}})}}),Np=U({rsqrt_:function(n){var t=O(n,"x","rsqrt"),e=[t];return W.runKernelFunc(function(r,a){var o=r.rsqrt(t);return a([t]),o},{x:t},function(r,a){var o=a[0];return{x:function(){return r.div(o.pow(1.5).mul(2)).neg()}}},"Rsqrt",{},e)}}),Rp=U({sigmoid_:function(n){var t=O(n,"x","sigmoid");return W.runKernelFunc(function(e,r){var a=e.sigmoid(t);return r([a]),a},{x:t},function(e,r){var a=r[0];return{x:function(){return e.mul(a.mul(ce(1).sub(a)))}}},"Sigmoid")}}),fb=U({sign_:function(n){var t=O(n,"x","sign");return W.runKernelFunc(function(e){return e.sign(t)},{$x:t},function(e){return{$x:function(){return qe(e)}}})}}),hb=U({isNaN_:function(n){var t=O(n,"x","isNaN");return W.runKernelFunc(function(e){return e.isNaN(t)},{$x:t},function(e){return{$x:function(){return qe(e)}}})}}),vb=U({isInf_:function(n){var t=O(n,"x","isInf");return W.runKernelFunc(function(e){return e.isInf(t)},{$x:t},function(e){return{$x:function(){return qe(e)}}})}}),mb=U({isFinite_:function(n){var t=O(n,"x","isFinite");return W.runKernelFunc(function(e){return e.isFinite(t)},{$x:t},function(e){return{$x:function(){return qe(e)}}})}}),gb=U({sin_:function(n){var t=O(n,"x","sin"),e=[t];return W.runKernelFunc(function(r,a){var o=r.sin(t);return a([t]),o},{x:t},function(r,a){var o=a[0];return{x:function(){return o.toFloat().cos().mul(r)}}},"Sin",{},e)}}),yb=U({sinh_:function(n){var t=O(n,"x","sinh");return W.runKernelFunc(function(e,r){var a=e.sinh(t);return r([t]),a},{$x:t},function(e,r){var a=r[0];return{$x:function(){return a.toFloat().cosh().mulStrict(e)}}})}}),xb=U({softplus_:function(n){var t=O(n,"x","softplus");return W.runKernelFunc(function(e,r){var a=e.softplus(t);return r([t]),a},{$x:t},function(e,r){var a=r[0];return{$x:function(){return e.mul(a.sigmoid())}}})}}),bb=U({sqrt_:function(n){var t=O(n,"x","sqrt");return W.runKernelFunc(function(e,r){var a=e.sqrt(t);return r([t]),a},{$x:t},function(e,r){var a=r[0];return{$x:function(){return e.div(a.toFloat().sqrt().mul(2))}}})}}),_b=U({step_:function(n,t){t===void 0&&(t=0);var e=O(n,"x","step");return W.runKernelFunc(function(r){return r.step(e,t)},{$x:e},function(r){return{$x:function(){return qe(r)}}})}}),wb=U({tan_:function(n){var t=O(n,"x","tan");return W.runKernelFunc(function(e,r){var a=e.tan(t);return r([t]),a},{$x:t},function(e,r){var a=r[0];return{$x:function(){return e.div(a.cos().square())}}})}}),Eb=U({tanh_:function(n){var t=O(n,"x","tanh");return W.runKernelFunc(function(e,r){var a=e.tanh(t);return r([a]),a},{x:t},function(e,r){var a=r[0];return{x:function(){return ce(1).sub(a.square()).mulStrict(e)}}},"Tanh",{},null,[!0])}});function Ap(n,t,e,r,a,o){var i,s,u=O(n,"x","batchNorm"),l=O(t,"mean","batchNorm"),c=O(e,"variance","batchNorm");return a!=null&&(i=O(a,"scale","batchNorm")),r!=null&&(s=O(r,"offset","batchNorm")),V(u.rank===2,function(){return"Error in batchNorm3D: x must be rank 3 but got rank "+u.rank+"."}),V(l.rank===2||l.rank===1,function(){return"Error in batchNorm2D: mean must be rank 2 or rank 1 but got rank "+l.rank+"."}),V(c.rank===2||c.rank===1,function(){return"Error in batchNorm2D: variance must be rank 2 or rank 1 but got rank "+c.rank+"."}),i!=null&&V(i.rank===2||i.rank===1,function(){return"Error in batchNorm2D: scale must be rank 2 or rank 1 but got rank "+i.rank+"."}),s!=null&&V(s.rank===2||s.rank===1,function(){return"Error in batchNorm2D: offset must be rank 2 or rank 1 but got rank "+s.rank+"."}),Eo(u,l,c,s,i,o)}function Pp(n,t,e,r,a,o){var i,s,u=O(n,"x","batchNorm"),l=O(t,"mean","batchNorm"),c=O(e,"variance","batchNorm");return a!=null&&(i=O(a,"scale","batchNorm")),r!=null&&(s=O(r,"offset","batchNorm")),V(u.rank===3,function(){return"Error in batchNorm3D: x must be rank 3 but got rank "+u.rank+"."}),V(l.rank===3||l.rank===1,function(){return"Error in batchNorm3D: mean must be rank 3 or rank 1 but got rank "+l.rank+"."}),V(c.rank===3||c.rank===1,function(){return"Error in batchNorm3D: variance must be rank 3 or rank 1 but got rank "+c.rank+"."}),i!=null&&V(i.rank===3||i.rank===1,function(){return"Error in batchNorm3D: scale must be rank 3 or rank 1 but got rank "+i.rank+"."}),s!=null&&V(s.rank===3||s.rank===1,function(){return"Error in batchNorm3D: offset must be rank 3 or rank 1 but got rank "+s.rank+"."}),Eo(u,l,c,s,i,o)}function Op(n,t,e,r,a,o){var i,s,u=O(n,"x","batchNorm"),l=O(t,"mean","batchNorm"),c=O(e,"variance","batchNorm");return a!=null&&(i=O(a,"scale","batchNorm")),r!=null&&(s=O(r,"offset","batchNorm")),V(u.rank===4,function(){return"Error in batchNorm4D: x must be rank 4 but got rank "+u.rank+"."}),V(l.rank===4||l.rank===1,function(){return"Error in batchNorm4D: mean must be rank 4 or rank 1 but got rank "+l.rank+"."}),V(c.rank===4||c.rank===1,function(){return"Error in batchNorm4D: variance must be rank 4 or rank 1 but got rank "+c.rank+"."}),i!=null&&V(i.rank===4||i.rank===1,function(){return"Error in batchNorm4D: scale must be rank 4 or rank 1 but got rank "+i.rank+"."}),s!=null&&V(s.rank===4||s.rank===1,function(){return"Error in batchNorm4D: offset must be rank 4 or rank 1 but got rank "+s.rank+"."}),Eo(u,l,c,s,i,o)}function Eo(n,t,e,r,a,o){o==null&&(o=.001);var i,s,u,l=O(n,"x","batchNorm"),c=O(t,"mean","batchNorm"),p=O(e,"variance","batchNorm");a!=null&&(i=O(a,"scale","batchNorm")),r!=null&&(s=O(r,"offset","batchNorm")),V(c.rank===p.rank,function(){return"Batch normalization gradient requires mean and variance to have equal ranks."}),V(s==null||c.rank===s.rank,function(){return"Batch normalization gradient requires mean and offset to have equal ranks."}),V(i==null||c.rank===i.rank,function(){return"Batch normalization gradient requires mean and scale to have equal ranks."}),u=l.rank===0||l.rank===1?l.as4D(1,1,1,l.size):l.rank===2?l.as4D(1,1,l.shape[0],l.shape[1]):l.rank===3?l.as4D(1,l.shape[0],l.shape[1],l.shape[2]):l;var f=[l,c,p,i];return W.runKernelFunc(function(d,h){var v=d.batchNormalization(u,$o(c),$o(p),o,$o(i),$o(s));return h([l,c,p,i]),v},{x:l,mean:c,variance:p,scale:i,offset:s},function(d,h){var v=h,g=v[0],m=v[1],x=v[2],y=v[3],w=y??ce(1),E=Et(m.shape,u.shape),D=[];if(m.rank===1){for(var k=0;k<u.shape.length-1;++k)D.push(u.shape[k]);D.push(1)}var S=g.sub(m),_=d.mul(w),b=Np(x.add(ce(o))),N=b.mul(b).mul(b).mul(ce(-.5));return{x:function(){return m.rank===1?d.mul(xa(b.as4D(1,1,1,m.shape[0]),D)).mul(w).reshape(g.shape):d.mul(b).mul(w).reshape(g.shape)},mean:function(){var T=b.mul(ce(-1)).mul(_);return m.rank===1&&(T=T.sum(E)),T.reshape(m.shape)},variance:function(){var T=N.mul(S).mul(_);return m.rank===1&&(T=T.sum(E)),T.reshape(m.shape)},scale:function(){var T=S.mul(b),P=d.mul(T);return m.rank===1&&(P=P.sum(E)),P.reshape(m.shape)},offset:function(){var T=d;return m.rank===1&&(T=T.sum(E)),T.reshape(m.shape)}}},"BatchNormalization",{varianceEpsilon:o},f).reshape(l.shape)}function $o(n){return n==null?null:n.rank===0?n.as1D():n.rank===1?n:n.rank===2?n.as4D(1,1,n.shape[0],n.shape[1]):n.rank===3?n.as4D(1,n.shape[0],n.shape[1],n.shape[2]):n}function qi(){Yd("tf.batchNormalization() is going away. Use tf.batchNorm() instead, and note the positional argument change of scale, offset, and varianceEpsilon")}var Sb=U({batchNormalization2d_:function(n,t,e,r,a,o){return r===void 0&&(r=.001),qi(),Ap(n,t,e,o,a,r)}}),Cb=U({batchNormalization3d_:function(n,t,e,r,a,o){return r===void 0&&(r=.001),qi(),Pp(n,t,e,o,a,r)}}),Ib=U({batchNormalization4d_:function(n,t,e,r,a,o){return r===void 0&&(r=.001),qi(),Op(n,t,e,o,a,r)}}),Db=U({batchNormalization_:function(n,t,e,r,a,o){return r===void 0&&(r=.001),qi(),Eo(n,t,e,o,a,r)}}),Mp=U({batchNorm_:Eo}),kb=U({batchNorm2d_:Ap}),Tb=U({batchNorm3d_:Pp}),Nb=U({batchNorm4d_:Op}),zi=U({logicalAnd_:function(n,t){var e=O(n,"a","logicalAnd","bool"),r=O(t,"b","logicalAnd","bool");return Le(e.shape,r.shape),W.runKernelFunc(function(a){return a.logicalAnd(e,r)},{a:e,b:r},null,"LogicalAnd")}}),Rb=U({logicalNot_:function(n){var t=O(n,"x","logicalNot","bool");return W.runKernelFunc(function(e){return e.logicalNot(t)},{$x:t})}}),Fp=U({logicalOr_:function(n,t){var e=O(n,"a","logicalOr","bool"),r=O(t,"b","logicalOr","bool");return Le(e.shape,r.shape),W.runKernelFunc(function(a){return a.logicalOr(e,r)},{$a:e,$b:r})}}),Ab=U({logicalXor_:function(n,t){var e=O(n,"a","logicalXor","bool"),r=O(t,"b","logicalXor","bool");return Le(e.shape,r.shape),Fp(n,t).logicalAnd(zi(n,t).logicalNot())}}),Jr=U({where_:function(n,t,e){var r=O(t,"a","where"),a=O(e,"b","where"),o=O(n,"condition","where","bool");return je(r.shape,a.shape,"Error in where: "),o.rank===1?V(o.shape[0]===r.shape[0],function(){return"The first dimension of `a` must match the size of `condition`."}):je(o.shape,a.shape,"Error in where: "),W.runKernelFunc(function(i,s){var u=i.select(o,r,a);return s([o]),u},{$condition:o,$a:r,$b:a},function(i,s){var u=s[0];return{$condition:function(){return qe(u).toFloat()},$a:function(){return i.mul(u.cast(i.dtype))},$b:function(){return i.mul(u.logicalNot().cast(i.dtype))}}})}}),Vp=function(n){return he(this,void 0,void 0,function(){var t,e,r;return ve(this,function(a){switch(a.label){case 0:return[4,(t=O(n,"condition","whereAsync","bool")).data()];case 1:return e=a.sent(),r=Vu(t.shape,e),n!==t&&t.dispose(),[2,r]}})})},Fe=U({add_:function(n,t){var e,r=O(n,"a","add"),a=O(t,"b","add");e=st(r,a),r=e[0],a=e[1];var o=Le(r.shape,a.shape);return W.runKernelFunc(function(i){return i.add(r,a)},{a:r,b:a},function(i){return{a:function(){var s=i,u=Et(r.shape,o);return u.length>0&&(s=s.sum(u)),s.reshape(r.shape)},b:function(){var s=i,u=Et(a.shape,o);return u.length>0&&(s=s.sum(u)),s.reshape(a.shape)}}},"Add")}}),Pb=U({addN_:function(n){V(Array.isArray(n),function(){return"The argument passed to tf.addN() must be a list of tensors"}),V(n.length>=1,function(){return"Must pass at least one tensor to tf.addN(), but got "+n.length});var t=n.map(function(a,o){return O(a,"tensors"+o,"addN")}),e=t[0];t.forEach(function(a){if(a.dtype!==e.dtype)throw new Error("All tensors passed to tf.addN() must have the same dtype")}),t.forEach(function(a){if(!kt(a.shape,e.shape))throw new Error("All tensors passed to tf.addN() must have the same shape")});var r=t;return W.runKernelFunc(function(a){return a.addN(t)},r,function(a){var o={};return t.forEach(function(i,s){o[s]=function(){return a.clone()}}),o},"AddN")}}),Ob=U({addStrict_:function(n,t){var e=O(n,"a","addStrict"),r=O(t,"b","addStrict");return je(e.shape,r.shape,"Error in addStrict: "),e.add(r)}}),Mb=U({atan2_:function(n,t){var e,r=O(n,"a","atan2"),a=O(t,"b","atan2");e=st(r,a),r=e[0],a=e[1];var o=Le(r.shape,a.shape);return W.runKernelFunc(function(i,s){var u=i.atan2(r,a);return s([r,a]),u},{$a:r,$b:a},function(i,s){var u=s[0],l=s[1];return{$a:function(){var c=Fe(u.square(),l.square()),p=i.mul(l.div(c)),f=Et(u.shape,o);return f.length>0&&(p=p.sum(f)),p.reshape(u.shape)},$b:function(){var c=Fe(u.square(),l.square()),p=wi(i.mul(u.div(c))),f=Et(l.shape,o);return f.length>0&&(p=p.sum(f)),p.reshape(l.shape)}}})}}),Tn=U({div_:function(n,t){var e,r=O(n,"a","div"),a=O(t,"b","div");if(e=st(r,a),r=e[0],a=e[1],r.dtype==="int32"&&a.dtype==="int32")return Lp(r,a);var o=Le(r.shape,a.shape);return W.runKernelFunc(function(i,s){var u=i.realDivide(r,a);return s([r,a]),u},{a:r,b:a},function(i,s){var u=s[0],l=s[1];return{a:function(){var c=i.div(l.toFloat()),p=Et(u.shape,o);return p.length>0?c.sum(p).reshape(u.shape):c},b:function(){var c=i.mul(u.toFloat()),p=Et(l.shape,o);p.length>0&&(c=c.sum(p).reshape(l.shape));var f=l.square();return c.div(f.toFloat()).neg()}}},"Div")}}),Fb=U({divNoNan_:function(n,t){var e,r=O(n,"a","div"),a=O(t,"b","div");r=(e=st(r,a))[0],a=e[1];var o=Tn(r,a),i=qe(o),s=a.equal(i);return Jr(s,i,o)}}),Vb=U({divStrict_:function(n,t){var e=O(n,"a","div"),r=O(t,"b","div");return je(e.shape,r.shape,"Error in divideStrict: "),e.div(r)}}),Lp=U({floorDiv_:function(n,t){var e,r=O(n,"a","floorDiv"),a=O(t,"b","floorDiv");e=st(r,a),r=e[0],a=e[1];var o=Le(r.shape,a.shape);return W.runKernelFunc(function(i,s){var u=i.floorDiv(r,a);return s([r,a]),u},{a:r,b:a},function(i,s){var u=s[0],l=s[1];return{a:function(){var c=i.div(l.toFloat()),p=Et(u.shape,o);return p.length>0?c.sum(p).reshape(u.shape):c},b:function(){var c=i.mul(u.toFloat()),p=Et(l.shape,o);p.length>0&&(c=c.sum(p).reshape(l.shape));var f=l.square();return c.div(f.toFloat()).neg()}}},"FloorDiv")}}),qu=U({maximum_:function(n,t){var e,r=O(n,"a","maximum"),a=O(t,"b","maximum");return e=st(r,a),r=e[0],a=e[1],r.dtype==="bool"&&(r=r.toInt(),a=a.toInt()),Le(r.shape,a.shape),W.runKernelFunc(function(o,i){var s=o.maximum(r,a);return i([r,a]),s},{a:r,b:a},function(o,i){var s=i[0],u=i[1];return{a:function(){return o.mul(s.greaterEqual(u).toFloat())},b:function(){return o.mul(s.less(u).toFloat())}}},"Maximum")}}),Lb=U({maximumStrict_:function(n,t){var e=O(n,"a","maximumStrict"),r=O(t,"b","maximumStrict");return je(e.shape,r.shape,"Error in maximumStrict: "),e.maximum(r)}}),Bp=U({minimum_:function(n,t){var e,r=O(n,"a","minimum"),a=O(t,"b","minimum");return e=st(r,a),r=e[0],a=e[1],r.dtype==="bool"&&(r=r.toInt(),a=a.toInt()),Le(r.shape,a.shape),W.runKernelFunc(function(o,i){var s=o.minimum(r,a);return i([r,a]),s},{a:r,b:a},function(o,i){var s=i[0],u=i[1];return{a:function(){return o.mul(s.lessEqual(u).toFloat())},b:function(){return o.mul(s.greater(u).toFloat())}}},"Minimum")}}),Bb=U({minimumStrict_:function(n,t){var e=O(n,"a","minimumStrict"),r=O(t,"b","minimumStrict");return je(e.shape,r.shape,"Error in minimumStrict: "),e.minimum(r)}}),Ub=U({mod_:function(n,t){var e,r=O(n,"a","mod"),a=O(t,"b","mod");e=st(r,a),r=e[0],a=e[1];var o=Le(r.shape,a.shape);return W.runKernelFunc(function(i,s){var u=i.mod(r,a);return s([r,a]),u},{$a:r,$b:a},function(i,s){var u=s[0],l=s[1];return{$a:function(){var c=Et(u.shape,o);return c.length>0?i.sum(c).reshape(u.shape):i},$b:function(){var c=i.mul(u.div(l).floor().neg()),p=Et(l.shape,o);return p.length>0?c.sum(p).reshape(l.shape):c}}})}}),Wb=U({modStrict_:function(n,t){var e=O(n,"a","modStrict"),r=O(t,"b","modStrict");return je(e.shape,r.shape,"Error in modStrict: "),e.mod(r)}}),$t=U({mul_:function(n,t){var e,r=O(n,"a","mul"),a=O(t,"b","mul");e=st(r,a),r=e[0],a=e[1];var o=Le(r.shape,a.shape);return W.runKernelFunc(function(i,s){var u=i.multiply(r,a);return s([r,a]),u},{a:r,b:a},function(i,s){var u=s[0],l=s[1];return{a:function(){var c=i.mul(l.toFloat()),p=Et(u.shape,o);return p.length>0?c.sum(p).reshape(u.shape):c},b:function(){var c=i.mul(u.toFloat()),p=Et(l.shape,o);return p.length>0?c.sum(p).reshape(l.shape):c}}},"Mul")}}),qb=U({mulStrict_:function(n,t){var e=O(n,"a","mul"),r=O(t,"b","mul");return je(e.shape,r.shape,"Error in multiplyStrict: "),e.mul(r)}}),Ei=U({pow_:function(n,t){var e,r=O(n,"base","pow"),a=O(t,"exp","pow");e=st(r,a),r=e[0],a=e[1];var o=Le(r.shape,a.shape),i=[r,a];return W.runKernelFunc(function(s,u){var l=s.pow(r,a);return u([r,a,l]),l},{a:r,b:a},function(s,u){var l=u[0],c=u[1],p=u[2];return{a:function(){var f=c.toFloat(),d=s.mul(f.mul(l.pow(f.sub(ce(1))))),h=Et(l.shape,o);return h.length>0&&(d=d.sum(h)),d.reshape(l.shape)},b:function(){var f=l.greater(0),d=l.log().where(f,qe(l)),h=s.mul(p.mul(d)),v=Et(c.shape,o);return v.length>0&&(h=h.sum(v)),h.reshape(c.shape)}}},"Pow",{},i,[!0])}}),zb=U({powStrict_:function(n,t){return je(n.shape,t.shape,"Error in powStrict: "),n.pow(t)}}),$b=U({squaredDifferenceStrict_:function(n,t){var e=O(n,"a","squaredDifferenceStrict"),r=O(t,"b","squaredDifferenceStrict");return je(e.shape,r.shape,"Error in squaredDifferenceStrict: "),e.squaredDifference(r)}}),St=U({sub_:function(n,t){var e,r=O(n,"a","sub"),a=O(t,"b","sub");e=st(r,a),r=e[0],a=e[1];var o=Le(r.shape,a.shape);return W.runKernelFunc(function(i){return i.subtract(r,a)},{a:r,b:a},function(i){return{a:function(){var s=i,u=Et(r.shape,o);return u.length>0&&(s=s.sum(u)),s.reshape(r.shape)},b:function(){var s=i,u=Et(a.shape,o);return u.length>0&&(s=s.sum(u)),s.neg().reshape(a.shape)}}},"Sub")}}),Hb=U({subStrict_:function(n,t){var e=O(n,"a","subStrict"),r=O(t,"b","subStrict");return je(e.shape,r.shape,"Error in subStrict: "),e.sub(r)}}),Up=U({equal_:function(n,t){var e,r=O(n,"a","equal"),a=O(t,"b","equal");return e=st(r,a),r=e[0],a=e[1],Le(r.shape,a.shape),W.runKernelFunc(function(o){return o.equal(r,a)},{$a:r,$b:a})}}),Gb=U({equalStrict_:function(n,t){var e=O(n,"a","equalStrict"),r=O(t,"b","equalStrict");return je(e.shape,r.shape,"Error in equalStrict: "),e.equal(r)}}),jb=U({greater_:function(n,t){var e,r=O(n,"a","greater"),a=O(t,"b","greater");return e=st(r,a),r=e[0],a=e[1],Le(r.shape,a.shape),W.runKernelFunc(function(o){return o.greater(r,a)},{a:r,b:a},null,"Greater")}}),Wp=U({greaterEqual_:function(n,t){var e,r=O(n,"a","greaterEqual"),a=O(t,"b","greaterEqual");return e=st(r,a),r=e[0],a=e[1],Le(r.shape,a.shape),W.runKernelFunc(function(o,i){var s=o.greaterEqual(r,a);return i([r,a]),s},{a:r,b:a},function(o,i){var s=i[0],u=i[1];return{a:function(){return qe(s)},b:function(){return qe(u)}}},"GreaterEqual")}}),Xb=U({greaterEqualStrict_:function(n,t){var e=O(n,"a","greaterEqualStrict"),r=O(t,"b","greaterEqualStrict");return je(e.shape,r.shape,"Error in greaterEqualStrict: "),e.greaterEqual(r)}}),Yb=U({greaterStrict_:function(n,t){var e=O(n,"a","greaterStrict"),r=O(t,"b","greaterStrict");return je(e.shape,r.shape,"Error in greaterStrict: "),e.greater(r)}}),Kb=U({less_:function(n,t){var e,r=O(n,"a","less"),a=O(t,"b","less");return e=st(r,a),r=e[0],a=e[1],Le(r.shape,a.shape),W.runKernelFunc(function(o){return o.less(r,a)},{a:r,b:a},null,"Less")}}),Jb=U({lessEqual_:function(n,t){var e,r=O(n,"a","lessEqual"),a=O(t,"b","lessEqual");return e=st(r,a),r=e[0],a=e[1],Le(r.shape,a.shape),W.runKernelFunc(function(o,i){var s=o.lessEqual(r,a);return i([r,a]),s},{a:r,b:a},null,"LessEqual")}}),Qb=U({lessEqualStrict_:function(n,t){var e=O(n,"a","lessEqualStrict"),r=O(t,"b","lessEqualStrict");return je(e.shape,r.shape,"Error in lessEqualStrict: "),e.lessEqual(r)}}),Zb=U({lessStrict_:function(n,t){var e=O(n,"a","lessStrict"),r=O(t,"b","lessStrict");return je(e.shape,r.shape,"Error in lessStrict: "),e.less(r)}}),e_=U({notEqual_:function(n,t){var e,r=O(n,"a","notEqual"),a=O(t,"b","notEqual");return e=st(r,a),r=e[0],a=e[1],Le(r.shape,a.shape),W.runKernelFunc(function(o){return o.notEqual(r,a)},{a:r,b:a},null,"NotEqual")}}),t_=U({notEqualStrict_:function(n,t){var e=O(n,"a","notEqualStrict"),r=O(t,"b","notEqualStrict");return je(e.shape,r.shape,"Error in notEqualStrict: "),e.notEqual(r)}});function Lc(n,t){for(var e=[],r=n;r<t;++r)e.push(r);return e}function Bc(n){for(var t=[],e=0;e<n.length;++e)for(var r=0;r<n[e].length;++r)t.push(n[e][r]);return t}var zu=U({gather_:function(n,t,e){e===void 0&&(e=0);var r=O(n,"x","gather"),a=O(t,"indices","gather","int32");e=Ct(e,r.shape)[0];var o=function(i,s,u){for(var l=i.shape[u],c=[],p=1,f=1,d=0;d<u;d++)c.push(i.shape[d]),p*=i.shape[d];for(d=0;d<s.rank;d++)c.push(s.shape[d]);for(d=u+1;d<i.rank;d++)c.push(i.shape[d]),f*=i.shape[d];return{batchSize:p,sliceSize:f,dimSize:l,outputShape:c}}(r,a,e);return W.runKernelFunc(function(i,s){var u=i.gather(r,a.flatten(),e);return s([a]),u},{x:r,indices:a},function(i,s){var u=s[0];return{x:function(){var l=r.shape,c=u.size,p=l.slice(0,e),f=p.length,d=l.slice(e,l.length).slice(1),h=d.length,v=Lc(0,f),g=Lc(f+1,f+1+h),m=Bc([p,[c],d]),x=i.reshape(m),y=u.reshape([c]),w=Bc([[f],v,g]),E=x.transpose(w),D=qp(E,y,r.shape[e]),k=Tu(w);return D=D.transpose(k)},indices:function(){return u}}},"Gather",{axis:e}).reshape(o.outputShape)}}),qp=U({unsortedSegmentSum_:function(n,t,e){var r=O(n,"x","unsortedSegmentSum"),a=O(t,"segmentIds","unsortedSegmentSum","int32");return V(mt(e),function(){return"numSegments must be of dtype int"}),W.runKernelFunc(function(o,i){var s=o.unsortedSegmentSum(r,a,e);return i([a]),s},{$x:r},function(o,i){var s=i[0];return{$x:function(){return function(u,l){for(var c=qu(l,qe(l)),p=zu(u,c),f=Wp(l,ce(0,"int32")),d=p.rank-f.rank,h=0;h<d;++h)f=bn(f,h+1);f=zi(f,La(p.shape,"bool"));var v=qe(p);return Jr(f,p,v)}(o,s)}}})}}),n_=function(n,t,e){return he(this,void 0,void 0,function(){var r,a,o,i,s,u,l,c,p,f,d,h,v;return ve(this,function(g){switch(g.label){case 0:for(r=O(n,"tensor","boolMask"),a=O(t,"mask","boolMask","bool"),o=e??0,i=a.rank,s=r.shape,V(i>0,function(){return"mask cannot be scalar"}),je(s.slice(o,o+i),a.shape,"mask's shape must match the first K dimensions of tensor's shape,"),u=1,l=o;l<o+i;l++)u*=s[l];return c=s.slice(0,o).concat([u],s.slice(o+i)),p=r.reshape(c),f=a.reshape([-1]),[4,Vp(f)];case 1:return d=g.sent(),h=d.squeeze([1]),v=zu(p,h,o),n!==r&&r.dispose(),t!==a&&a.dispose(),h.dispose(),p.dispose(),f.dispose(),d.dispose(),[2,v]}})})};function zp(n,t,e,r,a,o,i){o===void 0&&(o="NHWC"),V(n.length===t.rank,function(){return"Length of inShape ("+n.length+") and rank of dy ("+t.rank+") must match"});var s=n,u=t,l=!1;t.rank===3&&(l=!0,u=t.as4D(1,t.shape[0],t.shape[1],t.shape[2]),s=[1,n[0],n[1],n[2]]),V(s.length===4,function(){return"Error in conv2dDerInput: inShape must be length 4, but got length "+s.length+"."}),V(u.rank===4,function(){return"Error in conv2dDerInput: dy must be rank 4, but got rank "+u.rank}),V(e.rank===4,function(){return"Error in conv2dDerInput: filter must be rank 4, but got rank "+e.rank});var c=o==="NHWC"?s[3]:s[1],p=o==="NHWC"?u.shape[3]:u.shape[1];V(c===e.shape[2],function(){return"Error in conv2dDerInput: depth of input ("+c+") must match input depth for filter "+e.shape[2]+"."}),V(p===e.shape[3],function(){return"Error in conv2dDerInput: depth of output ("+p+") must match output depth for filter "+e.shape[3]+"."}),i!=null&&V(mt(a),function(){return"Error in conv2dDerInput: pad must be an integer when using, dimRoundingMode "+i+" but got pad "+a+"."});var f=Ou(o),d=oa(s,e.shape,r,1,a,i,!1,f),h=W.runKernelFunc(function(v,g){var m=v.conv2dDerInput(u,e,d);return g([e,u]),m},{dy4D:u,filter:e},function(v,g){var m=g[0],x=g[1];return{dy4D:function(){return Cn(v,m,r,a,o,1,i)},filter:function(){return $u(v,x,m.shape,r,a,o,i)}}});return l?h.as3D(h.shape[1],h.shape[2],h.shape[3]):h}function Ms(n){var t=function(o){return typeof o=="number"?[o,o,o]:o.length===2?[o[0],o[1],1]:o}(n),e=t[0],r=t[1],a=t[2];return e===1&&r===1&&a===1}function $p(n,t,e,r,a){V(n.length===t.rank,function(){return"Length of inShape ("+n.length+") and rank of dy ("+t.rank+") must match"});var o=n,i=t,s=!1;t.rank===4&&(s=!0,i=t.as5D(1,t.shape[0],t.shape[1],t.shape[2],t.shape[3]),o=[1,n[0],n[1],n[2],n[3]]);var u=o[4],l=i.shape[4];V(o.length===5,function(){return"Error in conv3dDerInput: inShape must be length 5, but got length "+o.length+"."}),V(i.rank===5,function(){return"Error in conv3dDerInput: dy must be rank 5, but got rank "+i.rank}),V(e.rank===5,function(){return"Error in conv3dDerInput: filter must be rank 5, but got rank "+e.rank}),V(u===e.shape[3],function(){return"Error in conv3dDerInput: depth of input ("+u+") must match input depth for filter "+e.shape[3]+"."}),V(l===e.shape[4],function(){return"Error in conv3dDerInput: depth of output ("+l+") must match output depth for filter "+e.shape[4]+"."});var c=bi(o,e.shape,r,1,a),p=W.runKernelFunc(function(f){return f.conv3dDerInput(i,e,c)},{dy5D:i});return s?p.as4D(p.shape[1],p.shape[2],p.shape[3],p.shape[4]):p}var r_=U({conv1d_:function(n,t,e,r,a,o,i){a===void 0&&(a="NWC"),o===void 0&&(o=1);var s=O(n,"x","conv1d"),u=O(t,"filter","conv1d"),l=s,c=!1;s.rank===2&&(c=!0,l=s.as3D(1,s.shape[0],s.shape[1])),V(l.rank===3,function(){return"Error in conv1d: input must be rank 3, but got rank "+l.rank+"."}),V(u.rank===3,function(){return"Error in conv1d: filter must be rank 3, but got rank "+u.rank+"."}),i!=null&&V(mt(r),function(){return"Error in conv1d: pad must be an integer when using, dimRoundingMode "+i+" but got pad "+r+"."}),V(l.shape[2]===u.shape[1],function(){return"Error in conv1d: depth of input ("+l.shape[2]+") must match input depth for filter "+u.shape[1]+"."}),V(sn(e,o),function(){return"Error in conv1D: Either stride or dilation must be 1. Got stride "+e+" and dilation '"+o+"'"}),V(a==="NWC",function(){return"Error in conv1d: got dataFormat of "+a+" but only NWC is currently supported."});var p=u.as4D(1,u.shape[0],u.shape[1],u.shape[2]),f=l.as4D(l.shape[0],1,l.shape[1],l.shape[2]),d=Cn(f,p,[1,e],r,"NHWC",[1,o],i);return c?d.as2D(d.shape[2],d.shape[3]):d.as3D(d.shape[0],d.shape[2],d.shape[3])}}),Cn=U({conv2d_:function(n,t,e,r,a,o,i){a===void 0&&(a="NHWC"),o===void 0&&(o=[1,1]);var s=O(n,"x","conv2d"),u=O(t,"filter","conv2d"),l=s,c=!1;s.rank===3&&(c=!0,l=s.as4D(1,s.shape[0],s.shape[1],s.shape[2])),V(l.rank===4,function(){return"Error in conv2d: input must be rank 4, but got rank "+l.rank+"."}),V(u.rank===4,function(){return"Error in conv2d: filter must be rank 4, but got rank "+u.rank+"."}),i!=null&&V(mt(r),function(){return"Error in conv2d: pad must be an integer when using, dimRoundingMode "+i+" but got pad "+r+"."});var p=a==="NHWC"?l.shape[3]:l.shape[1];V(p===u.shape[2],function(){return"Error in conv2d: depth of input ("+p+") must match input depth for filter "+u.shape[2]+"."}),V(sn(e,o),function(){return"Error in conv2D: Either strides or dilations must be 1. Got strides "+e+" and dilations '"+o+"'"});var f=Ou(a),d=oa(l.shape,u.shape,e,o,r,i,!1,f),h=[u,l],v=W.runKernelFunc(function(g,m){var x=g.conv2d(l,u,d);return m([u,l]),x},{x:l,filter:u},function(g,m){var x=m,y=x[0],w=x[1];return V(Na(o),function(){return"Error in gradient of conv2D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '"+o+"'"}),{x:function(){return Hp(w.shape,g,y,e,r,a)},filter:function(){return $u(w,g,y.shape,e,r,a)}}},"Conv2D",d,h);return c?v.as3D(v.shape[1],v.shape[2],v.shape[3]):v}}),a_=U({conv3d_:function(n,t,e,r,a,o){a===void 0&&(a="NDHWC"),o===void 0&&(o=[1,1,1]);var i=O(n,"x","conv3d"),s=O(t,"filter","conv3d"),u=i,l=!1;i.rank===4&&(l=!0,u=i.as5D(1,i.shape[0],i.shape[1],i.shape[2],i.shape[3])),V(u.rank===5,function(){return"Error in conv3d: input must be rank 5, but got rank "+u.rank+"."}),V(s.rank===5,function(){return"Error in conv3d: filter must be rank 5, but got rank "+s.rank+"."}),V(u.shape[4]===s.shape[3],function(){return"Error in conv3d: depth of input ("+u.shape[4]+") must match input depth for filter "+s.shape[3]+"."}),V(function(f,d){return Ms(f)||Ms(d)}(e,o),function(){return"Error in conv3D: Either strides or dilations must be 1. Got strides "+e+" and dilations '"+o+"'"}),V(a==="NDHWC",function(){return"Error in conv3d: got dataFormat of "+a+" but only NDHWC is currently supported."});var c=bi(u.shape,s.shape,e,o,r),p=W.runKernelFunc(function(f,d){var h=f.conv3d(u,s,c);return d([u,s]),h},{x:u,$filter:s},function(f,d){V(Ms(o),function(){return"Error in gradient of conv3D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '"+o+"'"});var h=d[0],v=d[1];return{x:function(){return $p(h.shape,f,v,e,r)},$filter:function(){return function(g,m,x,y,w){var E=g;g.rank===4&&(E=g.as5D(1,g.shape[0],g.shape[1],g.shape[2],g.shape[3]));var D=m;D.rank===4&&(D=m.as5D(1,m.shape[0],m.shape[1],m.shape[2],m.shape[3])),V(E.rank===5,function(){return"Error in conv3dDerFilter: input must be rank 5, but got shape "+E.shape+"."}),V(D.rank===5,function(){return"Error in conv3dDerFilter: dy must be rank 5, but got shape "+D.shape+"."}),V(x.length===5,function(){return"Error in conv3dDerFilter: filterShape must be length 5, but got "+x+"."}),V(E.shape[4]===x[3],function(){return"Error in conv3dDerFilter: depth of input "+E.shape[4]+") must match input depth in filter ("+x[3]+"."}),V(D.shape[4]===x[4],function(){return"Error in conv3dDerFilter: depth of dy ("+D.shape[4]+") must match output depth for filter ("+x[4]+")."});var k=bi(E.shape,x,y,1,w);return W.runKernelFunc(function(S){return S.conv3dDerFilter(E,D,k)},{x5D:E,dy5D:D})}(h,f,v.shape,e,r)}}});return l?p.as4D(p.shape[1],p.shape[2],p.shape[3],p.shape[4]):p}}),$u=U({conv2dDerFilter_:function(n,t,e,r,a,o,i){o===void 0&&(o="NHWC");var s=n;n.rank===3&&(s=n.as4D(1,n.shape[0],n.shape[1],n.shape[2]));var u=t;u.rank===3&&(u=t.as4D(1,t.shape[0],t.shape[1],t.shape[2])),V(s.rank===4,function(){return"Error in conv2dDerFilter: input must be rank 4, but got shape "+s.shape+"."}),V(u.rank===4,function(){return"Error in conv2dDerFilter: dy must be rank 4, but got shape "+u.shape+"."}),V(e.length===4,function(){return"Error in conv2dDerFilter: filterShape must be length 4, but got "+e+"."});var l=o==="NHWC"?s.shape[3]:s.shape[1],c=o==="NHWC"?u.shape[3]:u.shape[1];V(l===e[2],function(){return"Error in conv2dDerFilter: depth of input "+l+") must match input depth in filter ("+e[2]+"."}),V(c===e[3],function(){return"Error in conv2dDerFilter: depth of dy ("+c+") must match output depth for filter ("+e[3]+")."}),i!=null&&V(mt(a),function(){return"Error in conv2dDerFilter: pad must be an integer when using, dimRoundingMode "+i+" but got pad "+a+"."});var p=Ou(o),f=oa(s.shape,e,r,1,a,i,!1,p);return W.runKernelFunc(function(d){return d.conv2dDerFilter(s,u,f)},{x4D:s,dy4D:u})}}),Hp=U({conv2dDerInput_:zp}),$i=U({depthwiseConv2d_:function(n,t,e,r,a,o,i){o===void 0&&(o=[1,1]);var s=O(n,"x","depthwiseConv2d"),u=O(t,"filter","depthwiseConv2d"),l=s,c=!1;s.rank===3&&(c=!0,l=s.as4D(1,s.shape[0],s.shape[1],s.shape[2])),V(l.rank===4,function(){return"Error in depthwiseConv2d: input must be rank 4, but got rank "+l.rank+"."}),V(u.rank===4,function(){return"Error in depthwiseConv2d: filter must be rank 4, but got rank "+u.rank+"."}),V(l.shape[3]===u.shape[2],function(){return"Error in depthwiseConv2d: number of input channels ("+l.shape[3]+") must match the inChannels dimension in filter "+u.shape[2]+"."}),o==null&&(o=[1,1]),V(sn(e,o),function(){return"Error in depthwiseConv2d: Either strides or dilations must be 1. Got strides "+e+" and dilations '"+o+"'"}),i!=null&&V(mt(r),function(){return"Error in depthwiseConv2d: pad must be an integer when using, dimRoundingMode "+i+" but got pad "+r+"."});var p=oa(l.shape,u.shape,e,o,r,i,!0),f=[l,u],d=W.runKernelFunc(function(h,v){var g=h.depthwiseConv2D(l,u,p);return v([l,u]),g},{x:l,filter:u},function(h,v){V(Na(o),function(){return"Error in gradient of depthwiseConv2d: dilation rates greater than 1 are not yet supported. Got dilations '"+o+"'"});var g=v[0],m=v[1];return{x:function(){return Gp(g.shape,h,m,p)},filter:function(){return jp(g,h,m.shape,p)}}},"DepthwiseConv2dNative",p,f);return c?d.as3D(d.shape[1],d.shape[2],d.shape[3]):d}}),Gp=U({depthwiseConv2dDerInput_:function(n,t,e,r){var a=t,o=!1;t.rank===3&&(o=!0,a=t.as4D(1,t.shape[0],t.shape[1],t.shape[2]));var i=W.runKernelFunc(function(s){return s.depthwiseConv2DDerInput(a,e,r)},{dy4D:a});return o?i.as3D(i.shape[1],i.shape[2],i.shape[3]):i}}),jp=U({depthwiseConv2dDerFilter_:function(n,t,e,r){var a=n;n.rank===3&&(a=n.as4D(1,n.shape[0],n.shape[1],n.shape[2]));var o=t;return o.rank===3&&(o=t.as4D(1,t.shape[0],t.shape[1],t.shape[2])),W.runKernelFunc(function(i){return i.depthwiseConv2DDerFilter(a,o,r)},{x4D:a,dy4D:o})}}),Hu=U({separableConv2d_:function(n,t,e,r,a,o,i){o===void 0&&(o=[1,1]),i===void 0&&(i="NHWC");var s=O(n,"x","separableConv2d"),u=O(t,"depthwiseFilter","separableConv2d"),l=O(e,"pointwiseFilter","separableConv2d"),c=s,p=!1;if(s.rank===3&&(p=!0,c=s.as4D(1,s.shape[0],s.shape[1],s.shape[2])),i==="NCHW")throw new Error("separableConv2d currently does not support dataFormat NCHW; only NHWC is supported");V(c.rank===4,function(){return"Error in separableConv2d: input must be rank 4, but got rank "+c.rank+"."}),V(u.rank===4,function(){return"Error in separableConv2d: depthwise filter must be rank 4, but got rank "+u.rank+"."}),V(l.rank===4,function(){return"Error in separableConv2d: pointwise filter must be rank 4, but got rank "+u.rank+"."}),V(l.shape[0]===1,function(){return"Error in separableConv2d: the first dimension of pointwise filter  must be 1, but got "+l.shape[0]+"."}),V(l.shape[1]===1,function(){return"Error in separableConv2d: the second dimension of pointwise filter must be 1, but got "+l.shape[1]+"."});var f=u.shape[2],d=u.shape[3];V(l.shape[2]===f*d,function(){return"Error in separableConv2d: the third dimension of pointwise filter must be "+f*d+", but got "+l.shape[2]+"."});var h=$i(c,u,r,a,i,o),v=Cn(h,l,1,"valid",i);return p?v.as3D(v.shape[1],v.shape[2],v.shape[3]):v}}),o_=U({conv2dTranspose_:function(n,t,e,r,a,o){return zp(e,O(n,"x","conv2dTranspose"),O(t,"filter","conv2dTranspose"),r,a,"NHWC",o)}}),i_=U({conv3dTranspose_:function(n,t,e,r,a){return $p(e,O(n,"x","conv3dTranspose"),O(t,"filter","conv3dTranspose"),r,a)}}),Hi=U({matMul_:function(n,t,e,r){var a;e===void 0&&(e=!1),r===void 0&&(r=!1);var o=O(n,"a","matMul"),i=O(t,"b","matMul");a=st(o,i),o=a[0],i=a[1];var s=e?o.shape[o.rank-2]:o.shape[o.rank-1],u=r?i.shape[i.rank-1]:i.shape[i.rank-2],l=e?o.shape[o.rank-1]:o.shape[o.rank-2],c=r?i.shape[i.rank-2]:i.shape[i.rank-1],p=o.shape.slice(0,-2),f=i.shape.slice(0,-2),d=ge(p),h=ge(f);V(o.rank>=2&&i.rank>=2&&o.rank===i.rank,function(){return"Error in matMul: inputs must have the same rank of at least 2, got ranks "+o.rank+" and "+i.rank+"."}),V(kt(p,f),function(){return"Error in matMul: outer dimensions ("+p+") and ("+f+") of Tensors with shapes "+o.shape+" and "+i.shape+" must match."}),V(s===u,function(){return"Error in matMul: inner shapes ("+s+") and ("+u+") of Tensors with shapes "+o.shape+" and "+i.shape+" and transposeA="+e+" and transposeB="+r+" must match."});var v=o.shape.slice(0,-2).concat([l,c]),g=e?o.as3D(d,s,l):o.as3D(d,l,s),m=r?i.as3D(h,c,u):i.as3D(h,u,c),x={transposeA:e,transposeB:r};return W.runKernelFunc(function(y,w){var E=y.batchMatMul(g,m,e,r);return w([g,m]),E},{a:g,b:m},function(y,w){var E=w,D=E[0],k=E[1];return e||r?!e&&r?{a:function(){return y.matMul(k,!1,!1)},b:function(){return y.matMul(D,!0,!1)}}:e&&!r?{a:function(){return k.matMul(y,!1,!0)},b:function(){return D.matMul(y,!1,!1)}}:{a:function(){return k.matMul(y,!0,!0)},b:function(){return y.matMul(D,!0,!0)}}:{a:function(){return y.matMul(k,!1,!0)},b:function(){return D.matMul(y,!0,!1)}}},"BatchMatMul",x).reshape(v)}}),s_=U({dot_:function(n,t){var e=O(n,"t1","dot"),r=O(t,"t2","dot");V(!(e.rank!==1&&e.rank!==2||r.rank!==1&&r.rank!==2),function(){return"Error in dot: inputs must all be rank 1 or 2, but got ranks "+e.rank+" and "+r.rank+"."});var a=e.rank===1?e.size:e.shape[1],o=r.rank===1?r.size:r.shape[0];return V(a===o,function(){return"Error in dot: inner dimensions of inputs must match, but got "+a+" and "+o+"."}),e.rank===1&&r.rank===1?e.as2D(1,-1).matMul(r.as2D(-1,1)).asScalar():e.rank===1&&r.rank===2?e.as2D(1,-1).matMul(r.as2D(r.shape[0],r.shape[1])).as1D():e.rank===2&&r.rank===1?e.matMul(r.as2D(-1,1)).as1D():e.matMul(r.as2D(r.shape[0],r.shape[1]))}}),u_=U({outerProduct_:function(n,t){var e=O(n,"v1","outerProduct"),r=O(t,"v2","outerProduct");return V(e.rank===1&&r.rank===1,function(){return"Error in outerProduct: inputs must be rank 1, but got ranks "+e.rank+" and "+r.rank+"."}),e.as2D(-1,1).matMul(r.as2D(1,-1))}}),So=U({reverse_:function(n,t){var e=O(n,"x","reverse");if(e.rank===0)return e.clone();var r=Ct(t,e.shape);return W.runKernelFunc(function(a){return a.reverse(e,r)},{$x:e},function(a){return{$x:function(){return a.reverse(r)}}}).reshapeAs(e)}}),l_=U({reverse1d_:function(n){var t=O(n,"x","reverse");return V(t.rank===1,function(){return"Error in reverse1D: x must be rank 1 but got rank "+t.rank+"."}),So(t,0)}}),c_=U({reverse2d_:function(n,t){var e=O(n,"x","reverse");return V(e.rank===2,function(){return"Error in reverse2D: x must be rank 2 but got rank "+e.rank+"."}),So(e,t)}}),d_=U({reverse3d_:function(n,t){var e=O(n,"x","reverse");return V(e.rank===3,function(){return"Error in reverse3D: x must be rank 3 but got rank "+e.rank+"."}),So(e,t)}}),p_=U({reverse4d_:function(n,t){var e=O(n,"x","reverse");return V(e.rank===4,function(){return"Error in reverse4D: x must be rank 4 but got rank "+e.rank+"."}),So(e,t)}});function Xp(n,t,e,r,a,o){var i=O(n,"x","maxPool"),s=i,u=!1;i.rank===3&&(u=!0,s=i.as4D(1,i.shape[0],i.shape[1],i.shape[2])),V(s.rank===4,function(){return"Error in maxPool: input must be rank 4 but got rank "+s.rank+"."}),V(sn(e,r),function(){return"Error in maxPool: Either strides or dilations must be 1. Got strides "+e+" and dilations '"+r+"'"}),o!=null&&V(mt(a),function(){return"Error in maxPool: pad must be an integer when using, dimRoundingMode "+o+" but got pad "+a+"."});var l=so(s.shape,t,e,r,a,o);if(l.filterWidth===1&&l.filterHeight===1&&kt(l.inShape,l.outShape))return i.clone();var c=[s],p=W.runKernelFunc(function(f,d){var h=f.maxPool(s,l);return d([s,h]),h},{x:s},function(f,d){var h=d[0],v=d[1];return{x:function(){return function(g,m,x,y,w,E,D,k){var S=O(g,"dy","maxPoolBackprop"),_=O(m,"input","maxPoolBackprop"),b=O(x,"output","maxPoolBackprop");V(_.rank===S.rank,function(){return"Rank of input ("+_.rank+") does not match rank of dy ("+S.rank+")"}),V(sn(w,E),function(){return"Error in maxPoolBackProp: Either strides or dilations must be 1. Got strides "+w+" and dilations '"+E+"'"}),V(S.rank===4,function(){return"Error in maxPoolBackprop: dy must be rank 4 but got rank "+S.rank+"."}),V(_.rank===4,function(){return"Error in maxPoolBackprop: input must be rank 4 but got rank "+_.rank+"."});var N=so(_.shape,y,w,E,D,k);return W.runKernelFunc(function(T){return T.maxPoolBackprop(S,_,b,N)},{$dy:S,$input:_})}(f,h,v,t,e,r,a)}}},"MaxPool",l,c);return u?p.as3D(p.shape[1],p.shape[2],p.shape[3]):p}function Yp(n,t,e,r,a,o){var i=O(n,"x","avgPool","float32");V(sn(e,r),function(){return"Error in avgPool: Either strides or dilations must be 1. Got strides "+e+" and dilations '"+r+"'"});var s=i,u=!1;i.rank===3&&(u=!0,s=i.as4D(1,i.shape[0],i.shape[1],i.shape[2])),V(s.rank===4,function(){return"Error in avgPool: x must be rank 4 but got rank "+s.rank+"."}),o!=null&&V(mt(a),function(){return"Error in avgPool: pad must be an integer when using, dimRoundingMode "+o+" but got pad "+a+"."});var l=so(s.shape,t,e,r,a,o);if(l.filterWidth===1&&l.filterHeight===1&&kt(l.inShape,l.outShape))return i.clone();var c=W.runKernelFunc(function(p){return p.avgPool(s,l)},{x:s},function(p){return{x:function(){return function(f,d,h,v,g,m){var x=O(f,"dy","avgPoolBackprop"),y=O(d,"input","avgPoolBackprop");V(y.rank===x.rank,function(){return"Rank of input ("+y.rank+") does not match rank of dy ("+x.rank+")"}),V(sn(v,g),function(){return"Error in avgPoolBackprop: Either strides or dilations must be 1. Got strides "+v+" and dilations '"+g+"'"});var w=y,E=x,D=!1;y.rank===3&&(D=!0,w=y.as4D(1,y.shape[0],y.shape[1],y.shape[2]),E=x.as4D(1,x.shape[0],x.shape[1],x.shape[2])),V(E.rank===4,function(){return"Error in avgPoolBackprop: dy must be rank 4 but got rank "+E.rank+"."}),V(w.rank===4,function(){return"Error in avgPoolBackprop: input must be rank 4 but got rank "+w.rank+"."});var k=so(w.shape,h,v,g,m),S=W.runKernelFunc(function(_){return _.avgPoolBackprop(E,w,k)},{dy4D:E,input4D:w});return D?S.as3D(S.shape[1],S.shape[2],S.shape[3]):S}(p,s,t,e,r,a)}}},"AvgPool",l);return c=c.cast(i.dtype),u?c.as3D(c.shape[1],c.shape[2],c.shape[3]):c}var Dt=U({maxPool_:function(n,t,e,r,a){return Xp(n,t,e,1,r,a)}}),Co=U({avgPool_:function(n,t,e,r,a){return Yp(n,t,e,1,r,a)}}),f_=U({pool_:function(n,t,e,r,a,o){a==null&&(a=[1,1]),o==null&&(o=1),r===0&&(r="valid");var i=O(n,"x","maxPool"),s=i,u=!1;i.rank===3&&(u=!0,s=i.as4D(1,i.shape[0],i.shape[1],i.shape[2])),V(sn(o,a),function(){return"Error in pool: Either strides or dilations must be 1. Got strides "+o+" and dilations '"+a+"'"});var l,c=so(s.shape,t,o,a,r),p=[c.dilationHeight,c.dilationWidth];l=r==="same"?function(w,E){var D=w.map(function(_,b){return _+(_-1)*(E[b]-1)}).map(function(_){return _-1}),k=D.map(function(_){return Math.floor(_/2)}),S=D.map(function(_,b){return _-k[b]});return D.map(function(_,b){return[k[b],S[b]]})}([c.filterHeight,c.filterWidth],p):[[0,0],[0,0]];var f=p[0]===1&&p[1]===1,d=function(w,E,D){var k=D.map(function(F){return F[0]}),S=D.map(function(F){return F[1]}),_=w.concat(k,S),b=E.map(function(F,M){return(F-_[M]%F)%F}),N=S.map(function(F,M){return F+b[M]}),T=E.map(function(F,M){return[k[M],N[M]]}),P=E.map(function(F,M){return[0,b[M]]});return[T,P]}([c.inHeight,c.inWidth],p,l),h=d[0],v=d[1],g=f?r:"valid",m=f?s:tp(s,p,h),x=(e==="avg"?function(){return Yp(m,t,o,1,g)}:function(){return Xp(m,t,o,1,g)})(),y=f?x:Qd(x,p,v);return u?y.as3D(y.shape[1],y.shape[2],y.shape[3]):y}}),h_=U({maxPool3d_:function(n,t,e,r,a,o,i){o===void 0&&(o="NDHWC");var s=O(n,"x","maxPool3d"),u=s,l=!1;s.rank===4&&(l=!0,u=s.as5D(1,s.shape[0],s.shape[1],s.shape[2],s.shape[3])),i==null&&(i=[1,1,1]),V(u.rank===5,function(){return"Error in maxPool3d: x must be rank 5 but got rank "+u.rank+"."}),V(o==="NDHWC",function(){return"Error in maxPool3d: Only NDHWC is currently supported, but got dataFormat of "+o}),V(sn(e,i),function(){return"Error in maxPool3d: Either strides or dilations must be 1. Got strides "+e+" and dilations '"+i+"'"}),a!=null&&V(mt(r),function(){return"Error in maxPool3d: pad must be an integer when using, dimRoundingMode "+a+" but got pad "+r+"."});var c=xi(u.shape,t,e,i,r,a,o),p=W.runKernelFunc(function(f,d){var h=f.maxPool3d(u,c);return d([u,h]),h},{x:u},function(f,d){var h=d[0],v=d[1];return{x:function(){return function(g,m,x,y,w,E,D,k){var S=O(g,"dy","maxPool3dBackprop"),_=O(m,"input","maxPool3dBackprop"),b=O(x,"output","maxPool3dBackprop"),N=S,T=_,P=b,F=!1;_.rank===4&&(F=!0,N=S.as5D(1,S.shape[0],S.shape[1],S.shape[2],S.shape[3]),T=_.as5D(1,_.shape[0],_.shape[1],_.shape[2],_.shape[3]),P=b.as5D(1,b.shape[0],b.shape[1],b.shape[2],b.shape[3])),V(N.rank===5,function(){return"Error in maxPool3dBackprop: dy must be rank 5 but got rank "+N.rank+"."}),V(T.rank===5,function(){return"Error in maxPool3dBackprop: input must be rank 5 but got rank "+T.rank+"."}),V(P.rank===5,function(){return"Error in maxPool3dBackprop: output must be rank 5 but got rank "+P.rank+"."}),E==null&&(E=[1,1,1]),V(sn(w,E),function(){return"Error in maxPool3dBackprop: Either strides or dilations must be 1. Got strides "+w+" and dilations '"+E+"'"}),k!=null&&V(mt(D),function(){return"Error in maxPool3dBackprop: pad must be an integer when using, dimRoundingMode "+k+" but got pad "+D+"."});var M=xi(T.shape,y,w,E,D,k),L=W.runKernelFunc(function(A){return A.maxPool3dBackprop(N,T,P,M)},{dy5D:N,input5D:T});return F?L.as4D(L.shape[1],L.shape[2],L.shape[3],L.shape[4]):L}(f,h,v,t,e,i,r,a)}}});return l?p.as4D(p.shape[1],p.shape[2],p.shape[3],p.shape[4]):p}}),v_=U({avgPool3d_:function(n,t,e,r,a,o,i){o===void 0&&(o="NDHWC");var s=O(n,"x","avgPool3d","float32"),u=s,l=!1;s.rank===4&&(l=!0,u=s.as5D(1,s.shape[0],s.shape[1],s.shape[2],s.shape[3])),i==null&&(i=[1,1,1]),V(u.rank===5,function(){return"Error in avgPool3d: x must be rank 5 but got rank "+u.rank+"."}),V(o==="NDHWC",function(){return"Error in avgPool3d: Only NDHWC is currently supported, but got dataFormat of "+o}),V(sn(e,i),function(){return"Error in avgPool3d: Either strides or dilations must be 1. Got strides "+e+" and dilations '"+i+"'"}),a!=null&&V(mt(r),function(){return"Error in avgPool3d: pad must be an integer when using, dimRoundingMode "+a+" but got pad "+r+"."});var c=xi(u.shape,t,e,i,r,a,o),p=W.runKernelFunc(function(f){return f.avgPool3d(u,c)},{x:u},function(f){return{x:function(){return function(d,h,v,g,m,x,y){var w=O(d,"dy","avgPool3dBackprop"),E=O(h,"input","avgPool3dBackprop"),D=w,k=E,S=!1;E.rank===4&&(S=!0,D=w.as5D(1,w.shape[0],w.shape[1],w.shape[2],w.shape[3]),k=E.as5D(1,E.shape[0],E.shape[1],E.shape[2],E.shape[3])),V(D.rank===5,function(){return"Error in avgPool3dBackprop: dy must be rank 5 but got rank "+D.rank+"."}),V(k.rank===5,function(){return"Error in avgPool3dBackprop: input must be rank 5 but got rank "+k.rank+"."}),m==null&&(m=[1,1,1]),V(sn(g,m),function(){return"Error in avgPool3dBackprop: Either strides or dilations must be 1. Got strides "+g+" and dilations '"+m+"'"}),y!=null&&V(mt(x),function(){return"Error in maxPool3dBackprop: pad must be an integer when using, dimRoundingMode "+y+" but got pad "+x+"."});var _=xi(k.shape,v,g,m,x,y),b=W.runKernelFunc(function(N){return N.avgPool3dBackprop(D,k,_)},{dy5D:D,input5D:k});return S?b.as4D(b.shape[1],b.shape[2],b.shape[3],b.shape[4]):b}(f,u,t,e,i,r,a)}}});return p=p.cast(u.dtype),l?p.as4D(p.shape[1],p.shape[2],p.shape[3],p.shape[4]):p}}),Yn=U({slice_:function(n,t,e){var r,a,o=O(n,"x","slice");if(o.rank===0)throw new Error("Slicing scalar is not possible");(r=typeof t=="number"?[t].concat(new Array(o.rank-1).fill(0)):t.length<o.rank?t.concat(new Array(o.rank-t.length).fill(0)):t.slice()).forEach(function(u){V(u!==-1,function(){return"slice() does not support negative begin indexing."})}),a=(a=e==null?new Array(o.rank).fill(-1):typeof e=="number"?[e].concat(new Array(o.rank-1).fill(-1)):e.length<o.rank?e.concat(new Array(o.rank-e.length).fill(-1)):e).map(function(u,l){return u>=0?u:(V(u===-1,function(){return"Negative size values should be exactly -1 but got "+u+" for the slice() size at index "+l+"."}),o.shape[l]-r[l])}),zx(o,r,a);var i=o.shape,s={begin:r,size:a};return W.runKernelFunc(function(u){return u.slice(o,r,a)},{x:o},function(u){for(var l=[],c=0;c<u.rank;c++)l.push([r[c],i[c]-r[c]-a[c]]);return{x:function(){return u.pad(l)}}},"Slice",s)}}),m_=U({slice1d_:function(n,t,e){var r=O(n,"x","slice1d");return V(r.rank===1,function(){return"slice1d expects a rank-1 tensor, but got a rank-"+r.rank+" tensor"}),Yn(r,[t],[e])}}),g_=U({slice2d_:function(n,t,e){var r=O(n,"x","slice2d");return V(r.rank===2,function(){return"slice2d expects a rank-2 tensor, but got a rank-"+r.rank+" tensor"}),Yn(r,t,e)}}),Kp=U({slice3d_:function(n,t,e){var r=O(n,"x","slice3d");return V(r.rank===3,function(){return"slice3d expects a rank-3 tensor, but got a rank-"+r.rank+" tensor"}),Yn(r,t,e)}}),y_=U({slice4d_:function(n,t,e){var r=O(n,"x","slice4d");return V(r.rank===4,function(){return"slice4d expects a rank-4 tensor, but got a rank-"+r.rank+" tensor"}),Yn(r,t,e)}});function Jp(n,t,e,r,a){return t.rank<e.rank&&(t=t.reshape(on(t.shape,r))),n.rank<e.rank&&(n=n.reshape(on(n.shape,r))),{x:function(){var o=n.mul(e.equal(t).cast(n.dtype));return a==null?o:o.transpose(a)}}}var x_=U({all_:function(n,t,e){t===void 0&&(t=null),e===void 0&&(e=!1);var r=O(n,"x","all","bool"),a=Ct(t,r.shape),o=a,i=Qn(o,r.rank);i!=null&&(r=r.transpose(i),o=Zn(o.length,r.rank));var s=W.runKernelFunc(function(l){return l.all(r,o)},{$x:r});if(e){var u=on(s.shape,a);return s.reshape(u)}return s}}),b_=U({any_:function(n,t,e){t===void 0&&(t=null),e===void 0&&(e=!1);var r=O(n,"x","any","bool"),a=Ct(t,r.shape),o=a,i=Qn(o,r.rank);i!=null&&(r=r.transpose(i),o=Zn(o.length,r.rank));var s=W.runKernelFunc(function(l){return l.any(r,o)},{$x:r});if(e){var u=on(s.shape,a);return s.reshape(u)}return s}}),__=U({argMax_:function(n,t){t===void 0&&(t=0);var e=O(n,"x","argMax");t==null&&(t=0);var r=Ct(t,e.shape),a=Qn(r,e.rank);a!=null&&(e=e.transpose(a),r=Zn(r.length,e.rank));var o={axis:r[0]},i=[e];return W.runKernelFunc(function(s,u){var l=s.argMax(e,r[0]);return u([e]),l},{x:e},function(s,u){var l=u[0];return{x:function(){return qe(l)}}},"ArgMax",o,i)}}),w_=U({argMin_:function(n,t){t===void 0&&(t=0);var e=O(n,"x","argMin");t==null&&(t=0);var r=Ct(t,e.shape),a=Qn(r,e.rank);return a!=null&&(e=e.transpose(a),r=Zn(r.length,e.rank)),W.runKernelFunc(function(o,i){var s=o.argMin(e,r[0]);return i([e]),s},{$x:e},function(o,i){var s=i[0];return{$x:function(){return qe(s)}}})}}),E_=U({logSumExp_:function(n,t,e){t===void 0&&(t=null),e===void 0&&(e=!1);var r=O(n,"x","logSumExp"),a=Ct(t,r.shape),o=r.max(a,!0),i=r.sub(o).exp().sum(a).log(),s=o.reshape(i.shape).add(i);if(e){var u=on(s.shape,a);return s.reshape(u)}return s}}),Gi=U({max_:function(n,t,e){t===void 0&&(t=null),e===void 0&&(e=!1);var r=O(n,"x","max"),a=r,o=Ct(t,r.shape),i=o,s=Qn(i,r.rank);s!=null&&(r=r.transpose(s),i=Zn(i.length,r.rank));var u=[r],l=W.runKernelFunc(function(p,f){var d=p.max(r,i);return f([a,d]),d},{x:r},function(p,f){return Jp(p,f[1],f[0],o,s)},"Max",{axes:i},u,[!0]);if(e){var c=on(l.shape,o);l=l.reshape(c)}return l}}),S_=U({mean_:function(n,t,e){t===void 0&&(t=null),e===void 0&&(e=!1);var r=O(n,"x","mean"),a=Ct(t,r.shape),o=ge(Bt(r.shape,a)[1]);return Wi(function(i){var s=ce(o);return{value:(s.dtype===i.dtype?i:i.cast(s.dtype)).div(s).sum(t,e),gradFunc:function(u){var l=i.shape.slice();return a.forEach(function(c){l[c]=1}),u.reshape(l).mul(La(i.shape,"float32")).div(o)}}})(r)}}),C_=U({min_:function(n,t,e){t===void 0&&(t=null),e===void 0&&(e=!1);var r=O(n,"x","min"),a=r,o=Ct(t,r.shape),i=o,s=Qn(i,r.rank);s!=null&&(r=r.transpose(s),i=Zn(i.length,r.rank));var u=[r],l=W.runKernelFunc(function(p,f){var d=p.min(r,i);return f([a,d]),d},{x:r},function(p,f){return Jp(p,f[1],f[0],o,s)},"Min",{axes:i},u,[!0]);if(e){var c=on(l.shape,o);l=l.reshape(c)}return l}}),I_=U({moments_:function(n,t,e){t===void 0&&(t=null),e===void 0&&(e=!1);var r=Ct(t,(n=O(n,"x","moments")).shape),a=n.mean(r,e),o=a.shape;e||(o=on(a.shape,r));var i=n.toFloat().sub(a.reshape(o)).square();return{mean:a,variance:i.mean(r,e)}}}),Qp=U({sum_:function(n,t,e){t===void 0&&(t=null),e===void 0&&(e=!1);var r=O(n,"x","sum");r.dtype==="bool"&&(r=r.toInt());var a=Ct(t,r.shape);return Wi(function(o){var i=Qn(a,o.rank),s=a,u=o;i!=null&&(u=o.transpose(i),s=Zn(s.length,o.rank));var l=function(d){var h=o.shape.slice();return a.forEach(function(v){h[v]=1}),d.reshape(h).mul(La(o.shape,"float32"))},c={axes:s},p=W.runKernelFunc(function(d){return d.sum(u,s)},{x:u},function(d){return{x:function(){return l(d)}}},"Sum",c);if(e){var f=on(p.shape,a);p=p.reshape(f)}return{value:p,gradFunc:l}})(r)}}),D_=U({prod_:function(n,t,e){t===void 0&&(t=null),e===void 0&&(e=!1);var r=O(n,"x","prod");r.dtype==="bool"&&(r=r.toInt());var a=Ct(t,r.shape),o=Qn(a,r.rank),i=a,s=r;o!=null&&(s=r.transpose(o),i=Zn(i.length,r.rank));var u=W.runKernelFunc(function(c){return c.prod(s,i)},{permutedX:s});if(e){var l=on(u.shape,a);u=u.reshape(l)}return u}}),Zp=U({elu_:function(n){var t=O(n,"x","elu");return W.runKernelFunc(function(e,r){var a=e.elu(t);return r([a]),a},{$x:t},function(e,r){var a=r[0];return{$x:function(){return W.runKernelFunc(function(o){return o.eluDer(e,a)},{dy:e,y:a})}}})}}),k_=U({leakyRelu_:function(n,t){t===void 0&&(t=.2);var e=O(n,"x","leakyRelu");return qu(ce(t).mul(e),e)}}),ef=U({prelu_:function(n,t){var e=O(n,"x","prelu"),r=O(t,"alpha","prelu");return W.runKernelFunc(function(a,o){var i=a.prelu(e,r);return o([e,r]),i},{x:e,alpha:r},function(a,o){var i=o[0],s=o[1],u=i.greater(0);return{x:function(){return Jr(u,a,a.mul(s))},alpha:function(){var l=Jr(u,qe(a),a.mul(i)),c=Et(s.shape,a.shape);return c.length>0&&(l=l.sum(c)),l.reshape(s.shape)}}},"Prelu")}}),ot=U({relu_:function(n){var t=O(n,"x","relu");return t.dtype==="bool"?t.toInt():W.runKernelFunc(function(e,r){var a=e.relu(t);return r([t]),a},{x:t},function(e,r){var a=r[0];return{x:function(){return e.mulStrict(a.step().toFloat())}}},"Relu")}}),tf=U({relu6_:function(n){var t=O(n,"x","relu6");return t.dtype==="bool"?t.toInt():W.runKernelFunc(function(e,r){var a=e.relu6(t);return r([t]),a},{x:t},function(e,r){var a=r[0],o=a.lessEqual(6).mul(a.step());return{x:function(){return e.mulStrict(o.toFloat())}}},"Relu6")}}),T_=U({selu_:function(n){var t=O(n,"x","selu");return W.runKernelFunc(function(e,r){var a=e.selu(t);return r([t]),a},{$x:t},function(e,r){var a=r[0];return{$x:function(){var o=a.greater(ce(0)),i=ce(Bu),s=ce(Uu),u=e.mul(s),l=e.mul(i).mul(a.toFloat().exp());return Jr(o,u,l)}}})}}),Mr=U({transpose_:function(n,t){var e=O(n,"x","transpose");if(t==null&&(t=e.shape.map(function(a,o){return o}).reverse()),V(e.rank===t.length,function(){return"Error in transpose: rank of input "+e.rank+" must match length of perm "+t+"."}),t.forEach(function(a){V(a>=0&&a<e.rank,function(){return"All entries in 'perm' must be between 0 and "+(e.rank-1)+" but got "+t})}),e.rank<=1)return e.clone();var r={perm:t};return W.runKernelFunc(function(a){return a.transpose(e,t)},{x:e},function(a){var o=Tu(t);return{x:function(){return a.transpose(o)}}},"Transpose",r)}}),N_=U({localResponseNormalization_:function(n,t,e,r,a){t===void 0&&(t=5),e===void 0&&(e=1),r===void 0&&(r=1),a===void 0&&(a=.5);var o=O(n,"x","localResponseNormalization");V(o.rank===4||o.rank===3,function(){return`Error in localResponseNormalization: x must be rank 3 or 4 but got
               rank `+o.rank+"."}),V(mt(t),function(){return"Error in localResponseNormalization: depthRadius must be an integer but got depthRadius "+t+"."});var i=o,s=!1;o.rank===3&&(s=!0,i=o.as4D(1,o.shape[0],o.shape[1],o.shape[2]));var u=W.runKernelFunc(function(l,c){var p=l.localResponseNormalization4D(i,t,e,r,a);return c([i,p]),p},{x4D:i},function(l,c){var p=c[0],f=c[1];return{x4D:function(){return W.runKernelFunc(function(d){return d.LRNGrad(l,p,f,t,e,r,a)},{})}}});return s?u.as3D(u.shape[1],u.shape[2],u.shape[3]):u}}),nf=U({norm_:function(n,t,e,r){t===void 0&&(t="euclidean"),e===void 0&&(e=null),r===void 0&&(r=!1);var a=function s(u,l,c){if(c===void 0&&(c=null),u.rank===0)return u.abs();if(u.rank!==1&&c===null)return s(u.reshape([-1]),l,c);if(u.rank===1||typeof c=="number"||Array.isArray(c)&&c.length===1){if(l===1)return u.abs().sum(c);if(l===1/0)return u.abs().max(c);if(l===-1/0)return u.abs().min(c);if(l==="euclidean"||l===2)return u.abs().pow(ce(2,"int32")).sum(c).sqrt();throw new Error("Error in norm: invalid ord value: "+l)}if(Array.isArray(c)&&c.length===2){if(l===1)return u.abs().sum(c[0]).max(c[1]-1);if(l===1/0)return u.abs().sum(c[1]).max(c[0]);if(l===-1/0)return u.abs().sum(c[1]).min(c[0]);if(l==="fro"||l==="euclidean")return u.square().sum(c).sqrt();throw new Error("Error in norm: invalid ord value: "+l)}throw new Error("Error in norm: invalid axis: "+c)}(n=O(n,"x","norm"),t,e),o=a.shape;if(r){var i=Ct(e,n.shape);o=on(a.shape,i)}return a.reshape(o)}}),R_=U({basicLSTMCell_:function(n,t,e,r,a,o){var i=O(n,"forgetBias","basicLSTMCell"),s=O(t,"lstmKernel","basicLSTMCell"),u=O(e,"lstmBias","basicLSTMCell"),l=O(r,"data","basicLSTMCell"),c=O(a,"c","basicLSTMCell"),p=O(o,"h","basicLSTMCell"),f=l.concat(p,1).matMul(s).add(u),d=f.shape[0],h=f.shape[1]/4,v=[d,h],g=f.slice([0,0],v),m=f.slice([0,h],v),x=f.slice([0,2*h],v),y=f.slice([0,3*h],v),w=g.sigmoid().mulStrict(m.tanh()).addStrict(c.mulStrict(i.add(x).sigmoid())),E=w.tanh().mulStrict(y.sigmoid());return[w,E]}}),A_=U({multiRNNCell_:function(n,t,e,r){for(var a=O(t,"data","multiRNNCell"),o=fi(e,"c","multiRNNCell"),i=fi(r,"h","multiRNNCell"),s=a,u=[],l=0;l<n.length;l++){var c=n[l](s,o[l],i[l]);u.push(c[0]),u.push(c[1]),s=c[1]}var p=[],f=[];for(l=0;l<u.length;l+=2)p.push(u[l]),f.push(u[l+1]);return[p,f]}}),P_=U({movingAverage_:function(n,t,e,r,a){a===void 0&&(a=!0);var o=O(n,"v","movingAverage"),i=O(t,"x","movingAverage"),s=O(e,"decay","movingAverage");Ny(o,i),V(kt(o.shape,i.shape),function(){return"Shape mismatch in v and x"});var u=ce(1),l=u.sub(s),c=i.sub(o).mul(l);if(a){V(r!=null,function(){return"When using zeroDebias: true, step is required."});var p=O(r,"step","movingAverage");c=c.div(u.sub(Ei(s,p)))}return o.add(c)}}),O_=U({stridedSlice_:function(n,t,e,r,a,o,i,s,u){if(a===void 0&&(a=0),o===void 0&&(o=0),i===void 0&&(i=0),s===void 0&&(s=0),u===void 0&&(u=0),r==null&&(r=new Array(t.length)),i!==0)throw new Error("ellipsis mask is not yet supported");var l=O(n,"x","stridedSlice"),c=yc(s),p=l.shape.slice();c.forEach(function(g){t[g]=0,e[g]=1,p.splice(g,0,1)}),l=l.reshape(p);for(var f=0;f<l.rank;f++)t[f]=$x(a,t,r,l.shape,f),e[f]=Hx(o,e,r,l.shape,f),r[f]=r[f]||1;var d=yc(u);d.forEach(function(g){e[g]=t[g]+1,r[g]=1});var h=Pu(t,e,r),v=h.filter(function(g,m){return d.indexOf(m)===-1});return r.every(function(g){return g===1})?Yn(l,t,h).reshape(v):W.runKernelFunc(function(g){return g.stridedSlice(l,t,e,r)},{$x:l}).reshape(v)}}),M_=U({topk_:function(n,t,e){t===void 0&&(t=1),e===void 0&&(e=!0);var r=O(n,"x","topk");if(r.rank===0)throw new Error("topk() expects the input to be of rank 1 or higher");var a=r.shape[r.shape.length-1];if(t>a)throw new Error("'k' passed to topk() must be <= the last dimension ("+a+") but got "+t);var o=W.runKernelFunc(function(i){return i.topk(r,t,e)},{$x:r});return{values:o[0],indices:o[1]}}}),F_=U({scatterND_:function(n,t,e){var r=O(n,"indices","scatterND","int32"),a=O(t,"updates","scatterND");return qx(a,r,e),W.runKernelFunc(function(o){return o.scatterND(r,a,e)},{indices:r,updates:a},null,"ScatterNd",{shape:e})}}),Gu=U({fft_:function(n){V(n.dtype==="complex64",function(){return"The dtype for tf.spectral.fft() must be complex64 but got "+n.dtype+"."});var t=n.shape[n.shape.length-1],e=n.size/t,r=n.as2D(e,t);return W.runKernelFunc(function(a){return a.fft(r)},{input:n}).reshape(n.shape)}}),Si=U({ifft_:function(n){V(n.dtype==="complex64",function(){return"The dtype for tf.spectral.ifft() must be complex64 but got "+n.dtype+"."});var t=n.shape[n.shape.length-1],e=n.size/t,r=n.as2D(e,t);return W.runKernelFunc(function(a){return a.ifft(r)},{input:n}).reshape(n.shape)}}),ju=U({rfft_:function(n,t){V(n.dtype==="float32",function(){return"The dtype for rfft() must be real value but got "+n.dtype});var e,r=n.shape[n.shape.length-1],a=n.size/r;if(t!=null&&t<r){var o=n.shape.map(function(m){return 0}),i=n.shape.map(function(m){return m});i[n.shape.length-1]=t,e=n.slice(o,i),r=t}else if(t!=null&&t>r){var s=n.shape.map(function(m){return m});s[n.shape.length-1]=t-r,e=n.concat(et(s),n.shape.length-1),r=t}else e=n;var u=e.zerosLike(),l=At(e,u).as2D(a,r),c=Gu(l),p=Math.floor(r/2)+1,f=_n(c),d=zn(c),h=f.split([p,r-p],f.shape.length-1),v=d.split([p,r-p],d.shape.length-1),g=e.shape.slice();return g[e.shape.length-1]=p,At(h[0],v[0]).reshape(g)}}),rf=U({irfft_:function(n){var t=n.shape[n.shape.length-1],e=n.size/t;if(t<=2){var r=n.as2D(e,t),a=Si(r);return _n(a)}var o=[e,2*(t-1)],i=_n(n).as2D(e,t),s=zn(n).as2D(e,t),u=i.slice([0,1],[e,t-2]).reverse(1),l=s.slice([0,1],[e,t-2]).reverse(1).mul(ce(-1)),c=i.concat(u,1),p=s.concat(l,1);return r=At(c,p).as2D(o[0],o[1]),a=Si(r),_n(a)}}),V_=Object.freeze({fft:Gu,ifft:Si,rfft:ju,irfft:rf}),L_=U({sparseToDense_:function(n,t,e,r){r===void 0&&(r=0);var a=O(n,"sparseIndices","sparseToDense","int32"),o=O(t,"sparseValues","sparseToDense"),i=O(r,"defaultValue","sparseToDense",o.dtype);return function(s,u,l,c){if(s.dtype!=="int32")throw new Error("tf.sparseToDense() expects the indices to be int32 type, but the dtype was "+s.dtype+".");if(s.rank>2)throw new Error("sparseIndices should be a scalar, vector, or matrix, but got shape "+s.shape+".");var p=s.rank>0?s.shape[0]:1,f=s.rank>1?s.shape[1]:1;if(l.length!==f)throw new Error("outputShape has incorrect number of elements:, "+l.length+", should be: "+f+".");var d=u.size;if(u.rank!==0&&(u.rank!==1||d!==p))throw new Error("sparseValues has incorrect shape "+u.shape+", should be [] or ["+p+"]");if(u.dtype!==c.dtype)throw new Error("sparseValues.dtype must match defaultValues.dtype")}(a,o,e,i),W.runKernelFunc(function(s){return s.sparseToDense(a,o,e,i)},{$sparseIndices:a,$sparseValues:o,$defaultValue:i})}}),B_=U({gatherND_:function(n,t){var e=O(t,"indices","gatherND","int32"),r=O(n,"x","gatherND");return W.runKernelFunc(function(a){return a.gatherND(r,e)},{x:r,indices:e},null,"GatherNd")}}),U_=U({diag_:function(n){var t=O(n,"x","diag").flatten(),e=n.shape.concat(n.shape);return W.runKernelFunc(function(r){return r.diag(t)},{$x:t}).reshape(e)}}),W_=U({dropout_:function(n,t,e,r){var a=O(n,"x","dropout");if(V(a.dtype==="float32",function(){return"x has to be a floating point tensor since it's going to be scaled, but got a "+a.dtype+" tensor instead."}),V(t>=0&&t<1,function(){return"rate must be a float in the range [0, 1), but got "+t+"."}),t===0)return n instanceof at?a.clone():a;var o=function(u,l){if(l==null)return u.shape.slice();if(kt(u.shape,l))return l;if(u.shape.length===l.length){for(var c=[],p=0;p<u.shape.length;p++)l[p]==null&&u.shape[p]!=null?c.push(u.shape[p]):c.push(l[p]);return c}return l}(a,e),i=1-t,s=ep(o,0,1,"float32",r).add(i).floor().div(i);return a.mul(s)}});function af(n,t,e){for(var r=1-n%2,a=new Float32Array(n),o=0;o<n;++o){var i=2*Math.PI*o/(n+r-1);a[o]=t-e*Math.cos(i)}return yt(a,"float32")}var Xu=U({hannWindow_:function(n){return af(n,.5,.5)}}),of=U({hammingWindow_:function(n){return af(n,.54,.46)}}),Yu=U({frame_:function(n,t,e,r,a){r===void 0&&(r=!1),a===void 0&&(a=0);for(var o=0,i=[];o+t<=n.size;)i.push(Yn(n,o,t)),o+=e;if(r)for(;o<n.size;){var s=o+t-n.size,u=_t([Yn(n,o,t-s),jn([s],a)]);i.push(u),o+=e}return i.length===0?Nr([],[0,t]):_t(i).as2D(i.length,t)}}),sf=U({stft_:function(n,t,e,r,a){var o;a===void 0&&(a=Xu),r==null&&(o=t,r=Math.floor(Math.pow(2,Math.ceil(Math.log(o)/Math.log(2)))));for(var i=Yu(n,t,e),s=$t(i,a(t)),u=[],l=0;l<i.shape[0];l++)u.push(ju(s.slice([l,0],[1,t]),r));return _t(u)}}),q_=Object.freeze({hannWindow:Xu,hammingWindow:of,frame:Yu,stft:sf}),zt,z_=function(n,t,e){return e===void 0&&(e=1),he(this,void 0,void 0,function(){var r,a,o,i,s,u,l,c,p,f,d,h,v,g;return ve(this,function(m){switch(m.label){case 0:return r=O(n,"predictions","inTopK"),a=O(t,"targets","inTopK"),V(r.rank>1,function(){return"inTopK() expects the predictions to be of rank 2 or higher, but got "+r.rank}),V(r.rank-1===a.rank,function(){return"predictions rank should be 1 larger than targets rank, but got predictions rank "+r.rank+" and targets rank "+a.rank}),je(r.shape.slice(0,r.shape.length-1),a.shape,"predictions's shape should be align with the targets' shape, except the last dimension."),o=r.shape[r.shape.length-1],V(e>0&&e<=o,function(){return"'k' passed to inTopK() must be > 0 && <= the predictions last dimension ("+o+"), but got "+e}),[4,r.data()];case 1:return i=m.sent(),[4,a.data()];case 2:for(s=m.sent(),u=[i.length/o,o],c=u[1],p=ao("bool",l=u[0]),f=0;f<l;f++){for(d=f*c,h=i.subarray(d,d+c),v=[],g=0;g<h.length;g++)v.push({value:h[g],index:g});for(v.sort(function(x,y){return y.value-x.value}),p[f]=0,g=0;g<e;g++)if(v[g].index===s[f]){p[f]=1;break}}return n!==r&&r.dispose(),t!==a&&a.dispose(),[2,Ot(p,a.shape,"bool")]}})})};(function(n){n[n.NONE=0]="NONE",n[n.MEAN=1]="MEAN",n[n.SUM=2]="SUM",n[n.SUM_BY_NONZERO_WEIGHTS=3]="SUM_BY_NONZERO_WEIGHTS"})(zt||(zt={}));var $_=U({absoluteDifference_:function(n,t,e,r){r===void 0&&(r=zt.SUM_BY_NONZERO_WEIGHTS);var a=O(n,"labels","absoluteDifference"),o=O(t,"predictions","absoluteDifference"),i=null;e!=null&&(i=O(e,"weights","absoluteDifference")),je(a.shape,o.shape,"Error in absoluteDifference: ");var s=a.sub(o).abs();return hr(s,i,r)}}),hr=U({computeWeightedLoss_:function(n,t,e){e===void 0&&(e=zt.SUM_BY_NONZERO_WEIGHTS);var r=O(n,"losses","computeWeightedLoss"),a=null;t!=null&&(a=O(t,"weights","computeWeightedLoss"));var o=a==null?r:r.mul(a);if(e===zt.NONE)return o;if(e===zt.SUM)return o.sum();if(e===zt.MEAN){if(a==null)return o.mean();var i=r.size/a.size,s=o.sum().div(a.sum());return i>1?s.div(ce(i)):s}if(e===zt.SUM_BY_NONZERO_WEIGHTS){if(a==null)return o.sum().div(ce(r.size));var u=a.mul(La(r.shape)).notEqual(ce(0)).sum().toFloat();return o.sum().div(u)}throw Error("Unknown reduction: "+e)}}),H_=U({cosineDistance_:function(n,t,e,r,a){a===void 0&&(a=zt.SUM_BY_NONZERO_WEIGHTS);var o=O(n,"labels","cosineDistance"),i=O(t,"predictions","cosineDistance"),s=null;r!=null&&(s=O(r,"weights","cosineDistance")),je(o.shape,i.shape,"Error in cosineDistance: ");var u=ce(1).sub(o.mul(i).sum(e,!0));return hr(u,s,a)}}),G_=U({hingeLoss_:function(n,t,e,r){r===void 0&&(r=zt.SUM_BY_NONZERO_WEIGHTS);var a=O(n,"labels","hingeLoss"),o=O(t,"predictions","hingeLoss"),i=null;e!=null&&(i=O(e,"weights","hingeLoss")),je(a.shape,o.shape,"Error in hingeLoss: ");var s=ce(1);a=ce(2).mul(a).sub(s);var u=s.sub(a.mul(o)).relu();return hr(u,i,r)}}),j_=U({huberLoss_:function(n,t,e,r,a){r===void 0&&(r=1),a===void 0&&(a=zt.SUM_BY_NONZERO_WEIGHTS);var o=O(n,"labels","huberLoss"),i=O(t,"predictions","huberLoss"),s=null;e!=null&&(s=O(e,"weights","huberLoss")),je(o.shape,i.shape,"Error in huberLoss: ");var u=ce(r),l=i.sub(o).abs(),c=Bp(l,u),p=l.sub(c),f=ce(.5).mul(c.square()).add(u.mul(p));return hr(f,s,a)}}),X_=U({logLoss_:function(n,t,e,r,a){r===void 0&&(r=1e-7),a===void 0&&(a=zt.SUM_BY_NONZERO_WEIGHTS);var o=O(n,"labels","logLoss"),i=O(t,"predictions","logLoss"),s=null;e!=null&&(s=O(e,"weights","logLoss")),je(o.shape,i.shape,"Error in logLoss: ");var u=ce(1),l=ce(r),c=o.mul(i.add(l).log()).neg().sub(u.sub(o).mul(u.sub(i).add(l).log()));return hr(c,s,a)}}),Y_=U({meanSquaredError_:function(n,t,e,r){r===void 0&&(r=zt.SUM_BY_NONZERO_WEIGHTS);var a=O(n,"labels","meanSquaredError"),o=O(t,"predictions","meanSquaredError"),i=null;e!=null&&(i=O(e,"weights","meanSquaredError")),je(a.shape,o.shape,"Error in meanSquaredError: ");var s=a.squaredDifference(o);return hr(s,i,r)}}),K_=U({sigmoidCrossEntropy_:function(n,t,e,r,a){r===void 0&&(r=0),a===void 0&&(a=zt.SUM_BY_NONZERO_WEIGHTS);var o=O(n,"multiClassLabels","sigmoidCrossEntropy"),i=O(t,"logits","sigmoidCrossEntropy"),s=null;if(e!=null&&(s=O(e,"weights","sigmoidCrossEntropy")),je(o.shape,i.shape,"Error in sigmoidCrossEntropy: "),r>0){var u=ce(r),l=ce(1),c=ce(.5);o=o.mul(l.sub(u)).add(c.mul(u))}var p=function(f,d){var h=O(f,"labels","sigmoidCrossEntropyWithLogits"),v=O(d,"logits","sigmoidCrossEntropyWithLogits");je(h.shape,v.shape,"Error in sigmoidCrossEntropyWithLogits: ");var g=v.relu(),m=v.mul(h),x=v.abs().neg().exp().log1p();return g.sub(m).add(x)}(o,i);return hr(p,s,a)}}),J_=U({softmaxCrossEntropy_:function(n,t,e,r,a){r===void 0&&(r=0),a===void 0&&(a=zt.SUM_BY_NONZERO_WEIGHTS);var o=O(n,"onehotLabels","softmaxCrossEntropy"),i=O(t,"logits","softmaxCrossEntropy"),s=null;if(e!=null&&(s=O(e,"weights","softmaxCrossEntropy")),je(o.shape,i.shape,"Error in softmaxCrossEntropy: "),r>0){var u=ce(r),l=ce(1),c=ce(o.shape[1]);o=o.mul(l.sub(u)).add(u.div(c))}var p=function(f,d,h){if(h===void 0&&(h=-1),h===-1&&(h=d.rank-1),h!==d.rank-1)throw Error("Softmax cross entropy along a non-last dimension is not yet supported. Labels / logits was rank "+d.rank+" and dim was "+h);return Wi(function(v,g,m){var x=g.logSumExp([h],!0),y=g.toFloat().sub(x);return m([v,y]),{value:y.mul(v).neg().sum([h]),gradFunc:function(w,E){var D=E[0],k=E[1],S=on(w.shape,[h]);return[w.reshape(S).mul(D.toFloat().sub(k.exp())),w.reshape(S).mul(k.exp().sub(D.toFloat()))]}}})(f,d)}(o,i);return hr(p,s,a)}}),Q_=Object.freeze({get Reduction(){return zt},absoluteDifference:$_,computeWeightedLoss:hr,cosineDistance:H_,hingeLoss:G_,huberLoss:j_,logLoss:X_,meanSquaredError:Y_,sigmoidCrossEntropy:K_,softmaxCrossEntropy:J_});function Uc(n,t){return t===void 0&&(t=!1),W.tidy(function(){if(n.shape.length!==2)throw new Error("qr2d() requires a 2D Tensor, but got a "+n.shape.length+"D Tensor.");for(var e=n.shape[0],r=n.shape[1],a=Zd(e),o=n.clone(),i=Nr([[1]],[1,1]),s=i.clone(),u=e>=r?r:e,l=function(p){var f,d=o,h=s,v=a;f=W.tidy(function(){var g=o.slice([p,p],[e-p,1]),m=g.norm(),x=o.slice([p,p],[1,1]),y=Nr([[-1]]).where(x.greater(0),Nr([[1]])),w=x.sub(y.mul(m)),E=g.div(w);s=E.shape[0]===1?i.clone():i.concat(E.slice([1,0],[E.shape[0]-1,E.shape[1]]),0);var D=y.matMul(w).div(m).neg(),k=o.slice([p,0],[e-p,r]),S=D.mul(s);if(p===0)o=k.sub(S.matMul(s.transpose().matMul(k)));else{var _=k.sub(S.matMul(s.transpose().matMul(k)));o=o.slice([0,0],[p,r]).concat(_,0)}var b=a.slice([0,p],[e,a.shape[1]-p]);if(p===0)a=b.sub(b.matMul(s).matMul(S.transpose()));else{var N=b.sub(b.matMul(s).matMul(S.transpose()));a=a.slice([0,0],[e,p]).concat(N,1)}return[s,o,a]}),s=f[0],o=f[1],a=f[2],rn([d,h,v])},c=0;c<u;++c)l(c);return!t&&e>r&&(a=a.slice([0,0],[e,r]),o=o.slice([0,0],[r,r])),[a,o]})}var Z_=U({bandPart_:function(n,t,e){if(t%1!=0)throw new Error("bandPart(): numLower must be an integer, got "+t+".");if(e%1!=0)throw new Error("bandPart(): numUpper must be an integer, got "+e+".");var r=O(n,"a","bandPart");if(r.rank<2)throw new Error("bandPart(): Rank must be at least 2, got "+r.rank+".");var a=r.shape,o=r.shape.slice(-2),i=o[0],s=o[1];if(!(t<=i))throw new Error("bandPart(): numLower ("+t+") must not be greater than the number of rows ("+i+").");if(!(e<=s))throw new Error("bandPart(): numUpper ("+e+") must not be greater than the number of columns ("+s+").");t<0&&(t=i),e<0&&(e=s);var u=hi(0,i,1,"int32").reshape([-1,1]),l=hi(0,s,1,"int32"),c=St(u,l),p=zi(c.lessEqual(ce(+t,"int32")),c.greaterEqual(ce(-e,"int32"))),f=et([i,s],r.dtype);return vn(wt(r.reshape([-1,i,s])).map(function(d){return Jr(p,d,f)})).reshape(a)}}),ew=U({gramSchmidt_:function(n){var t;if(Array.isArray(n)){t=!1,V(n!=null&&n.length>0,function(){return"Gram-Schmidt process: input must not be null, undefined, or empty"});for(var e=n[0].shape[0],r=function(u){V(n[u].shape[0]===e,function(){return"Gram-Schmidt: Non-unique lengths found in the input vectors: ("+n[u].shape[0]+" vs. "+e+")"})},a=1;a<n.length;++a)r(a)}else t=!0,n=Ru(n,n.shape[0],0).map(function(u){return np(u,[0])});V(n.length<=n[0].shape[0],function(){return"Gram-Schmidt: Number of vectors ("+n.length+") exceeds number of dimensions ("+n[0].shape[0]+")."});var o=[],i=n,s=function(u){o.push(W.tidy(function(){var l=i[u];if(u>0)for(var c=0;c<u;++c){var p=Qp(o[c].mulStrict(l)).mul(o[c]);l=l.sub(p)}return l.div(nf(l,"euclidean"))}))};for(a=0;a<n.length;++a)s(a);return t?vn(o,0):o}}),tw=U({qr_:function(n,t){if(t===void 0&&(t=!1),n.rank<2)throw new Error("qr() requires input tensor to have a rank >= 2, but got rank "+n.rank);if(n.rank===2)return Uc(n,t);var e=n.shape.slice(0,n.shape.length-2).reduce(function(i,s){return i*s}),r=wt(n.reshape([e,n.shape[n.shape.length-2],n.shape[n.shape.length-1]]),0),a=[],o=[];return r.forEach(function(i){var s=Uc(i,t),u=s[0],l=s[1];a.push(u),o.push(l)}),[vn(a,0).reshape(n.shape),vn(o,0).reshape(n.shape)]}}),nw=Object.freeze({bandPart:Z_,gramSchmidt:ew,qr:tw});function ji(n,t,e,r,a,o){r==null&&(r=.5),a==null&&(a=Number.NEGATIVE_INFINITY),o==null&&(o=0);var i=n.shape[0];return e=Math.min(e,i),V(0<=r&&r<=1,function(){return"iouThreshold must be in [0, 1], but was '"+r+"'"}),V(n.rank===2,function(){return"boxes must be a 2D tensor, but was of rank '"+n.rank+"'"}),V(n.shape[1]===4,function(){return"boxes must have 4 columns, but 2nd dimension was "+n.shape[1]}),V(t.rank===1,function(){return"scores must be a 1D tensor"}),V(t.shape[0]===i,function(){return"scores has incompatible shape with boxes. Expected "+i+", but was "+t.shape[0]}),V(0<=o&&o<=1,function(){return"softNmsSigma must be in [0, 1], but was '"+o+"'"}),{maxOutputSize:e,iouThreshold:r,scoreThreshold:a,softNmsSigma:o}}var rw=U({resizeBilinear_:function(n,t,e){e===void 0&&(e=!1);var r=O(n,"images","resizeBilinear");V(r.rank===3||r.rank===4,function(){return"Error in resizeBilinear: x must be rank 3 or 4, but got rank "+r.rank+"."}),V(t.length===2,function(){return"Error in resizeBilinear: new shape must 2D, but got shape "+t+"."});var a=r,o=!1;r.rank===3&&(o=!0,a=r.as4D(1,r.shape[0],r.shape[1],r.shape[2]));var i=t[0],s=t[1],u=W.runKernelFunc(function(l,c){return c([a]),l.resizeBilinear(a,i,s,e)},{x:a},function(l,c){return{x:function(){return W.runKernelFunc(function(p){return p.resizeBilinearBackprop(l,c[0],e)},{})}}},"ResizeBilinear",{alignCorners:e,newHeight:i,newWidth:s});return o?u.as3D(u.shape[1],u.shape[2],u.shape[3]):u}}),aw=U({resizeNearestNeighbor_:function(n,t,e){e===void 0&&(e=!1);var r=O(n,"images","resizeNearestNeighbor");V(r.rank===3||r.rank===4,function(){return"Error in resizeNearestNeighbor: x must be rank 3 or 4, but got rank "+r.rank+"."}),V(t.length===2,function(){return"Error in resizeNearestNeighbor: new shape must 2D, but got shape "+t+"."}),V(r.dtype==="float32"||r.dtype==="int32",function(){return"`images` must have `int32` or `float32` as dtype"});var a=r,o=!1;r.rank===3&&(o=!0,a=r.as4D(1,r.shape[0],r.shape[1],r.shape[2]));var i=t[0],s=t[1],u=W.runKernelFunc(function(l,c){return c([a]),l.resizeNearestNeighbor(a,i,s,e)},{batchImages:a},function(l,c){return{batchImages:function(){return W.runKernelFunc(function(p){return p.resizeNearestNeighborBackprop(l,c[0],e)},{})}}});return o?u.as3D(u.shape[1],u.shape[2],u.shape[3]):u}}),ow=U({nonMaxSuppression_:function(n,t,e,r,a){r===void 0&&(r=.5),a===void 0&&(a=Number.NEGATIVE_INFINITY);var o=O(n,"boxes","nonMaxSuppression"),i=O(t,"scores","nonMaxSuppression"),s=ji(o,i,e,r,a);e=s.maxOutputSize,r=s.iouThreshold,a=s.scoreThreshold;var u={maxOutputSize:e,iouThreshold:r,scoreThreshold:a};return W.runKernelFunc(function(l){return l.nonMaxSuppression(o,i,e,r,a)},{boxes:o,scores:i},null,"NonMaxSuppressionV3",u)}}),iw=function(n,t,e,r,a){return r===void 0&&(r=.5),a===void 0&&(a=Number.NEGATIVE_INFINITY),he(this,void 0,void 0,function(){var o,i,s,u,l,c,p;return ve(this,function(f){switch(f.label){case 0:return o=O(n,"boxes","nonMaxSuppressionAsync"),i=O(t,"scores","nonMaxSuppressionAsync"),s=ji(o,i,e,r,a),e=s.maxOutputSize,r=s.iouThreshold,a=s.scoreThreshold,[4,Promise.all([o.data(),i.data()])];case 1:return u=f.sent(),l=u[0],c=u[1],p=Mu(l,c,e,r,a),o!==n&&o.dispose(),i!==t&&i.dispose(),[2,p]}})})},sw=U({nonMaxSuppressionWithScore_:function(n,t,e,r,a,o){r===void 0&&(r=.5),a===void 0&&(a=Number.NEGATIVE_INFINITY),o===void 0&&(o=0);var i=O(n,"boxes","nonMaxSuppression"),s=O(t,"scores","nonMaxSuppression"),u=ji(i,s,e,r,a,o),l={maxOutputSize:e=u.maxOutputSize,iouThreshold:r=u.iouThreshold,scoreThreshold:a=u.scoreThreshold,softNmsSigma:o=u.softNmsSigma},c=W.runKernel("NonMaxSuppressionV5",{boxes:i,scores:s},l);return{selectedIndices:c[0],selectedScores:c[1]}}}),uw=function(n,t,e,r,a,o){return r===void 0&&(r=.5),a===void 0&&(a=Number.NEGATIVE_INFINITY),o===void 0&&(o=0),he(this,void 0,void 0,function(){var i,s,u,l,c,p,f;return ve(this,function(d){switch(d.label){case 0:return i=O(n,"boxes","nonMaxSuppressionAsync"),s=O(t,"scores","nonMaxSuppressionAsync"),u=ji(i,s,e,r,a,o),e=u.maxOutputSize,r=u.iouThreshold,a=u.scoreThreshold,o=u.softNmsSigma,[4,Promise.all([i.data(),s.data()])];case 1:return l=d.sent(),c=l[0],p=l[1],f=Fu(c,p,e,r,a,o),i!==n&&i.dispose(),s!==t&&s.dispose(),[2,f]}})})},lw=U({cropAndResize_:function(n,t,e,r,a,o){var i=O(n,"image","cropAndResize"),s=O(t,"boxes","cropAndResize","float32"),u=O(e,"boxInd","cropAndResize","int32");a=a||"bilinear",o=o||0;var l=s.shape[0];return V(i.rank===4,function(){return"Error in cropAndResize: image must be rank 4,but got rank "+i.rank+"."}),V(s.rank===2&&s.shape[1]===4,function(){return"Error in cropAndResize: boxes must be have size ["+l+",4] but had shape "+s.shape+"."}),V(u.rank===1&&u.shape[0]===l,function(){return"Error in cropAndResize: boxInd must be have size ["+l+"] but had shape "+s.shape+"."}),V(r.length===2,function(){return"Error in cropAndResize: cropSize must be of length 2, but got length "+r.length+"."}),V(r[0]>=1&&r[1]>=1,function(){return"cropSize must be atleast [1,1], but was "+r}),V(a==="bilinear"||a==="nearest",function(){return"method must be bilinear or nearest, but was "+a}),W.runKernelFunc(function(c,p){return c.cropAndResize(i,s,u,r,a,o)},{images:i,boxes:s,boxInd:u},null,"CropAndResize",{method:a,extrapolationValue:o,cropSize:r})}}),Ku=Object.freeze({resizeBilinear:rw,resizeNearestNeighbor:aw,nonMaxSuppression:ow,nonMaxSuppressionAsync:iw,nonMaxSuppressionWithScore:sw,nonMaxSuppressionWithScoreAsync:uw,cropAndResize:lw}),Ju=function(n,t){return!(n>0)||t==="linear"},Qu=function(n,t,e){if(e==null||e==="linear")return n;if(e==="relu")return n.mul(t.step());throw new Error("Gradient for activation "+e+" has not been implemented yet.")},Zu=function(n,t){var e=t,r=Et(n.shape,t.shape);return r.length>0&&(e=e.sum(r)),e.reshape(n.shape)},el=function(n,t,e){if(t==="linear")return n;if(t==="relu")return ot(n);if(t==="elu")return Zp(n);if(t==="relu6")return tf(n);if(t==="prelu")return ef(n,e);throw new Error("Unknown fused activation "+t+".")},cw=U({fusedMatMul_:function(n){var t,e=n.a,r=n.b,a=n.transposeA,o=a!==void 0&&a,i=n.transposeB,s=i!==void 0&&i,u=n.bias,l=n.activation,c=l===void 0?"linear":l,p=n.preluActivationWeights;if(Ju(W.state.gradientDepth,c)===!1){var f=Hi(e,r,o,s);return u!=null&&(f=Fe(f,u)),el(f,c,p)}var d=O(e,"a","fused matMul"),h=O(r,"b","fused matMul");t=st(d,h),d=t[0],h=t[1];var v=o?d.shape[d.rank-2]:d.shape[d.rank-1],g=s?h.shape[h.rank-1]:h.shape[h.rank-2],m=o?d.shape[d.rank-1]:d.shape[d.rank-2],x=s?h.shape[h.rank-2]:h.shape[h.rank-1],y=d.shape.slice(0,-2),w=h.shape.slice(0,-2),E=ge(y),D=ge(w);V(d.rank>=2&&h.rank>=2&&d.rank===h.rank,function(){return"Error in fused matMul: inputs must have the same rank of at least 2, got ranks "+d.rank+" and "+h.rank+"."}),V(kt(y,w),function(){return"Error in fused matMul: outer dimensions ("+y+") and ("+w+") of Tensors with shapes "+d.shape+" and "+h.shape+" must match."}),V(v===g,function(){return"Error in fused matMul: inner shapes ("+v+") and ("+g+") of Tensors with shapes "+d.shape+" and "+h.shape+" and transposeA="+o+" and transposeB="+s+" must match."});var k,S,_=d.shape.slice(0,-2).concat([m,x]),b=o?d.as3D(E,v,m):d.as3D(E,m,v),N=s?h.as3D(D,x,g):h.as3D(D,g,x);u!=null&&Le(_,(k=st(k=O(u,"bias","fused matMul"),d)[0]).shape),p!=null&&(S=O(p,"prelu weights","fused matMul"));var T={a:b,b:N};u!=null&&(T.bias=k),p!=null&&(T.preluActivationWeights=S);var P=[b,N];return W.runKernelFunc(function(F,M){var L=F.fusedBatchMatMul({a:b,b:N,transposeA:o,transposeB:s,bias:k,activation:c,preluActivationWeights:S});return M([b,N,L]),L},T,function(F,M){var L=M[0],A=M[1],$=M[2],q=Qu(F,$,c),z={};return u!=null&&(z={bias:function(){return Zu(k,q)}}),Object.assign(o||s?!o&&s?{a:function(){return q.matMul(A,!1,!1)},b:function(){return q.matMul(L,!0,!1)}}:o&&!s?{a:function(){return A.matMul(q,!1,!0)},b:function(){return L.matMul(q,!1,!1)}}:{a:function(){return A.matMul(q,!0,!0)},b:function(){return q.matMul(L,!0,!0)}}:{a:function(){return q.matMul(A,!1,!0)},b:function(){return L.matMul(q,!0,!1)}},z)},"_FusedMatMul",{transposeA:o,transposeB:s,activation:c},P,[!0]).reshape(_)}}),dw=U({fusedConv2d_:function(n){var t=n.x,e=n.filter,r=n.strides,a=n.pad,o=n.dataFormat,i=o===void 0?"NHWC":o,s=n.dilations,u=s===void 0?[1,1]:s,l=n.dimRoundingMode,c=n.bias,p=n.activation,f=p===void 0?"linear":p,d=n.preluActivationWeights;if(f=f||"linear",Ju(W.state.gradientDepth,f)===!1){var h=Cn(t,e,r,a,i,u,l);return c!=null&&(h=Fe(h,c)),el(h,f,d)}var v=O(t,"x","conv2d"),g=O(e,"filter","conv2d"),m=v,x=!1;v.rank===3&&(x=!0,m=v.as4D(1,v.shape[0],v.shape[1],v.shape[2])),V(m.rank===4,function(){return"Error in fused conv2d: input must be rank 4, but got rank "+m.rank+"."}),V(g.rank===4,function(){return"Error in fused conv2d: filter must be rank 4, but got rank "+g.rank+"."}),l!=null&&V(mt(a),function(){return"Error in fused conv2d: pad must be an integer when using, dimRoundingMode "+l+" but got pad "+a+"."}),V(m.shape[3]===g.shape[2],function(){return"Error in conv2d: depth of input ("+m.shape[3]+") must match input depth for filter "+g.shape[2]+"."}),V(sn(r,u),function(){return"Error in conv2D: Either strides or dilations must be 1. Got strides "+r+" and dilations '"+u+"'"}),V(i==="NHWC",function(){return"Error in conv2d: got dataFormat of "+i+" but only NHWC is currently supported."});var y,w,E=oa(m.shape,g.shape,r,u,a,l);c!=null&&(y=st(y=O(c,"bias","fused conv2d"),v)[0],Le(E.outShape,y.shape)),d!=null&&(w=O(d,"prelu weights","fused conv2d"));var D={x:m,filter:g};c!=null&&(D.bias=y),d!=null&&(D.preluActivationWeights=w);var k=[g,m],S=W.runKernelFunc(function(_,b){var N=_.fusedConv2d({input:m,filter:g,convInfo:E,bias:y,activation:f,preluActivationWeights:w});return b([g,m,N]),N},D,function(_,b){var N=b,T=N[0],P=N[1],F=N[2],M=Qu(_,F,f);V(Na(u),function(){return"Error in gradient of fused conv2D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '"+u+"'"});var L={};return c!=null&&(L={bias:function(){return Zu(y,M)}}),Object.assign({x:function(){return Hp(P.shape,M,T,r,a)},filter:function(){return $u(P,M,T.shape,r,a)}},L)},"FusedConv2D",{convInfo:E,activation:f},k,[!0]);return x?S.as3D(S.shape[1],S.shape[2],S.shape[3]):S}}),pw=U({fusedDepthwiseConv2d_:function(n){var t=n.x,e=n.filter,r=n.strides,a=n.pad,o=n.dataFormat,i=o===void 0?"NHWC":o,s=n.dilations,u=s===void 0?[1,1]:s,l=n.dimRoundingMode,c=n.bias,p=n.activation,f=p===void 0?"linear":p,d=n.preluActivationWeights;if(Ju(W.state.gradientDepth,f)===!1){var h=$i(t,e,r,a,i,u,l);return c!=null&&(h=Fe(h,c)),el(h,f,d)}var v=O(t,"x","depthwiseConv2d"),g=O(e,"filter","depthwiseConv2d"),m=v,x=!1;v.rank===3&&(x=!0,m=v.as4D(1,v.shape[0],v.shape[1],v.shape[2])),V(m.rank===4,function(){return"Error in fused depthwiseConv2d: input must be rank 4, but got rank "+m.rank+"."}),V(g.rank===4,function(){return"Error in fused depthwiseConv2d: filter must be rank 4, but got rank "+g.rank+"."}),V(m.shape[3]===g.shape[2],function(){return"Error in fused depthwiseConv2d: number of input channels ("+m.shape[3]+") must match the inChannels dimension in filter "+g.shape[2]+"."}),u==null&&(u=[1,1]),V(sn(r,u),function(){return"Error in fused depthwiseConv2d: Either strides or dilations must be 1. Got strides "+r+" and dilations '"+u+"'"}),l!=null&&V(mt(a),function(){return"Error in fused depthwiseConv2d: pad must be an integer when using dimRoundingMode "+l+" but got pad "+a+"."});var y,w,E=oa(m.shape,g.shape,r,u,a,l,!0);c!=null&&(y=st(y=O(c,"bias","fused conv2d"),v)[0],Le(E.outShape,y.shape)),d!=null&&(w=O(d,"prelu weights","fused depthwiseConv2d"));var D={x:m,filter:g};c!=null&&(D.bias=y),d!=null&&(D.preluActivationWeights=w);var k=[g,m],S=W.runKernelFunc(function(_,b){var N=_.fusedDepthwiseConv2D({input:m,filter:g,convInfo:E,bias:y,activation:f,preluActivationWeights:w});return b([g,m,N]),N},D,function(_,b){V(Na(u),function(){return"Error in gradient of fused depthwiseConv2d: dilation rates greater than 1 are not yet supported. Got dilations '"+u+"'"});var N=b[0],T=b[1],P=b[2],F=Qu(_,P,f),M={};return c!=null&&(M={bias:function(){return Zu(y,F)}}),Object.assign({x:function(){return Gp(T.shape,F,N,E)},filter:function(){return jp(T,F,N.shape,E)}},M)},"FusedDepthwiseConv2D",{convInfo:E,activation:f},k,[!0]);return x?S.as3D(S.shape[1],S.shape[2],S.shape[3]):S}}),fw=Object.freeze({matMul:cw,conv2d:dw,depthwiseConv2d:pw}),hw=Object.freeze({image:Ku,linalg:nw,losses:Q_,spectral:V_,fused:fw,signal:q_,square:X0,squaredDifference:Tp,conv1d:r_,conv2d:Cn,conv3d:a_,depthwiseConv2d:$i,separableConv2d:Hu,conv2dTranspose:o_,conv3dTranspose:i_,op:U,batchNormalization2d:Sb,batchNormalization3d:Cb,batchNormalization4d:Ib,batchNormalization:Db,batchNorm:Mp,batchNorm2d:kb,batchNorm3d:Tb,batchNorm4d:Nb,booleanMaskAsync:n_,complex:At,real:_n,imag:zn,concat:_t,concat1d:fx,concat2d:hx,concat3d:vx,concat4d:mx,split:Ru,matMul:Hi,dot:s_,outerProduct:u_,reverse:So,reverse1d:l_,reverse2d:c_,reverse3d:d_,reverse4d:p_,maxPool:Dt,avgPool:Co,pool:f_,maxPool3d:h_,avgPool3d:v_,slice:Yn,slice1d:m_,slice2d:g_,slice3d:Kp,slice4d:y_,abs:Y0,acos:K0,acosh:J0,asin:Q0,asinh:Z0,atan:eb,atanh:tb,ceil:nb,clipByValue:Wu,cos:rb,cosh:ab,erf:ob,exp:cu,expm1:ib,floor:sb,log:ub,log1p:lb,logSigmoid:cb,neg:wi,reciprocal:db,round:pb,rsqrt:Np,sigmoid:Rp,sign:fb,isNaN:hb,isInf:vb,isFinite:mb,sin:gb,sinh:yb,softplus:xb,sqrt:bb,step:_b,tan:wb,tanh:Eb,all:x_,any:b_,argMax:__,argMin:w_,logSumExp:E_,max:Gi,mean:S_,min:C_,moments:I_,sum:Qp,prod:D_,equal:Up,equalStrict:Gb,greater:jb,greaterEqual:Wp,greaterEqualStrict:Xb,greaterStrict:Yb,less:Kb,lessEqual:Jb,lessEqualStrict:Qb,lessStrict:Zb,notEqual:e_,notEqualStrict:t_,add:Fe,addN:Pb,addStrict:Ob,atan2:Mb,div:Tn,divNoNan:Fb,divStrict:Vb,floorDiv:Lp,maximum:qu,maximumStrict:Lb,minimum:Bp,minimumStrict:Bb,mod:Ub,modStrict:Wb,mul:$t,mulStrict:qb,pow:Ei,powStrict:zb,squaredDifferenceStrict:$b,sub:St,subStrict:Hb,elu:Zp,leakyRelu:k_,prelu:ef,relu:ot,relu6:tf,selu:T_,logicalAnd:zi,logicalNot:Rb,logicalOr:Fp,logicalXor:Ab,where:Jr,whereAsync:Vp,buffer:Ne,print:Cx,batchToSpaceND:Qd,broadcastTo:Ix,cast:Dx,clone:kx,cumsum:Tx,depthToSpace:Nx,expandDims:bn,eye:Zd,multinomial:Rx,oneHot:iu,pad:aa,pad1d:Ax,pad2d:Px,pad3d:Ox,pad4d:Mx,rand:Fx,randomNormal:Vx,randomGamma:Lx,randomUniform:ep,reshape:Nn,spaceToBatchND:tp,squeeze:np,stack:vn,tile:xa,truncatedNormal:Bx,unstack:wt,setdiff1dAsync:Ux,fill:jn,linspace:px,ones:La,range:hi,scalar:ce,tensor:Ot,tensor1d:yt,tensor2d:Nr,tensor3d:Nu,tensor4d:en,tensor5d:lx,tensor6d:cx,variable:dx,zeros:et,onesLike:Jd,zerosLike:qe,transpose:Mr,softmax:fr,logSoftmax:jx,localResponseNormalization:N_,norm:nf,gather:zu,unsortedSegmentSum:qp,basicLSTMCell:R_,multiRNNCell:A_,movingAverage:P_,stridedSlice:O_,topk:M_,scatterND:F_,fft:Gu,ifft:Si,rfft:ju,irfft:rf,sparseToDense:L_,gatherND:B_,diag:U_,dropout:W_,hannWindow:Xu,hammingWindow:of,frame:Yu,stft:sf,inTopKAsync:z_});function Z(n,t){Array.isArray(n)||(n=[n]),n.forEach(function(e){e!=null&&V(e.dtype!=="complex64",function(){return t+" does not support complex64 tensors."})})}function Fs(n,t,e,r){if(e==="linear")return n.linear(t);if(e==="relu")return n.relu(t);if(e==="elu")return n.elu(t);if(e==="relu6")return n.relu6(t);if(e==="prelu")return n.prelu(t,r);throw new Error("Activation "+e+" has not been implemented for the CPU backend.")}var vw=function(n){function t(){var e=n.call(this)||this;return e.blockSize=48,e.firstUse=!0,e.data=new lp(e,W),e}return On(t,n),t.prototype.write=function(e,r,a){this.firstUse&&(this.firstUse=!1,J().get("IS_NODE")&&pi(`
============================
Hi there ð. Looks like you are running TensorFlow.js in Node.js. To speed things up dramatically, install our node backend, which binds to TensorFlow C++, by running npm i @tensorflow/tfjs-node, or npm i @tensorflow/tfjs-node-gpu if you have CUDA. Then call require('@tensorflow/tfjs-node'); (-gpu suffix for CUDA) at the start of your program. Visit https://github.com/tensorflow/tfjs-node for more details.
============================`));var o={};return this.data.set(o,{values:e,dtype:a}),o},t.prototype.move=function(e,r,a,o){this.data.set(e,{values:r,dtype:o})},t.prototype.numDataIds=function(){return this.data.numDataIds()},t.prototype.read=function(e){return he(this,void 0,void 0,function(){return ve(this,function(r){return[2,this.readSync(e)]})})},t.prototype.readSync=function(e){var r=this.data.get(e),a=r.dtype,o=r.complexTensors;return a==="complex64"?lu(this.readSync(o.real.dataId),this.readSync(o.imag.dataId)):this.data.get(e).values},t.prototype.bufferSync=function(e){var r=this.readSync(e.dataId),a=r;if(e.dtype==="string")try{a=r.map(function(o){return li(o)})}catch{throw new Error("Failed to decode encoded string bytes into utf-8")}return Ne(e.shape,e.dtype,a)},t.prototype.makeOutput=function(e,r,a){var o=this.write(e,r,a);return W.makeTensorFromDataId(o,r,a,this)},t.prototype.disposeData=function(e){if(this.data.has(e)){var r=this.data.get(e).complexTensors;r!=null&&(r.real.dispose(),r.imag.dispose()),this.data.delete(e)}},t.prototype.time=function(e){return he(this,void 0,void 0,function(){var r;return ve(this,function(a){return r=Wn(),e(),[2,{kernelMs:Wn()-r}]})})},t.prototype.memory=function(){return{unreliable:!0,reasons:["The reported memory is an upper bound. Due to automatic garbage collection, the true allocated memory may be less."]}},t.prototype.complex=function(e,r){var a=this.makeOutput(null,e.shape,"complex64");return this.data.get(a.dataId).complexTensors={real:W.keep(e.clone()),imag:W.keep(r.clone())},a},t.prototype.real=function(e){return this.data.get(e.dataId).complexTensors.real.clone()},t.prototype.imag=function(e){return this.data.get(e.dataId).complexTensors.imag.clone()},t.prototype.slice=function(e,r,a){if(Z(e,"slice"),sp(e.shape,r,a)){var o=up(r,e.strides),i=ge(a);return Ot(this.readSync(e.dataId).subarray(o,o+i),a,e.dtype)}for(var s=Ne(a,e.dtype),u=this.bufferSync(e),l=0;l<s.size;++l){var c=s.indexToLoc(l).map(function(p,f){return p+r[f]});s.values[l]=u.get.apply(u,c)}return s.toTensor()},t.prototype.stridedSlice=function(e,r,a,o){Z(e,"stridedSlice");var i=Pu(r,a,o);if(i.some(function(d){return d===0}))return Ot([],i);for(var s=Ne(i,e.dtype),u=this.bufferSync(e),l=0;l<s.size;l++){for(var c=s.indexToLoc(l),p=new Array(c.length),f=0;f<p.length;f++)p[f]=c[f]*o[f]+r[f];s.set.apply(s,[u.get.apply(u,p)].concat(c))}return s.toTensor()},t.prototype.diag=function(e){for(var r=this.readSync(e.dataId),a=Ne([e.size,e.size],e.dtype),o=a.values,i=0;i<r.length;i++)o[i*e.size+i]=r[i];return a.toTensor()},t.prototype.unstack=function(e,r){for(var a=e.shape[r],o=new Array(e.rank-1),i=0,s=0;s<e.rank;s++)s!==r&&(o[i++]=e.shape[s]);var u=new Array(e.rank).fill(0),l=e.shape.slice();l[r]=1;var c=new Array(a);for(s=0;s<c.length;s++)u[r]=s,c[s]=this.slice(e,u,l).reshape(o);return c},t.prototype.reverse=function(e,r){Z(e,"reverse");for(var a=Ne(e.shape,e.dtype),o=this.bufferSync(e),i=function(u){var l=a.indexToLoc(u),c=l.slice();r.forEach(function(p){return c[p]=e.shape[p]-1-c[p]}),a.set.apply(a,[o.get.apply(o,c)].concat(l))},s=0;s<a.size;s++)i(s);return a.toTensor()},t.prototype.concat=function(e,r){var a=this;if(e[0].dtype==="complex64"){var o=e.map(function(d){return _n(d)}),i=e.map(function(d){return zn(d)});return At(this.concat(o,r),this.concat(i,r))}var s=e.map(function(d){var h=ge(d.shape.slice(r));return d.as2D(-1,h)}),u=Ta(s.map(function(d){return d.shape}),1),l=Ne(u,e[0].dtype).values;if(s[0].shape[0]===1){var c=0;s.forEach(function(d){l.set(a.readSync(d.dataId),c),c+=d.size})}else{var p=0;s.forEach(function(d){for(var h=a.readSync(d.dataId),v=0,g=0;g<d.shape[0];++g)for(var m=g*u[1]+p,x=0;x<d.shape[1];++x)l[m+x]=h[v++];p+=d.shape[1]})}var f=Ta(e.map(function(d){return d.shape}),r);return Ot(l,f,e[0].dtype)},t.prototype.neg=function(e){return Z(e,"neg"),this.multiply(ce(-1),e)},t.prototype.add=function(e,r){return e.dtype==="complex64"||r.dtype==="complex64"?this.broadcastedBinaryComplexOp(e.cast("complex64"),r.cast("complex64"),function(a,o,i,s){return{real:a+i,imag:o+s}}):this.broadcastedBinaryOp(e,r,Pt(e.dtype,r.dtype),function(a,o){return a+o})},t.prototype.addN=function(e){var r=this;Z(e,"addN");for(var a=e.map(function(c){return r.readSync(c.dataId)}),o=Ne(e[0].shape,e[0].dtype),i=o.values,s=0;s<e.length;s++)for(var u=a[s],l=0;l<i.length;l++)i[l]+=u[l];return o.toTensor()},t.prototype.softmax=function(e,r){var a=Ct([r],e.shape),o=this.max(e,a),i=on(o.shape,a),s=this.subtract(e,o.reshape(i)),u=this.exp(s),l=this.sum(u,a).reshape(i);return this.realDivide(u,l)},t.prototype.subtract=function(e,r){return e.dtype==="complex64"||r.dtype==="complex64"?this.broadcastedBinaryComplexOp(e.cast("complex64"),r.cast("complex64"),function(a,o,i,s){return{real:a-i,imag:o-s}}):this.broadcastedBinaryOp(e,r,Pt(e.dtype,r.dtype),function(a,o){return a-o})},t.prototype.pow=function(e,r){return Z([e,r],"pow"),this.broadcastedBinaryOp(e,r,e.dtype,function(a,o){return Math.pow(a,o)})},t.prototype.batchMatMul=function(e,r,a,o){Z([e,r],"matMul");for(var i=a?e.shape[1]:e.shape[2],s=a?e.shape[2]:e.shape[1],u=o?r.shape[1]:r.shape[2],l=e.shape[0],c=this.readSync(e.dataId),p=this.readSync(r.dataId),f=a?[e.strides[0],1,e.strides[1]]:[e.strides[0],e.strides[1],1],d=f[0],h=f[1],v=f[2],g=o?[1,r.strides[1],r.strides[0]]:[r.strides[1],1,r.strides[0]],m=g[0],x=g[1],y=g[2],w=s*u,E=Ne([l,s,u],e.dtype),D=E.values,k=this.blockSize,S=0;S<l;S++)for(var _=0;_<s;_+=k)for(var b=0;b<u;b+=k)for(var N=0;N<i;N+=k)for(var T=Math.min(_+k,s),P=Math.min(b+k,u),F=Math.min(N+k,i),M=_;M<T;M++)for(var L=b;L<P;L++){for(var A=0,$=N;$<F;$++)A+=c[S*d+M*h+$*v]*p[$*m+L*x+S*y];D[S*w+(M*u+L)]+=A}return E.toTensor()},t.prototype.fusedBatchMatMul=function(e){var r=e.a,a=e.b,o=e.transposeA,i=e.transposeB,s=e.bias,u=e.activation,l=e.preluActivationWeights,c=this.batchMatMul(r,a,o,i);return s&&(c=this.add(c,s)),u&&(c=Fs(this,c,u,l)),c},t.prototype.multiply=function(e,r){return e.dtype==="complex64"||r.dtype==="complex64"?this.broadcastedBinaryComplexOp(e.cast("complex64"),r.cast("complex64"),function(a,o,i,s){return{real:a*i-o*s,imag:a*s+o*i}}):this.broadcastedBinaryOp(e,r,Pt(e.dtype,r.dtype),function(a,o){return a*o})},t.prototype.realDivide=function(e,r){return Z([e,r],"realDivide"),this.broadcastedBinaryOp(e,r,"float32",function(a,o){return a/o})},t.prototype.floorDiv=function(e,r){return Z([e,r],"floorDiv"),this.broadcastedBinaryOp(e,r,"int32",function(a,o){return Math.floor(a/o)})},t.prototype.sum=function(e,r){Z(e,"sum"),ln("sum",r,e.rank);for(var a=Bt(e.shape,r),o=a[0],i=a[1],s=et(o,Pt(e.dtype,"int32")),u=ge(i),l=this.readSync(s.dataId),c=this.readSync(e.dataId),p=0;p<l.length;++p){for(var f=p*u,d=0,h=0;h<u;++h)d+=c[f+h];l[p]=d}return s},t.prototype.prod=function(e,r){Z(e,"sum");for(var a=Bt(e.shape,r),o=a[0],i=a[1],s=et(o,Pt(e.dtype,"int32")),u=ge(i),l=this.readSync(s.dataId),c=this.readSync(e.dataId),p=0;p<l.length;++p){for(var f=p*u,d=1,h=0;h<u;++h)d*=c[f+h];l[p]=d}return s},t.prototype.unsortedSegmentSum=function(e,r,a){Z(e,"unsortedSegmentSum");for(var o=[],i=e.rank-r.rank,s=0;s<i;++s)r=r.expandDims(s+1);for(s=0;s<a;++s){var u=ce(s,"int32"),l=Up(u,r).asType("float32").mul(e).sum(0);o.push(l)}return vn(o)},t.prototype.argMin=function(e,r){Z(e,"argMin");var a=[r];ln("argMin",a,e.rank);for(var o=Bt(e.shape,a),i=o[0],s=o[1],u=et(i,"int32"),l=ge(s),c=this.readSync(u.dataId),p=this.readSync(e.dataId),f=0;f<c.length;++f){for(var d=f*l,h=p[d],v=0,g=0;g<l;++g){var m=p[d+g];m<h&&(h=m,v=g)}c[f]=v}return u},t.prototype.argMax=function(e,r){Z(e,"argMax");var a=[r];ln("argMax",a,e.rank);for(var o=Bt(e.shape,a),i=o[0],s=o[1],u=et(i,"int32"),l=ge(s),c=this.readSync(u.dataId),p=this.readSync(e.dataId),f=0;f<c.length;++f){for(var d=f*l,h=p[d],v=0,g=0;g<l;++g){var m=p[d+g];m>h&&(h=m,v=g)}c[f]=v}return u},t.prototype.cumsum=function(e,r,a,o){if(Z(e,"cumsum"),r!==e.rank-1)throw new Error("backend.cumsum in CPU expects an inner-most axis="+(e.rank-1)+" but got axis="+r);for(var i=Pt(e.dtype,"int32"),s=et(e.shape,i),u=this.readSync(s.dataId),l=this.readSync(e.dataId),c=e.shape[e.rank-1],p=o?function(g,m){return g+c-m-1}:function(g,m){return g+m},f=0;f<l.length;f+=c)for(var d=0;d<c;d++){var h=p(f,d);if(d===0)u[h]=a?0:l[h];else{var v=p(f,d-1);u[h]=a?l[v]+u[v]:l[h]+u[v]}}return s},t.prototype.equal=function(e,r){return Z([e,r],"equal"),this.broadcastedBinaryOp(e,r,"bool",function(a,o){return a===o?1:0})},t.prototype.notEqual=function(e,r){return Z([e,r],"notEqual"),this.broadcastedBinaryOp(e,r,"bool",function(a,o){return a!==o?1:0})},t.prototype.less=function(e,r){return Z([e,r],"less"),this.broadcastedBinaryOp(e,r,"bool",function(a,o){return a<o?1:0})},t.prototype.lessEqual=function(e,r){return Z([e,r],"lessEqual"),this.broadcastedBinaryOp(e,r,"bool",function(a,o){return a<=o?1:0})},t.prototype.greater=function(e,r){return Z([e,r],"greater"),this.broadcastedBinaryOp(e,r,"bool",function(a,o){return a>o?1:0})},t.prototype.greaterEqual=function(e,r){return Z([e,r],"greaterEqual"),this.broadcastedBinaryOp(e,r,"bool",function(a,o){return a>=o?1:0})},t.prototype.logicalNot=function(e){Z(e,"logicalNot");for(var r=this.readSync(e.dataId),a=new Uint8Array(r.length),o=0;o<r.length;++o)a[o]=r[o]?0:1;return this.makeOutput(a,e.shape,"bool")},t.prototype.logicalAnd=function(e,r){return Z([e,r],"logicalAnd"),this.broadcastedBinaryOp(e,r,"bool",function(a,o){return a&&o})},t.prototype.logicalOr=function(e,r){return Z([e,r],"logicalOr"),this.broadcastedBinaryOp(e,r,"bool",function(a,o){return a||o})},t.prototype.select=function(e,r,a){Z([e,r,a],"select");for(var o=this.readSync(e.dataId),i=this.readSync(r.dataId),s=this.readSync(a.dataId),u=et(r.shape,Pt(r.dtype,a.dtype)),l=this.readSync(u.dataId),c=0,p=e.rank===0||e.rank>1||r.rank===1?1:ge(r.shape.slice(1)),f=0;f<o.length;f++)for(var d=0;d<p;d++)o[f]===1?l[c++]=i[f]:l[c++]=s[f];return u},t.prototype.where=function(e){Z([e],"where");var r=this.readSync(e.dataId);return Vu(e.shape,r)},t.prototype.topk=function(e,r,a){return Z(e,"topk"),gp(this.readSync(e.dataId),e.shape,e.dtype,r)},t.prototype.min=function(e,r){Z(e,"min"),ln("min",r,e.rank);for(var a=Bt(e.shape,r),o=a[0],i=a[1],s=et(o,e.dtype),u=ge(i),l=this.readSync(s.dataId),c=this.readSync(e.dataId),p=0;p<l.length;++p){for(var f=p*u,d=c[f],h=0;h<u;++h){var v=c[f+h];v<d&&(d=v)}l[p]=d}return s},t.prototype.minimum=function(e,r){return Z([e,r],"minimum"),this.broadcastedBinaryOp(e,r,e.dtype,function(a,o){return Math.min(a,o)})},t.prototype.mod=function(e,r){return Z([e,r],"mod"),this.broadcastedBinaryOp(e,r,e.dtype,function(a,o){var i=a%o;return a<0&&o<0||a>=0&&o>=0?i:(i+o)%o})},t.prototype.max=function(e,r){Z(e,"max"),ln("max",r,e.rank);for(var a=Bt(e.shape,r),o=a[0],i=a[1],s=et(o,e.dtype),u=ge(i),l=this.readSync(s.dataId),c=this.readSync(e.dataId),p=0;p<l.length;++p){for(var f=p*u,d=c[f],h=0;h<u;++h){var v=c[f+h];v>d&&(d=v)}l[p]=d}return s},t.prototype.maximum=function(e,r){return Z([e,r],"maximum"),this.broadcastedBinaryOp(e,r,e.dtype,function(a,o){return Math.max(a,o)})},t.prototype.all=function(e,r){Z(e,"all"),ln("all",r,e.rank);for(var a=Bt(e.shape,r),o=a[0],i=a[1],s=et(o,e.dtype),u=ge(i),l=this.readSync(s.dataId),c=this.readSync(e.dataId),p=0;p<l.length;++p){for(var f=p*u,d=c[f],h=0;h<u;++h){var v=c[f+h];d=d&&v}l[p]=d}return s},t.prototype.any=function(e,r){Z(e,"any"),ln("any",r,e.rank);for(var a=Bt(e.shape,r),o=a[0],i=a[1],s=et(o,e.dtype),u=ge(i),l=this.readSync(s.dataId),c=this.readSync(e.dataId),p=0;p<l.length;++p){for(var f=p*u,d=c[f],h=0;h<u;++h){var v=c[f+h];d=d||v}l[p]=d}return s},t.prototype.squaredDifference=function(e,r){return Z([e,r],"squaredDifference"),this.broadcastedBinaryOp(e,r,e.dtype,function(a,o){var i=a-o;return i*i})},t.prototype.ceil=function(e){Z(e,"ceil");for(var r=this.readSync(e.dataId),a=new Float32Array(r.length),o=0;o<r.length;++o)a[o]=Math.ceil(r[o]);return this.makeOutput(a,e.shape,"float32")},t.prototype.floor=function(e){Z(e,"floor");for(var r=this.readSync(e.dataId),a=new Float32Array(r.length),o=0;o<r.length;++o)a[o]=Math.floor(r[o]);return this.makeOutput(a,e.shape,"float32")},t.prototype.sign=function(e){Z(e,"x");for(var r=this.readSync(e.dataId),a=new Float32Array(r.length),o=0;o<r.length;++o)r[o]<0?a[o]=-1:r[o]>0?a[o]=1:a[o]=0;return this.makeOutput(a,e.shape,"float32")},t.prototype.isNaN=function(e){Z(e,"x");for(var r=this.readSync(e.dataId),a=new Uint8Array(r.length),o=0;o<r.length;++o)Number.isNaN(r[o])&&(a[o]=1);return this.makeOutput(a,e.shape,"bool")},t.prototype.isInf=function(e){Z(e,"x");for(var r=this.readSync(e.dataId),a=new Uint8Array(r.length),o=0;o<r.length;++o)Math.abs(r[o])===1/0&&(a[o]=1);return this.makeOutput(a,e.shape,"bool")},t.prototype.isFinite=function(e){Z(e,"x");for(var r=this.readSync(e.dataId),a=new Uint8Array(r.length),o=0;o<r.length;++o)Number.isFinite(r[o])&&(a[o]=1);return this.makeOutput(a,e.shape,"bool")},t.prototype.round=function(e){Z(e,"round");for(var r=this.readSync(e.dataId),a=new Float32Array(r.length),o=0;o<r.length;++o){var i=Math.floor(r[o]);r[o]-i<.5?a[o]=Math.floor(r[o]):r[o]-i>.5?a[o]=Math.ceil(r[o]):a[o]=i%2==0?i:i+1}return this.makeOutput(a,e.shape,"float32")},t.prototype.exp=function(e){Z(e,"exp");for(var r=this.readSync(e.dataId),a=new Float32Array(r.length),o=0;o<r.length;++o)a[o]=Math.exp(r[o]);return this.makeOutput(a,e.shape,"float32")},t.prototype.expm1=function(e){Z(e,"expm1");for(var r=this.readSync(e.dataId),a=new Float32Array(r.length),o=0;o<r.length;++o)a[o]=Math.expm1(r[o]);return this.makeOutput(a,e.shape,"float32")},t.prototype.log=function(e){Z(e,"log");for(var r=this.readSync(e.dataId),a=new Float32Array(r.length),o=0;o<r.length;++o){var i=r[o];a[o]=Math.log(i)}return this.makeOutput(a,e.shape,"float32")},t.prototype.log1p=function(e){Z(e,"log1p");for(var r=this.readSync(e.dataId),a=new Float32Array(r.length),o=0;o<r.length;++o){var i=r[o];a[o]=Math.log1p(i)}return this.makeOutput(a,e.shape,"float32")},t.prototype.sqrt=function(e){Z(e,"sqrt");for(var r=this.readSync(e.dataId),a=new Float32Array(r.length),o=0;o<r.length;++o){var i=r[o];a[o]=Math.sqrt(i)}return this.makeOutput(a,e.shape,"float32")},t.prototype.rsqrt=function(e){Z(e,"rsqrt");for(var r=this.readSync(e.dataId),a=new Float32Array(r.length),o=0;o<r.length;++o){var i=r[o];a[o]=1/Math.sqrt(i)}return this.makeOutput(a,e.shape,"float32")},t.prototype.reciprocal=function(e){Z(e,"reciprocal");for(var r=this.readSync(e.dataId),a=new Float32Array(r.length),o=0;o<r.length;++o)a[o]=1/r[o];return this.makeOutput(a,e.shape,"float32")},t.prototype.linear=function(e){return e},t.prototype.relu=function(e){Z(e,"relu");for(var r=et(e.shape,e.dtype),a=this.readSync(r.dataId),o=this.readSync(e.dataId),i=0;i<o.length;++i)a[i]=Math.max(0,o[i]);return r},t.prototype.relu6=function(e){Z(e,"relu");for(var r=et(e.shape,e.dtype),a=this.readSync(r.dataId),o=this.readSync(e.dataId),i=0;i<o.length;++i)a[i]=Math.min(Math.max(0,o[i]),6);return r},t.prototype.prelu=function(e,r){return Z([e,r],"prelu"),this.broadcastedBinaryOp(e,r,e.dtype,function(a,o){return a<0?o*a:a})},t.prototype.elu=function(e){Z(e,"elu");for(var r=new Float32Array(e.size),a=this.readSync(e.dataId),o=0;o<a.length;++o){var i=a[o];r[o]=i>=0?i:Math.exp(i)-1}return this.makeOutput(r,e.shape,"float32")},t.prototype.eluDer=function(e,r){Z([e,r],"eluDer");for(var a=new Float32Array(r.size),o=this.readSync(r.dataId),i=this.readSync(e.dataId),s=0;s<o.length;++s){var u=o[s];a[s]=u>=1?i[s]:i[s]*(u+1)}return this.makeOutput(a,r.shape,"float32")},t.prototype.selu=function(e){Z(e,"selu");for(var r=Bu,a=Uu,o=new Float32Array(e.size),i=this.readSync(e.dataId),s=0;s<i.length;++s){var u=i[s];o[s]=u>=0?a*u:r*(Math.exp(u)-1)}return this.makeOutput(o,e.shape,"float32")},t.prototype.clip=function(e,r,a){Z(e,"clip");for(var o=new Float32Array(e.size),i=this.readSync(e.dataId),s=0;s<i.length;++s){var u=i[s];o[s]=u>a?a:u<r?r:u}return this.makeOutput(o,e.shape,"float32")},t.prototype.abs=function(e){for(var r=new Float32Array(e.size),a=this.readSync(e.dataId),o=0;o<a.length;++o)r[o]=Math.abs(a[o]);return this.makeOutput(r,e.shape,"float32")},t.prototype.complexAbs=function(e){for(var r=new Float32Array(e.size),a=this.readSync(e.dataId),o=0;o<e.size;++o){var i=a[2*o],s=a[2*o+1];r[o]=Math.hypot(i,s)}return this.makeOutput(r,e.shape,"float32")},t.prototype.int=function(e){Z(e,"int");for(var r=new Int32Array(e.size),a=this.readSync(e.dataId),o=0;o<a.length;++o)r[o]=a[o];return this.makeOutput(r,e.shape,"int32")},t.prototype.sigmoid=function(e){Z(e,"sigmoid");for(var r=new Float32Array(e.size),a=this.readSync(e.dataId),o=0;o<a.length;++o)r[o]=1/(1+Math.exp(-a[o]));return this.makeOutput(r,e.shape,"float32")},t.prototype.softplus=function(e){Z(e,"softplus");for(var r=Math.log(11920928955078125e-23)+2,a=new Float32Array(e.size),o=this.readSync(e.dataId),i=0;i<o.length;++i){var s=o[i]>-r,u=o[i]<r,l=Math.exp(o[i]),c=void 0;c=u?l:s?o[i]:Math.log(1+l),a[i]=c}return this.makeOutput(a,e.shape,"float32")},t.prototype.sin=function(e){Z(e,"sin");for(var r=new Float32Array(e.size),a=this.readSync(e.dataId),o=0;o<a.length;++o)r[o]=Math.sin(a[o]);return this.makeOutput(r,e.shape,"float32")},t.prototype.cos=function(e){Z(e,"cos");for(var r=new Float32Array(e.size),a=this.readSync(e.dataId),o=0;o<a.length;++o)r[o]=Math.cos(a[o]);return this.makeOutput(r,e.shape,"float32")},t.prototype.tan=function(e){Z(e,"tan");for(var r=new Float32Array(e.size),a=this.readSync(e.dataId),o=0;o<a.length;++o)r[o]=Math.tan(a[o]);return this.makeOutput(r,e.shape,"float32")},t.prototype.asin=function(e){Z(e,"asin");for(var r=new Float32Array(e.size),a=this.readSync(e.dataId),o=0;o<a.length;++o)r[o]=Math.asin(a[o]);return this.makeOutput(r,e.shape,"float32")},t.prototype.acos=function(e){Z(e,"acos");for(var r=new Float32Array(e.size),a=this.readSync(e.dataId),o=0;o<a.length;++o)r[o]=Math.acos(a[o]);return this.makeOutput(r,e.shape,"float32")},t.prototype.atan=function(e){Z(e,"atan");for(var r=new Float32Array(e.size),a=this.readSync(e.dataId),o=0;o<a.length;++o)r[o]=Math.atan(a[o]);return this.makeOutput(r,e.shape,"float32")},t.prototype.atan2=function(e,r){return Z([e,r],"atan2"),this.broadcastedBinaryOp(e,r,e.dtype,function(a,o){return Math.atan2(a,o)})},t.prototype.sinh=function(e){Z(e,"sinh");for(var r=new Float32Array(e.size),a=this.readSync(e.dataId),o=0;o<a.length;++o)r[o]=Math.sinh(a[o]);return this.makeOutput(r,e.shape,"float32")},t.prototype.cosh=function(e){Z(e,"cosh");for(var r=new Float32Array(e.size),a=this.readSync(e.dataId),o=0;o<a.length;++o)r[o]=Math.cosh(a[o]);return this.makeOutput(r,e.shape,"float32")},t.prototype.tanh=function(e){Z(e,"tanh");for(var r=new Float32Array(e.size),a=this.readSync(e.dataId),o=0;o<a.length;++o)r[o]=my(a[o]);return this.makeOutput(r,e.shape,"float32")},t.prototype.asinh=function(e){Z(e,"asinh");for(var r=new Float32Array(e.size),a=this.readSync(e.dataId),o=0;o<a.length;++o)r[o]=Math.asinh(a[o]);return this.makeOutput(r,e.shape,"float32")},t.prototype.acosh=function(e){Z(e,"acosh");for(var r=new Float32Array(e.size),a=this.readSync(e.dataId),o=0;o<a.length;++o)r[o]=Math.acosh(a[o]);return this.makeOutput(r,e.shape,"float32")},t.prototype.atanh=function(e){Z(e,"atanh");for(var r=new Float32Array(e.size),a=this.readSync(e.dataId),o=0;o<a.length;++o)r[o]=Math.atanh(a[o]);return this.makeOutput(r,e.shape,"float32")},t.prototype.erf=function(e){Z(e,"erf");for(var r=new Float32Array(e.size),a=this.readSync(e.dataId),o=0;o<a.length;++o){var i=Math.sign(a[o]),s=Math.abs(a[o]),u=1/(1+.3275911*s);r[o]=i*(1-((((1.061405429*u-1.453152027)*u+1.421413741)*u-.284496736)*u+.254829592)*u*Math.exp(-s*s))}return this.makeOutput(r,e.shape,"float32")},t.prototype.step=function(e,r){r===void 0&&(r=0),Z(e,"step");for(var a=new Float32Array(e.size),o=this.readSync(e.dataId),i=0;i<o.length;++i){var s=o[i];isNaN(s)?a[i]=NaN:a[i]=s>0?1:r}return this.makeOutput(a,e.shape,"float32")},t.prototype.fusedConv2d=function(e){var r=e.input,a=e.filter,o=e.convInfo,i=e.bias,s=e.activation,u=e.preluActivationWeights,l=this.conv2d(r,a,o);return i&&(l=this.add(l,i)),s&&(l=Fs(this,l,s,u)),l},t.prototype.conv2d=function(e,r,a){Z([e,r],"conv2d");for(var o=a.filterHeight,i=a.filterWidth,s=a.dilationHeight,u=a.dilationWidth,l=a.padInfo.left,c=a.padInfo.top,p=a.dataFormat==="channelsLast",f=Ne(a.outShape,e.dtype),d=e.strides[0],h=p?e.strides[1]:e.strides[2],v=p?e.strides[2]:1,g=p?1:e.strides[1],m=f.strides[0],x=p?f.strides[1]:f.strides[2],y=p?f.strides[2]:1,w=p?1:f.strides[1],E=this.readSync(e.dataId),D=this.readSync(r.dataId),k=f.values,S=0;S<a.batchSize;++S)for(var _=S*d,b=S*m,N=0;N<a.outHeight;++N)for(var T=b+N*x,P=N*a.strideHeight-c,F=0;F<o;F++){var M=P+F*s;if(!(M<0||M>=a.inHeight))for(var L=F*r.strides[0],A=_+M*h,$=0;$<a.outWidth;++$)for(var q=T+$*y,z=$*a.strideWidth-l,K=0;K<i;K++){var re=z+K*u;if(!(re<0||re>=a.inWidth))for(var ae=A+re*v,Se=L+K*r.strides[1],Ce=0;Ce<a.inChannels;++Ce){for(var Pe=E[ae+Ce*g],Me=0;Me<a.outChannels;++Me)k[q+Me*w]+=Pe*D[Se+Me];Se+=a.outChannels}}}return f.toTensor()},t.prototype.conv3d=function(e,r,a){for(var o=a.filterDepth,i=a.filterHeight,s=a.filterWidth,u=a.dilationDepth,l=a.dilationHeight,c=a.dilationWidth,p=a.padInfo.front,f=a.padInfo.left,d=a.padInfo.top,h=Ne(a.outShape,e.dtype),v=this.readSync(e.dataId),g=this.readSync(r.dataId),m=h.values,x=0;x<a.batchSize;++x)for(var y=x*e.strides[0],w=x*h.strides[0],E=0;E<a.outDepth;++E)for(var D=w+E*h.strides[1],k=E*a.strideDepth-p,S=0;S<o;S++){var _=k+S*u;if(!(_<0||_>=a.inDepth))for(var b=S*r.strides[0],N=y+_*e.strides[1],T=0;T<a.outHeight;++T)for(var P=D+T*h.strides[2],F=T*a.strideHeight-d,M=0;M<i;M++){var L=F+M*l;if(!(L<0||L>=a.inHeight))for(var A=b+M*r.strides[1],$=N+L*e.strides[2],q=0;q<a.outWidth;++q)for(var z=P+q*a.outChannels,K=q*a.strideWidth-f,re=0;re<s;re++){var ae=K+re*c;if(!(ae<0||ae>=a.inWidth))for(var Se=A+re*r.strides[2],Ce=$+ae*a.inChannels,Pe=Se,Me=0;Me<a.inChannels;++Me){for(var ie=v[Ce+Me],ee=0;ee<a.outChannels;++ee)m[z+ee]+=ie*g[Pe+ee];Pe+=a.outChannels}}}}return h.toTensor()},t.prototype.conv2dDerInput=function(e,r,a){Z([e,r],"conv2dDerInput");for(var o=Ne(a.inShape,"float32"),i=o.values,s=this.readSync(e.dataId),u=this.readSync(r.dataId),l=r.strides,c=l[0],p=l[1],f=l[2],d=a.batchSize,h=a.filterHeight,v=a.filterWidth,g=a.inChannels,m=a.inHeight,x=a.inWidth,y=a.outChannels,w=a.outHeight,E=a.outWidth,D=a.strideHeight,k=a.strideWidth,S=a.dataFormat,_=h-1-a.padInfo.top,b=v-1-a.padInfo.left,N=S==="channelsLast",T=o.strides[0],P=N?o.strides[1]:o.strides[2],F=N?o.strides[2]:1,M=N?1:o.strides[1],L=e.strides[0],A=N?e.strides[1]:e.strides[2],$=N?e.strides[2]:1,q=N?1:e.strides[1],z=0;z<d;++z)for(var K=0;K<g;++K)for(var re=0;re<m;++re)for(var ae=re-_,Se=Math.max(0,Math.ceil(ae/D)),Ce=Math.min(w,(h+ae)/D),Pe=0;Pe<x;++Pe){for(var Me=Pe-b,ie=Math.max(0,Math.ceil(Me/k)),ee=Math.min(E,(v+Me)/k),ue=0,Ie=Se;Ie<Ce;++Ie)for(var $e=Ie*D-ae,ze=ie;ze<ee;++ze)for(var Qe=L*z+A*Ie+$*ze,Xe=c*(h-1-$e)+p*(v-1-(ze*k-Me))+f*K,Ze=0;Ze<y;++Ze)ue+=s[Qe+q*Ze]*u[Xe+Ze];i[T*z+P*re+F*Pe+M*K]=ue}return o.toTensor()},t.prototype.conv3dDerInput=function(e,r,a){for(var o=Ne(a.inShape,"float32"),i=o.values,s=o.strides,u=s[0],l=s[1],c=s[2],p=s[3],f=this.readSync(e.dataId),d=e.strides,h=d[0],v=d[1],g=d[2],m=d[3],x=this.readSync(r.dataId),y=r.strides,w=y[0],E=y[1],D=y[2],k=y[3],S=a.batchSize,_=a.filterDepth,b=a.filterHeight,N=a.filterWidth,T=a.inChannels,P=a.inDepth,F=a.inHeight,M=a.inWidth,L=a.outChannels,A=a.outDepth,$=a.outHeight,q=a.outWidth,z=a.strideDepth,K=a.strideHeight,re=a.strideWidth,ae=_-1-a.padInfo.front,Se=b-1-a.padInfo.top,Ce=N-1-a.padInfo.left,Pe=0;Pe<S;++Pe)for(var Me=0;Me<T;++Me)for(var ie=0;ie<P;++ie)for(var ee=ie-ae,ue=Math.max(0,Math.ceil(ee/z)),Ie=Math.min(A,(_+ee)/z),$e=0;$e<F;++$e)for(var ze=$e-Se,Qe=Math.max(0,Math.ceil(ze/K)),Xe=Math.min($,(b+ze)/K),Ze=0;Ze<M;++Ze){for(var mn=Ze-Ce,gn=Math.max(0,Math.ceil(mn/re)),Nt=Math.min(q,(N+mn)/re),yr=0,yn=ue;yn<Ie;++yn)for(var Fn=yn*z-ee,In=Qe;In<Xe;++In)for(var xr=In*K-ze,Dn=gn;Dn<Nt;++Dn)for(var Wa=h*Pe+v*yn+g*In+m*Dn,br=w*(_-1-Fn)+E*(b-1-xr)+D*(N-1-(Dn*re-mn))+k*Me,xn=0;xn<L;++xn)yr+=f[Wa+xn]*x[br+xn];i[u*Pe+l*ie+c*$e+p*Ze+Me]=yr}return o.toTensor()},t.prototype.conv2dDerFilter=function(e,r,a){Z([e,r],"conv2dDerFilter");for(var o=a.strideHeight,i=a.strideWidth,s=a.filterHeight,u=a.filterWidth,l=a.dataFormat==="channelsLast",c=Ne(a.filterShape,"float32"),p=a.padInfo.left,f=a.padInfo.top,d=this.bufferSync(e),h=this.bufferSync(r),v=0;v<s;++v)for(var g=Math.max(0,Math.ceil((f-v)/o)),m=Math.min(a.outHeight,(a.inHeight+f-v)/o),x=0;x<u;++x)for(var y=Math.max(0,Math.ceil((p-x)/i)),w=Math.min(a.outWidth,(a.inWidth+p-x)/i),E=0;E<a.inChannels;++E)for(var D=0;D<a.outChannels;++D){for(var k=0,S=0;S<a.batchSize;++S)for(var _=g;_<m;++_)for(var b=v+_*o-f,N=y;N<w;++N){var T=x+N*i-p;k+=l?d.get(S,b,T,E)*h.get(S,_,N,D):d.get(S,E,b,T)*h.get(S,D,_,N)}c.set(k,v,x,E,D)}return c.toTensor()},t.prototype.conv3dDerFilter=function(e,r,a){for(var o=a.strideDepth,i=a.strideHeight,s=a.strideWidth,u=a.filterDepth,l=a.filterHeight,c=a.filterWidth,p=Ne(a.filterShape,"float32"),f=p.values,d=p.strides,h=d[0],v=d[1],g=d[2],m=d[3],x=this.readSync(r.dataId),y=r.strides,w=y[0],E=y[1],D=y[2],k=y[3],S=this.readSync(e.dataId),_=e.strides,b=_[0],N=_[1],T=_[2],P=_[3],F=a.padInfo.front,M=a.padInfo.left,L=a.padInfo.top,A=0;A<u;++A)for(var $=Math.max(0,Math.ceil((F-A)/o)),q=Math.min(a.outDepth,(a.inDepth+F-A)/o),z=A*h,K=0;K<l;++K)for(var re=Math.max(0,Math.ceil((L-K)/i)),ae=Math.min(a.outHeight,(a.inHeight+L-K)/i),Se=K*v+z,Ce=0;Ce<c;++Ce)for(var Pe=Math.max(0,Math.ceil((M-Ce)/s)),Me=Math.min(a.outWidth,(a.inWidth+M-Ce)/s),ie=Ce*g+Se,ee=0;ee<a.inChannels;++ee)for(var ue=ee*m+ie,Ie=0;Ie<a.outChannels;++Ie){for(var $e=0,ze=0;ze<a.batchSize;++ze)for(var Qe=ze*b,Xe=ze*w,Ze=$;Ze<q;++Ze)for(var mn=(A+Ze*o-F)*N+Qe,gn=Ze*E+Xe,Nt=re;Nt<ae;++Nt)for(var yr=(K+Nt*i-L)*T+mn,yn=Nt*D+gn,Fn=Pe;Fn<Me;++Fn){var In=Fn*k+yn;$e+=S[(Ce+Fn*s-M)*P+yr+ee]*x[In+Ie]}f[ue+Ie]=$e}return p.toTensor()},t.prototype.fusedDepthwiseConv2D=function(e){var r=e.input,a=e.filter,o=e.convInfo,i=e.bias,s=e.activation,u=e.preluActivationWeights,l=this.depthwiseConv2D(r,a,o);return i&&(l=this.add(l,i)),s&&(l=Fs(this,l,s,u)),l},t.prototype.depthwiseConv2D=function(e,r,a){Z([e,r],"depthwiseConv2D");for(var o=a.filterHeight,i=a.filterWidth,s=a.dilationHeight,u=a.dilationWidth,l=a.padInfo.left,c=a.padInfo.top,p=a.outChannels/a.inChannels,f=Ne(a.outShape,e.dtype),d=this.readSync(e.dataId),h=this.readSync(r.dataId),v=f.values,g=0;g<a.batchSize;++g)for(var m=g*e.strides[0],x=g*f.strides[0],y=0;y<a.outHeight;++y)for(var w=x+y*f.strides[1],E=y*a.strideHeight-l,D=0;D<o;++D){var k=E+D*s;if(!(k<0||k>=a.inHeight))for(var S=D*r.strides[0],_=m+k*e.strides[1],b=0;b<a.outWidth;++b)for(var N=w+b*f.strides[2],T=b*a.strideWidth-c,P=0;P<i;++P){var F=T+P*u;if(!(F<0||F>=a.inWidth))for(var M=S+P*r.strides[1],L=_+F*a.inChannels,A=N,$=M,q=0;q<a.inChannels;++q){for(var z=d[L+q],K=0;K<p;++K)v[A+K]+=z*h[$+K];A+=p,$+=p}}}return f.toTensor()},t.prototype.depthwiseConv2DDerInput=function(e,r,a){Z([e,r],"depthwiseConv2DDerInput");for(var o=Ne(a.inShape,"float32"),i=o.values,s=o.strides,u=s[0],l=s[1],c=s[2],p=this.readSync(e.dataId),f=e.strides,d=f[0],h=f[1],v=f[2],g=this.readSync(r.dataId),m=r.strides,x=m[0],y=m[1],w=m[2],E=a.batchSize,D=a.filterHeight,k=a.filterWidth,S=a.inChannels,_=a.inHeight,b=a.inWidth,N=a.outChannels,T=a.outHeight,P=a.outWidth,F=a.strideHeight,M=a.strideWidth,L=D-1-a.padInfo.top,A=k-1-a.padInfo.left,$=N/S,q=0;q<E;++q)for(var z=0;z<S;++z)for(var K=0;K<_;++K)for(var re=K-L,ae=Math.max(0,Math.ceil(re/F)),Se=Math.min(T,(D+re)/F),Ce=0;Ce<b;++Ce){for(var Pe=Ce-A,Me=Math.max(0,Math.ceil(Pe/M)),ie=Math.min(P,(k+Pe)/M),ee=0,ue=ae;ue<Se;++ue)for(var Ie=ue*F-re,$e=Me;$e<ie;++$e)for(var ze=d*q+h*ue+v*$e,Qe=x*(D-1-Ie)+y*(k-1-($e*M-Pe))+w*z,Xe=0;Xe<$;++Xe)ee+=p[ze+(z*$+Xe)]*g[Qe+Xe];i[u*q+l*K+c*Ce+z]=ee}return o.toTensor()},t.prototype.depthwiseConv2DDerFilter=function(e,r,a){Z([e,r],"depthwiseConv2DDerFilter");for(var o=a.strideHeight,i=a.strideWidth,s=a.filterHeight,u=a.filterWidth,l=Ne(a.filterShape,"float32"),c=a.padInfo.left,p=a.padInfo.top,f=a.outChannels/a.inChannels,d=this.bufferSync(e),h=this.bufferSync(r),v=0;v<s;++v)for(var g=Math.max(0,Math.ceil((p-v)/o)),m=Math.min(a.outHeight,(a.inHeight+p-v)/o),x=0;x<u;++x)for(var y=Math.max(0,Math.ceil((c-x)/i)),w=Math.min(a.outWidth,(a.inWidth+c-x)/i),E=0;E<a.outChannels;++E){for(var D=Math.trunc(E/f),k=E%f,S=0,_=0;_<a.batchSize;++_)for(var b=g;b<m;++b)for(var N=v+b*o-p,T=y;T<w;++T){var P=x+T*i-c;S+=d.get(_,N,P,D)*h.get(_,b,T,E)}l.set(S,v,x,D,k)}return l.toTensor()},t.prototype.tile=function(e,r){return Z(e,"tile"),mp(this.bufferSync(e),r)},t.prototype.pad=function(e,r,a){Z(e,"pad");var o=r.map(function(f,d){return f[0]+e.shape[d]+f[1]}),i=r.map(function(f){return f[0]}),s=this.bufferSync(e),u=Ne(o,e.dtype);a!==0&&u.values.fill(a);for(var l=0;l<e.size;l++){var c=s.indexToLoc(l),p=c.map(function(f,d){return f+i[d]});u.set.apply(u,[s.get.apply(s,c)].concat(p))}return u.toTensor()},t.prototype.transpose=function(e,r){Z(e,"transpose");for(var a=new Array(e.rank),o=0;o<a.length;o++)a[o]=e.shape[r[o]];var i=this.readSync(e.dataId),s=Ne(a,e.dtype),u=this.bufferSync(e);for(o=0;o<e.size;++o){for(var l=u.indexToLoc(o),c=new Array(l.length),p=0;p<c.length;p++)c[p]=l[r[p]];var f=s.locToIndex(c);s.values[f]=i[o]}return s.toTensor()},t.prototype.gather=function(e,r,a){Z([e,r],"gather");var o=e.shape.slice(),i=this.readSync(r.dataId);o[a]=i.length;for(var s=Ne(o,e.dtype),u=this.bufferSync(e),l=0;l<s.size;++l){var c=s.indexToLoc(l),p=c.slice();p[a]=i[c[a]];var f=u.locToIndex(p);s.values[l]=u.values[f]}return s.toTensor()},t.prototype.batchToSpaceND=function(e,r,a){Z([e],"batchToSpaceND");var o=r.reduce(function(p,f){return p*f}),i=vi(e.shape,r,o),s=mi(i.length,r.length),u=gi(e.shape,r,o),l=rp(a,r.length),c=ap(u,a,r.length);return e.reshape(i).transpose(s).reshape(u).slice(l,c)},t.prototype.spaceToBatchND=function(e,r,a){Z([e],"spaceToBatchND");var o=r.reduce(function(f,d){return f*d}),i=[[0,0]];i.push.apply(i,a);for(var s=1+r.length;s<e.shape.length;++s)i.push([0,0]);var u=e.pad(i),l=vi(u.shape,r,o,!1),c=mi(l.length,r.length,!1),p=gi(u.shape,r,o,!1);return u.reshape(l).transpose(c).reshape(p)},t.prototype.pool=function(e,r,a){Z(e,"pool");for(var o=r.strideHeight,i=r.strideWidth,s=r.dilationHeight,u=r.dilationWidth,l=r.effectiveFilterHeight,c=r.effectiveFilterWidth,p=r.padInfo.top,f=r.padInfo.left,d=a==="max"?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,h=this.readSync(e.dataId),v=Ne(r.outShape,e.dtype),g=v.values,m=r.outShape[1]*r.outShape[2]*r.outShape[3],x=r.outShape[2]*r.outShape[3],y=r.outShape[3],w=0;w<r.batchSize;++w)for(var E=w*m,D=w*e.strides[0],k=0;k<r.inChannels;++k)for(var S=0;S<r.outHeight;++S)for(var _=S*o-p,b=Math.max(0,_),N=Math.min(r.inHeight,l+_),T=E+S*x,P=0;P<r.outWidth;++P){for(var F=P*i-f,M=Math.max(0,F),L=Math.min(r.inWidth,c+F),A=d,$=0,q=0,z=b;z<N;z+=s){for(var K=D+z*e.strides[1],re=M;re<L;re+=u){var ae=h[K+re*e.strides[2]+k];a==="max"&&ae>A?A=ae:a==="avg"&&($+=ae,q++)}if(isNaN(A))break}g[T+P*y+k]=a==="avg"?$/q:A}return v.toTensor()},t.prototype.maxPool=function(e,r){return this.pool(e,r,"max")},t.prototype.maxPoolPositions=function(e,r){for(var a=Ne(r.outShape,"int32"),o=r.strideHeight,i=r.strideWidth,s=r.dilationHeight,u=r.dilationWidth,l=r.effectiveFilterHeight,c=r.effectiveFilterWidth,p=r.padInfo.top,f=r.padInfo.left,d=this.bufferSync(e),h=0;h<r.batchSize;++h)for(var v=0;v<r.inChannels;++v)for(var g=0;g<r.outHeight;++g){for(var m=g*o-p,x=m;x<0;)x+=s;for(var y=Math.min(r.inHeight,l+m),w=0;w<r.outWidth;++w){for(var E=w*i-f,D=E;D<0;)D+=u;for(var k=Math.min(r.inWidth,c+E),S=Number.NEGATIVE_INFINITY,_=-1,b=x;b<y;b+=s)for(var N=b-m,T=D;T<k;T+=u){var P=T-E,F=d.get(h,b,T,v);F>S&&(S=F,_=N*c+P)}a.set(_,h,g,w,v)}}return a.toTensor()},t.prototype.maxPoolBackprop=function(e,r,a,o){Z([r,a],"maxPoolBackprop");for(var i=this.maxPoolPositions(r,o),s=o.strideHeight,u=o.strideWidth,l=o.dilationHeight,c=o.dilationWidth,p=o.effectiveFilterHeight,f=o.effectiveFilterWidth,d=f-1-o.padInfo.left,h=p-1-o.padInfo.top,v=Ne(r.shape,"float32"),g=this.bufferSync(i),m=this.bufferSync(e),x=0;x<o.batchSize;++x)for(var y=0;y<o.inChannels;++y)for(var w=0;w<o.inHeight;++w)for(var E=0;E<o.inWidth;++E){for(var D=w-h,k=E-d,S=0,_=0;_<p;_+=l){var b=(D+_)/s;if(!(b<0||b>=o.outHeight||Math.floor(b)!==b))for(var N=0;N<f;N+=c){var T=(k+N)/u;if(!(T<0||T>=o.outWidth||Math.floor(T)!==T)){var P=p*f-1-g.get(x,b,T,y)===_*f+N?1:0;P!==0&&(S+=m.get(x,b,T,y)*P)}}}v.set(S,x,w,E,y)}return v.toTensor()},t.prototype.avgPoolBackprop=function(e,r,a){Z([e,r],"avgPoolBackprop");for(var o=a.strideHeight,i=a.strideWidth,s=a.filterHeight,u=a.filterWidth,l=a.dilationHeight,c=a.dilationWidth,p=a.effectiveFilterHeight,f=a.effectiveFilterWidth,d=f-1-a.padInfo.left,h=p-1-a.padInfo.top,v=Ne(r.shape,"float32"),g=1/(s*u),m=this.bufferSync(e),x=0;x<a.batchSize;++x)for(var y=0;y<a.inChannels;++y)for(var w=0;w<a.inHeight;++w)for(var E=0;E<a.inWidth;++E){for(var D=w-h,k=E-d,S=0,_=0;_<p;_+=l){var b=(D+_)/o;if(!(b<0||b>=a.outHeight||Math.floor(b)!==b))for(var N=0;N<f;N+=c){var T=(k+N)/i;T<0||T>=a.outWidth||Math.floor(T)!==T||(S+=m.get(x,b,T,y))}}v.set(S*g,x,w,E,y)}return v.toTensor()},t.prototype.pool3d=function(e,r,a){Z(e,"pool3d");for(var o=r.strideDepth,i=r.strideHeight,s=r.strideWidth,u=r.dilationDepth,l=r.dilationHeight,c=r.dilationWidth,p=r.effectiveFilterDepth,f=r.effectiveFilterHeight,d=r.effectiveFilterWidth,h=r.padInfo.front,v=r.padInfo.top,g=r.padInfo.left,m=a==="max"?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,x=this.readSync(e.dataId),y=Ne(r.outShape,e.dtype),w=y.values,E=r.outShape[1]*r.outShape[2]*r.outShape[3]*r.outShape[4],D=r.outShape[2]*r.outShape[3]*r.outShape[4],k=r.outShape[3]*r.outShape[4],S=r.outShape[4],_=0;_<r.batchSize;++_)for(var b=_*E,N=_*e.strides[0],T=0;T<r.inChannels;++T)for(var P=0;P<r.outDepth;++P){for(var F=P*o-h,M=F;M<0;)M+=u;for(var L=Math.min(r.inDepth,p+F),A=b+P*D,$=0;$<r.outHeight;++$){for(var q=$*i-v,z=q;z<0;)z+=l;for(var K=Math.min(r.inHeight,f+q),re=A+$*k,ae=0;ae<r.outWidth;++ae){for(var Se=ae*s-g,Ce=Se;Ce<0;)Ce+=c;for(var Pe=Math.min(r.inWidth,d+Se),Me=re+ae*S,ie=m,ee=0,ue=0,Ie=M;Ie<L;Ie+=u){for(var $e=N+Ie*e.strides[1],ze=z;ze<K;ze+=l){for(var Qe=$e+ze*e.strides[2],Xe=Ce;Xe<Pe;Xe+=c){var Ze=x[Qe+Xe*e.strides[3]+T];if(a==="max"&&Ze>ie?ie=Ze:a==="avg"&&(ee+=Ze,ue++),isNaN(ie))break}if(isNaN(ie))break}if(isNaN(ie))break}w[Me+T]=a==="avg"?ee/ue:ie}}}return y.toTensor()},t.prototype.avgPool3d=function(e,r){return Z(e,"avgPool3d"),this.pool3d(e,r,"avg").toFloat()},t.prototype.avgPool3dBackprop=function(e,r,a){Z([e,r],"avgPool3dBackprop");for(var o=a.strideDepth,i=a.strideHeight,s=a.strideWidth,u=a.filterDepth,l=a.filterHeight,c=a.filterWidth,p=a.dilationDepth,f=a.dilationHeight,d=a.dilationWidth,h=a.effectiveFilterDepth,v=a.effectiveFilterHeight,g=a.effectiveFilterWidth,m=h-1-a.padInfo.front,x=g-1-a.padInfo.left,y=v-1-a.padInfo.top,w=Ne(r.shape,"float32"),E=1/(u*l*c),D=this.bufferSync(e),k=0;k<a.batchSize;++k)for(var S=0;S<a.inChannels;++S)for(var _=0;_<a.inDepth;++_)for(var b=0;b<a.inHeight;++b)for(var N=0;N<a.inWidth;++N){for(var T=_-m,P=b-y,F=N-x,M=0,L=0;L<h;L+=p){var A=(T+L)/o;if(!(A<0||A>=a.outDepth||Math.floor(A)!==A))for(var $=0;$<v;$+=f){var q=(P+$)/i;if(!(q<0||q>=a.outHeight||Math.floor(q)!==q))for(var z=0;z<g;z+=d){var K=(F+z)/s;K<0||K>=a.outWidth||Math.floor(K)!==K||(M+=D.get(k,A,q,K,S))}}}w.set(M*E,k,_,b,N,S)}return w.toTensor()},t.prototype.maxPool3d=function(e,r){return Z(e,"maxPool3d"),this.pool3d(e,r,"max").toFloat()},t.prototype.maxPool3dPositions=function(e,r){for(var a=Ne(r.outShape,"int32"),o=r.strideDepth,i=r.strideHeight,s=r.strideWidth,u=r.dilationDepth,l=r.dilationHeight,c=r.dilationWidth,p=r.effectiveFilterDepth,f=r.effectiveFilterHeight,d=r.effectiveFilterWidth,h=r.padInfo.front,v=r.padInfo.top,g=r.padInfo.left,m=this.bufferSync(e),x=0;x<r.batchSize;++x)for(var y=0;y<r.inChannels;++y)for(var w=0;w<r.outDepth;++w){for(var E=w*o-h,D=E;D<0;)D+=u;for(var k=Math.min(r.inDepth,p+E),S=0;S<r.outHeight;++S){for(var _=S*i-v,b=_;b<0;)b+=l;for(var N=Math.min(r.inHeight,f+_),T=0;T<r.outWidth;++T){for(var P=T*s-g,F=P;F<0;)F+=c;for(var M=Math.min(r.inWidth,d+P),L=Number.NEGATIVE_INFINITY,A=-1,$=D;$<k;$+=u)for(var q=$-E,z=b;z<N;z+=l)for(var K=z-_,re=F;re<M;re+=c){var ae=re-P,Se=m.get(x,$,z,re,y);Se>=L&&(L=Se,A=q*f*d+K*f+ae)}a.set(A,x,w,S,T,y)}}}return a.toTensor()},t.prototype.maxPool3dBackprop=function(e,r,a,o){Z([r,a],"maxPool3dBackprop");for(var i=this.maxPool3dPositions(r,o),s=o.strideDepth,u=o.strideHeight,l=o.strideWidth,c=o.dilationDepth,p=o.dilationHeight,f=o.dilationWidth,d=o.effectiveFilterDepth,h=o.effectiveFilterHeight,v=o.effectiveFilterWidth,g=d-1-o.padInfo.front,m=v-1-o.padInfo.left,x=h-1-o.padInfo.top,y=Ne(r.shape,"float32"),w=this.bufferSync(i),E=this.bufferSync(e),D=0;D<o.batchSize;++D)for(var k=0;k<o.inChannels;++k)for(var S=0;S<o.inDepth;++S)for(var _=0;_<o.inHeight;++_)for(var b=0;b<o.inWidth;++b){for(var N=S-g,T=_-x,P=b-m,F=0,M=0;M<d;M+=c){var L=(N+M)/s;if(!(L<0||L>=o.outDepth||Math.floor(L)!==L))for(var A=0;A<h;A+=p){var $=(T+A)/u;if(!($<0||$>=o.outHeight||Math.floor($)!==$))for(var q=0;q<v;q+=f){var z=(P+q)/l;if(!(z<0||z>=o.outWidth||Math.floor(z)!==z)){var K=d*h*v-1-w.get(D,L,$,z,k)===M*h*v+A*v+q?1:0;K!==0&&(F+=E.get(D,L,$,z,k)*K)}}}}y.set(F,D,S,_,b,k)}return y.toTensor()},t.prototype.cast=function(e,r){return pp(e,r,this)},t.prototype.reshape=function(e,r){return uu(e,r)},t.prototype.avgPool=function(e,r){return Z(e,"avgPool"),this.pool(e,r,"avg").toFloat()},t.prototype.resizeBilinear=function(e,r,a,o){Z(e,"resizeBilinear");for(var i=e.shape,s=i[0],u=i[1],l=i[2],c=i[3],p=this.readSync(e.dataId),f=new Float32Array(ge([s,r,a,c])),d=[o&&r>1?u-1:u,o&&a>1?l-1:l],h=[o&&r>1?r-1:r,o&&a>1?a-1:a],v=0,g=d[0]/h[0],m=d[1]/h[1],x=0;x<s;x++)for(var y=0;y<r;y++)for(var w=g*y,E=Math.floor(w),D=w-E,k=Math.min(u-1,Math.ceil(w)),S=x*e.strides[0]+E*e.strides[1],_=x*e.strides[0]+k*e.strides[1],b=0;b<a;b++)for(var N=m*b,T=Math.floor(N),P=N-T,F=Math.min(l-1,Math.ceil(N)),M=S+T*e.strides[2],L=_+T*e.strides[2],A=S+F*e.strides[2],$=_+F*e.strides[2],q=0;q<c;q++){var z=p[M+q],K=p[L+q],re=z+(p[A+q]-z)*P,ae=re+(K+(p[$+q]-K)*P-re)*D;f[v++]=ae}return Ot(f,[s,r,a,c])},t.prototype.resizeBilinearBackprop=function(e,r,a){Z([e,r],"resizeBilinearBackprop");for(var o=r.shape,i=o[0],s=o[1],u=o[2],l=o[3],c=e.shape,p=c[1],f=c[2],d=new Float32Array(i*s*u*l),h=[a&&p>1?s-1:s,a&&f>1?u-1:u],v=[a&&p>1?p-1:p,a&&f>1?f-1:f],g=h[0]/v[0],m=h[1]/v[1],x=this.readSync(e.dataId),y=0,w=0;w<i;w++)for(var E=w*r.strides[0],D=0;D<p;D++)for(var k=D*g,S=Math.floor(k),_=Math.min(Math.ceil(k),s-1),b=E+S*r.strides[1],N=E+_*r.strides[1],T=k-S,P=1-T,F=0;F<f;F++)for(var M=F*m,L=Math.floor(M),A=Math.min(Math.ceil(M),u-1),$=M-L,q=1-$,z=b+L*r.strides[2],K=b+A*r.strides[2],re=N+L*r.strides[2],ae=N+A*r.strides[2],Se=P*q,Ce=P*$,Pe=T*q,Me=T*$,ie=0;ie<l;ie++){var ee=x[y++];d[z+ie]+=ee*Se,d[K+ie]+=ee*Ce,d[re+ie]+=ee*Pe,d[ae+ie]+=ee*Me}return en(d,[i,u,s,l],r.dtype)},t.prototype.resizeNearestNeighbor=function(e,r,a,o){Z(e,"resizeNearestNeighbor");for(var i=e.shape,s=i[0],u=i[1],l=i[2],c=i[3],p=this.readSync(e.dataId),f=new Float32Array(s*r*a*c),d=[o&&r>1?u-1:u,o&&a>1?l-1:l],h=[o&&r>1?r-1:r,o&&a>1?a-1:a],v=d[0]/h[0],g=d[1]/h[1],m=0,x=0;x<s;x++)for(var y=x*e.strides[0],w=0;w<r;w++)for(var E=v*w,D=y+Math.min(u-1,o?Math.round(E):Math.floor(E))*e.strides[1],k=0;k<a;k++)for(var S=g*k,_=D+Math.min(l-1,o?Math.round(S):Math.floor(S))*e.strides[2],b=0;b<c;b++){var N=p[_+b];f[m++]=N}return Ot(f,[s,r,a,c],e.dtype)},t.prototype.resizeNearestNeighborBackprop=function(e,r,a){Z([e,r],"resizeNearestNeighborBackprop");for(var o=r.shape,i=o[0],s=o[1],u=o[2],l=o[3],c=e.shape,p=c[1],f=c[2],d=new Float32Array(i*s*u*l),h=this.readSync(e.dataId),v=[a&&p>1?s-1:s,a&&f>1?u-1:u],g=[a&&p>1?p-1:p,a&&f>1?f-1:f],m=v[0]/g[0],x=v[1]/g[1],y=1/m,w=1/x,E=2*Math.ceil(y)+2,D=2*Math.ceil(w)+2,k=0;k<i;k++)for(var S=k*r.strides[0],_=0;_<s;_++)for(var b=S+_*r.strides[1],N=Math.floor(_*y),T=Math.floor(N-E/2),P=0;P<u;P++)for(var F=b+P*r.strides[2],M=Math.floor(P*w),L=Math.floor(M-D/2),A=0;A<l;A++){for(var $=0,q=0;q<E;q++){var z=q+T;if(!(z<0||z>=p)){var K=S+z*e.strides[1],re=z*m;if(_===Math.min(s-1,a?Math.round(re):Math.floor(re)))for(var ae=0;ae<D;ae++){var Se=ae+L;if(!(Se<0||Se>=f)){var Ce=K+Se*e.strides[2],Pe=Se*x;P===Math.min(u-1,a?Math.round(Pe):Math.floor(Pe))&&($+=h[Ce+A])}}}}d[F+A]=$}return en(d,r.shape,r.dtype)},t.prototype.batchNormalization=function(e,r,a,o,i,s){Z([e,r,a,i,s],"batchNorm");for(var u=this.readSync(e.dataId),l=this.readSync(r.dataId),c=this.readSync(a.dataId),p=i?this.readSync(i.dataId):new Float32Array([1]),f=s?this.readSync(s.dataId):new Float32Array([0]),d=new Float32Array(u.length),h=f.length,v=p.length,g=c.length,m=l.length,x=0,y=0,w=0,E=0,D=0;D<u.length;++D)d[D]=f[x++]+(u[D]-l[y++])*p[w++]/Math.sqrt(c[E++]+o),x>=h&&(x=0),y>=m&&(y=0),w>=v&&(w=0),E>=g&&(E=0);return en(d,e.shape)},t.prototype.localResponseNormalization4D=function(e,r,a,o,i){Z(e,"localResponseNormalization4D");var s=e.shape[3],u=s-1,l=this.readSync(e.dataId),c=e.size,p=new Float32Array(c);function f(g){for(var m=g%s,x=g-m+Math.max(0,m-r),y=g-m+Math.min(m+r,u),w=0;x<=y;x++){var E=l[x];w+=E*E}return w}for(var d=0;d<c;d++){var h=f(d),v=l[d]*Math.pow(a+o*h,-i);p[d]=v}return en(p,e.shape)},t.prototype.LRNGrad=function(e,r,a,o,i,s,u){Z(e,"LRNGrad");for(var l=e.shape[3],c=this.readSync(e.dataId),p=this.readSync(r.dataId),f=this.readSync(a.dataId),d=new Float32Array(e.size),h=e.size,v=0;v<h;v++){for(var g=v%l,m=v-g+Math.max(0,g-o),x=v-g+Math.min(l,g+o+1),y=0,w=m;w<x;w++)y+=Math.pow(p[w],2);for(y=s*y+i,w=m;w<x;w++){var E=-2*s*u*p[w]*f[v]/y;v===w&&(E+=Math.pow(y,-u)),E*=c[v],d[w]+=E}}return en(d,e.shape)},t.prototype.multinomial=function(e,r,a,o){Z(e,"multinomial");for(var i=r?e:fr(e),s=i.shape[0],u=i.shape[1],l=et([s,a],"int32"),c=this.readSync(l.dataId),p=this.readSync(i.dataId),f=0;f<s;++f){var d=f*u,h=new Float32Array(u-1);h[0]=p[d];for(var v=1;v<h.length;++v)h[v]=h[v-1]+p[d+v];for(var g=Ui(o.toString()),m=f*a,x=0;x<a;++x){var y=g();c[m+x]=h.length;for(var w=0;w<h.length;w++)if(y<h[w]){c[m+x]=w;break}}}return l},t.prototype.oneHot=function(e,r,a,o){Z(e,"oneHot");var i=new Float32Array(e.size*r);i.fill(o);for(var s=this.readSync(e.dataId),u=0;u<e.size;++u)s[u]>=0&&s[u]<r&&(i[u*r+s[u]]=a);return Nr(i,[e.size,r],"int32")},t.prototype.nonMaxSuppression=function(e,r,a,o,i){return Z(e,"nonMaxSuppression"),Mu(this.readSync(e.dataId),this.readSync(r.dataId),a,o,i)},t.prototype.fft=function(e){return this.fftBatch(e,!1)},t.prototype.ifft=function(e){return this.fftBatch(e,!0)},t.prototype.fftBatch=function(e,r){for(var a=e.shape[0],o=e.shape[1],i=Ne(e.shape,"float32"),s=Ne(e.shape,"float32"),u=_n(e).as2D(a,o),l=zn(e).as2D(a,o),c=0;c<a;c++)for(var p=u.slice([c,0],[1,o]),f=l.slice([c,0],[1,o]),d=At(p,f),h=this.readSync(this.fftImpl(d,r).dataId),v=0;v<o;v++){var g=xc(h,v);i.values[c*o+v]=g.real,s.values[c*o+v]=g.imag}return At(i.toTensor(),s.toTensor()).as2D(a,o)},t.prototype.fftImpl=function(e,r){var a=e.as1D(),o=a.size;if(this.isExponentOf2(o)){var i=this.fftRadix2(a,o,r).as2D(e.shape[0],e.shape[1]);return r&&(i=At(_n(i).div(ce(o)),zn(i).div(ce(o)))),i}var s=this.readSync(e.dataId),u=function(l){for(var c=new Float32Array(l.length/2),p=new Float32Array(l.length/2),f=0;f<l.length;f+=2)c[f/2]=l[f],p[f/2]=l[f+1];return{real:c,imag:p}}(this.fourierTransformByMatmul(s,o,r));return At(u.real,u.imag).as2D(e.shape[0],e.shape[1])},t.prototype.isExponentOf2=function(e){return(e&e-1)==0},t.prototype.fftRadix2=function(e,r,a){if(r===1)return e;var o=this.readSync(e.dataId),i=r/2,s=function(m){for(var x=Math.ceil(m.length/4),y=new Float32Array(x),w=new Float32Array(x),E=0;E<m.length;E+=4)y[Math.floor(E/4)]=m[E],w[Math.floor(E/4)]=m[E+1];return{real:y,imag:w}}(o),u=At(s.real,s.imag).as1D(),l=function(m){for(var x=Math.floor(m.length/4),y=new Float32Array(x),w=new Float32Array(x),E=2;E<m.length;E+=4)y[Math.floor(E/4)]=m[E],w[Math.floor(E/4)]=m[E+1];return{real:y,imag:w}}(o),c=At(l.real,l.imag).as1D();u=this.fftRadix2(u,i,a),c=this.fftRadix2(c,i,a);var p=function(m,x){for(var y=new Float32Array(m/2),w=new Float32Array(m/2),E=0;E<Math.ceil(m/2);E++){var D=(x?2:-2)*Math.PI*(E/m);y[E]=Math.cos(D),w[E]=Math.sin(D)}return{real:y,imag:w}}(r,a),f=At(p.real,p.imag).mul(c),d=u.add(f),h=u.sub(f),v=_n(d).concat(_n(h)),g=zn(d).concat(zn(h));return At(v,g).as1D()},t.prototype.fourierTransformByMatmul=function(e,r,a){for(var o=new Float32Array(2*r),i=0;i<r;i++){for(var s=0,u=0,l=0;l<r;l++){var c=Yx(i*l,r,a),p=xc(e,l);s+=p.real*c.real-p.imag*c.imag,u+=p.real*c.imag+p.imag*c.real}a&&(s/=r,u/=r),Xx(o,s,u,i)}return o},t.prototype.depthToSpace=function(e,r,a){V(a==="NHWC",function(){return"Only NHWC dataFormat supported on CPU for depthToSpace. Got "+a}),V(r>1,function(){return"blockSize should be > 1 for depthToSpace, but was: "+r});for(var o=e.shape[0],i=e.shape[1],s=e.shape[2],u=e.shape[3],l=i*r,c=s*r,p=u/(r*r),f=this.readSync(e.dataId),d=new Float32Array(o*l*c*p),h=0,v=0;v<o;++v)for(var g=0;g<l;++g)for(var m=Math.floor(g/r),x=g%r,y=0;y<c;++y)for(var w=Math.floor(y/r),E=(x*r+y%r)*p,D=0;D<p;++D){var k=D+E+u*(w+s*(m+i*v));d[h++]=f[k]}return en(d,[o,l,c,p])},t.prototype.broadcastedBinaryOp=function(e,r,a,o){var i=Le(e.shape,r.shape),s=Ne(i,a),u=this.readSync(e.dataId),l=this.readSync(r.dataId),c=Ir(e.shape,i),p=Ir(r.shape,i),f=s.values;if(c.length+p.length===0)for(var d=0;d<f.length;++d)f[d]=o(u[d%u.length],l[d%l.length]);else{var h=this.bufferSync(e),v=this.bufferSync(r),g=function(m){var x=s.indexToLoc(m),y=x.slice(-e.rank);c.forEach(function(k){return y[k]=0});var w=h.locToIndex(y),E=x.slice(-r.rank);p.forEach(function(k){return E[k]=0});var D=v.locToIndex(E);f[m]=o(u[w],l[D])};for(d=0;d<f.length;++d)g(d)}return s.toTensor()},t.prototype.broadcastedBinaryComplexOp=function(e,r,a){var o=Le(e.shape,r.shape),i=Ne(o,"float32"),s=Ne(o,"float32"),u=this.readSync(e.dataId),l=this.readSync(r.dataId),c=Ir(e.shape,o),p=Ir(r.shape,o),f=i.values,d=s.values;if(c.length+p.length===0)for(var h=0;h<f.length;h++){var v=h%u.length,g=h%l.length,m=a(u[2*v],u[2*v+1],l[2*g],l[2*g+1]);f[h]=m.real,d[h]=m.imag}else{var x=this.bufferSync(this.data.get(e.dataId).complexTensors.real),y=this.bufferSync(this.data.get(r.dataId).complexTensors.real),w=function(E){var D=i.indexToLoc(E),k=D.slice(-e.rank);c.forEach(function(T){return k[T]=0});var S=x.locToIndex(k),_=D.slice(-r.rank);p.forEach(function(T){return _[T]=0});var b=y.locToIndex(_),N=a(u[2*S],u[2*S+1],l[2*b],l[2*b+1]);f[E]=N.real,d[E]=N.imag};for(h=0;h<f.length;h++)w(h)}return this.complex(i.toTensor(),s.toTensor())},t.prototype.split=function(e,r,a){return vp(e,r,a)},t.prototype.dispose=function(){},t.prototype.floatPrecision=function(){return 32},t.prototype.epsilon=function(){return 1e-7},t.prototype.cropAndResize=function(e,r,a,o,i,s){for(var u=e.shape,l=u[0],c=u[1],p=u[2],f=u[3],d=r.shape[0],h=o[0],v=o[1],g=Ne([d,h,v,f],"float32"),m=this.readSync(r.dataId),x=this.readSync(a.dataId),y=this.readSync(e.dataId),w=e.strides,E=g.strides,D=0;D<d;D++){var k=4*D,S=m[k],_=m[k+1],b=m[k+2],N=m[k+3],T=x[D];if(!(T>=l))for(var P=h>1?(b-S)*(c-1)/(h-1):0,F=v>1?(N-_)*(p-1)/(v-1):0,M=0;M<h;M++){var L=h>1?S*(c-1)+M*P:.5*(S+b)*(c-1);if(L<0||L>c-1)for(var A=0;A<v;A++)for(var $=0;$<f;$++){var q=$+A*E[2]+M*E[1]+D*E[0];g.values[q]=s}else if(i==="bilinear"){var z=Math.floor(L),K=Math.ceil(L),re=L-z;for(A=0;A<v;A++)if((Ie=v>1?_*(p-1)+A*F:.5*(_+N)*(p-1))<0||Ie>p-1)for($=0;$<f;$++)q=$+A*E[2]+M*E[1]+D*E[0],g.values[q]=s;else{var ae=Math.floor(Ie),Se=Math.ceil(Ie),Ce=Ie-ae;for($=0;$<f;$++){var Pe=y[q=$+ae*w[2]+z*w[1]+T*w[0]],Me=y[q=$+Se*w[2]+z*w[1]+T*w[0]],ie=y[q=$+ae*w[2]+K*w[1]+T*w[0]],ee=Pe+(Me-Pe)*Ce,ue=ie+(y[q=$+Se*w[2]+K*w[1]+T*w[0]]-ie)*Ce;q=$+A*E[2]+M*E[1]+D*E[0],g.values[q]=ee+(ue-ee)*re}}}else for(A=0;A<v;++A){var Ie;if((Ie=v>1?_*(p-1)+A*F:.5*(_+N)*(p-1))<0||Ie>p-1)for($=0;$<f;$++)q=$+A*E[2]+M*E[1]+D*E[0],g.values[q]=s;else{var $e=Math.round(Ie),ze=Math.round(L);for($=0;$<f;$++){var Qe=$+$e*w[2]+ze*w[1]+T*w[0],Xe=$+A*E[2]+M*E[1]+D*E[0];g.values[Xe]=y[Qe]}}}}}return g.toTensor()},t.prototype.sparseToDense=function(e,r,a,o){var i=yi(0,e,a),s=i.sliceRank,u=i.numUpdates,l=i.sliceSize,c=i.strides,p=i.outputSize;return this.scatter(e,r,a,p,l,u,s,c,o,!1)},t.prototype.gatherND=function(e,r){var a=r.shape,o=a[a.length-1],i=op(e,r),s=i[0],u=i[1],l=i[2],c=i[3];if(u===0)return Ot([],s,e.dtype);for(var p=new oo([u,l],e.dtype),f=this.readSync(r.dataId),d=this.readSync(e.dataId),h=0;h<u;h++){for(var v=[],g=0,m=0;m<o;m++){var x=f[h*o+m];g+=x*c[m],v.push(x)}if(g<0||g>=e.size/l)throw new Error("Invalid indices: "+v+" does not index into "+e.shape);for(var y=0;y<l;y++)p.values[h*l+y]=d[g*l+y]}return p.toTensor().reshape(s)},t.prototype.scatterND=function(e,r,a){var o=yi(0,e,a),i=o.sliceRank,s=o.numUpdates,u=o.sliceSize,l=o.strides,c=o.outputSize,p=ce(0);return this.scatter(e,r,a,c,u,s,i,l,p,!0)},t.prototype.fill=function(e,r,a){var o=ui(a=a||xo(r),ge(e));return o.fill(r),W.makeTensor(o,e,a,this)},t.prototype.onesLike=function(e){if(e.dtype==="string")throw new Error("onesLike is not supported for string tensors");return this.fill(e.shape,1,e.dtype)},t.prototype.zerosLike=function(e){var r=ui(e.dtype,ge(e.shape));return this.makeOutput(r,e.shape,e.dtype)},t.prototype.linspace=function(e,r,a){return fp(e,r,a)},t.prototype.scatter=function(e,r,a,o,i,s,u,l,c,p){var f=[o/i,i],d=this.readSync(e.dataId),h=this.readSync(r.dataId);if(o===0)return Ot([],a,r.dtype);var v=new oo(f,r.dtype);v.values.fill(this.readSync(c.dataId)[0]);for(var g=0;g<s;g++){for(var m=[],x=0,y=0;y<u;y++){var w=d[g*u+y];m.push(w),x+=w*l[y]}if(x<0||x>=o/i)throw new Error("Invalid indices: "+m+" does not index into "+a);for(var E=0;E<i;E++)p?v.values[x*i+E]+=h[g*i+E]:v.values[x*i+E]=r.rank===0?h[0]:h[g*i+E]}return v.toTensor().reshape(a)},t}(cp);W.registerBackend("cpu",function(){return new vw},1);for(var Vs=0,Wc=[{kernelName:"NonMaxSuppressionV5",backendName:"cpu",kernelFunc:function(n){var t=n.inputs,e=n.backend,r=n.attrs,a=t,o=a.boxes,i=a.scores,s=r,u=s.maxOutputSize,l=s.iouThreshold,c=s.scoreThreshold,p=s.softNmsSigma,f=e;Z(o,"NonMaxSuppressionWithScore");var d=Fu(f.data.get(o.dataId).values,f.data.get(i.dataId).values,u,l,c,p);return[d.selectedIndices,d.selectedScores]}},{kernelName:"Square",backendName:"cpu",kernelFunc:function(n){var t=n.inputs,e=n.backend,r=t.x,a=e;Z(r,"square");for(var o=a.data.get(r.dataId).values,i=new Float32Array(o.length),s=0;s<o.length;++s){var u=o[s];i[s]=u*u}return{dataId:a.write(i,r.shape,r.dtype),shape:r.shape,dtype:r.dtype}}},{kernelName:uo,backendName:"cpu",kernelFunc:function(n){var t=n.inputs,e=n.backend,r=t,a=r.a,o=r.b,i=e;Z([a,o],uo);var s=i.data.get(a.dataId).values,u=i.data.get(o.dataId).values,l=function(f,d,h,v,g,m){var x=Le(f,d),y=x.length,w=Gn(x),E=ao(g,ge(x)),D=f.length,k=d.length,S=Gn(f),_=Gn(d),b=Ir(f,x),N=Ir(d,x);if(b.length+N.length===0)for(var T=0;T<E.length;++T)E[T]=m(h[T%h.length],v[T%v.length]);else{var P=function(F){var M=Cy(F,y,w),L=M.slice(-D);b.forEach(function(z){return L[z]=0});var A=cc(L,D,S),$=M.slice(-k);N.forEach(function(z){return $[z]=0});var q=cc($,k,_);E[F]=m(h[A],v[q])};for(T=0;T<E.length;++T)P(T)}return[E,x]}(a.shape,o.shape,s,u,a.dtype,function(f,d){var h=f-d;return h*h}),c=l[0],p=l[1];return{dataId:i.write(c,p,a.dtype),shape:p,dtype:a.dtype}}}];Vs<Wc.length;Vs++)Ld(Wc[Vs]);var la,mw=function(n){this.variableNames=["A"];var t=qt(),e=n[0],r=n[1];this.outputShape=n,this.userCode=`
      void main() {
        ivec3 coords = getOutputCoords();
        int texR = coords[0];
        int texC = coords[1];
        int depth = coords[2];
        vec2 uv = (vec2(texC, texR) + halfCR) / vec2(`+r+".0, "+e+`.0);

        vec4 values = `+t.texture2D+`(A, uv);
        float value;
        if (depth == 0) {
          value = values.r;
        } else if (depth == 1) {
          value = values.g;
        } else if (depth == 2) {
          value = values.b;
        } else if (depth == 3) {
          value = values.a;
        }

        setOutput(floor(value * 255.0 + 0.5));
      }
    `},gw=function(n){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0;var t=qt(),e=n[0],r=n[1];this.outputShape=n,this.userCode=`
      void main() {
        ivec3 coords = getOutputCoords();
        int texR = coords[0];
        int texC = coords[1];
        int depth = coords[2];

        vec4 result = vec4(0.);

        for(int row=0; row<=1; row++) {
          for(int col=0; col<=1; col++) {
            texC = coords[1] + row;
            depth = coords[2] + col;

            vec2 uv = (vec2(texC, texR) + halfCR) /
                       vec2(`+r+".0, "+e+`.0);
            vec4 values = `+t.texture2D+`(A, uv);
            float value;
            if (depth == 0) {
              value = values.r;
            } else if (depth == 1) {
              value = values.g;
            } else if (depth == 2) {
              value = values.b;
            } else if (depth == 3) {
              value = values.a;
            }

            result[row * 2 + col] = floor(value * 255.0 + 0.5);
          }
        }

        `+t.output+` = result;
      }
    `};for(var Ls=0,qc=[{kernelName:"FromPixels",backendName:"webgl",kernelFunc:function(n){var t=n.inputs,e=n.backend,r=n.attrs,a=t.pixels,o=r.numChannels,i=typeof HTMLVideoElement<"u"&&a instanceof HTMLVideoElement,s=typeof HTMLImageElement<"u"&&a instanceof HTMLImageElement,u=i?[a.videoWidth,a.videoHeight]:[a.width,a.height],l=u[0],c=u[1],p=[c,l],f=[c,l,o];(s||i)&&(la==null&&(la=document.createElement("canvas").getContext("2d")),la.canvas.width=l,la.canvas.height=c,la.drawImage(a,0,0,l,c),a=la.canvas);var d=e.makeTensorInfo(p,"int32");e.texData.get(d.dataId).usage=dn.PIXELS,e.gpgpu.uploadPixelDataToTexture(e.getTexture(d.dataId),a);var h=J().getBool("WEBGL_PACK")?new gw(f):new mw(f),v=e.runWebGLProgram(h,[d],"int32");return e.disposeData(d.dataId),v}},{kernelName:"NonMaxSuppressionV5",backendName:"webgl",kernelFunc:function(n){var t=n.inputs,e=n.backend,r=n.attrs;pi("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");var a=t,o=a.boxes,i=a.scores,s=r,u=s.maxOutputSize,l=s.iouThreshold,c=s.scoreThreshold,p=s.softNmsSigma,f=e,d=Fu(f.readSync(o.dataId),f.readSync(i.dataId),u,l,c,p);return[d.selectedIndices,d.selectedScores]}},{kernelName:"Square",backendName:"webgl",kernelFunc:function(n){var t=n.inputs,e=n.backend,r=t.x,a=e,o=new Oe(r.shape,"return x * x;");return a.runWebGLProgram(o,[r],r.dtype)}},{kernelName:uo,backendName:"webgl",kernelFunc:function(n){var t=n.inputs,e=n.backend,r=t,a=r.a,o=r.b,i=e,s=J().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new rr("return (a - b) * (a - b);",a.shape,o.shape):new ut("return (a - b) * (a - b);",a.shape,o.shape);return i.compileAndRun(s,[a,o])}}];Ls<qc.length;Ls++)Ld(qc[Ls]);for(var Bs=0,zc=[{kernelName:"Square",gradFunc:function(n,t){var e=t[0];return{x:function(){return n.mul(e.toFloat().mul(2))}}}},{kernelName:uo,gradFunc:function(n,t){var e=t[0],r=t[1],a=ce(2);return{a:function(){return $t(n,$t(a,St(e,r)))},b:function(){return $t(n,$t(a,St(r,e)))}}}}];Bs<zc.length;Bs++)hy(zc[Bs]);var yw=function(){function n(){}return n.prototype.fetch=function(t,e){return fetch(t,e)},n.prototype.now=function(){return performance.now()},n.prototype.encode=function(t,e){if(e!=="utf-8"&&e!=="utf8")throw new Error("Browser's encoder only supports utf-8, but got "+e);return this.textEncoder==null&&(this.textEncoder=new TextEncoder),this.textEncoder.encode(t)},n.prototype.decode=function(t,e){return new TextDecoder(e).decode(t)},n}();J().get("IS_BROWSER")&&J().setPlatform("browser",new yw);var Us,xw=function(){return require("node-fetch")},bw=function(){function n(){this.util=require("util"),this.textEncoder=new this.util.TextEncoder}return n.prototype.fetch=function(t,e){return J().global.fetch!=null?J().global.fetch(t,e):(Us==null&&(Us=xw()),Us(t,e))},n.prototype.now=function(){var t=process.hrtime();return 1e3*t[0]+t[1]/1e6},n.prototype.encode=function(t,e){if(e!=="utf-8"&&e!=="utf8")throw new Error("Node built-in encoder only supports utf-8, but got "+e);return this.textEncoder.encode(t)},n.prototype.decode=function(t,e){return t.length===0?"":new this.util.TextDecoder(e).decode(t)},n}();J().get("IS_NODE")&&J().setPlatform("node",new bw);var du={float32:4,int32:4,uint16:2,uint8:1,bool:1},Ci=4;function uf(n,t){for(var e={},r=0,a=function(s){var u=s.name,l=s.dtype,c=s.shape,p=ge(c),f=void 0;if("quantization"in s){var d=s.quantization;if(d.dtype!=="uint8"&&d.dtype!=="uint16")throw new Error("Weight "+s.name+" has unknown quantization dtype "+d.dtype+". Supported quantization dtypes are: 'uint8' and 'uint16'.");var h=du[d.dtype],v=n.slice(r,r+p*h),g=d.dtype==="uint8"?new Uint8Array(v):new Uint16Array(v);if(l==="float32")f=Float32Array.from(g,function(D){return D*d.scale+d.min});else{if(l!=="int32")throw new Error("Unsupported dtype in weight '"+u+"': "+l);f=Int32Array.from(g,function(D){return Math.round(D*d.scale+d.min)})}r+=p*h}else if(l==="string"){var m=ge(s.shape);f=[];for(var x=0;x<m;x++){var y=new Uint32Array(n.slice(r,r+Ci))[0];r+=Ci;var w=new Uint8Array(n.slice(r,r+y));f.push(w),r+=y}}else{var E=du[l];if(v=n.slice(r,r+p*E),l==="float32")f=new Float32Array(v);else if(l==="int32")f=new Int32Array(v);else{if(l!=="bool")throw new Error("Unsupported dtype in weight '"+u+"': "+l);f=new Uint8Array(v)}r+=p*E}e[u]=Ot(f,c,l)},o=0,i=t;o<i.length;o++)a(i[o]);return e}function _w(n){if(n===null)throw new Error("Invalid input value: "+JSON.stringify(n));var t=0,e=[];n.forEach(function(o){if(t+=o.byteLength,e.push(o.byteLength===o.buffer.byteLength?o:new o.constructor(o)),!(o instanceof Float32Array||o instanceof Int32Array||o instanceof Uint8Array))throw new Error("Unsupported TypedArray subtype: "+o.constructor.name)});var r=new Uint8Array(t),a=0;return e.forEach(function(o){r.set(new Uint8Array(o.buffer),a),a+=o.byteLength}),r.buffer}var pu=typeof Buffer<"u"&&(typeof Blob>"u"||typeof atob>"u"||typeof btoa>"u");function $c(n){return pu?Buffer.byteLength(n):new Blob([n]).size}function tl(n){var t=0;n.forEach(function(a){t+=a.byteLength});var e=new Uint8Array(t),r=0;return n.forEach(function(a){e.set(new Uint8Array(a),r),r+=a.byteLength}),e.buffer}function Hc(n){for(n=n.trim();n.endsWith("/");)n=n.slice(0,n.length-1);var t=n.split("/");return t[t.length-1]}function Io(n){if(n.modelTopology instanceof ArrayBuffer)throw new Error("Expected JSON model topology, received ArrayBuffer.");return{dateSaved:new Date,modelTopologyType:"JSON",modelTopologyBytes:n.modelTopology==null?0:$c(JSON.stringify(n.modelTopology)),weightSpecsBytes:n.weightSpecs==null?0:$c(JSON.stringify(n.weightSpecs)),weightDataBytes:n.weightData==null?0:n.weightData.byteLength}}var pn=function(){function n(){this.saveRouters=[],this.loadRouters=[]}return n.getInstance=function(){return n.instance==null&&(n.instance=new n),n.instance},n.registerSaveRouter=function(t){n.getInstance().saveRouters.push(t)},n.registerLoadRouter=function(t){n.getInstance().loadRouters.push(t)},n.getSaveHandlers=function(t){return n.getHandlers(t,"save")},n.getLoadHandlers=function(t,e){return n.getHandlers(t,"load",e)},n.getHandlers=function(t,e,r){var a=[];return(e==="load"?n.getInstance().loadRouters:n.getInstance().saveRouters).forEach(function(o){var i=o(t,r);i!==null&&a.push(i)}),a},n}(),_a="://",Rr=function(){function n(){this.managers={}}return n.getInstance=function(){return n.instance==null&&(n.instance=new n),n.instance},n.registerManager=function(t,e){V(t!=null,function(){return"scheme must not be undefined or null."}),t.endsWith(_a)&&(t=t.slice(0,t.indexOf(_a))),V(t.length>0,function(){return"scheme must not be an empty string."});var r=n.getInstance();V(r.managers[t]==null,function(){return"A model store manager is already registered for scheme '"+t+"'."}),r.managers[t]=e},n.getManager=function(t){var e=this.getInstance().managers[t];if(e==null)throw new Error("Cannot find model manager for scheme '"+t+"'");return e},n.getSchemes=function(){return Object.keys(this.getInstance().managers)},n}();function Zo(n){if(n.indexOf(_a)===-1)throw new Error("The url string provided does not contain a scheme. Supported schemes are: "+Rr.getSchemes().join(","));return{scheme:n.split(_a)[0],path:n.split(_a)[1]}}function Gc(n,t,e){return e===void 0&&(e=!1),he(this,void 0,void 0,function(){var r,a,o,i,s,u,l,c,p;return ve(this,function(f){switch(f.label){case 0:return V(n!==t,function(){return"Old path and new path are the same: '"+n+"'"}),V((r=pn.getLoadHandlers(n)).length>0,function(){return"Copying failed because no load handler is found for source URL "+n+"."}),V(r.length<2,function(){return"Copying failed because more than one ("+r.length+") load handlers for source URL "+n+"."}),a=r[0],V((o=pn.getSaveHandlers(t)).length>0,function(){return"Copying failed because no save handler is found for destination URL "+t+"."}),V(o.length<2,function(){return"Copying failed because more than one ("+r.length+") save handlers for destination URL "+t+"."}),i=o[0],s=Zo(n).scheme,u=Zo(n).path,l=s===Zo(n).scheme,[4,a.load()];case 1:return c=f.sent(),e&&l?[4,Rr.getManager(s).removeModel(u)]:[3,3];case 2:f.sent(),f.label=3;case 3:return[4,i.save(c)];case 4:return p=f.sent(),!e||l?[3,6]:[4,Rr.getManager(s).removeModel(u)];case 5:f.sent(),f.label=6;case 6:return[2,p.modelArtifactsInfo]}})})}var jr="models_store",Dr="model_info_store";function lf(){if(!J().getBool("IS_BROWSER"))throw new Error("Failed to obtain IndexedDB factory because the current environmentis not a web browser.");var n=window||self,t=n.indexedDB||n.mozIndexedDB||n.webkitIndexedDB||n.msIndexedDB||n.shimIndexedDB;if(t==null)throw new Error("The current browser does not appear to support IndexedDB.");return t}function fu(n){var t=n.result;t.createObjectStore(jr,{keyPath:"modelPath"}),t.createObjectStore(Dr,{keyPath:"modelPath"})}var wa=function(){function n(t){if(this.indexedDB=lf(),t==null||!t)throw new Error("For IndexedDB, modelPath must not be null, undefined or empty.");this.modelPath=t}return n.prototype.save=function(t){return he(this,void 0,void 0,function(){return ve(this,function(e){if(t.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");return[2,this.databaseAction(this.modelPath,t)]})})},n.prototype.load=function(){return he(this,void 0,void 0,function(){return ve(this,function(t){return[2,this.databaseAction(this.modelPath)]})})},n.prototype.databaseAction=function(t,e){var r=this;return new Promise(function(a,o){var i=r.indexedDB.open("tensorflowjs",1);i.onupgradeneeded=function(){return fu(i)},i.onsuccess=function(){var s=i.result;if(e==null){var u=s.transaction(jr,"readonly"),l=u.objectStore(jr).get(r.modelPath);l.onsuccess=function(){if(l.result==null)return s.close(),o(new Error("Cannot find model with path '"+r.modelPath+"' in IndexedDB."));a(l.result.modelArtifacts)},l.onerror=function(v){return s.close(),o(l.error)},u.oncomplete=function(){return s.close()}}else{var c,p=Io(e),f=s.transaction(Dr,"readwrite"),d=f.objectStore(Dr),h=d.put({modelPath:r.modelPath,modelArtifactsInfo:p});h.onsuccess=function(){var v=(c=s.transaction(jr,"readwrite")).objectStore(jr).put({modelPath:r.modelPath,modelArtifacts:e,modelArtifactsInfo:p});v.onsuccess=function(){return a({modelArtifactsInfo:p})},v.onerror=function(g){var m=(d=f.objectStore(Dr)).delete(r.modelPath);m.onsuccess=function(){return s.close(),o(v.error)},m.onerror=function(x){return s.close(),o(v.error)}}},h.onerror=function(v){return s.close(),o(h.error)},f.oncomplete=function(){c==null?s.close():c.oncomplete=function(){return s.close()}}}},i.onerror=function(s){return o(i.error)}})},n.URL_SCHEME="indexeddb://",n}(),jc=function(n){return J().getBool("IS_BROWSER")&&!Array.isArray(n)&&n.startsWith(wa.URL_SCHEME)?(t=n.slice(wa.URL_SCHEME.length),new wa(t)):null;var t};pn.registerSaveRouter(jc),pn.registerLoadRouter(jc);var ww=function(){function n(){this.indexedDB=lf()}return n.prototype.listModels=function(){return he(this,void 0,void 0,function(){var t=this;return ve(this,function(e){return[2,new Promise(function(r,a){var o=t.indexedDB.open("tensorflowjs",1);o.onupgradeneeded=function(){return fu(o)},o.onsuccess=function(){var i=o.result,s=i.transaction(Dr,"readonly"),u=s.objectStore(Dr).getAll();u.onsuccess=function(){for(var l={},c=0,p=u.result;c<p.length;c++){var f=p[c];l[f.modelPath]=f.modelArtifactsInfo}r(l)},u.onerror=function(l){return i.close(),a(u.error)},s.oncomplete=function(){return i.close()}},o.onerror=function(i){return a(o.error)}})]})})},n.prototype.removeModel=function(t){return he(this,void 0,void 0,function(){var e=this;return ve(this,function(r){var a;return t=(a=t).startsWith(wa.URL_SCHEME)?a.slice(wa.URL_SCHEME.length):a,[2,new Promise(function(o,i){var s=e.indexedDB.open("tensorflowjs",1);s.onupgradeneeded=function(){return fu(s)},s.onsuccess=function(){var u,l=s.result,c=l.transaction(Dr,"readwrite"),p=c.objectStore(Dr),f=p.get(t);f.onsuccess=function(){if(f.result==null)return l.close(),i(new Error("Cannot find model with path '"+t+"' in IndexedDB."));var d=p.delete(t),h=function(){var v=(u=l.transaction(jr,"readwrite")).objectStore(jr).delete(t);v.onsuccess=function(){return o(f.result.modelArtifactsInfo)},v.onerror=function(g){return i(f.error)}};d.onsuccess=h,d.onerror=function(v){return h(),l.close(),i(f.error)}},f.onerror=function(d){return l.close(),i(f.error)},c.oncomplete=function(){u==null?l.close():u.oncomplete=function(){return l.close()}}},s.onerror=function(u){return i(s.error)}})]})})},n}();if(J().getBool("IS_BROWSER"))try{Rr.registerManager(wa.URL_SCHEME,new ww)}catch{}var ir="/",ma="tensorflowjs_models",cf="info",Ew="model_topology",Sw="weight_specs",Cw="weight_data",Iw="model_metadata";function df(n){return{info:[ma,n,cf].join(ir),topology:[ma,n,Ew].join(ir),weightSpecs:[ma,n,Sw].join(ir),weightData:[ma,n,Cw].join(ir),modelMetadata:[ma,n,Iw].join(ir)}}function Dw(n){var t=n.split(ir);if(t.length<3)throw new Error("Invalid key format: "+n);return t.slice(1,t.length-1).join(ir)}var Ea=function(){function n(t){if(!J().getBool("IS_BROWSER")||typeof window>"u"||window.localStorage===void 0)throw new Error("The current environment does not support local storage.");if(this.LS=window.localStorage,t==null||!t)throw new Error("For local storage, modelPath must not be null, undefined or empty.");this.modelPath=t,this.keys=df(this.modelPath)}return n.prototype.save=function(t){return he(this,void 0,void 0,function(){var e,r,a;return ve(this,function(o){if(t.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");e=JSON.stringify(t.modelTopology),r=JSON.stringify(t.weightSpecs),a=Io(t);try{return this.LS.setItem(this.keys.info,JSON.stringify(a)),this.LS.setItem(this.keys.topology,e),this.LS.setItem(this.keys.weightSpecs,r),this.LS.setItem(this.keys.weightData,function(i){if(pu)return Buffer.from(i).toString("base64");for(var s=new Uint8Array(i),u="",l=0,c=s.length;l<c;l++)u+=String.fromCharCode(s[l]);return btoa(u)}(t.weightData)),this.LS.setItem(this.keys.modelMetadata,JSON.stringify({format:t.format,generatedBy:t.generatedBy,convertedBy:t.convertedBy,userDefinedMetadata:t.userDefinedMetadata})),[2,{modelArtifactsInfo:a}]}catch{throw this.LS.removeItem(this.keys.info),this.LS.removeItem(this.keys.topology),this.LS.removeItem(this.keys.weightSpecs),this.LS.removeItem(this.keys.weightData),this.LS.removeItem(this.keys.modelMetadata),new Error("Failed to save model '"+this.modelPath+"' to local storage: size quota being exceeded is a possible cause of this failure: modelTopologyBytes="+a.modelTopologyBytes+", weightSpecsBytes="+a.weightSpecsBytes+", weightDataBytes="+a.weightDataBytes+".")}return[2]})})},n.prototype.load=function(){return he(this,void 0,void 0,function(){var t,e,r,a,o,i,s;return ve(this,function(u){if((t=JSON.parse(this.LS.getItem(this.keys.info)))==null)throw new Error("In local storage, there is no model with name '"+this.modelPath+"'");if(t.modelTopologyType!=="JSON")throw new Error("BrowserLocalStorage does not support loading non-JSON model topology yet.");if(e={},(r=JSON.parse(this.LS.getItem(this.keys.topology)))==null)throw new Error("In local storage, the topology of model '"+this.modelPath+"' is missing.");if(e.modelTopology=r,(a=JSON.parse(this.LS.getItem(this.keys.weightSpecs)))==null)throw new Error("In local storage, the weight specs of model '"+this.modelPath+"' are missing.");if(e.weightSpecs=a,(o=this.LS.getItem(this.keys.modelMetadata))!=null&&(i=JSON.parse(o),e.format=i.format,e.generatedBy=i.generatedBy,e.convertedBy=i.convertedBy,e.userDefinedMetadata=i.userDefinedMetadata),(s=this.LS.getItem(this.keys.weightData))==null)throw new Error("In local storage, the binary weight values of model '"+this.modelPath+"' are missing.");return e.weightData=function(l){if(pu){var c=Buffer.from(l,"base64");return c.buffer.slice(c.byteOffset,c.byteOffset+c.byteLength)}for(var p=atob(l),f=new Uint8Array(p.length),d=0;d<p.length;++d)f.set([p.charCodeAt(d)],d);return f.buffer}(s),[2,e]})})},n.URL_SCHEME="localstorage://",n}(),Xc=function(n){return J().getBool("IS_BROWSER")&&!Array.isArray(n)&&n.startsWith(Ea.URL_SCHEME)?(t=n.slice(Ea.URL_SCHEME.length),new Ea(t)):null;var t};pn.registerSaveRouter(Xc),pn.registerLoadRouter(Xc);var kw=function(){function n(){V(J().getBool("IS_BROWSER"),function(){return"Current environment is not a web browser"}),V(typeof window>"u"||window.localStorage!==void 0,function(){return"Current browser does not appear to support localStorage"}),this.LS=window.localStorage}return n.prototype.listModels=function(){return he(this,void 0,void 0,function(){var t,e,r,a,o,i;return ve(this,function(s){for(t={},e=ma+ir,r=ir+cf,a=0;a<this.LS.length;++a)(o=this.LS.key(a)).startsWith(e)&&o.endsWith(r)&&(i=Dw(o),t[i]=JSON.parse(this.LS.getItem(o)));return[2,t]})})},n.prototype.removeModel=function(t){return he(this,void 0,void 0,function(){var e,r;return ve(this,function(a){var o;if(t=(o=t).startsWith(Ea.URL_SCHEME)?o.slice(Ea.URL_SCHEME.length):o,e=df(t),this.LS.getItem(e.info)==null)throw new Error("Cannot find model at path '"+t+"'");return r=JSON.parse(this.LS.getItem(e.info)),this.LS.removeItem(e.info),this.LS.removeItem(e.topology),this.LS.removeItem(e.weightSpecs),this.LS.removeItem(e.weightData),[2,r]})})},n}();if(J().getBool("IS_BROWSER"))try{Rr.registerManager(Ea.URL_SCHEME,new kw)}catch{}var Tw="model",Nw=".json",Rw=".weights.bin";function Yc(n){return new Promise(function(t){return setTimeout(t)}).then(n)}var Ws=function(){function n(t){if(!J().getBool("IS_BROWSER"))throw new Error("browserDownloads() cannot proceed because the current environment is not a browser.");t.startsWith(n.URL_SCHEME)&&(t=t.slice(n.URL_SCHEME.length)),t!=null&&t.length!==0||(t=Tw),this.modelTopologyFileName=t+Nw,this.weightDataFileName=t+Rw}return n.prototype.save=function(t){return he(this,void 0,void 0,function(){var e,r,a,o,i,s;return ve(this,function(u){switch(u.label){case 0:if(typeof document>"u")throw new Error("Browser downloads are not supported in this environment since `document` is not present");if(e=window.URL.createObjectURL(new Blob([t.weightData],{type:"application/octet-stream"})),!(t.modelTopology instanceof ArrayBuffer))return[3,1];throw new Error("BrowserDownloads.save() does not support saving model topology in binary formats yet.");case 1:return r=[{paths:["./"+this.weightDataFileName],weights:t.weightSpecs}],a={modelTopology:t.modelTopology,format:t.format,generatedBy:t.generatedBy,convertedBy:t.convertedBy,weightsManifest:r},o=window.URL.createObjectURL(new Blob([JSON.stringify(a)],{type:"application/json"})),(i=this.jsonAnchor==null?document.createElement("a"):this.jsonAnchor).download=this.modelTopologyFileName,i.href=o,[4,Yc(function(){return i.dispatchEvent(new MouseEvent("click"))})];case 2:return u.sent(),t.weightData==null?[3,4]:((s=this.weightDataAnchor==null?document.createElement("a"):this.weightDataAnchor).download=this.weightDataFileName,s.href=e,[4,Yc(function(){return s.dispatchEvent(new MouseEvent("click"))})]);case 3:u.sent(),u.label=4;case 4:return[2,{modelArtifactsInfo:Io(t)}]}})})},n.URL_SCHEME="downloads://",n}(),Aw=function(){function n(t){if(t==null||t.length<1)throw new Error("When calling browserFiles, at least 1 file is required, but received "+t);this.files=t}return n.prototype.load=function(){return he(this,void 0,void 0,function(){var t,e,r=this;return ve(this,function(a){return t=this.files[0],e=this.files.slice(1),[2,new Promise(function(o,i){var s=new FileReader;s.onload=function(u){var l=JSON.parse(u.target.result),c=l.modelTopology;if(c!=null){e.length===0&&o({modelTopology:c});var p=l.weightsManifest;if(p!=null){var f;try{f=r.checkManifestAndWeightFiles(p,e)}catch(g){return void i(g)}var d=[],h=[],v=[];p.forEach(function(g){g.paths.forEach(function(m){h.push(m),v.push(null)}),d.push.apply(d,g.weights)}),p.forEach(function(g){g.paths.forEach(function(m){var x=new FileReader;x.onload=function(y){var w=y.target.result,E=h.indexOf(m);v[E]=w,v.indexOf(null)===-1&&o({modelTopology:c,weightSpecs:d,weightData:tl(v),format:l.format,generatedBy:l.generatedBy,convertedBy:l.convertedBy,userDefinedMetadata:l.userDefinedMetadata})},x.onerror=function(y){return i("Failed to weights data from file of path '"+m+"'.")},x.readAsArrayBuffer(f[m])})})}else i(new Error("weightManifest field is missing from file "+t.name))}else i(new Error("modelTopology field is missing from file "+t.name))},s.onerror=function(u){return i("Failed to read model topology and weights manifest JSON from file '"+t.name+"'. BrowserFiles supports loading Keras-style tf.Model artifacts only.")},s.readAsText(t)})]})})},n.prototype.checkManifestAndWeightFiles=function(t,e){for(var r=[],a=e.map(function(u){return Hc(u.name)}),o={},i=0,s=t;i<s.length;i++)s[i].paths.forEach(function(u){var l=Hc(u);if(r.indexOf(l)!==-1)throw new Error("Duplicate file basename found in weights manifest: '"+l+"'");if(r.push(l),a.indexOf(l)===-1)throw new Error("Weight file with basename '"+l+"' is not provided.");o[u]=e[a.indexOf(l)]});if(r.length!==e.length)throw new Error("Mismatch in the number of files in weights manifest ("+r.length+") and the number of weight files provided ("+e.length+").");return o},n}();function Kc(n,t,e,r){(function(o){V(o!=null&&Array.isArray(o)&&o.length>0,function(){return"promises must be a none empty array"})})(n),function(o,i){V(o>=0&&o<=1,function(){return"Progress fraction must be in range [0, 1], but got startFraction "+o}),V(i>=0&&i<=1,function(){return"Progress fraction must be in range [0, 1], but got endFraction "+i}),V(i>=o,function(){return"startFraction must be no more than endFraction, but got startFraction "+o+" and endFraction "+i})}(e=e??0,r=r??1);var a=0;return Promise.all(n.map(function(o){return o.then(function(i){var s=e+ ++a/n.length*(r-e);return t(s),i}),o}))}function pf(n,t){return he(this,void 0,void 0,function(){var e,r,a,o,i,s,u,l,c;return ve(this,function(p){switch(p.label){case 0:return t==null&&(t={}),e=t.fetchFunc==null?J().platform.fetch:t.fetchFunc,r=n.map(function(f){return e(f,t.requestInit,{isBinary:!0})}),a=0,o=.5,t.onProgress!=null?[3,2]:[4,Promise.all(r)];case 1:return i=p.sent(),[3,4];case 2:return[4,Kc(r,t.onProgress,a,o)];case 3:i=p.sent(),p.label=4;case 4:return s=i.map(function(f){return f.arrayBuffer()}),u=.5,l=1,t.onProgress!=null?[3,6]:[4,Promise.all(s)];case 5:return c=p.sent(),[3,8];case 6:return[4,Kc(s,t.onProgress,u,l)];case 7:c=p.sent(),p.label=8;case 8:return[2,c]}})})}function Jc(n){var t=this;return function(e,r,a){return r===void 0&&(r=""),he(t,void 0,void 0,function(){var o,i,s,u,l,c,p,f,d,h;return ve(this,function(v){switch(v.label){case 0:if(o=e.map(function(){return!1}),i={},s=a!=null?a.map(function(){return!1}):[],u=[],e.forEach(function(g,m){var x=0;g.weights.forEach(function(y){var w="quantization"in y?y.quantization.dtype:y.dtype,E=du[w]*ge(y.shape),D=function(){o[m]=!0,i[m]==null&&(i[m]=[]),i[m].push({manifestEntry:y,groupOffset:x,sizeBytes:E})};a!=null?a.forEach(function(k,S){k===y.name&&(D(),s[S]=!0)}):D(),u.push(y.name),x+=E})}),!s.every(function(g){return g}))throw l=a.filter(function(g,m){return!s[m]}),new Error("Could not find weights in manifest with names: "+l.join(", ")+`. 
Manifest JSON has weights with names: `+u.join(", ")+".");return c=o.reduce(function(g,m,x){return m&&g.push(x),g},[]),p=[],c.forEach(function(g){e[g].paths.forEach(function(m){var x=r+(r.endsWith("/")?"":"/")+m;p.push(x)})}),[4,n(p)];case 1:return f=v.sent(),d={},h=0,c.forEach(function(g){for(var m=e[g].paths.length,x=0,y=0;y<m;y++)x+=f[h+y].byteLength;for(var w=new ArrayBuffer(x),E=new Uint8Array(w),D=0,k=0;k<m;k++){var S=new Uint8Array(f[h+k]);E.set(S,D),D+=S.byteLength}i[g].forEach(function(_){var b=uf(w.slice(_.groupOffset,_.groupOffset+_.sizeBytes),[_.manifestEntry]);for(var N in b)d[N]=b[N]}),h+=m}),[2,d]}})})}}pn.registerSaveRouter(function(n){return J().getBool("IS_BROWSER")&&!Array.isArray(n)&&n.startsWith(Ws.URL_SCHEME)?function(t){return t===void 0&&(t="model"),new Ws(t)}(n.slice(Ws.URL_SCHEME.length)):null});var ff=function(){function n(t,e){if(this.DEFAULT_METHOD="POST",e==null&&(e={}),this.weightPathPrefix=e.weightPathPrefix,this.onProgress=e.onProgress,e.fetchFunc!=null?(V(typeof e.fetchFunc=="function",function(){return"Must pass a function that matches the signature of `fetch` (see https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API)"}),this.fetch=e.fetchFunc):this.fetch=J().platform.fetch,V(t!=null&&t.length>0,function(){return"URL path for http must not be null, undefined or empty."}),Array.isArray(t)&&V(t.length===2,function(){return"URL paths for http must have a length of 2, (actual length is "+t.length+")."}),this.path=t,e.requestInit!=null&&e.requestInit.body!=null)throw new Error("requestInit is expected to have no pre-existing body, but has one.");this.requestInit=e.requestInit||{}}return n.prototype.save=function(t){return he(this,void 0,void 0,function(){var e,r,a,o;return ve(this,function(i){switch(i.label){case 0:if(t.modelTopology instanceof ArrayBuffer)throw new Error("BrowserHTTPRequest.save() does not support saving model topology in binary formats yet.");return(e=Object.assign({method:this.DEFAULT_METHOD},this.requestInit)).body=new FormData,r=[{paths:["./model.weights.bin"],weights:t.weightSpecs}],a={modelTopology:t.modelTopology,format:t.format,generatedBy:t.generatedBy,convertedBy:t.convertedBy,userDefinedMetadata:t.userDefinedMetadata,weightsManifest:r},e.body.append("model.json",new Blob([JSON.stringify(a)],{type:"application/json"}),"model.json"),t.weightData!=null&&e.body.append("model.weights.bin",new Blob([t.weightData],{type:"application/octet-stream"}),"model.weights.bin"),[4,this.fetch(this.path,e)];case 1:if((o=i.sent()).ok)return[2,{modelArtifactsInfo:Io(t),responses:[o]}];throw new Error("BrowserHTTPRequest.save() failed due to HTTP response status "+o.status+".")}})})},n.prototype.load=function(){return he(this,void 0,void 0,function(){var t,e,r,a,o,i,s,u,l,c,p,f;return ve(this,function(d){switch(d.label){case 0:return[4,this.fetch(this.path,this.requestInit)];case 1:if(!(t=d.sent()).ok)throw new Error("Request to "+this.path+" failed with status code "+t.status+". Please verify this URL points to the model JSON of the model to load.");d.label=2;case 2:return d.trys.push([2,4,,5]),[4,t.json()];case 3:return e=d.sent(),[3,5];case 4:throw d.sent(),r="Failed to parse model JSON of response from "+this.path+".",this.path.endsWith(".pb")?r+=" Your path contains a .pb file extension. Support for .pb models have been removed in TensorFlow.js 1.0 in favor of .json models. You can re-convert your Python TensorFlow model using the TensorFlow.js 1.0 conversion scripts or you can convert your.pb models with the 'pb2json'NPM script in the tensorflow/tfjs-converter repository.":r+=" Please make sure the server is serving valid JSON for this request.",new Error(r);case 5:if(a=e.modelTopology,o=e.weightsManifest,i=e.generatedBy,s=e.convertedBy,u=e.format,l=e.userDefinedMetadata,a==null&&o==null)throw new Error("The JSON from HTTP path "+this.path+" contains neither model topology or manifest for weights.");return o==null?[3,7]:[4,this.loadWeights(o)];case 6:f=d.sent(),c=f[0],p=f[1],d.label=7;case 7:return[2,{modelTopology:a,weightSpecs:c,weightData:p,userDefinedMetadata:l,generatedBy:i,convertedBy:s,format:u}]}})})},n.prototype.loadWeights=function(t){return he(this,void 0,void 0,function(){var e,r,a,o,i,s,u,l,c,p,f;return ve(this,function(d){switch(d.label){case 0:for(e=Array.isArray(this.path)?this.path[1]:this.path,r=function(h){var v=h.lastIndexOf("/"),g=h.lastIndexOf("?"),m=h.substring(0,v),x=g>v?h.substring(g):"";return[m+"/",x]}(e),a=r[0],o=r[1],i=this.weightPathPrefix||a,s=[],u=0,l=t;u<l.length;u++)c=l[u],s.push.apply(s,c.weights);return p=[],t.forEach(function(h){h.paths.forEach(function(v){p.push(i+v+o)})}),[4,pf(p,{requestInit:this.requestInit,fetchFunc:this.fetch,onProgress:this.onProgress})];case 1:return f=d.sent(),[2,[s,tl(f)]]}})})},n.URL_SCHEME_REGEX=/^https?:\/\//,n}();function hu(n){return n.match(ff.URL_SCHEME_REGEX)!=null}var Qc=function(n,t){return typeof fetch>"u"?null:(Array.isArray(n)?n.every(function(e){return hu(e)}):hu(n))?vu(n,{onProgress:t}):null};function vu(n,t){return new ff(n,t)}pn.registerSaveRouter(Qc),pn.registerLoadRouter(Qc);var qs=function(){function n(t){this.modelArtifacts=t}return n.prototype.load=function(){return he(this,void 0,void 0,function(){return ve(this,function(t){return[2,this.modelArtifacts]})})},n}(),Pw=function(){function n(t){this.saveHandler=t}return n.prototype.save=function(t){return he(this,void 0,void 0,function(){return ve(this,function(e){return[2,this.saveHandler(t)]})})},n}(),hf=Object.freeze({browserFiles:function(n){return new Aw(n)},browserHTTPRequest:function(n,t){return vu(n,t)},concatenateArrayBuffers:tl,decodeWeights:uf,encodeWeights:function(n,t){return he(this,void 0,void 0,function(){var e,r,a,o,i,s=this;return ve(this,function(u){switch(u.label){case 0:for(e=[],r=[],a=Array.isArray(n)?n.map(function(l){return l.name}):Object.keys(n),o=function(l){var c=a[l],p=Array.isArray(n)?n[l].tensor:n[c];if(p.dtype!=="float32"&&p.dtype!=="int32"&&p.dtype!=="bool"&&p.dtype!=="string")throw new Error("Unsupported dtype in weight '"+c+"': "+p.dtype);var f={name:c,shape:p.shape,dtype:p.dtype};if(p.dtype==="string"){var d=new Promise(function(h){return he(s,void 0,void 0,function(){var v,g,m,x,y,w,E;return ve(this,function(D){switch(D.label){case 0:return[4,p.bytes()];case 1:for(v=D.sent(),g=v.reduce(function(k,S){return k+S.length},0)+Ci*v.length,m=new Uint8Array(g),x=0,y=0;y<v.length;y++)w=v[y],E=new Uint8Array(new Uint32Array([w.length]).buffer),m.set(E,x),x+=Ci,m.set(w,x),x+=w.length;return h(m),[2]}})})});r.push(d)}else r.push(p.data());t!=null&&(f.group=t),e.push(f)},i=0;i<a.length;++i)o(i);return[4,Promise.all(r)];case 1:return[2,{data:_w(u.sent()),specs:e}]}})})},fromMemory:function(n,t,e,r){return arguments.length===1?n.modelTopology!=null||n.weightSpecs!=null?new qs(n):(console.warn("Please call tf.io.fromMemory() with only one argument. The argument should be of type ModelArtifacts. The multi-argument signature of tf.io.fromMemory() has been deprecated and will be removed in a future release."),new qs({modelTopology:n})):(console.warn("Please call tf.io.fromMemory() with only one argument. The argument should be of type ModelArtifacts. The multi-argument signature of tf.io.fromMemory() has been deprecated and will be removed in a future release."),new qs({modelTopology:n,weightSpecs:t,weightData:e,trainingConfig:r}))},getLoadHandlers:function(n,t){return pn.getLoadHandlers(n,t)},getModelArtifactsInfoForJSON:Io,getSaveHandlers:function(n){return pn.getSaveHandlers(n)},http:vu,isHTTPScheme:hu,loadWeights:function(n,t,e,r){return t===void 0&&(t=""),he(this,void 0,void 0,function(){return ve(this,function(a){return[2,Jc(function(o){return pf(o,{requestInit:r})})(n,t,e)]})})},registerLoadRouter:function(n){return pn.registerLoadRouter(n)},registerSaveRouter:function(n){return pn.registerSaveRouter(n)},weightsLoaderFactory:Jc,withSaveHandler:function(n){return new Pw(n)},copyModel:function(n,t){return he(this,void 0,void 0,function(){return ve(this,function(e){return[2,Gc(n,t,!1)]})})},listModels:function(){return he(this,void 0,void 0,function(){var n,t,e,r,a,o,i;return ve(this,function(s){switch(s.label){case 0:n=Rr.getSchemes(),t={},e=0,r=n,s.label=1;case 1:return e<r.length?(a=r[e],[4,Rr.getManager(a).listModels()]):[3,4];case 2:for(i in o=s.sent())t[a+_a+i]=o[i];s.label=3;case 3:return e++,[3,1];case 4:return[2,t]}})})},moveModel:function(n,t){return he(this,void 0,void 0,function(){return ve(this,function(e){return[2,Gc(n,t,!0)]})})},removeModel:function(n){return he(this,void 0,void 0,function(){var t;return ve(this,function(e){return t=Zo(n),[2,Rr.getManager(t.scheme).removeModel(t.path)]})})}}),ca;U({confusionMatrix_:function(n,t,e){var r=O(n,"labels","confusionMatrix"),a=O(t,"predictions","confusionMatrix");V(e==null||e>0&&Number.isInteger(e),function(){return"If provided, numClasses must be a positive integer, but got "+e}),V(r.rank===1,function(){return"Expected the rank of labels to be 1, but got "+r.rank}),V(a.rank===1,function(){return"Expected the rank of predictions to be 1, but got "+a.rank}),V(r.shape[0]===a.shape[0],function(){return"Mismatch in the number of examples: "+r.shape[0]+" vs. "+a.shape[0]+". Labels and predictions should have the same number of elements."}),V(e>0&&Number.isInteger(e),function(){return"numClasses is required to be a positive integer, but got "+e});var o=iu(r.asType("int32"),e),i=iu(a.asType("int32"),e);return o.transpose().matMul(i).asType("int32")}});var Ow=U({fromPixels_:function(n,t){if(t===void 0&&(t=3),t>4)throw new Error("Cannot construct Tensor with more than 4 channels from pixels.");if(n==null)throw new Error("pixels passed to tf.browser.fromPixels() can not be null");var e=!1,r=!1,a=!1,o=!1,i=!1;if(n.data instanceof Uint8Array)e=!0;else if(typeof ImageData<"u"&&n instanceof ImageData)r=!0;else if(typeof HTMLVideoElement<"u"&&n instanceof HTMLVideoElement)a=!0;else if(typeof HTMLImageElement<"u"&&n instanceof HTMLImageElement)o=!0;else{if(n.getContext==null)throw new Error("pixels passed to tf.browser.fromPixels() must be either an HTMLVideoElement, HTMLImageElement, HTMLCanvasElement, ImageData in browser, or OffscreenCanvas, ImageData in webworker or {data: Uint32Array, width: number, height: number}, but was "+n.constructor.name);i=!0}if(a&&a&&n.readyState<2)throw new Error("The video element has not loaded data yet. Please wait for `loadeddata` event on the <video> element.");if(Vd("FromPixels",W.backendName)!=null)return W.runKernel("FromPixels",{pixels:n},{numChannels:t});var s,u,l=a?[n.videoWidth,n.videoHeight]:[n.width,n.height],c=l[0],p=l[1];if(i?s=n.getContext("2d").getImageData(0,0,c,p).data:r||e?s=n.data:(o||a)&&(ca==null&&(ca=document.createElement("canvas").getContext("2d")),ca.canvas.width=c,ca.canvas.height=p,ca.drawImage(n,0,0,c,p),s=ca.getImageData(0,0,c,p).data),t===4)u=new Int32Array(s);else{var f=c*p;u=new Int32Array(f*t);for(var d=0;d<f;d++)for(var h=0;h<t;++h)u[d*t+h]=s[4*d+h]}return Nu(u,[p,c,t],"int32")}}),nl=Object.freeze({toPixels:function(n,t){return he(this,void 0,void 0,function(){var e,r,a,o,i,s,u,l,c,p,f,d,h,v,g,m,x,y,w,E,D,k,S;return ve(this,function(_){switch(_.label){case 0:if(e=O(n,"img","toPixels"),n instanceof at||(e=e.toInt()),e.rank!==2&&e.rank!==3)throw new Error("toPixels only supports rank 2 or 3 tensors, got rank "+e.rank+".");if(r=e.shape.slice(0,2),a=r[0],o=r[1],(i=e.rank===2?1:e.shape[2])>4||i===2)throw new Error("toPixels only supports depth of size 1, 3 or 4 but got "+i);return[4,e.data()];case 1:return s=_.sent(),u=e.min(),l=e.max(),[4,Promise.all([u.data(),l.data()])];case 2:if(c=_.sent(),p=c[0],f=c[1],d=p[0],h=f[0],u.dispose(),l.dispose(),e.dtype==="float32"){if(d<0||h>1)throw new Error("Tensor values for a float32 Tensor must be in the range [0 - 1] but got range ["+d+" - "+h+"].")}else{if(e.dtype!=="int32")throw new Error("Unsupported type for toPixels: "+e.dtype+". Please use float32 or int32 tensors.");if(d<0||h>255)throw new Error("Tensor values for a int32 Tensor must be in the range [0 - 255] but got range ["+d+" - "+h+"].")}for(v=e.dtype==="float32"?255:1,g=new Uint8ClampedArray(o*a*4),m=0;m<a*o;++m)x=void 0,y=void 0,w=void 0,E=void 0,i===1?(x=s[m]*v,y=s[m]*v,w=s[m]*v,E=255):i===3?(x=s[3*m]*v,y=s[3*m+1]*v,w=s[3*m+2]*v,E=255):i===4&&(x=s[4*m]*v,y=s[4*m+1]*v,w=s[4*m+2]*v,E=s[4*m+3]*v),g[(D=4*m)+0]=Math.round(x),g[D+1]=Math.round(y),g[D+2]=Math.round(w),g[D+3]=Math.round(E);return t!=null&&(t.width=o,t.height=a,k=t.getContext("2d"),S=new ImageData(g,o,a),k.putImageData(S,0,0)),e!==n&&e.dispose(),[2,g]}})})},fromPixels:Ow}),Mw=function(){function n(){}return n.prototype.getClassName=function(){return this.constructor.className},n.fromConfig=function(t,e){return new t(e)},n}(),Fw=function(){function n(){this.classNameMap={}}return n.getMap=function(){return n.instance==null&&(n.instance=new n),n.instance},n.register=function(t){n.getMap().classNameMap[t.className]=[t,t.fromConfig]},n}();function ia(n){V(n.className!=null,function(){return"Class being registered does not have the static className property defined."}),V(typeof n.className=="string",function(){return"className is required to be a string, but got type "+typeof n.className}),V(n.className.length>0,function(){return"Class being registered has an empty-string as its className, which is disallowed."}),Fw.register(n)}var sa=function(n){function t(){return n!==null&&n.apply(this,arguments)||this}return On(t,n),t.prototype.minimize=function(e,r,a){r===void 0&&(r=!1);var o=this.computeGradients(e,a),i=o.value,s=o.grads;if(a!=null){var u=a.map(function(l){return{name:l.name,tensor:s[l.name]}});this.applyGradients(u)}else this.applyGradients(s);return rn(s),r?i:(i.dispose(),null)},Object.defineProperty(t.prototype,"iterations",{get:function(){return this.iterations_==null&&(this.iterations_=0),this.iterations_},enumerable:!0,configurable:!0}),t.prototype.incrementIterations=function(){this.iterations_=this.iterations+1},t.prototype.computeGradients=function(e,r){return Gx(e,r)},t.prototype.dispose=function(){this.iterations_!=null&&rn(this.iterations_)},t.prototype.saveIterations=function(){return he(this,void 0,void 0,function(){return ve(this,function(e){return this.iterations_==null&&(this.iterations_=0),[2,{name:"iter",tensor:ce(this.iterations_,"int32")}]})})},t.prototype.getWeights=function(){return he(this,void 0,void 0,function(){return ve(this,function(e){throw new Error("getWeights() is not implemented for this optimizer yet.")})})},t.prototype.setWeights=function(e){return he(this,void 0,void 0,function(){return ve(this,function(r){throw new Error("setWeights() is not implemented for this optimizer class "+this.getClassName())})})},t.prototype.extractIterations=function(e){return he(this,void 0,void 0,function(){var r;return ve(this,function(a){switch(a.label){case 0:return r=this,[4,e[0].tensor.data()];case 1:return r.iterations_=a.sent()[0],[2,e.slice(1)]}})})},t}(Mw);Object.defineProperty(sa,Symbol.hasInstance,{value:function(n){return n.minimize!=null&&n.computeGradients!=null&&n.applyGradients!=null}});var Vw=function(n){function t(e,r,a){a===void 0&&(a=null);var o=n.call(this)||this;return o.learningRate=e,o.rho=r,o.epsilon=a,o.accumulatedGrads=[],o.accumulatedUpdates=[],a==null&&(o.epsilon=W.backend.epsilon()),o}return On(t,n),t.prototype.applyGradients=function(e){var r=this;(Array.isArray(e)?e.map(function(a){return a.name}):Object.keys(e)).forEach(function(a,o){var i=W.registeredVariables[a];r.accumulatedGrads[o]==null&&(r.accumulatedGrads[o]={originalName:a+"/accum_grad",variable:fe(function(){return qe(i).variable(!1)})}),r.accumulatedUpdates[o]==null&&(r.accumulatedUpdates[o]={originalName:a+"/accum_var",variable:fe(function(){return qe(i).variable(!1)})});var s=Array.isArray(e)?e[o].tensor:e[a];if(s!=null){var u=r.accumulatedGrads[o].variable,l=r.accumulatedUpdates[o].variable;fe(function(){var c=u.mul(r.rho).add(s.square().mul(1-r.rho)),p=l.add(r.epsilon).sqrt().div(u.add(r.epsilon).sqrt()).mul(s),f=l.mul(r.rho).add(p.square().mul(1-r.rho));u.assign(c),l.assign(f);var d=p.mul(-r.learningRate).add(i);i.assign(d)})}}),this.incrementIterations()},t.prototype.dispose=function(){this.accumulatedUpdates!=null&&(rn(this.accumulatedGrads.map(function(e){return e.variable})),rn(this.accumulatedUpdates.map(function(e){return e.variable})))},t.prototype.getWeights=function(){return he(this,void 0,void 0,function(){var e;return ve(this,function(r){switch(r.label){case 0:return e=this.accumulatedGrads.concat(this.accumulatedUpdates),[4,this.saveIterations()];case 1:return[2,[r.sent()].concat(e.map(function(a){return{name:a.originalName,tensor:a.variable}}))]}})})},t.prototype.setWeights=function(e){return he(this,void 0,void 0,function(){var r;return ve(this,function(a){switch(a.label){case 0:return[4,this.extractIterations(e)];case 1:return e=a.sent(),r=e.length/2,this.accumulatedGrads=e.slice(0,r).map(function(o){return{originalName:o.name,variable:o.tensor.variable(!1)}}),this.accumulatedUpdates=e.slice(r,2*r).map(function(o){return{originalName:o.name,variable:o.tensor.variable(!1)}}),[2]}})})},t.prototype.getConfig=function(){return{learningRate:this.learningRate,rho:this.rho,epsilon:this.epsilon}},t.fromConfig=function(e,r){return new e(r.learningRate,r.rho,r.epsilon)},t.className="Adadelta",t}(sa);ia(Vw);var Lw=function(n){function t(e,r){r===void 0&&(r=.1);var a=n.call(this)||this;return a.learningRate=e,a.initialAccumulatorValue=r,a.accumulatedGrads=[],a}return On(t,n),t.prototype.applyGradients=function(e){var r=this;(Array.isArray(e)?e.map(function(a){return a.name}):Object.keys(e)).forEach(function(a,o){var i=W.registeredVariables[a];r.accumulatedGrads[o]==null&&(r.accumulatedGrads[o]={originalName:a+"/accumulator",variable:fe(function(){return jn(i.shape,r.initialAccumulatorValue).variable(!1)})});var s=Array.isArray(e)?e[o].tensor:e[a];if(s!=null){var u=r.accumulatedGrads[o].variable;fe(function(){var l=u.add(s.square());u.assign(l);var c=s.div(l.add(W.backend.epsilon()).sqrt()).mul(-r.learningRate).add(i);i.assign(c)})}}),this.incrementIterations()},t.prototype.dispose=function(){this.accumulatedGrads!=null&&rn(this.accumulatedGrads.map(function(e){return e.variable}))},t.prototype.getWeights=function(){return he(this,void 0,void 0,function(){return ve(this,function(e){switch(e.label){case 0:return[4,this.saveIterations()];case 1:return[2,[e.sent()].concat(this.accumulatedGrads.map(function(r){return{name:r.originalName,tensor:r.variable}}))]}})})},t.prototype.setWeights=function(e){return he(this,void 0,void 0,function(){return ve(this,function(r){switch(r.label){case 0:return[4,this.extractIterations(e)];case 1:return e=r.sent(),this.accumulatedGrads=e.map(function(a){return{originalName:a.name,variable:a.tensor.variable(!1)}}),[2]}})})},t.prototype.getConfig=function(){return{learningRate:this.learningRate,initialAccumulatorValue:this.initialAccumulatorValue}},t.fromConfig=function(e,r){return new e(r.learningRate,r.initialAccumulatorValue)},t.className="Adagrad",t}(sa);ia(Lw);var Bw=function(n){function t(e,r,a,o){o===void 0&&(o=null);var i=n.call(this)||this;return i.learningRate=e,i.beta1=r,i.beta2=a,i.epsilon=o,i.accumulatedFirstMoment=[],i.accumulatedSecondMoment=[],fe(function(){i.accBeta1=ce(r).variable(),i.accBeta2=ce(a).variable()}),o==null&&(i.epsilon=W.backend.epsilon()),i}return On(t,n),t.prototype.applyGradients=function(e){var r=this,a=Array.isArray(e)?e.map(function(o){return o.name}):Object.keys(e);fe(function(){var o=St(1,r.accBeta1),i=St(1,r.accBeta2);a.forEach(function(s,u){var l=W.registeredVariables[s];r.accumulatedFirstMoment[u]==null&&(r.accumulatedFirstMoment[u]={originalName:s+"/m",variable:fe(function(){return qe(l).variable(!1)})}),r.accumulatedSecondMoment[u]==null&&(r.accumulatedSecondMoment[u]={originalName:s+"/v",variable:fe(function(){return qe(l).variable(!1)})});var c=Array.isArray(e)?e[u].tensor:e[s];if(c!=null){var p=r.accumulatedFirstMoment[u].variable,f=r.accumulatedSecondMoment[u].variable,d=p.mul(r.beta1).add(c.mul(1-r.beta1)),h=f.mul(r.beta2).add(c.square().mul(1-r.beta2)),v=d.div(o),g=h.div(i);p.assign(d),f.assign(h);var m=v.div(g.sqrt().add(r.epsilon)).mul(-r.learningRate).add(l);l.assign(m)}}),r.accBeta1.assign(r.accBeta1.mul(r.beta1)),r.accBeta2.assign(r.accBeta2.mul(r.beta2))}),this.incrementIterations()},t.prototype.dispose=function(){this.accBeta1.dispose(),this.accBeta2.dispose(),this.accumulatedFirstMoment!=null&&rn(this.accumulatedFirstMoment.map(function(e){return e.variable})),this.accumulatedSecondMoment!=null&&rn(this.accumulatedSecondMoment.map(function(e){return e.variable}))},t.prototype.getWeights=function(){return he(this,void 0,void 0,function(){var e;return ve(this,function(r){switch(r.label){case 0:return e=this.accumulatedFirstMoment.concat(this.accumulatedSecondMoment),[4,this.saveIterations()];case 1:return[2,[r.sent()].concat(e.map(function(a){return{name:a.originalName,tensor:a.variable}}))]}})})},t.prototype.setWeights=function(e){return he(this,void 0,void 0,function(){var r,a=this;return ve(this,function(o){switch(o.label){case 0:return[4,this.extractIterations(e)];case 1:return e=o.sent(),fe(function(){a.accBeta1.assign(Ei(a.beta1,a.iterations_+1)),a.accBeta2.assign(Ei(a.beta2,a.iterations_+1))}),r=e.length/2,this.accumulatedFirstMoment=e.slice(0,r).map(function(i){return{originalName:i.name,variable:i.tensor.variable(!1)}}),this.accumulatedSecondMoment=e.slice(r,2*r).map(function(i){return{originalName:i.name,variable:i.tensor.variable(!1)}}),[2]}})})},t.prototype.getConfig=function(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon}},t.fromConfig=function(e,r){return new e(r.learningRate,r.beta1,r.beta2,r.epsilon)},t.className="Adam",t}(sa);ia(Bw);var Uw=function(n){function t(e,r,a,o,i){o===void 0&&(o=null),i===void 0&&(i=0);var s=n.call(this)||this;return s.learningRate=e,s.beta1=r,s.beta2=a,s.epsilon=o,s.decay=i,s.accumulatedFirstMoment=[],s.accumulatedWeightedInfNorm=[],fe(function(){s.iteration=ce(0).variable(),s.accBeta1=ce(r).variable()}),o==null&&(s.epsilon=W.backend.epsilon()),s}return On(t,n),t.prototype.applyGradients=function(e){var r=this,a=Array.isArray(e)?e.map(function(o){return o.name}):Object.keys(e);fe(function(){var o=St(1,r.accBeta1),i=Tn(-r.learningRate,r.iteration.mul(r.decay).add(1));a.forEach(function(s,u){var l=W.registeredVariables[s];r.accumulatedFirstMoment[u]==null&&(r.accumulatedFirstMoment[u]={originalName:s+"/m",variable:qe(l).variable(!1)}),r.accumulatedWeightedInfNorm[u]==null&&(r.accumulatedWeightedInfNorm[u]={originalName:s+"/v",variable:qe(l).variable(!1)});var c=Array.isArray(e)?e[u].tensor:e[s];if(c!=null){var p=r.accumulatedFirstMoment[u].variable,f=r.accumulatedWeightedInfNorm[u].variable,d=p.mul(r.beta1).add(c.mul(1-r.beta1)),h=f.mul(r.beta2),v=c.abs(),g=h.maximum(v);p.assign(d),f.assign(g);var m=i.div(o).mul(d.div(g.add(r.epsilon))).add(l);l.assign(m)}}),r.iteration.assign(r.iteration.add(1)),r.accBeta1.assign(r.accBeta1.mul(r.beta1))}),this.incrementIterations()},t.prototype.dispose=function(){this.accBeta1.dispose(),this.iteration.dispose(),this.accumulatedFirstMoment!=null&&rn(this.accumulatedFirstMoment.map(function(e){return e.variable})),this.accumulatedWeightedInfNorm!=null&&rn(this.accumulatedWeightedInfNorm.map(function(e){return e.variable}))},t.prototype.getWeights=function(){return he(this,void 0,void 0,function(){return ve(this,function(e){throw new Error("getWeights() is not implemented for Adamax yet.")})})},t.prototype.setWeights=function(e){return he(this,void 0,void 0,function(){return ve(this,function(r){throw new Error("setWeights() is not implemented for Adamax yet.")})})},t.prototype.getConfig=function(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon,decay:this.decay}},t.fromConfig=function(e,r){return new e(r.learningRate,r.beta1,r.beta2,r.epsilon,r.decay)},t.className="Adamax",t}(sa);ia(Uw);var vf=function(n){function t(e){var r=n.call(this)||this;return r.learningRate=e,r.setLearningRate(e),r}return On(t,n),t.prototype.applyGradients=function(e){var r=this;(Array.isArray(e)?e.map(function(a){return a.name}):Object.keys(e)).forEach(function(a,o){var i=Array.isArray(e)?e[o].tensor:e[a];if(i!=null){var s=W.registeredVariables[a];fe(function(){var u=r.c.mul(i).add(s);s.assign(u)})}}),this.incrementIterations()},t.prototype.setLearningRate=function(e){this.learningRate=e,this.c!=null&&this.c.dispose(),this.c=ix(ce(-e))},t.prototype.dispose=function(){this.c.dispose()},t.prototype.getWeights=function(){return he(this,void 0,void 0,function(){return ve(this,function(e){switch(e.label){case 0:return[4,this.saveIterations()];case 1:return[2,[e.sent()]]}})})},t.prototype.setWeights=function(e){return he(this,void 0,void 0,function(){return ve(this,function(r){switch(r.label){case 0:return[4,this.extractIterations(e)];case 1:if((e=r.sent()).length!==0)throw new Error("SGD optimizer does not have settable weights.");return[2]}})})},t.prototype.getConfig=function(){return{learningRate:this.learningRate}},t.fromConfig=function(e,r){return new e(r.learningRate)},t.className="SGD",t}(sa);ia(vf);var Ww=function(n){function t(e,r,a){a===void 0&&(a=!1);var o=n.call(this,e)||this;return o.learningRate=e,o.momentum=r,o.useNesterov=a,o.accumulations=[],o.m=ce(o.momentum),o}return On(t,n),t.prototype.applyGradients=function(e){var r=this;(Array.isArray(e)?e.map(function(a){return a.name}):Object.keys(e)).forEach(function(a,o){var i=W.registeredVariables[a];r.accumulations[o]==null&&(r.accumulations[o]={originalName:a+"/momentum",variable:fe(function(){return qe(i).variable(!1)})});var s=r.accumulations[o].variable,u=Array.isArray(e)?e[o].tensor:e[a];u!=null&&fe(function(){var l,c=r.m.mul(s).add(u);l=r.useNesterov?r.c.mul(u.add(c.mul(r.m))).add(i):r.c.mul(c).add(i),s.assign(c),i.assign(l)})}),this.incrementIterations()},t.prototype.dispose=function(){this.m.dispose(),this.accumulations!=null&&rn(this.accumulations.map(function(e){return e.variable}))},t.prototype.setMomentum=function(e){this.momentum=e},t.prototype.getWeights=function(){return he(this,void 0,void 0,function(){return ve(this,function(e){switch(e.label){case 0:return[4,this.saveIterations()];case 1:return[2,[e.sent()].concat(this.accumulations.map(function(r){return{name:r.originalName,tensor:r.variable}}))]}})})},t.prototype.setWeights=function(e){return he(this,void 0,void 0,function(){return ve(this,function(r){switch(r.label){case 0:return[4,this.extractIterations(e)];case 1:return e=r.sent(),this.accumulations=e.map(function(a){return{originalName:a.name,variable:a.tensor.variable(!1)}}),[2]}})})},t.prototype.getConfig=function(){return{learningRate:this.learningRate,momentum:this.momentum,useNesterov:this.useNesterov}},t.fromConfig=function(e,r){return new e(r.learningRate,r.momentum,r.useNesterov)},t.className="Momentum",t}(vf);ia(Ww);var qw=function(n){function t(e,r,a,o,i){r===void 0&&(r=.9),a===void 0&&(a=0),o===void 0&&(o=null),i===void 0&&(i=!1);var s=n.call(this)||this;if(s.learningRate=e,s.decay=r,s.momentum=a,s.epsilon=o,s.accumulatedMeanSquares=[],s.accumulatedMoments=[],s.accumulatedMeanGrads=[],s.centered=i,o==null&&(s.epsilon=W.backend.epsilon()),e==null)throw new Error("learningRate for RMSPropOptimizer must be defined.");return s}return On(t,n),t.prototype.applyGradients=function(e){var r=this;(Array.isArray(e)?e.map(function(a){return a.name}):Object.keys(e)).forEach(function(a,o){var i=W.registeredVariables[a];r.accumulatedMeanSquares[o]==null&&(r.accumulatedMeanSquares[o]={originalName:a+"/rms",variable:fe(function(){return qe(i).variable(!1)})}),r.accumulatedMoments[o]==null&&(r.accumulatedMoments[o]={originalName:a+"/momentum",variable:fe(function(){return qe(i).variable(!1)})}),r.accumulatedMeanGrads[o]==null&&r.centered&&(r.accumulatedMeanGrads[o]={originalName:a+"/mg",variable:fe(function(){return qe(i).variable(!1)})});var s=Array.isArray(e)?e[o].tensor:e[a];if(s!=null){var u=r.accumulatedMeanSquares[o].variable,l=r.accumulatedMoments[o].variable;fe(function(){var c=u.mul(r.decay).add(s.square().mul(1-r.decay));if(r.centered){var p=r.accumulatedMeanGrads[o].variable,f=p.mul(r.decay).add(s.mul(1-r.decay)),d=l.mul(r.momentum).add(s.mul(r.learningRate).div(c.sub(f.square().add(r.epsilon)).sqrt()));u.assign(c),p.assign(f),l.assign(d);var h=i.sub(d);i.assign(h)}else{var v=u.mul(r.decay).add(s.square().mul(1-r.decay));d=l.mul(r.momentum).add(s.mul(r.learningRate).div(v.add(r.epsilon).sqrt())),u.assign(v),l.assign(d),h=i.sub(d),i.assign(h)}})}}),this.incrementIterations()},t.prototype.dispose=function(){this.accumulatedMeanSquares!=null&&rn(this.accumulatedMeanSquares.map(function(e){return e.variable})),this.accumulatedMeanGrads!=null&&this.centered&&rn(this.accumulatedMeanGrads.map(function(e){return e.variable})),this.accumulatedMoments!=null&&rn(this.accumulatedMoments.map(function(e){return e.variable}))},t.prototype.getWeights=function(){return he(this,void 0,void 0,function(){var e;return ve(this,function(r){switch(r.label){case 0:return e=this.accumulatedMeanSquares.concat(this.accumulatedMoments),this.centered&&e.push.apply(e,this.accumulatedMeanGrads),[4,this.saveIterations()];case 1:return[2,[r.sent()].concat(e.map(function(a){return{name:a.originalName,tensor:a.variable}}))]}})})},t.prototype.setWeights=function(e){return he(this,void 0,void 0,function(){var r;return ve(this,function(a){switch(a.label){case 0:return[4,this.extractIterations(e)];case 1:return e=a.sent(),r=this.centered?e.length/3:e.length/2,this.accumulatedMeanSquares=e.slice(0,r).map(function(o){return{originalName:o.name,variable:o.tensor.variable(!1)}}),this.accumulatedMoments=e.slice(r,2*r).map(function(o){return{originalName:o.name,variable:o.tensor.variable(!1)}}),this.centered&&(this.accumulatedMeanGrads=e.slice(2*r,3*r).map(function(o){return{originalName:o.name,variable:o.tensor.variable(!1)}})),[2]}})})},t.prototype.getConfig=function(){return{learningRate:this.learningRate,decay:this.decay,momentum:this.momentum,epsilon:this.epsilon,centered:this.centered}},t.fromConfig=function(e,r){return new e(r.learningRate,r.decay,r.momentum,r.epsilon,r.centered)},t.className="RMSProp",t}(sa);ia(qw);at.prototype.squaredDifference=function(n){return Tp(this,n)},Y=hw;/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */var mu=function(n,t){return mu=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,r){e.__proto__=r}||function(e,r){for(var a in r)r.hasOwnProperty(a)&&(e[a]=r[a])},mu(n,t)};function Te(n,t){mu(n,t);function e(){this.constructor=n}n.prototype=t===null?Object.create(t):(e.prototype=t.prototype,new e)}var Wt=function(){return Wt=Object.assign||function(t){for(var e,r=1,a=arguments.length;r<a;r++){e=arguments[r];for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])}return t},Wt.apply(this,arguments)};function xe(n,t,e,r){function a(o){return o instanceof e?o:new e(function(i){i(o)})}return new(e||(e=Promise))(function(o,i){function s(c){try{l(r.next(c))}catch(p){i(p)}}function u(c){try{l(r.throw(c))}catch(p){i(p)}}function l(c){c.done?o(c.value):a(c.value).then(s,u)}l((r=r.apply(n,[])).next())})}function be(n,t){var e={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},r,a,o,i;return i={next:s(0),throw:s(1),return:s(2)},typeof Symbol=="function"&&(i[Symbol.iterator]=function(){return this}),i;function s(l){return function(c){return u([l,c])}}function u(l){if(r)throw new TypeError("Generator is already executing.");for(;e;)try{if(r=1,a&&(o=l[0]&2?a.return:l[0]?a.throw||((o=a.return)&&o.call(a),0):a.next)&&!(o=o.call(a,l[1])).done)return o;switch(a=0,o&&(l=[l[0]&2,o.value]),l[0]){case 0:case 1:o=l;break;case 4:return e.label++,{value:l[1],done:!1};case 5:e.label++,a=l[1],l=[0];continue;case 7:l=e.ops.pop(),e.trys.pop();continue;default:if(o=e.trys,!(o=o.length>0&&o[o.length-1])&&(l[0]===6||l[0]===2)){e=0;continue}if(l[0]===3&&(!o||l[1]>o[0]&&l[1]<o[3])){e.label=l[1];break}if(l[0]===6&&e.label<o[1]){e.label=o[1],o=l;break}if(o&&e.label<o[2]){e.label=o[2],e.ops.push(l);break}o[2]&&e.ops.pop(),e.trys.pop();continue}l=t.call(n,e)}catch(c){l=[6,c],a=0}finally{r=o=0}if(l[0]&5)throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}}function no(){for(var n=0,t=0,e=arguments.length;t<e;t++)n+=arguments[t].length;for(var r=Array(n),a=0,t=0;t<e;t++)for(var o=arguments[t],i=0,s=o.length;i<s;i++,a++)r[a]=o[i];return r}var Sa=function(){function n(t,e){if(!Yr(t)||!Yr(e))throw new Error("Dimensions.constructor - expected width and height to be valid numbers, instead have "+JSON.stringify({width:t,height:e}));this._width=t,this._height=e}return Object.defineProperty(n.prototype,"width",{get:function(){return this._width},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"height",{get:function(){return this._height},enumerable:!0,configurable:!0}),n.prototype.reverse=function(){return new n(1/this.width,1/this.height)},n}();function Xi(n,t){return n instanceof at&&n.shape.length===t}function zw(n){return Xi(n,2)}function Yi(n){return Xi(n,3)}function Ar(n){return Xi(n,4)}function $w(n){return n%1!==0}function Zc(n){return n%2===0}function Hw(n,t){t===void 0&&(t=2);var e=Math.pow(10,t);return Math.floor(n*e)/e}function ed(n){return n&&n.width&&n.height}function Gw(n,t){var e=n.width,r=n.height,a=t/Math.max(r,e);return new Sa(Math.round(e*a),Math.round(r*a))}function rl(n){return n.reduce(function(t,e){return t.add(e)},new Ge(0,0)).div(new Ge(n.length,n.length))}function lo(n,t,e){return Array(n).fill(0).map(function(r,a){return t+a*e})}function Yr(n){return!!n&&n!==1/0&&n!==-1/0&&!isNaN(n)||n===0}function td(n){return Yr(n)&&0<=n&&n<=1}var Ge=function(){function n(t,e){this._x=t,this._y=e}return Object.defineProperty(n.prototype,"x",{get:function(){return this._x},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"y",{get:function(){return this._y},enumerable:!0,configurable:!0}),n.prototype.add=function(t){return new n(this.x+t.x,this.y+t.y)},n.prototype.sub=function(t){return new n(this.x-t.x,this.y-t.y)},n.prototype.mul=function(t){return new n(this.x*t.x,this.y*t.y)},n.prototype.div=function(t){return new n(this.x/t.x,this.y/t.y)},n.prototype.abs=function(){return new n(Math.abs(this.x),Math.abs(this.y))},n.prototype.magnitude=function(){return Math.sqrt(Math.pow(this.x,2)+Math.pow(this.y,2))},n.prototype.floor=function(){return new n(Math.floor(this.x),Math.floor(this.y))},n}(),Fr=function(){function n(t,e){e===void 0&&(e=!0);var r=t||{},a=[r.left,r.top,r.right,r.bottom].every(Yr),o=[r.x,r.y,r.width,r.height].every(Yr);if(!o&&!a)throw new Error("Box.constructor - expected box to be IBoundingBox | IRect, instead have "+JSON.stringify(r));var i=o?[r.x,r.y,r.width,r.height]:[r.left,r.top,r.right-r.left,r.bottom-r.top],s=i[0],u=i[1],l=i[2],c=i[3];n.assertIsValidBox({x:s,y:u,width:l,height:c},"Box.constructor",e),this._x=s,this._y=u,this._width=l,this._height=c}return n.isRect=function(t){return!!t&&[t.x,t.y,t.width,t.height].every(Yr)},n.assertIsValidBox=function(t,e,r){if(r===void 0&&(r=!1),!n.isRect(t))throw new Error(e+" - invalid box: "+JSON.stringify(t)+", expected object with properties x, y, width, height");if(!r&&(t.width<0||t.height<0))throw new Error(e+" - width ("+t.width+") and height ("+t.height+") must be positive numbers")},Object.defineProperty(n.prototype,"x",{get:function(){return this._x},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"y",{get:function(){return this._y},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"width",{get:function(){return this._width},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"height",{get:function(){return this._height},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"left",{get:function(){return this.x},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"top",{get:function(){return this.y},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"right",{get:function(){return this.x+this.width},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"bottom",{get:function(){return this.y+this.height},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"area",{get:function(){return this.width*this.height},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"topLeft",{get:function(){return new Ge(this.left,this.top)},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"topRight",{get:function(){return new Ge(this.right,this.top)},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"bottomLeft",{get:function(){return new Ge(this.left,this.bottom)},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"bottomRight",{get:function(){return new Ge(this.right,this.bottom)},enumerable:!0,configurable:!0}),n.prototype.round=function(){var t=[this.x,this.y,this.width,this.height].map(function(i){return Math.round(i)}),e=t[0],r=t[1],a=t[2],o=t[3];return new n({x:e,y:r,width:a,height:o})},n.prototype.floor=function(){var t=[this.x,this.y,this.width,this.height].map(function(i){return Math.floor(i)}),e=t[0],r=t[1],a=t[2],o=t[3];return new n({x:e,y:r,width:a,height:o})},n.prototype.toSquare=function(){var t=this,e=t.x,r=t.y,a=t.width,o=t.height,i=Math.abs(a-o);return a<o&&(e-=i/2,a+=i),o<a&&(r-=i/2,o+=i),new n({x:e,y:r,width:a,height:o})},n.prototype.rescale=function(t){var e=ed(t)?t.width:t,r=ed(t)?t.height:t;return new n({x:this.x*e,y:this.y*r,width:this.width*e,height:this.height*r})},n.prototype.pad=function(t,e){var r=[this.x-t/2,this.y-e/2,this.width+t,this.height+e],a=r[0],o=r[1],i=r[2],s=r[3];return new n({x:a,y:o,width:i,height:s})},n.prototype.clipAtImageBorders=function(t,e){var r=this,a=r.x,o=r.y,i=r.right,s=r.bottom,u=Math.max(a,0),l=Math.max(o,0),c=i-u,p=s-l,f=Math.min(c,t-u),d=Math.min(p,e-l);return new n({x:u,y:l,width:f,height:d}).floor()},n.prototype.shift=function(t,e){var r=this,a=r.width,o=r.height,i=this.x+t,s=this.y+e;return new n({x:i,y:s,width:a,height:o})},n.prototype.padAtBorders=function(t,e){var r=this.width+1,a=this.height+1,o=1,i=1,s=r,u=a,l=this.left,c=this.top,p=this.right,f=this.bottom;return p>e&&(s=-p+e+r,p=e),f>t&&(u=-f+t+a,f=t),l<1&&(u=2-l,l=1),c<1&&(u=2-c,c=1),{dy:i,edy:u,dx:o,edx:s,y:c,ey:f,x:l,ex:p,w:r,h:a}},n.prototype.calibrate=function(t){return new n({left:this.left+t.left*this.width,top:this.top+t.top*this.height,right:this.right+t.right*this.width,bottom:this.bottom+t.bottom*this.height}).toSquare().round()},n}(),Ki=function(n){Te(t,n);function t(e,r,a,o,i){return i===void 0&&(i=!1),n.call(this,{left:e,top:r,right:a,bottom:o},i)||this}return t}(Fr),mf=function(){function n(t,e,r,a,o){this._imageDims=new Sa(o.width,o.height),this._score=t,this._classScore=e,this._className=r,this._box=new Fr(a).rescale(this._imageDims)}return Object.defineProperty(n.prototype,"score",{get:function(){return this._score},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"classScore",{get:function(){return this._classScore},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"className",{get:function(){return this._className},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"box",{get:function(){return this._box},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"imageDims",{get:function(){return this._imageDims},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"imageWidth",{get:function(){return this.imageDims.width},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"imageHeight",{get:function(){return this.imageDims.height},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"relativeBox",{get:function(){return new Fr(this._box).rescale(this.imageDims.reverse())},enumerable:!0,configurable:!0}),n.prototype.forSize=function(t,e){return new n(this.score,this.classScore,this.className,this.relativeBox,{width:t,height:e})},n}(),er=function(n){Te(t,n);function t(e,r,a){return n.call(this,e,e,"",r,a)||this}return t.prototype.forSize=function(e,r){var a=n.prototype.forSize.call(this,e,r),o=a.score,i=a.relativeBox,s=a.imageDims;return new t(o,i,s)},t}(mf);function jw(n,t,e){e===void 0&&(e=!0);var r=Math.max(0,Math.min(n.right,t.right)-Math.max(n.left,t.left)),a=Math.max(0,Math.min(n.bottom,t.bottom)-Math.max(n.top,t.top)),o=r*a;return e?o/(n.area+t.area-o):o/Math.min(n.area,t.area)}function Xw(n){var t=n.map(function(s){return s.x}),e=n.map(function(s){return s.y}),r=t.reduce(function(s,u){return u<s?u:s},1/0),a=e.reduce(function(s,u){return u<s?u:s},1/0),o=t.reduce(function(s,u){return s<u?u:s},0),i=e.reduce(function(s,u){return s<u?u:s},0);return new Ki(r,a,o,i)}function co(n,t,e,r){r===void 0&&(r=!0);for(var a=t.map(function(s,u){return{score:s,boxIndex:u}}).sort(function(s,u){return s.score-u.score}).map(function(s){return s.boxIndex}),o=[],i=function(){var s=a.pop();o.push(s);for(var u=a,l=[],c=0;c<u.length;c++){var p=u[c],f=n[s],d=n[p];l.push(jw(f,d,r))}a=a.filter(function(h,v){return l[v]<=e})};a.length>0;)i();return o}function Do(n,t){return fe(function(){var e=t[0],r=t[1],a=t[2],o=jn(no(n.shape.slice(0,3),[1]),e),i=jn(no(n.shape.slice(0,3),[1]),r),s=jn(no(n.shape.slice(0,3),[1]),a),u=_t([o,i,s],3);return St(n,u)})}function Yw(n,t){return t===void 0&&(t=!1),fe(function(){var e=n.shape.slice(1),r=e[0],a=e[1];if(r===a)return n;var o=Math.abs(r-a),i=Math.round(o*(t?.5:1)),s=r>a?2:1,u=function(d){var h=n.shape.slice();return h[s]=d,jn(h,0)},l=u(i),c=o-l.shape[s],p=t&&c?u(c):null,f=[p,n,l].filter(function(d){return!!d}).map(function(d){return d.toFloat()});return _t(f,s)})}function zs(n){return 1/(1+Math.exp(-n))}var al=function(n){Te(t,n);function t(e,r,a,o,i){return i===void 0&&(i=!1),n.call(this,{x:e,y:r,width:a,height:o},i)||this}return t}(Fr),Kw=.5,Jw=.43,Qw=.45,Ii=function(){function n(t,e,r){r===void 0&&(r=new Ge(0,0));var a=e.width,o=e.height;this._imgDims=new Sa(a,o),this._shift=r,this._positions=t.map(function(i){return i.mul(new Ge(a,o)).add(r)})}return Object.defineProperty(n.prototype,"shift",{get:function(){return new Ge(this._shift.x,this._shift.y)},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"imageWidth",{get:function(){return this._imgDims.width},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"imageHeight",{get:function(){return this._imgDims.height},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"positions",{get:function(){return this._positions},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"relativePositions",{get:function(){var t=this;return this._positions.map(function(e){return e.sub(t._shift).div(new Ge(t.imageWidth,t.imageHeight))})},enumerable:!0,configurable:!0}),n.prototype.forSize=function(t,e){return new this.constructor(this.relativePositions,{width:t,height:e})},n.prototype.shiftBy=function(t,e){return new this.constructor(this.relativePositions,this._imgDims,new Ge(t,e))},n.prototype.shiftByPoint=function(t){return this.shiftBy(t.x,t.y)},n.prototype.align=function(t,e){if(e===void 0&&(e={}),t){var r=t instanceof er?t.box.floor():new Fr(t);return this.shiftBy(r.x,r.y).align(null,e)}var a=Object.assign({},{useDlibAlignment:!1,minBoxPadding:.2},e),o=a.useDlibAlignment,i=a.minBoxPadding;return o?this.alignDlib():this.alignMinBbox(i)},n.prototype.alignDlib=function(){var t=this.getRefPointsForAlignment(),e=t[0],r=t[1],a=t[2],o=function(p){return a.sub(p).magnitude()},i=(o(e)+o(r))/2,s=Math.floor(i/Qw),u=rl(t),l=Math.floor(Math.max(0,u.x-Kw*s)),c=Math.floor(Math.max(0,u.y-Jw*s));return new al(l,c,Math.min(s,this.imageWidth+l),Math.min(s,this.imageHeight+c))},n.prototype.alignMinBbox=function(t){var e=Xw(this.positions);return e.pad(e.width*t,e.height*t)},n.prototype.getRefPointsForAlignment=function(){throw new Error("getRefPointsForAlignment not implemented by base class")},n}(),Zw=function(n){Te(t,n);function t(){return n!==null&&n.apply(this,arguments)||this}return t.prototype.getRefPointsForAlignment=function(){var e=this.positions;return[e[0],e[1],rl([e[3],e[4]])]},t}(Ii),e2=function(n){Te(t,n);function t(){return n!==null&&n.apply(this,arguments)||this}return t.prototype.getJawOutline=function(){return this.positions.slice(0,17)},t.prototype.getLeftEyeBrow=function(){return this.positions.slice(17,22)},t.prototype.getRightEyeBrow=function(){return this.positions.slice(22,27)},t.prototype.getNose=function(){return this.positions.slice(27,36)},t.prototype.getLeftEye=function(){return this.positions.slice(36,42)},t.prototype.getRightEye=function(){return this.positions.slice(42,48)},t.prototype.getMouth=function(){return this.positions.slice(48,68)},t.prototype.getRefPointsForAlignment=function(){return[this.getLeftEye(),this.getRightEye(),this.getMouth()].map(rl)},t}(Ii),nd=function(){function n(t,e){this._label=t,this._distance=e}return Object.defineProperty(n.prototype,"label",{get:function(){return this._label},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"distance",{get:function(){return this._distance},enumerable:!0,configurable:!0}),n.prototype.toString=function(t){return t===void 0&&(t=!0),""+this.label+(t?" ("+Hw(this.distance)+")":"")},n}(),rd=function(n){Te(t,n);function t(e,r){var a=n.call(this,e)||this;return a._label=r,a}return t.assertIsValidLabeledBox=function(e,r){if(Fr.assertIsValidBox(e,r),!Yr(e.label))throw new Error(r+" - expected property label ("+e.label+") to be a number")},Object.defineProperty(t.prototype,"label",{get:function(){return this._label},enumerable:!0,configurable:!0}),t}(Fr),Ho=function(){function n(t,e){if(typeof t!="string")throw new Error("LabeledFaceDescriptors - constructor expected label to be a string");if(!Array.isArray(e)||e.some(function(r){return!(r instanceof Float32Array)}))throw new Error("LabeledFaceDescriptors - constructor expected descriptors to be an array of Float32Array");this._label=t,this._descriptors=e}return Object.defineProperty(n.prototype,"label",{get:function(){return this._label},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"descriptors",{get:function(){return this._descriptors},enumerable:!0,configurable:!0}),n.prototype.toJSON=function(){return{label:this.label,descriptors:this.descriptors.map(function(t){return Array.from(t)})}},n.fromJSON=function(t){var e=t.descriptors.map(function(r){return new Float32Array(r)});return new n(t.label,e)},n}();(function(n){Te(t,n);function t(e,r,a,o){var i=n.call(this,e,r)||this;return i._score=a,i._classScore=o,i}return t.assertIsValidPredictedBox=function(e,r){if(rd.assertIsValidLabeledBox(e,r),!td(e.score)||!td(e.classScore))throw new Error(r+" - expected properties score ("+e.score+") and ("+e.classScore+") to be a number between [0, 1]")},Object.defineProperty(t.prototype,"score",{get:function(){return this._score},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"classScore",{get:function(){return this._classScore},enumerable:!0,configurable:!0}),t})(rd);function t2(n){return n.detection instanceof er}function ol(n,t){var e={detection:t};return Object.assign({},n,e)}function gf(){var n=window.fetch||function(){throw new Error("fetch - missing fetch implementation for browser environment")},t=function(){throw new Error("readFile - filesystem not available for browser environment")};return{Canvas:HTMLCanvasElement,CanvasRenderingContext2D,Image:HTMLImageElement,ImageData,Video:HTMLVideoElement,createCanvasElement:function(){return document.createElement("canvas")},createImageElement:function(){return document.createElement("img")},fetch:n,readFile:t}}function yf(n){var t="";if(!n)try{n=require("fs")}catch(r){t=r.toString()}var e=n?function(r){return new Promise(function(a,o){n.readFile(r,function(i,s){return i?o(i):a(s)})})}:function(){throw new Error("readFile - failed to require fs in nodejs environment with error: "+t)};return{readFile:e}}function xf(){var n=global.Canvas||global.HTMLCanvasElement,t=global.Image||global.HTMLImageElement,e=function(){if(n)return new n;throw new Error("createCanvasElement - missing Canvas implementation for nodejs environment")},r=function(){if(t)return new t;throw new Error("createImageElement - missing Image implementation for nodejs environment")},a=global.fetch||function(){throw new Error("fetch - missing fetch implementation for nodejs environment")},o=yf();return Wt({Canvas:n||function(){function i(){}return i}(),CanvasRenderingContext2D:global.CanvasRenderingContext2D||function(){function i(){}return i}(),Image:t||function(){function i(){}return i}(),ImageData:global.ImageData||function(){function i(){}return i}(),Video:global.HTMLVideoElement||function(){function i(){}return i}(),createCanvasElement:e,createImageElement:r,fetch:a},o)}function bf(){return typeof window=="object"&&typeof document<"u"&&typeof HTMLImageElement<"u"&&typeof HTMLCanvasElement<"u"&&typeof HTMLVideoElement<"u"&&typeof ImageData<"u"&&typeof CanvasRenderingContext2D<"u"}function _f(){return typeof global=="object"&&typeof require=="function"&&typeof module<"u"&&typeof process<"u"&&!!process.version}var xt;function n2(){if(!xt)throw new Error("getEnv - environment is not defined, check isNodejs() and isBrowser()");return xt}function gu(n){xt=n}function il(){bf()&&gu(gf()),_f()&&gu(xf())}function r2(n){if(xt||il(),!xt)throw new Error("monkeyPatch - environment is not defined, check isNodejs() and isBrowser()");var t=n.Canvas,e=t===void 0?xt.Canvas:t,r=n.Image,a=r===void 0?xt.Image:r;xt.Canvas=e,xt.Image=a,xt.createCanvasElement=n.createCanvasElement||function(){return new e},xt.createImageElement=n.createImageElement||function(){return new a},xt.ImageData=n.ImageData||xt.ImageData,xt.Video=n.Video||xt.Video,xt.fetch=n.fetch||xt.fetch,xt.readFile=n.readFile||xt.readFile}var Gt={getEnv:n2,setEnv:gu,initialize:il,createBrowserEnv:gf,createFileSystem:yf,createNodejsEnv:xf,monkeyPatch:r2,isBrowser:bf,isNodejs:_f};il();function wf(n){return!Gt.isNodejs()&&typeof n=="string"?document.getElementById(n):n}function Qr(n){var t=Gt.getEnv(),e=t.Canvas,r=t.CanvasRenderingContext2D;if(n instanceof r)return n;var a=wf(n);if(!(a instanceof e))throw new Error("resolveContext2d - expected canvas to be of instance of Canvas");var o=a.getContext("2d");if(!o)throw new Error("resolveContext2d - canvas 2d context is null");return o}var ad;(function(n){n.TOP_LEFT="TOP_LEFT",n.TOP_RIGHT="TOP_RIGHT",n.BOTTOM_LEFT="BOTTOM_LEFT",n.BOTTOM_RIGHT="BOTTOM_RIGHT"})(ad||(ad={}));function Ef(n){var t=Gt.getEnv(),e=t.Image,r=t.Video;return n instanceof e&&n.complete||n instanceof r&&n.readyState>=3}function a2(n){return new Promise(function(t,e){if(n instanceof Gt.getEnv().Canvas||Ef(n))return t();function r(o){o.currentTarget&&(o.currentTarget.removeEventListener("load",r),o.currentTarget.removeEventListener("error",a),t(o))}function a(o){o.currentTarget&&(o.currentTarget.removeEventListener("load",r),o.currentTarget.removeEventListener("error",a),e(o))}n.addEventListener("load",r),n.addEventListener("error",a)})}function Sf(n){var t=Gt.getEnv(),e=t.Image,r=t.Video;return n instanceof e?new Sa(n.naturalWidth,n.naturalHeight):n instanceof r?new Sa(n.videoWidth,n.videoHeight):new Sa(n.width,n.height)}function Ji(n){var t=n.width,e=n.height,r=Gt.getEnv().createCanvasElement,a=r();return a.width=t,a.height=e,a}function sl(n,t){var e=Gt.getEnv().ImageData;if(!(n instanceof e)&&!Ef(n))throw new Error("createCanvasFromMedia - media has not finished loading yet");var r=Sf(n),a=r.width,o=r.height,i=Ji({width:a,height:o});return n instanceof e?Qr(i).putImageData(n,0,0):Qr(i).drawImage(n,0,0,a,o),i}function o2(n,t){return xe(this,void 0,void 0,function(){var e,r,a,o,i,s;return be(this,function(u){switch(u.label){case 0:return e=Gt.getEnv().createCanvasElement(),r=n.shape.slice(Ar(n)?1:0),a=r[0],o=r[1],i=r[2],s=fe(function(){return n.as3D(a,o,i).toInt()}),[4,nl.toPixels(s,e)];case 1:return u.sent(),s.dispose(),[2,e]}})})}function od(n){var t=Gt.getEnv(),e=t.Image,r=t.Canvas,a=t.Video;return n instanceof e||n instanceof r||n instanceof a}function i2(n,t,e){e===void 0&&(e=!1);var r=Gt.getEnv(),a=r.Image,o=r.Canvas;if(!(n instanceof a||n instanceof o))throw new Error("imageToSquare - expected arg0 to be HTMLImageElement | HTMLCanvasElement");var i=Sf(n),s=t/Math.max(i.height,i.width),u=s*i.width,l=s*i.height,c=Ji({width:t,height:t}),p=n instanceof o?n:sl(n),f=Math.abs(u-l)/2,d=e&&u<l?f:0,h=e&&l<u?f:0;return Qr(c).drawImage(p,d,h,u,l),c}var Di=function(){function n(t,e){var r=this;if(e===void 0&&(e=!1),this._imageTensors=[],this._canvases=[],this._treatAsBatchInput=!1,this._inputDimensions=[],!Array.isArray(t))throw new Error("NetInput.constructor - expected inputs to be an Array of TResolvedNetInput or to be instanceof tf.Tensor4D, instead have "+t);this._treatAsBatchInput=e,this._batchSize=t.length,t.forEach(function(a,o){if(Yi(a)){r._imageTensors[o]=a,r._inputDimensions[o]=a.shape;return}if(Ar(a)){var i=a.shape[0];if(i!==1)throw new Error("NetInput - tf.Tensor4D with batchSize "+i+" passed, but not supported in input array");r._imageTensors[o]=a,r._inputDimensions[o]=a.shape.slice(1);return}var s=a instanceof Gt.getEnv().Canvas?a:sl(a);r._canvases[o]=s,r._inputDimensions[o]=[s.height,s.width,3]})}return Object.defineProperty(n.prototype,"imageTensors",{get:function(){return this._imageTensors},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"canvases",{get:function(){return this._canvases},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"isBatchInput",{get:function(){return this.batchSize>1||this._treatAsBatchInput},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"batchSize",{get:function(){return this._batchSize},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"inputDimensions",{get:function(){return this._inputDimensions},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"inputSize",{get:function(){return this._inputSize},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"reshapedInputDimensions",{get:function(){var t=this;return lo(this.batchSize,0,1).map(function(e,r){return t.getReshapedInputDimensions(r)})},enumerable:!0,configurable:!0}),n.prototype.getInput=function(t){return this.canvases[t]||this.imageTensors[t]},n.prototype.getInputDimensions=function(t){return this._inputDimensions[t]},n.prototype.getInputHeight=function(t){return this._inputDimensions[t][0]},n.prototype.getInputWidth=function(t){return this._inputDimensions[t][1]},n.prototype.getReshapedInputDimensions=function(t){if(typeof this.inputSize!="number")throw new Error("getReshapedInputDimensions - inputSize not set, toBatchTensor has not been called yet");var e=this.getInputWidth(t),r=this.getInputHeight(t);return Gw({width:e,height:r},this.inputSize)},n.prototype.toBatchTensor=function(t,e){var r=this;return e===void 0&&(e=!0),this._inputSize=t,fe(function(){var a=lo(r.batchSize,0,1).map(function(i){var s=r.getInput(i);if(s instanceof at){var u=Ar(s)?s:s.expandDims();return u=Yw(u,e),(u.shape[1]!==t||u.shape[2]!==t)&&(u=Ku.resizeBilinear(u,[t,t])),u.as3D(t,t,3)}if(s instanceof Gt.getEnv().Canvas)return nl.fromPixels(i2(s,t,e));throw new Error("toBatchTensor - at batchIdx "+i+", expected input to be instanceof tf.Tensor or instanceof HTMLCanvasElement, instead have "+s)}),o=vn(a.map(function(i){return i.toFloat()})).as4D(r.batchSize,t,t,3);return o})},n}();function Tt(n){return xe(this,void 0,void 0,function(){var t,e,r;return be(this,function(a){switch(a.label){case 0:if(n instanceof Di)return[2,n];if(t=Array.isArray(n)?n:[n],!t.length)throw new Error("toNetInput - empty array passed as input");return e=function(o){return Array.isArray(n)?" at input index "+o+":":""},r=t.map(wf),r.forEach(function(o,i){if(!od(o)&&!Yi(o)&&!Ar(o))throw typeof t[i]=="string"?new Error("toNetInput -"+e(i)+" string passed, but could not resolve HTMLElement for element id "+t[i]):new Error("toNetInput -"+e(i)+" expected media to be of type HTMLImageElement | HTMLVideoElement | HTMLCanvasElement | tf.Tensor3D, or to be an element id");if(Ar(o)){var s=o.shape[0];if(s!==1)throw new Error("toNetInput -"+e(i)+" tf.Tensor4D with batchSize "+s+" passed, but not supported in input array")}}),[4,Promise.all(r.map(function(o){return od(o)&&a2(o)}))];case 1:return a.sent(),[2,new Di(r,Array.isArray(n))]}})})}function ul(n,t){return xe(this,void 0,void 0,function(){var e,r,a,o,i,s,u;return be(this,function(l){switch(l.label){case 0:return e=Gt.getEnv().Canvas,r=n,n instanceof e?[3,5]:[4,Tt(n)];case 1:if(a=l.sent(),a.batchSize>1)throw new Error("extractFaces - batchSize > 1 not supported");return o=a.getInput(0),o instanceof e?(i=o,[3,4]):[3,2];case 2:return[4,o2(o)];case 3:i=l.sent(),l.label=4;case 4:r=i,l.label=5;case 5:return s=Qr(r),u=t.map(function(c){return c instanceof er?c.forSize(r.width,r.height).box.floor():c}).map(function(c){return c.clipAtImageBorders(r.width,r.height)}),[2,u.map(function(c){var p=c.x,f=c.y,d=c.width,h=c.height,v=Ji({width:d,height:h});return Qr(v).putImageData(s.getImageData(p,f,d,h),0,0),v})]}})})}function ll(n,t){return xe(this,void 0,void 0,function(){return be(this,function(e){if(!Yi(n)&&!Ar(n))throw new Error("extractFaceTensors - expected image tensor to be 3D or 4D");if(Ar(n)&&n.shape[0]>1)throw new Error("extractFaceTensors - batchSize > 1 not supported");return[2,fe(function(){var r=n.shape.slice(Ar(n)?1:0),a=r[0],o=r[1],i=r[2],s=t.map(function(l){return l instanceof er?l.forSize(o,a).box:l}).map(function(l){return l.clipAtImageBorders(o,a)}),u=s.map(function(l){var c=l.x,p=l.y,f=l.width,d=l.height;return Kp(n.as3D(a,o,i),[p,c,0],[d,f,i])});return u})]})})}function s2(n,t){return xe(this,void 0,void 0,function(){var e,r;return be(this,function(a){switch(a.label){case 0:return e=Gt.getEnv().fetch,[4,e(n,t)];case 1:if(r=a.sent(),!(r.status<400))throw new Error("failed to fetch: ("+r.status+") "+r.statusText+", from url: "+r.url);return[2,r]}})})}function u2(n){return xe(this,void 0,void 0,function(){return be(this,function(t){switch(t.label){case 0:return[4,s2(n)];case 1:return[2,t.sent().json()]}})})}function Cf(n,t){var e=t+"-weights_manifest.json";if(!n)return{modelBaseUri:"",manifestUri:e};if(n==="/")return{modelBaseUri:"/",manifestUri:"/"+e};var r=n.startsWith("http://")?"http://":n.startsWith("https://")?"https://":"";n=n.replace(r,"");var a=n.split("/").filter(function(s){return s}),o=n.endsWith(".json")?a[a.length-1]:e,i=r+(n.endsWith(".json")?a.slice(0,a.length-1):a).join("/");return i=n.startsWith("/")?"/"+i:i,{modelBaseUri:i,manifestUri:i==="/"?"/"+o:i+"/"+o}}function l2(n,t){return xe(this,void 0,void 0,function(){var e,r,a,o;return be(this,function(i){switch(i.label){case 0:return e=Cf(n,t),r=e.manifestUri,a=e.modelBaseUri,[4,u2(r)];case 1:return o=i.sent(),[2,hf.loadWeights(o,a)]}})})}var vr=function(){function n(t){this._name=t,this._params=void 0,this._paramMappings=[]}return Object.defineProperty(n.prototype,"params",{get:function(){return this._params},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"paramMappings",{get:function(){return this._paramMappings},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"isLoaded",{get:function(){return!!this.params},enumerable:!0,configurable:!0}),n.prototype.getParamFromPath=function(t){var e=this.traversePropertyPath(t),r=e.obj,a=e.objProp;return r[a]},n.prototype.reassignParamFromPath=function(t,e){var r=this.traversePropertyPath(t),a=r.obj,o=r.objProp;a[o].dispose(),a[o]=e},n.prototype.getParamList=function(){var t=this;return this._paramMappings.map(function(e){var r=e.paramPath;return{path:r,tensor:t.getParamFromPath(r)}})},n.prototype.getTrainableParams=function(){return this.getParamList().filter(function(t){return t.tensor instanceof ka})},n.prototype.getFrozenParams=function(){return this.getParamList().filter(function(t){return!(t.tensor instanceof ka)})},n.prototype.variable=function(){var t=this;this.getFrozenParams().forEach(function(e){var r=e.path,a=e.tensor;t.reassignParamFromPath(r,a.variable())})},n.prototype.freeze=function(){var t=this;this.getTrainableParams().forEach(function(e){var r=e.path,a=e.tensor,o=Ot(a.dataSync());a.dispose(),t.reassignParamFromPath(r,o)})},n.prototype.dispose=function(t){t===void 0&&(t=!0),this.getParamList().forEach(function(e){if(t&&e.tensor.isDisposed)throw new Error("param tensor has already been disposed for path "+e.path);e.tensor.dispose()}),this._params=void 0},n.prototype.serializeParams=function(){return new Float32Array(this.getParamList().map(function(t){var e=t.tensor;return Array.from(e.dataSync())}).reduce(function(t,e){return t.concat(e)}))},n.prototype.load=function(t){return xe(this,void 0,void 0,function(){return be(this,function(e){switch(e.label){case 0:return t instanceof Float32Array?(this.extractWeights(t),[2]):[4,this.loadFromUri(t)];case 1:return e.sent(),[2]}})})},n.prototype.loadFromUri=function(t){return xe(this,void 0,void 0,function(){var e;return be(this,function(r){switch(r.label){case 0:if(t&&typeof t!="string")throw new Error(this._name+".loadFromUri - expected model uri");return[4,l2(t,this.getDefaultModelName())];case 1:return e=r.sent(),this.loadFromWeightMap(e),[2]}})})},n.prototype.loadFromDisk=function(t){return xe(this,void 0,void 0,function(){var e,r,a,o,i,s,u,l,c,p;return be(this,function(f){switch(f.label){case 0:if(t&&typeof t!="string")throw new Error(this._name+".loadFromDisk - expected model file path");return e=Gt.getEnv().readFile,r=Cf(t,this.getDefaultModelName()),a=r.manifestUri,o=r.modelBaseUri,i=function(d){return Promise.all(d.map(function(h){return e(h).then(function(v){return v.buffer})}))},s=hf.weightsLoaderFactory(i),c=(l=JSON).parse,[4,e(a)];case 1:return u=c.apply(l,[f.sent().toString()]),[4,s(u,o)];case 2:return p=f.sent(),this.loadFromWeightMap(p),[2]}})})},n.prototype.loadFromWeightMap=function(t){var e=this.extractParamsFromWeigthMap(t),r=e.paramMappings,a=e.params;this._paramMappings=r,this._params=a},n.prototype.extractWeights=function(t){var e=this.extractParams(t),r=e.paramMappings,a=e.params;this._paramMappings=r,this._params=a},n.prototype.traversePropertyPath=function(t){if(!this.params)throw new Error("traversePropertyPath - model has no loaded params");var e=t.split("/").reduce(function(o,i){if(!o.nextObj.hasOwnProperty(i))throw new Error("traversePropertyPath - object does not have property "+i+", for path "+t);return{obj:o.nextObj,objProp:i,nextObj:o.nextObj[i]}},{nextObj:this.params}),r=e.obj,a=e.objProp;if(!r||!a||!(r[a]instanceof at))throw new Error("traversePropertyPath - parameter is not a tensor, for path "+t);return{obj:r,objProp:a}},n}();function fn(n,t,e){return fe(function(){var r=Hu(n,t.depthwise_filter,t.pointwise_filter,e,"same");return r=Fe(r,t.bias),r})}function $s(n,t,e){return e===void 0&&(e=!1),fe(function(){var r=ot(e?Fe(Cn(n,t.conv0.filters,[2,2],"same"),t.conv0.bias):fn(n,t.conv0,[2,2])),a=fn(r,t.conv1,[1,1]),o=ot(Fe(r,a)),i=fn(o,t.conv2,[1,1]);return ot(Fe(r,Fe(a,i)))})}function Go(n,t,e,r){return e===void 0&&(e=!1),r===void 0&&(r=!0),fe(function(){var a=ot(e?Fe(Cn(n,t.conv0.filters,r?[2,2]:[1,1],"same"),t.conv0.bias):fn(n,t.conv0,r?[2,2]:[1,1])),o=fn(a,t.conv1,[1,1]),i=ot(Fe(a,o)),s=fn(i,t.conv2,[1,1]),u=ot(Fe(a,Fe(o,s))),l=fn(u,t.conv3,[1,1]);return ot(Fe(a,Fe(o,Fe(s,l))))})}function Pn(n,t,e,r){return e===void 0&&(e="same"),r===void 0&&(r=!1),fe(function(){var a=Fe(Cn(n,t.filters,[1,1],e),t.bias);return r?ot(a):a})}function mr(n,t){Object.keys(n).forEach(function(e){t.some(function(r){return r.originalPath===e})||n[e].dispose()})}function Qi(n,t){return function(e,r,a,o){var i=en(n(e*r*a*a),[a,a,e,r]),s=yt(n(r));return t.push({paramPath:o+"/filters"},{paramPath:o+"/bias"}),{filters:i,bias:s}}}function cl(n,t){return function(e,r,a){var o=Nr(n(e*r),[e,r]),i=yt(n(r));return t.push({paramPath:a+"/weights"},{paramPath:a+"/bias"}),{weights:o,bias:i}}}var If=function(){function n(t,e,r){this.depthwise_filter=t,this.pointwise_filter=e,this.bias=r}return n}();function dl(n,t){return function(e,r,a){var o=en(n(9*e),[3,3,e,1]),i=en(n(e*r),[1,1,e,r]),s=yt(n(r));return t.push({paramPath:a+"/depthwise_filter"},{paramPath:a+"/pointwise_filter"},{paramPath:a+"/bias"}),new If(o,i,s)}}function pl(n){return function(t){var e=n(t+"/depthwise_filter",4),r=n(t+"/pointwise_filter",4),a=n(t+"/bias",1);return new If(e,r,a)}}function Ur(n,t){return function(e,r,a){var o=n[e];if(!Xi(o,r))throw new Error("expected weightMap["+e+"] to be a Tensor"+r+"D, instead have "+o);return t.push({originalPath:e,paramPath:a||e}),o}}function gr(n){var t=n;function e(a){var o=t.slice(0,a);return t=t.slice(a),o}function r(){return t}return{extractWeights:e,getRemainingWeights:r}}function Df(n,t){var e=Qi(n,t),r=dl(n,t);function a(i,s,u,l){l===void 0&&(l=!1);var c=l?e(i,s,3,u+"/conv0"):r(i,s,u+"/conv0"),p=r(s,s,u+"/conv1"),f=r(s,s,u+"/conv2");return{conv0:c,conv1:p,conv2:f}}function o(i,s,u,l){l===void 0&&(l=!1);var c=a(i,s,u,l),p=c.conv0,f=c.conv1,d=c.conv2,h=r(s,s,u+"/conv3");return{conv0:p,conv1:f,conv2:d,conv3:h}}return{extractDenseBlock3Params:a,extractDenseBlock4Params:o}}function c2(n){var t=[],e=gr(n),r=e.extractWeights,a=e.getRemainingWeights,o=Df(r,t).extractDenseBlock4Params,i=o(3,32,"dense0",!0),s=o(32,64,"dense1"),u=o(64,128,"dense2"),l=o(128,256,"dense3");if(a().length!==0)throw new Error("weights remaing after extract: "+a().length);return{paramMappings:t,params:{dense0:i,dense1:s,dense2:u,dense3:l}}}function kf(n){return function(t){var e=n(t+"/filters",4),r=n(t+"/bias",1);return{filters:e,bias:r}}}function Tf(n,t){var e=Ur(n,t),r=kf(e),a=pl(e);function o(s,u){u===void 0&&(u=!1);var l=u?r(s+"/conv0"):a(s+"/conv0"),c=a(s+"/conv1"),p=a(s+"/conv2");return{conv0:l,conv1:c,conv2:p}}function i(s,u){u===void 0&&(u=!1);var l=u?r(s+"/conv0"):a(s+"/conv0"),c=a(s+"/conv1"),p=a(s+"/conv2"),f=a(s+"/conv3");return{conv0:l,conv1:c,conv2:p,conv3:f}}return{extractDenseBlock3Params:o,extractDenseBlock4Params:i}}function d2(n){var t=[],e=Tf(n,t).extractDenseBlock4Params,r={dense0:e("dense0",!0),dense1:e("dense1"),dense2:e("dense2"),dense3:e("dense3")};return mr(n,t),{params:r,paramMappings:t}}var Nf=function(n){Te(t,n);function t(){return n.call(this,"FaceFeatureExtractor")||this}return t.prototype.forwardInput=function(e){var r=this.params;if(!r)throw new Error("FaceFeatureExtractor - load model before inference");return fe(function(){var a=e.toBatchTensor(112,!0),o=[122.782,117.001,104.298],i=Do(a,o).div(ce(255)),s=Go(i,r.dense0,!0);return s=Go(s,r.dense1),s=Go(s,r.dense2),s=Go(s,r.dense3),s=Co(s,[7,7],[2,2],"valid"),s})},t.prototype.forward=function(e){return xe(this,void 0,void 0,function(){var r;return be(this,function(a){switch(a.label){case 0:return r=this.forwardInput,[4,Tt(e)];case 1:return[2,r.apply(this,[a.sent()])]}})})},t.prototype.getDefaultModelName=function(){return"face_feature_extractor_model"},t.prototype.extractParamsFromWeigthMap=function(e){return d2(e)},t.prototype.extractParams=function(e){return c2(e)},t}(vr);function $n(n,t){return fe(function(){return Fe(Hi(n,t.weights),t.bias)})}function p2(n,t,e){var r=[],a=gr(n),o=a.extractWeights,i=a.getRemainingWeights,s=cl(o,r),u=s(t,e,"fc");if(i().length!==0)throw new Error("weights remaing after extract: "+i().length);return{paramMappings:r,params:{fc:u}}}function f2(n){var t=[],e=Ur(n,t);function r(o){var i=e(o+"/weights",2),s=e(o+"/bias",1);return{weights:i,bias:s}}var a={fc:r("fc")};return mr(n,t),{params:a,paramMappings:t}}function Rf(n){var t={},e={};return Object.keys(n).forEach(function(r){var a=r.startsWith("fc")?e:t;a[r]=n[r]}),{featureExtractorMap:t,classifierMap:e}}var Af=function(n){Te(t,n);function t(e,r){var a=n.call(this,e)||this;return a._faceFeatureExtractor=r,a}return Object.defineProperty(t.prototype,"faceFeatureExtractor",{get:function(){return this._faceFeatureExtractor},enumerable:!0,configurable:!0}),t.prototype.runNet=function(e){var r=this,a=this.params;if(!a)throw new Error(this._name+" - load model before inference");return fe(function(){var o=e instanceof Di?r.faceFeatureExtractor.forwardInput(e):e;return $n(o.as2D(o.shape[0],-1),a.fc)})},t.prototype.dispose=function(e){e===void 0&&(e=!0),this.faceFeatureExtractor.dispose(e),n.prototype.dispose.call(this,e)},t.prototype.loadClassifierParams=function(e){var r=this.extractClassifierParams(e),a=r.params,o=r.paramMappings;this._params=a,this._paramMappings=o},t.prototype.extractClassifierParams=function(e){return p2(e,this.getClassifierChannelsIn(),this.getClassifierChannelsOut())},t.prototype.extractParamsFromWeigthMap=function(e){var r=Rf(e),a=r.featureExtractorMap,o=r.classifierMap;return this.faceFeatureExtractor.loadFromWeightMap(a),f2(o)},t.prototype.extractParams=function(e){var r=this.getClassifierChannelsIn(),a=this.getClassifierChannelsOut(),o=a*r+a,i=e.slice(0,e.length-o),s=e.slice(e.length-o);return this.faceFeatureExtractor.extractWeights(i),this.extractClassifierParams(s)},t}(vr),id=["neutral","happy","sad","angry","fearful","disgusted","surprised"],h2=function(){function n(t){var e=this;if(t.length!==7)throw new Error("FaceExpressions.constructor - expected probabilities.length to be 7, have: "+t.length);id.forEach(function(r,a){e[r]=t[a]})}return n.prototype.asSortedArray=function(){var t=this;return id.map(function(e){return{expression:e,probability:t[e]}}).sort(function(e,r){return r.probability-e.probability})},n}(),v2=function(n){Te(t,n);function t(e){return e===void 0&&(e=new Nf),n.call(this,"FaceExpressionNet",e)||this}return t.prototype.forwardInput=function(e){var r=this;return fe(function(){return fr(r.runNet(e))})},t.prototype.forward=function(e){return xe(this,void 0,void 0,function(){var r;return be(this,function(a){switch(a.label){case 0:return r=this.forwardInput,[4,Tt(e)];case 1:return[2,r.apply(this,[a.sent()])]}})})},t.prototype.predictExpressions=function(e){return xe(this,void 0,void 0,function(){var r,a,o,i,s=this;return be(this,function(u){switch(u.label){case 0:return[4,Tt(e)];case 1:return r=u.sent(),[4,this.forwardInput(r)];case 2:return a=u.sent(),[4,Promise.all(wt(a).map(function(l){return xe(s,void 0,void 0,function(){var c;return be(this,function(p){switch(p.label){case 0:return[4,l.data()];case 1:return c=p.sent(),l.dispose(),[2,c]}})})}))];case 3:return o=u.sent(),a.dispose(),i=o.map(function(l){return new h2(l)}),[2,r.isBatchInput?i:i[0]]}})})},t.prototype.getDefaultModelName=function(){return"face_expression_model"},t.prototype.getClassifierChannelsIn=function(){return 256},t.prototype.getClassifierChannelsOut=function(){return 7},t}(Af);function Pf(n,t){var e={expressions:t};return Object.assign({},n,e)}function m2(n){return t2(n)&&n.landmarks instanceof Ii&&n.unshiftedLandmarks instanceof Ii&&n.alignedRect instanceof er}function fl(n,t){var e=n.detection.box,r=t.shiftBy(e.x,e.y),a=r.align(),o=n.detection.imageDims,i=new er(n.detection.score,a.rescale(o.reverse()),o),s={landmarks:r,unshiftedLandmarks:t,alignedRect:i};return Object.assign({},n,s)}function g2(n,t){var e=Qi(n,t),r=dl(n,t);function a(i,s,u){var l=r(i,s,u+"/separable_conv0"),c=r(s,s,u+"/separable_conv1"),p=e(i,s,1,u+"/expansion_conv");return{separable_conv0:l,separable_conv1:c,expansion_conv:p}}function o(i,s){var u=r(i,i,s+"/separable_conv0"),l=r(i,i,s+"/separable_conv1"),c=r(i,i,s+"/separable_conv2");return{separable_conv0:u,separable_conv1:l,separable_conv2:c}}return{extractConvParams:e,extractSeparableConvParams:r,extractReductionBlockParams:a,extractMainBlockParams:o}}function y2(n,t){var e=[],r=gr(n),a=r.extractWeights,o=r.getRemainingWeights,i=g2(a,e),s=i.extractConvParams,u=i.extractSeparableConvParams,l=i.extractReductionBlockParams,c=i.extractMainBlockParams,p=s(3,32,3,"entry_flow/conv_in"),f=l(32,64,"entry_flow/reduction_block_0"),d=l(64,128,"entry_flow/reduction_block_1"),h={conv_in:p,reduction_block_0:f,reduction_block_1:d},v={};lo(t,0,1).forEach(function(y){v["main_block_"+y]=c(128,"middle_flow/main_block_"+y)});var g=l(128,256,"exit_flow/reduction_block"),m=u(256,512,"exit_flow/separable_conv"),x={reduction_block:g,separable_conv:m};if(o().length!==0)throw new Error("weights remaing after extract: "+o().length);return{paramMappings:e,params:{entry_flow:h,middle_flow:v,exit_flow:x}}}function x2(n,t){var e=Ur(n,t),r=kf(e),a=pl(e);function o(s){var u=a(s+"/separable_conv0"),l=a(s+"/separable_conv1"),c=r(s+"/expansion_conv");return{separable_conv0:u,separable_conv1:l,expansion_conv:c}}function i(s){var u=a(s+"/separable_conv0"),l=a(s+"/separable_conv1"),c=a(s+"/separable_conv2");return{separable_conv0:u,separable_conv1:l,separable_conv2:c}}return{extractConvParams:r,extractSeparableConvParams:a,extractReductionBlockParams:o,extractMainBlockParams:i}}function b2(n,t){var e=[],r=x2(n,e),a=r.extractConvParams,o=r.extractSeparableConvParams,i=r.extractReductionBlockParams,s=r.extractMainBlockParams,u=a("entry_flow/conv_in"),l=i("entry_flow/reduction_block_0"),c=i("entry_flow/reduction_block_1"),p={conv_in:u,reduction_block_0:l,reduction_block_1:c},f={};lo(t,0,1).forEach(function(g){f["main_block_"+g]=s("middle_flow/main_block_"+g)});var d=i("exit_flow/reduction_block"),h=o("exit_flow/separable_conv"),v={reduction_block:d,separable_conv:h};return mr(n,e),{params:{entry_flow:p,middle_flow:f,exit_flow:v},paramMappings:e}}function Of(n,t,e){return Fe(Cn(n,t.filters,e,"same"),t.bias)}function Hs(n,t,e){e===void 0&&(e=!0);var r=e?ot(n):n;return r=fn(r,t.separable_conv0,[1,1]),r=fn(ot(r),t.separable_conv1,[1,1]),r=Dt(r,[3,3],[2,2],"same"),r=Fe(r,Of(n,t.expansion_conv,[2,2])),r}function _2(n,t){var e=fn(ot(n),t.separable_conv0,[1,1]);return e=fn(ot(e),t.separable_conv1,[1,1]),e=fn(ot(e),t.separable_conv2,[1,1]),e=Fe(e,n),e}var w2=function(n){Te(t,n);function t(e){var r=n.call(this,"TinyXception")||this;return r._numMainBlocks=e,r}return t.prototype.forwardInput=function(e){var r=this,a=this.params;if(!a)throw new Error("TinyXception - load model before inference");return fe(function(){var o=e.toBatchTensor(112,!0),i=[122.782,117.001,104.298],s=Do(o,i).div(ce(256)),u=ot(Of(s,a.entry_flow.conv_in,[2,2]));return u=Hs(u,a.entry_flow.reduction_block_0,!1),u=Hs(u,a.entry_flow.reduction_block_1),lo(r._numMainBlocks,0,1).forEach(function(l){u=_2(u,a.middle_flow["main_block_"+l])}),u=Hs(u,a.exit_flow.reduction_block),u=ot(fn(u,a.exit_flow.separable_conv,[1,1])),u})},t.prototype.forward=function(e){return xe(this,void 0,void 0,function(){var r;return be(this,function(a){switch(a.label){case 0:return r=this.forwardInput,[4,Tt(e)];case 1:return[2,r.apply(this,[a.sent()])]}})})},t.prototype.getDefaultModelName=function(){return"tiny_xception_model"},t.prototype.extractParamsFromWeigthMap=function(e){return b2(e,this._numMainBlocks)},t.prototype.extractParams=function(e){return y2(e,this._numMainBlocks)},t}(vr);function E2(n){var t=[],e=gr(n),r=e.extractWeights,a=e.getRemainingWeights,o=cl(r,t),i=o(512,1,"fc/age"),s=o(512,2,"fc/gender");if(a().length!==0)throw new Error("weights remaing after extract: "+a().length);return{paramMappings:t,params:{fc:{age:i,gender:s}}}}function S2(n){var t=[],e=Ur(n,t);function r(o){var i=e(o+"/weights",2),s=e(o+"/bias",1);return{weights:i,bias:s}}var a={fc:{age:r("fc/age"),gender:r("fc/gender")}};return mr(n,t),{params:a,paramMappings:t}}var ki;(function(n){n.FEMALE="female",n.MALE="male"})(ki||(ki={}));var C2=function(n){Te(t,n);function t(e){e===void 0&&(e=new w2(2));var r=n.call(this,"AgeGenderNet")||this;return r._faceFeatureExtractor=e,r}return Object.defineProperty(t.prototype,"faceFeatureExtractor",{get:function(){return this._faceFeatureExtractor},enumerable:!0,configurable:!0}),t.prototype.runNet=function(e){var r=this,a=this.params;if(!a)throw new Error(this._name+" - load model before inference");return fe(function(){var o=e instanceof Di?r.faceFeatureExtractor.forwardInput(e):e,i=Co(o,[7,7],[2,2],"valid").as2D(o.shape[0],-1),s=$n(i,a.fc.age).as1D(),u=$n(i,a.fc.gender);return{age:s,gender:u}})},t.prototype.forwardInput=function(e){var r=this;return fe(function(){var a=r.runNet(e),o=a.age,i=a.gender;return{age:o,gender:fr(i)}})},t.prototype.forward=function(e){return xe(this,void 0,void 0,function(){var r;return be(this,function(a){switch(a.label){case 0:return r=this.forwardInput,[4,Tt(e)];case 1:return[2,r.apply(this,[a.sent()])]}})})},t.prototype.predictAgeAndGender=function(e){return xe(this,void 0,void 0,function(){var r,a,o,i,s,u,l=this;return be(this,function(c){switch(c.label){case 0:return[4,Tt(e)];case 1:return r=c.sent(),[4,this.forwardInput(r)];case 2:return a=c.sent(),o=wt(a.age),i=wt(a.gender),s=o.map(function(p,f){return{ageTensor:p,genderTensor:i[f]}}),[4,Promise.all(s.map(function(p){var f=p.ageTensor,d=p.genderTensor;return xe(l,void 0,void 0,function(){var h,v,g,m,x;return be(this,function(y){switch(y.label){case 0:return[4,f.data()];case 1:return h=y.sent()[0],[4,d.data()];case 2:return v=y.sent()[0],g=v>.5,m=g?ki.MALE:ki.FEMALE,x=g?v:1-v,f.dispose(),d.dispose(),[2,{age:h,gender:m,genderProbability:x}]}})})}))];case 3:return u=c.sent(),a.age.dispose(),a.gender.dispose(),[2,r.isBatchInput?u:u[0]]}})})},t.prototype.getDefaultModelName=function(){return"age_gender_model"},t.prototype.dispose=function(e){e===void 0&&(e=!0),this.faceFeatureExtractor.dispose(e),n.prototype.dispose.call(this,e)},t.prototype.loadClassifierParams=function(e){var r=this.extractClassifierParams(e),a=r.params,o=r.paramMappings;this._params=a,this._paramMappings=o},t.prototype.extractClassifierParams=function(e){return E2(e)},t.prototype.extractParamsFromWeigthMap=function(e){var r=Rf(e),a=r.featureExtractorMap,o=r.classifierMap;return this.faceFeatureExtractor.loadFromWeightMap(a),S2(o)},t.prototype.extractParams=function(e){var r=1539,a=e.slice(0,e.length-r),o=e.slice(e.length-r);return this.faceFeatureExtractor.extractWeights(a),this.extractClassifierParams(o)},t}(vr),Mf=function(n){Te(t,n);function t(){return n!==null&&n.apply(this,arguments)||this}return t.prototype.postProcess=function(e,r,a){var o=a.map(function(s){var u=s.width,l=s.height,c=r/Math.max(l,u);return{width:u*c,height:l*c}}),i=o.length;return fe(function(){var s=function(f,d){return vn([jn([68],f),jn([68],d)],1).as2D(1,136).as1D()},u=function(f,d){var h=o[f],v=h.width,g=h.height;return d(v,g)?Math.abs(v-g)/2:0},l=function(f){return u(f,function(d,h){return d<h})},c=function(f){return u(f,function(d,h){return h<d})},p=e.mul(jn([i,136],r)).sub(vn(Array.from(Array(i),function(f,d){return s(l(d),c(d))}))).div(vn(Array.from(Array(i),function(f,d){return s(o[d].width,o[d].height)})));return p})},t.prototype.forwardInput=function(e){var r=this;return fe(function(){var a=r.runNet(e);return r.postProcess(a,e.inputSize,e.inputDimensions.map(function(o){var i=o[0],s=o[1];return{height:i,width:s}}))})},t.prototype.forward=function(e){return xe(this,void 0,void 0,function(){var r;return be(this,function(a){switch(a.label){case 0:return r=this.forwardInput,[4,Tt(e)];case 1:return[2,r.apply(this,[a.sent()])]}})})},t.prototype.detectLandmarks=function(e){return xe(this,void 0,void 0,function(){var r,a,o,i=this;return be(this,function(s){switch(s.label){case 0:return[4,Tt(e)];case 1:return r=s.sent(),a=fe(function(){return wt(i.forwardInput(r))}),[4,Promise.all(a.map(function(u,l){return xe(i,void 0,void 0,function(){var c,p,f,d,h;return be(this,function(v){switch(v.label){case 0:return f=(p=Array).from,[4,u.data()];case 1:return c=f.apply(p,[v.sent()]),d=c.filter(function(g,m){return Zc(m)}),h=c.filter(function(g,m){return!Zc(m)}),[2,new e2(Array(68).fill(0).map(function(g,m){return new Ge(d[m],h[m])}),{height:r.getInputHeight(l),width:r.getInputWidth(l)})]}})})}))];case 2:return o=s.sent(),a.forEach(function(u){return u.dispose()}),[2,r.isBatchInput?o:o[0]]}})})},t.prototype.getClassifierChannelsOut=function(){return 136},t}(Af),Ff=function(n){Te(t,n);function t(e){return e===void 0&&(e=new Nf),n.call(this,"FaceLandmark68Net",e)||this}return t.prototype.getDefaultModelName=function(){return"face_landmark_68_model"},t.prototype.getClassifierChannelsIn=function(){return 256},t}(Mf);function I2(n){var t=[],e=Tf(n,t).extractDenseBlock3Params,r={dense0:e("dense0",!0),dense1:e("dense1"),dense2:e("dense2")};return mr(n,t),{params:r,paramMappings:t}}function D2(n){var t=[],e=gr(n),r=e.extractWeights,a=e.getRemainingWeights,o=Df(r,t).extractDenseBlock3Params,i=o(3,32,"dense0",!0),s=o(32,64,"dense1"),u=o(64,128,"dense2");if(a().length!==0)throw new Error("weights remaing after extract: "+a().length);return{paramMappings:t,params:{dense0:i,dense1:s,dense2:u}}}var k2=function(n){Te(t,n);function t(){return n.call(this,"TinyFaceFeatureExtractor")||this}return t.prototype.forwardInput=function(e){var r=this.params;if(!r)throw new Error("TinyFaceFeatureExtractor - load model before inference");return fe(function(){var a=e.toBatchTensor(112,!0),o=[122.782,117.001,104.298],i=Do(a,o).div(ce(255)),s=$s(i,r.dense0,!0);return s=$s(s,r.dense1),s=$s(s,r.dense2),s=Co(s,[14,14],[2,2],"valid"),s})},t.prototype.forward=function(e){return xe(this,void 0,void 0,function(){var r;return be(this,function(a){switch(a.label){case 0:return r=this.forwardInput,[4,Tt(e)];case 1:return[2,r.apply(this,[a.sent()])]}})})},t.prototype.getDefaultModelName=function(){return"face_feature_extractor_tiny_model"},t.prototype.extractParamsFromWeigthMap=function(e){return I2(e)},t.prototype.extractParams=function(e){return D2(e)},t}(vr),T2=function(n){Te(t,n);function t(e){return e===void 0&&(e=new k2),n.call(this,"FaceLandmark68TinyNet",e)||this}return t.prototype.getDefaultModelName=function(){return"face_landmark_68_tiny_model"},t.prototype.getClassifierChannelsIn=function(){return 128},t}(Mf);(function(n){Te(t,n);function t(){return n!==null&&n.apply(this,arguments)||this}return t})(Ff);function N2(n,t){return Fe($t(n,t.weights),t.biases)}function hl(n,t,e,r,a){a===void 0&&(a="same");var o=t.conv,i=o.filters,s=o.bias,u=Cn(n,i,e,a);return u=Fe(u,s),u=N2(u,t.scale),r?ot(u):u}function R2(n,t){return hl(n,t,[1,1],!0)}function Vf(n,t){return hl(n,t,[1,1],!1)}function Lf(n,t){return hl(n,t,[2,2],!0,"valid")}function A2(n,t){function e(s,u,l){var c=n(s),p=c.length/(u*l*l);if($w(p))throw new Error("depth has to be an integer: "+p+", weights.length: "+c.length+", numFilters: "+u+", filterSize: "+l);return fe(function(){return Mr(en(c,[u,p,l,l]),[2,3,1,0])})}function r(s,u,l,c){var p=e(s,u,l),f=yt(n(u));return t.push({paramPath:c+"/filters"},{paramPath:c+"/bias"}),{filters:p,bias:f}}function a(s,u){var l=yt(n(s)),c=yt(n(s));return t.push({paramPath:u+"/weights"},{paramPath:u+"/biases"}),{weights:l,biases:c}}function o(s,u,l,c){var p=r(s,u,l,c+"/conv"),f=a(u,c+"/scale");return{conv:p,scale:f}}function i(s,u,l,c,p){p===void 0&&(p=!1);var f=o((p?.5:1)*s,u,l,c+"/conv1"),d=o(s,u,l,c+"/conv2");return{conv1:f,conv2:d}}return{extractConvLayerParams:o,extractResidualLayerParams:i}}function P2(n){var t=gr(n),e=t.extractWeights,r=t.getRemainingWeights,a=[],o=A2(e,a),i=o.extractConvLayerParams,s=o.extractResidualLayerParams,u=i(4704,32,7,"conv32_down"),l=s(9216,32,3,"conv32_1"),c=s(9216,32,3,"conv32_2"),p=s(9216,32,3,"conv32_3"),f=s(36864,64,3,"conv64_down",!0),d=s(36864,64,3,"conv64_1"),h=s(36864,64,3,"conv64_2"),v=s(36864,64,3,"conv64_3"),g=s(147456,128,3,"conv128_down",!0),m=s(147456,128,3,"conv128_1"),x=s(147456,128,3,"conv128_2"),y=s(589824,256,3,"conv256_down",!0),w=s(589824,256,3,"conv256_1"),E=s(589824,256,3,"conv256_2"),D=s(589824,256,3,"conv256_down_out"),k=fe(function(){return Mr(Nr(e(256*128),[128,256]),[1,0])});if(a.push({paramPath:"fc"}),r().length!==0)throw new Error("weights remaing after extract: "+r().length);var S={conv32_down:u,conv32_1:l,conv32_2:c,conv32_3:p,conv64_down:f,conv64_1:d,conv64_2:h,conv64_3:v,conv128_down:g,conv128_1:m,conv128_2:x,conv256_down:y,conv256_1:w,conv256_2:E,conv256_down_out:D,fc:k};return{params:S,paramMappings:a}}function O2(n,t){var e=Ur(n,t);function r(i){var s=e(i+"/scale/weights",1),u=e(i+"/scale/biases",1);return{weights:s,biases:u}}function a(i){var s=e(i+"/conv/filters",4),u=e(i+"/conv/bias",1),l=r(i);return{conv:{filters:s,bias:u},scale:l}}function o(i){return{conv1:a(i+"/conv1"),conv2:a(i+"/conv2")}}return{extractConvLayerParams:a,extractResidualLayerParams:o}}function M2(n){var t=[],e=O2(n,t),r=e.extractConvLayerParams,a=e.extractResidualLayerParams,o=r("conv32_down"),i=a("conv32_1"),s=a("conv32_2"),u=a("conv32_3"),l=a("conv64_down"),c=a("conv64_1"),p=a("conv64_2"),f=a("conv64_3"),d=a("conv128_down"),h=a("conv128_1"),v=a("conv128_2"),g=a("conv256_down"),m=a("conv256_1"),x=a("conv256_2"),y=a("conv256_down_out"),w=n.fc;if(t.push({originalPath:"fc",paramPath:"fc"}),!zw(w))throw new Error("expected weightMap[fc] to be a Tensor2D, instead have "+w);var E={conv32_down:o,conv32_1:i,conv32_2:s,conv32_3:u,conv64_down:l,conv64_1:c,conv64_2:p,conv64_3:f,conv128_down:d,conv128_1:h,conv128_2:v,conv256_down:g,conv256_1:m,conv256_2:x,conv256_down_out:y,fc:w};return mr(n,t),{params:E,paramMappings:t}}function Bn(n,t){var e=R2(n,t.conv1);return e=Vf(e,t.conv2),e=Fe(e,n),e=ot(e),e}function jo(n,t){var e=Lf(n,t.conv1);e=Vf(e,t.conv2);var r=Co(n,2,2,"valid"),a=et(r.shape),o=r.shape[3]!==e.shape[3],i=r.shape[1]!==e.shape[1]||r.shape[2]!==e.shape[2];if(i){var s=no(e.shape);s[1]=1;var u=et(s);e=_t([e,u],1);var l=no(e.shape);l[2]=1;var c=et(l);e=_t([e,c],2)}return r=o?_t([r,a],3):r,e=Fe(r,e),e=ot(e),e}var F2=function(n){Te(t,n);function t(){return n.call(this,"FaceRecognitionNet")||this}return t.prototype.forwardInput=function(e){var r=this.params;if(!r)throw new Error("FaceRecognitionNet - load model before inference");return fe(function(){var a=e.toBatchTensor(150,!0).toFloat(),o=[122.782,117.001,104.298],i=Do(a,o).div(ce(256)),s=Lf(i,r.conv32_down);s=Dt(s,3,2,"valid"),s=Bn(s,r.conv32_1),s=Bn(s,r.conv32_2),s=Bn(s,r.conv32_3),s=jo(s,r.conv64_down),s=Bn(s,r.conv64_1),s=Bn(s,r.conv64_2),s=Bn(s,r.conv64_3),s=jo(s,r.conv128_down),s=Bn(s,r.conv128_1),s=Bn(s,r.conv128_2),s=jo(s,r.conv256_down),s=Bn(s,r.conv256_1),s=Bn(s,r.conv256_2),s=jo(s,r.conv256_down_out);var u=s.mean([1,2]),l=Hi(u,r.fc);return l})},t.prototype.forward=function(e){return xe(this,void 0,void 0,function(){var r;return be(this,function(a){switch(a.label){case 0:return r=this.forwardInput,[4,Tt(e)];case 1:return[2,r.apply(this,[a.sent()])]}})})},t.prototype.computeFaceDescriptor=function(e){return xe(this,void 0,void 0,function(){var r,a,o,i=this;return be(this,function(s){switch(s.label){case 0:return[4,Tt(e)];case 1:return r=s.sent(),a=fe(function(){return wt(i.forwardInput(r))}),[4,Promise.all(a.map(function(u){return u.data()}))];case 2:return o=s.sent(),a.forEach(function(u){return u.dispose()}),[2,r.isBatchInput?o:o[0]]}})})},t.prototype.getDefaultModelName=function(){return"face_recognition_model"},t.prototype.extractParamsFromWeigthMap=function(e){return M2(e)},t.prototype.extractParams=function(e){return P2(e)},t}(vr);function Bf(n,t){var e={descriptor:t};return Object.assign({},n,e)}function Uf(n,t){var e={age:t};return Object.assign({},n,e)}function Wf(n,t,e){var r={gender:t,genderProbability:e};return Object.assign({},n,r)}var qf=function(){function n(t){var e=t===void 0?{}:t,r=e.minFaceSize,a=e.scaleFactor,o=e.maxNumScales,i=e.scoreThresholds,s=e.scaleSteps;if(this._name="MtcnnOptions",this._minFaceSize=r||20,this._scaleFactor=a||.709,this._maxNumScales=o||10,this._scoreThresholds=i||[.6,.7,.7],this._scaleSteps=s,typeof this._minFaceSize!="number"||this._minFaceSize<0)throw new Error(this._name+" - expected minFaceSize to be a number > 0");if(typeof this._scaleFactor!="number"||this._scaleFactor<=0||this._scaleFactor>=1)throw new Error(this._name+" - expected scaleFactor to be a number between 0 and 1");if(typeof this._maxNumScales!="number"||this._maxNumScales<0)throw new Error(this._name+" - expected maxNumScales to be a number > 0");if(!Array.isArray(this._scoreThresholds)||this._scoreThresholds.length!==3||this._scoreThresholds.some(function(u){return typeof u!="number"}))throw new Error(this._name+" - expected scoreThresholds to be an array of numbers of length 3");if(this._scaleSteps&&(!Array.isArray(this._scaleSteps)||this._scaleSteps.some(function(u){return typeof u!="number"})))throw new Error(this._name+" - expected scaleSteps to be an array of numbers")}return Object.defineProperty(n.prototype,"minFaceSize",{get:function(){return this._minFaceSize},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"scaleFactor",{get:function(){return this._scaleFactor},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"maxNumScales",{get:function(){return this._maxNumScales},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"scoreThresholds",{get:function(){return this._scoreThresholds},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"scaleSteps",{get:function(){return this._scaleSteps},enumerable:!0,configurable:!0}),n}();function V2(n,t){function e(u,l){var c=en(n(9*u),[3,3,u,1]),p=yt(n(u)),f=yt(n(u)),d=yt(n(u)),h=yt(n(u));return t.push({paramPath:l+"/filters"},{paramPath:l+"/batch_norm_scale"},{paramPath:l+"/batch_norm_offset"},{paramPath:l+"/batch_norm_mean"},{paramPath:l+"/batch_norm_variance"}),{filters:c,batch_norm_scale:p,batch_norm_offset:f,batch_norm_mean:d,batch_norm_variance:h}}function r(u,l,c,p,f){var d=en(n(u*l*c*c),[c,c,u,l]),h=yt(n(l));return t.push({paramPath:p+"/filters"},{paramPath:p+"/"+(f?"batch_norm_offset":"bias")}),{filters:d,bias:h}}function a(u,l,c,p){var f=r(u,l,c,p,!0),d=f.filters,h=f.bias;return{filters:d,batch_norm_offset:h}}function o(u,l,c){var p=e(u,c+"/depthwise_conv"),f=a(u,l,1,c+"/pointwise_conv");return{depthwise_conv:p,pointwise_conv:f}}function i(){var u=a(3,32,3,"mobilenetv1/conv_0"),l=o(32,64,"mobilenetv1/conv_1"),c=o(64,128,"mobilenetv1/conv_2"),p=o(128,128,"mobilenetv1/conv_3"),f=o(128,256,"mobilenetv1/conv_4"),d=o(256,256,"mobilenetv1/conv_5"),h=o(256,512,"mobilenetv1/conv_6"),v=o(512,512,"mobilenetv1/conv_7"),g=o(512,512,"mobilenetv1/conv_8"),m=o(512,512,"mobilenetv1/conv_9"),x=o(512,512,"mobilenetv1/conv_10"),y=o(512,512,"mobilenetv1/conv_11"),w=o(512,1024,"mobilenetv1/conv_12"),E=o(1024,1024,"mobilenetv1/conv_13");return{conv_0:u,conv_1:l,conv_2:c,conv_3:p,conv_4:f,conv_5:d,conv_6:h,conv_7:v,conv_8:g,conv_9:m,conv_10:x,conv_11:y,conv_12:w,conv_13:E}}function s(){var u=a(1024,256,1,"prediction_layer/conv_0"),l=a(256,512,3,"prediction_layer/conv_1"),c=a(512,128,1,"prediction_layer/conv_2"),p=a(128,256,3,"prediction_layer/conv_3"),f=a(256,128,1,"prediction_layer/conv_4"),d=a(128,256,3,"prediction_layer/conv_5"),h=a(256,64,1,"prediction_layer/conv_6"),v=a(64,128,3,"prediction_layer/conv_7"),g=r(512,12,1,"prediction_layer/box_predictor_0/box_encoding_predictor"),m=r(512,9,1,"prediction_layer/box_predictor_0/class_predictor"),x=r(1024,24,1,"prediction_layer/box_predictor_1/box_encoding_predictor"),y=r(1024,18,1,"prediction_layer/box_predictor_1/class_predictor"),w=r(512,24,1,"prediction_layer/box_predictor_2/box_encoding_predictor"),E=r(512,18,1,"prediction_layer/box_predictor_2/class_predictor"),D=r(256,24,1,"prediction_layer/box_predictor_3/box_encoding_predictor"),k=r(256,18,1,"prediction_layer/box_predictor_3/class_predictor"),S=r(256,24,1,"prediction_layer/box_predictor_4/box_encoding_predictor"),_=r(256,18,1,"prediction_layer/box_predictor_4/class_predictor"),b=r(128,24,1,"prediction_layer/box_predictor_5/box_encoding_predictor"),N=r(128,18,1,"prediction_layer/box_predictor_5/class_predictor"),T={box_encoding_predictor:g,class_predictor:m},P={box_encoding_predictor:x,class_predictor:y},F={box_encoding_predictor:w,class_predictor:E},M={box_encoding_predictor:D,class_predictor:k},L={box_encoding_predictor:S,class_predictor:_},A={box_encoding_predictor:b,class_predictor:N};return{conv_0:u,conv_1:l,conv_2:c,conv_3:p,conv_4:f,conv_5:d,conv_6:h,conv_7:v,box_predictor_0:T,box_predictor_1:P,box_predictor_2:F,box_predictor_3:M,box_predictor_4:L,box_predictor_5:A}}return{extractMobilenetV1Params:i,extractPredictionLayerParams:s}}function L2(n){var t=[],e=gr(n),r=e.extractWeights,a=e.getRemainingWeights,o=V2(r,t),i=o.extractMobilenetV1Params,s=o.extractPredictionLayerParams,u=i(),l=s(),c=Nu(r(5118*4),[1,5118,4]),p={extra_dim:c};if(t.push({paramPath:"output_layer/extra_dim"}),a().length!==0)throw new Error("weights remaing after extract: "+a().length);return{params:{mobilenetv1:u,prediction_layer:l,output_layer:p},paramMappings:t}}function B2(n,t){var e=Ur(n,t);function r(l,c,p){var f=e(l+"/Conv2d_"+c+"_pointwise/weights",4,p+"/filters"),d=e(l+"/Conv2d_"+c+"_pointwise/convolution_bn_offset",1,p+"/batch_norm_offset");return{filters:f,batch_norm_offset:d}}function a(l){var c="mobilenetv1/conv_"+l,p="MobilenetV1/Conv2d_"+l+"_depthwise",f=c+"/depthwise_conv",d=c+"/pointwise_conv",h=e(p+"/depthwise_weights",4,f+"/filters"),v=e(p+"/BatchNorm/gamma",1,f+"/batch_norm_scale"),g=e(p+"/BatchNorm/beta",1,f+"/batch_norm_offset"),m=e(p+"/BatchNorm/moving_mean",1,f+"/batch_norm_mean"),x=e(p+"/BatchNorm/moving_variance",1,f+"/batch_norm_variance");return{depthwise_conv:{filters:h,batch_norm_scale:v,batch_norm_offset:g,batch_norm_mean:m,batch_norm_variance:x},pointwise_conv:r("MobilenetV1",l,d)}}function o(){return{conv_0:r("MobilenetV1",0,"mobilenetv1/conv_0"),conv_1:a(1),conv_2:a(2),conv_3:a(3),conv_4:a(4),conv_5:a(5),conv_6:a(6),conv_7:a(7),conv_8:a(8),conv_9:a(9),conv_10:a(10),conv_11:a(11),conv_12:a(12),conv_13:a(13)}}function i(l,c){var p=e(l+"/weights",4,c+"/filters"),f=e(l+"/biases",1,c+"/bias");return{filters:p,bias:f}}function s(l){var c=i("Prediction/BoxPredictor_"+l+"/BoxEncodingPredictor","prediction_layer/box_predictor_"+l+"/box_encoding_predictor"),p=i("Prediction/BoxPredictor_"+l+"/ClassPredictor","prediction_layer/box_predictor_"+l+"/class_predictor");return{box_encoding_predictor:c,class_predictor:p}}function u(){return{conv_0:r("Prediction",0,"prediction_layer/conv_0"),conv_1:r("Prediction",1,"prediction_layer/conv_1"),conv_2:r("Prediction",2,"prediction_layer/conv_2"),conv_3:r("Prediction",3,"prediction_layer/conv_3"),conv_4:r("Prediction",4,"prediction_layer/conv_4"),conv_5:r("Prediction",5,"prediction_layer/conv_5"),conv_6:r("Prediction",6,"prediction_layer/conv_6"),conv_7:r("Prediction",7,"prediction_layer/conv_7"),box_predictor_0:s(0),box_predictor_1:s(1),box_predictor_2:s(2),box_predictor_3:s(3),box_predictor_4:s(4),box_predictor_5:s(5)}}return{extractMobilenetV1Params:o,extractPredictionLayerParams:u}}function U2(n){var t=[],e=B2(n,t),r=e.extractMobilenetV1Params,a=e.extractPredictionLayerParams,o=n["Output/extra_dim"];if(t.push({originalPath:"Output/extra_dim",paramPath:"output_layer/extra_dim"}),!Yi(o))throw new Error("expected weightMap['Output/extra_dim'] to be a Tensor3D, instead have "+o);var i={mobilenetv1:r(),prediction_layer:a(),output_layer:{extra_dim:o}};return mr(n,t),{params:i,paramMappings:t}}function Un(n,t,e){return fe(function(){var r=Cn(n,t.filters,e,"same");return r=Fe(r,t.batch_norm_offset),Wu(r,0,6)})}var W2=.0010000000474974513;function q2(n,t,e){return fe(function(){var r=$i(n,t.filters,e,"same");return r=Mp(r,t.batch_norm_mean,t.batch_norm_variance,t.batch_norm_offset,t.batch_norm_scale,W2),Wu(r,0,6)})}function z2(n){return[2,4,6,12].some(function(t){return t===n})?[2,2]:[1,1]}function $2(n,t){return fe(function(){var e=null,r=Un(n,t.conv_0,[2,2]),a=[t.conv_1,t.conv_2,t.conv_3,t.conv_4,t.conv_5,t.conv_6,t.conv_7,t.conv_8,t.conv_9,t.conv_10,t.conv_11,t.conv_12,t.conv_13];if(a.forEach(function(o,i){var s=i+1,u=z2(s);r=q2(r,o.depthwise_conv,u),r=Un(r,o.pointwise_conv,[1,1]),s===11&&(e=r)}),e===null)throw new Error("mobileNetV1 - output of conv layer 11 is null");return{out:r,conv11:e}})}function H2(n,t,e,r,a){var o=n.shape[0],i=Math.min(e,o),s=t.map(function(c,p){return{score:c,boxIndex:p}}).filter(function(c){return c.score>a}).sort(function(c,p){return p.score-c.score}),u=function(c){return c<=r?1:0},l=[];return s.forEach(function(c){if(!(l.length>=i)){for(var p=c.score,f=l.length-1;f>=0;--f){var d=G2(n,c.boxIndex,l[f]);if(d!==0&&(c.score*=u(d),c.score<=a))break}p===c.score&&l.push(c.boxIndex)}}),l}function G2(n,t,e){var r=n.arraySync(),a=Math.min(r[t][0],r[t][2]),o=Math.min(r[t][1],r[t][3]),i=Math.max(r[t][0],r[t][2]),s=Math.max(r[t][1],r[t][3]),u=Math.min(r[e][0],r[e][2]),l=Math.min(r[e][1],r[e][3]),c=Math.max(r[e][0],r[e][2]),p=Math.max(r[e][1],r[e][3]),f=(i-a)*(s-o),d=(c-u)*(p-l);if(f<=0||d<=0)return 0;var h=Math.max(a,u),v=Math.max(o,l),g=Math.min(i,c),m=Math.min(s,p),x=Math.max(g-h,0)*Math.max(m-v,0);return x/(f+d-x)}function j2(n){var t=wt(Mr(n,[1,0])),e=[St(t[2],t[0]),St(t[3],t[1])],r=[Fe(t[0],Tn(e[0],ce(2))),Fe(t[1],Tn(e[1],ce(2)))];return{sizes:e,centers:r}}function X2(n,t){var e=j2(n),r=e.sizes,a=e.centers,o=wt(Mr(t,[1,0])),i=Tn($t(cu(Tn(o[2],ce(5))),r[0]),ce(2)),s=Fe($t(Tn(o[0],ce(10)),r[0]),a[0]),u=Tn($t(cu(Tn(o[3],ce(5))),r[1]),ce(2)),l=Fe($t(Tn(o[1],ce(10)),r[1]),a[1]);return Mr(vn([St(s,i),St(l,u),Fe(s,i),Fe(l,u)]),[1,0])}function Y2(n,t,e){return fe(function(){var r=n.shape[0],a=X2(Nn(xa(e.extra_dim,[r,1,1]),[-1,4]),Nn(n,[-1,4]));a=Nn(a,[r,a.shape[0]/r,4]);var o=Rp(Yn(t,[0,0,1],[-1,-1,-1])),i=Yn(o,[0,0,0],[-1,-1,1]);i=Nn(i,[r,i.shape[1]]);var s=wt(a),u=wt(i);return{boxes:s,scores:u}})}function da(n,t){return fe(function(){var e=n.shape[0],r=Nn(Pn(n,t.box_encoding_predictor),[e,-1,1,4]),a=Nn(Pn(n,t.class_predictor),[e,-1,3]);return{boxPredictionEncoding:r,classPrediction:a}})}function K2(n,t,e){return fe(function(){var r=Un(n,e.conv_0,[1,1]),a=Un(r,e.conv_1,[2,2]),o=Un(a,e.conv_2,[1,1]),i=Un(o,e.conv_3,[2,2]),s=Un(i,e.conv_4,[1,1]),u=Un(s,e.conv_5,[2,2]),l=Un(u,e.conv_6,[1,1]),c=Un(l,e.conv_7,[2,2]),p=da(t,e.box_predictor_0),f=da(n,e.box_predictor_1),d=da(a,e.box_predictor_2),h=da(i,e.box_predictor_3),v=da(u,e.box_predictor_4),g=da(c,e.box_predictor_5),m=_t([p.boxPredictionEncoding,f.boxPredictionEncoding,d.boxPredictionEncoding,h.boxPredictionEncoding,v.boxPredictionEncoding,g.boxPredictionEncoding],1),x=_t([p.classPrediction,f.classPrediction,d.classPrediction,h.classPrediction,v.classPrediction,g.classPrediction],1);return{boxPredictions:m,classPredictions:x}})}var Zi=function(){function n(t){var e=t===void 0?{}:t,r=e.minConfidence,a=e.maxResults;if(this._name="SsdMobilenetv1Options",this._minConfidence=r||.5,this._maxResults=a||100,typeof this._minConfidence!="number"||this._minConfidence<=0||this._minConfidence>=1)throw new Error(this._name+" - expected minConfidence to be a number between 0 and 1");if(typeof this._maxResults!="number")throw new Error(this._name+" - expected maxResults to be a number")}return Object.defineProperty(n.prototype,"minConfidence",{get:function(){return this._minConfidence},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"maxResults",{get:function(){return this._maxResults},enumerable:!0,configurable:!0}),n}(),zf=function(n){Te(t,n);function t(){return n.call(this,"SsdMobilenetv1")||this}return t.prototype.forwardInput=function(e){var r=this.params;if(!r)throw new Error("SsdMobilenetv1 - load model before inference");return fe(function(){var a=e.toBatchTensor(512,!1).toFloat(),o=St($t(a,ce(.007843137718737125)),ce(1)),i=$2(o,r.mobilenetv1),s=K2(i.out,i.conv11,r.prediction_layer),u=s.boxPredictions,l=s.classPredictions;return Y2(u,l,r.output_layer)})},t.prototype.forward=function(e){return xe(this,void 0,void 0,function(){var r;return be(this,function(a){switch(a.label){case 0:return r=this.forwardInput,[4,Tt(e)];case 1:return[2,r.apply(this,[a.sent()])]}})})},t.prototype.locateFaces=function(e,r){return r===void 0&&(r={}),xe(this,void 0,void 0,function(){var a,o,i,s,u,l,c,p,f,d,h,v,g,m,x,y,w,E,D,k,S;return be(this,function(_){switch(_.label){case 0:return a=new Zi(r),o=a.maxResults,i=a.minConfidence,[4,Tt(e)];case 1:for(s=_.sent(),u=this.forwardInput(s),l=u.boxes,c=u.scores,p=l[0],f=c[0],d=1;d<l.length;d++)l[d].dispose(),c[d].dispose();return g=(v=Array).from,[4,f.data()];case 2:return h=g.apply(v,[_.sent()]),m=.5,x=H2(p,h,o,m,i),y=s.getReshapedInputDimensions(0),w=s.inputSize,E=w/y.width,D=w/y.height,k=p.arraySync(),S=x.map(function(b){var N=[Math.max(0,k[b][0]),Math.min(1,k[b][2])].map(function(A){return A*D}),T=N[0],P=N[1],F=[Math.max(0,k[b][1]),Math.min(1,k[b][3])].map(function(A){return A*E}),M=F[0],L=F[1];return new er(h[b],new al(M,T,L-M,P-T),{height:s.getInputHeight(0),width:s.getInputWidth(0)})}),p.dispose(),f.dispose(),[2,S]}})})},t.prototype.getDefaultModelName=function(){return"ssd_mobilenetv1_model"},t.prototype.extractParamsFromWeigthMap=function(e){return U2(e)},t.prototype.extractParams=function(e){return L2(e)},t}(vr);(function(n){Te(t,n);function t(){return n!==null&&n.apply(this,arguments)||this}return t})(zf);var J2=.4,Q2=[new Ge(.738768,.874946),new Ge(2.42204,2.65704),new Ge(4.30971,7.04493),new Ge(10.246,4.59428),new Ge(12.6868,11.8741)],Z2=[new Ge(1.603231,2.094468),new Ge(6.041143,7.080126),new Ge(2.882459,3.518061),new Ge(4.266906,5.178857),new Ge(9.041765,10.66308)],eE=[117.001,114.697,97.404],tE="tiny_yolov2_model",nE="tiny_yolov2_separable_conv_model",Xo=function(n){return typeof n=="number"};function rE(n){if(!n)throw new Error("invalid config: "+n);if(typeof n.withSeparableConvs!="boolean")throw new Error("config.withSeparableConvs has to be a boolean, have: "+n.withSeparableConvs);if(!Xo(n.iouThreshold)||n.iouThreshold<0||n.iouThreshold>1)throw new Error("config.iouThreshold has to be a number between [0, 1], have: "+n.iouThreshold);if(!Array.isArray(n.classes)||!n.classes.length||!n.classes.every(function(t){return typeof t=="string"}))throw new Error("config.classes has to be an array class names: string[], have: "+JSON.stringify(n.classes));if(!Array.isArray(n.anchors)||!n.anchors.length||!n.anchors.map(function(t){return t||{}}).every(function(t){return Xo(t.x)&&Xo(t.y)}))throw new Error("config.anchors has to be an array of { x: number, y: number }, have: "+JSON.stringify(n.anchors));if(n.meanRgb&&(!Array.isArray(n.meanRgb)||n.meanRgb.length!==3||!n.meanRgb.every(Xo)))throw new Error("config.meanRgb has to be an array of shape [number, number, number], have: "+JSON.stringify(n.meanRgb))}function vl(n){return fe(function(){var t=$t(n,ce(.10000000149011612));return Fe(ot(St(n,t)),t)})}function wr(n,t){return fe(function(){var e=aa(n,[[0,0],[1,1],[1,1],[0,0]]);return e=Cn(e,t.conv.filters,[1,1],"valid"),e=St(e,t.bn.sub),e=$t(e,t.bn.truediv),e=Fe(e,t.conv.bias),vl(e)})}function Er(n,t){return fe(function(){var e=aa(n,[[0,0],[1,1],[1,1],[0,0]]);return e=Hu(e,t.depthwise_filter,t.pointwise_filter,[1,1],"valid"),e=Fe(e,t.bias),vl(e)})}function aE(n,t){var e=Qi(n,t);function r(i,s){var u=yt(n(i)),l=yt(n(i));return t.push({paramPath:s+"/sub"},{paramPath:s+"/truediv"}),{sub:u,truediv:l}}function a(i,s,u){var l=e(i,s,3,u+"/conv"),c=r(s,u+"/bn");return{conv:l,bn:c}}var o=dl(n,t);return{extractConvParams:e,extractConvWithBatchNormParams:a,extractSeparableConvParams:o}}function oE(n,t,e,r){var a=gr(n),o=a.extractWeights,i=a.getRemainingWeights,s=[],u=aE(o,s),l=u.extractConvParams,c=u.extractConvWithBatchNormParams,p=u.extractSeparableConvParams,f;if(t.withSeparableConvs){var d=r[0],h=r[1],v=r[2],g=r[3],m=r[4],x=r[5],y=r[6],w=r[7],E=r[8],D=t.isFirstLayerConv2d?l(d,h,3,"conv0"):p(d,h,"conv0"),k=p(h,v,"conv1"),S=p(v,g,"conv2"),_=p(g,m,"conv3"),b=p(m,x,"conv4"),N=p(x,y,"conv5"),T=w?p(y,w,"conv6"):void 0,P=E?p(w,E,"conv7"):void 0,F=l(E||w||y,5*e,1,"conv8");f={conv0:D,conv1:k,conv2:S,conv3:_,conv4:b,conv5:N,conv6:T,conv7:P,conv8:F}}else{var d=r[0],h=r[1],v=r[2],g=r[3],m=r[4],x=r[5],y=r[6],w=r[7],E=r[8],D=c(d,h,"conv0"),k=c(h,v,"conv1"),S=c(v,g,"conv2"),_=c(g,m,"conv3"),b=c(m,x,"conv4"),N=c(x,y,"conv5"),T=c(y,w,"conv6"),P=c(w,E,"conv7"),F=l(E,5*e,1,"conv8");f={conv0:D,conv1:k,conv2:S,conv3:_,conv4:b,conv5:N,conv6:T,conv7:P,conv8:F}}if(i().length!==0)throw new Error("weights remaing after extract: "+i().length);return{params:f,paramMappings:s}}function iE(n,t){var e=Ur(n,t);function r(s){var u=e(s+"/sub",1),l=e(s+"/truediv",1);return{sub:u,truediv:l}}function a(s){var u=e(s+"/filters",4),l=e(s+"/bias",1);return{filters:u,bias:l}}function o(s){var u=a(s+"/conv"),l=r(s+"/bn");return{conv:u,bn:l}}var i=pl(e);return{extractConvParams:a,extractConvWithBatchNormParams:o,extractSeparableConvParams:i}}function sE(n,t){var e=[],r=iE(n,e),a=r.extractConvParams,o=r.extractConvWithBatchNormParams,i=r.extractSeparableConvParams,s;if(t.withSeparableConvs){var u=t.filterSizes&&t.filterSizes.length||9;s={conv0:t.isFirstLayerConv2d?a("conv0"):i("conv0"),conv1:i("conv1"),conv2:i("conv2"),conv3:i("conv3"),conv4:i("conv4"),conv5:i("conv5"),conv6:u>7?i("conv6"):void 0,conv7:u>8?i("conv7"):void 0,conv8:a("conv8")}}else s={conv0:o("conv0"),conv1:o("conv1"),conv2:o("conv2"),conv3:o("conv3"),conv4:o("conv4"),conv5:o("conv5"),conv6:o("conv6"),conv7:o("conv7"),conv8:a("conv8")};return mr(n,e),{params:s,paramMappings:e}}var sd;(function(n){n[n.XS=224]="XS",n[n.SM=320]="SM",n[n.MD=416]="MD",n[n.LG=608]="LG"})(sd||(sd={}));var ml=function(){function n(t){var e=t===void 0?{}:t,r=e.inputSize,a=e.scoreThreshold;if(this._name="TinyYolov2Options",this._inputSize=r||416,this._scoreThreshold=a||.5,typeof this._inputSize!="number"||this._inputSize%32!==0)throw new Error(this._name+" - expected inputSize to be a number divisible by 32");if(typeof this._scoreThreshold!="number"||this._scoreThreshold<=0||this._scoreThreshold>=1)throw new Error(this._name+" - expected scoreThreshold to be a number between 0 and 1")}return Object.defineProperty(n.prototype,"inputSize",{get:function(){return this._inputSize},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"scoreThreshold",{get:function(){return this._scoreThreshold},enumerable:!0,configurable:!0}),n}(),$f=function(n){Te(t,n);function t(e){var r=n.call(this,"TinyYolov2")||this;return rE(e),r._config=e,r}return Object.defineProperty(t.prototype,"config",{get:function(){return this._config},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"withClassScores",{get:function(){return this.config.withClassScores||this.config.classes.length>1},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"boxEncodingSize",{get:function(){return 5+(this.withClassScores?this.config.classes.length:0)},enumerable:!0,configurable:!0}),t.prototype.runTinyYolov2=function(e,r){var a=wr(e,r.conv0);return a=Dt(a,[2,2],[2,2],"same"),a=wr(a,r.conv1),a=Dt(a,[2,2],[2,2],"same"),a=wr(a,r.conv2),a=Dt(a,[2,2],[2,2],"same"),a=wr(a,r.conv3),a=Dt(a,[2,2],[2,2],"same"),a=wr(a,r.conv4),a=Dt(a,[2,2],[2,2],"same"),a=wr(a,r.conv5),a=Dt(a,[2,2],[1,1],"same"),a=wr(a,r.conv6),a=wr(a,r.conv7),Pn(a,r.conv8,"valid",!1)},t.prototype.runMobilenet=function(e,r){var a=this.config.isFirstLayerConv2d?vl(Pn(e,r.conv0,"valid",!1)):Er(e,r.conv0);return a=Dt(a,[2,2],[2,2],"same"),a=Er(a,r.conv1),a=Dt(a,[2,2],[2,2],"same"),a=Er(a,r.conv2),a=Dt(a,[2,2],[2,2],"same"),a=Er(a,r.conv3),a=Dt(a,[2,2],[2,2],"same"),a=Er(a,r.conv4),a=Dt(a,[2,2],[2,2],"same"),a=Er(a,r.conv5),a=Dt(a,[2,2],[1,1],"same"),a=r.conv6?Er(a,r.conv6):a,a=r.conv7?Er(a,r.conv7):a,Pn(a,r.conv8,"valid",!1)},t.prototype.forwardInput=function(e,r){var a=this,o=this.params;if(!o)throw new Error("TinyYolov2 - load model before inference");return fe(function(){var i=e.toBatchTensor(r,!1).toFloat();return i=a.config.meanRgb?Do(i,a.config.meanRgb):i,i=i.div(ce(256)),a.config.withSeparableConvs?a.runMobilenet(i,o):a.runTinyYolov2(i,o)})},t.prototype.forward=function(e,r){return xe(this,void 0,void 0,function(){var a;return be(this,function(o){switch(o.label){case 0:return a=this.forwardInput,[4,Tt(e)];case 1:return[4,a.apply(this,[o.sent(),r])];case 2:return[2,o.sent()]}})})},t.prototype.detect=function(e,r){return r===void 0&&(r={}),xe(this,void 0,void 0,function(){var a,o,i,s,u,l,c,p,f,d,h,v,g,m,x=this;return be(this,function(y){switch(y.label){case 0:return a=new ml(r),o=a.inputSize,i=a.scoreThreshold,[4,Tt(e)];case 1:return s=y.sent(),[4,this.forwardInput(s,o)];case 2:return u=y.sent(),l=fe(function(){return wt(u)[0].expandDims()}),c={width:s.getInputWidth(0),height:s.getInputHeight(0)},[4,this.extractBoxes(l,s.getReshapedInputDimensions(0),i)];case 3:return p=y.sent(),u.dispose(),l.dispose(),f=p.map(function(w){return w.box}),d=p.map(function(w){return w.score}),h=p.map(function(w){return w.classScore}),v=p.map(function(w){return x.config.classes[w.label]}),g=co(f.map(function(w){return w.rescale(o)}),d,this.config.iouThreshold,!0),m=g.map(function(w){return new mf(d[w],h[w],v[w],f[w],c)}),[2,m]}})})},t.prototype.getDefaultModelName=function(){return""},t.prototype.extractParamsFromWeigthMap=function(e){return sE(e,this.config)},t.prototype.extractParams=function(e){var r=this.config.filterSizes||t.DEFAULT_FILTER_SIZES,a=r?r.length:void 0;if(a!==7&&a!==8&&a!==9)throw new Error("TinyYolov2 - expected 7 | 8 | 9 convolutional filters, but found "+a+" filterSizes in config");return oE(e,this.config,this.boxEncodingSize,r)},t.prototype.extractBoxes=function(e,r,a){return xe(this,void 0,void 0,function(){var o,i,s,u,l,c,p,f,d,h,v,g,m,x,y,w,E,D,k,S,_,b,N,T,P,F,M,L,A,$=this;return be(this,function(q){switch(q.label){case 0:return o=r.width,i=r.height,s=Math.max(o,i),u=s/o,l=s/i,c=e.shape[1],p=this.config.anchors.length,f=fe(function(){var z=e.reshape([c,c,p,$.boxEncodingSize]),K=z.slice([0,0,0,0],[c,c,p,4]),re=z.slice([0,0,0,4],[c,c,p,1]),ae=$.withClassScores?fr(z.slice([0,0,0,5],[c,c,p,$.config.classes.length]),3):ce(0);return[K,re,ae]}),d=f[0],h=f[1],v=f[2],g=[],[4,h.array()];case 1:return m=q.sent(),[4,d.array()];case 2:x=q.sent(),y=0,q.label=3;case 3:if(!(y<c))return[3,12];w=0,q.label=4;case 4:if(!(w<c))return[3,11];E=0,q.label=5;case 5:return E<p?(D=zs(m[y][w][E][0]),!a||D>a?(k=(w+zs(x[y][w][E][0]))/c*u,S=(y+zs(x[y][w][E][1]))/c*l,_=Math.exp(x[y][w][E][2])*this.config.anchors[E].x/c*u,b=Math.exp(x[y][w][E][3])*this.config.anchors[E].y/c*l,N=k-_/2,T=S-b/2,P={row:y,col:w,anchor:E},this.withClassScores?[4,this.extractPredictedClass(v,P)]:[3,7]):[3,9]):[3,10];case 6:return A=q.sent(),[3,8];case 7:A={classScore:1,label:0},q.label=8;case 8:F=A,M=F.classScore,L=F.label,g.push(Wt({box:new Ki(N,T,N+_,T+b),score:D,classScore:D*M,label:L},P)),q.label=9;case 9:return E++,[3,5];case 10:return w++,[3,4];case 11:return y++,[3,3];case 12:return d.dispose(),h.dispose(),v.dispose(),[2,g]}})})},t.prototype.extractPredictedClass=function(e,r){return xe(this,void 0,void 0,function(){var a,o,i,s;return be(this,function(u){switch(u.label){case 0:return a=r.row,o=r.col,i=r.anchor,[4,e.array()];case 1:return s=u.sent(),[2,Array(this.config.classes.length).fill(0).map(function(l,c){return s[a][o][i][c]}).map(function(l,c){return{classScore:l,label:c}}).reduce(function(l,c){return l.classScore>c.classScore?l:c})]}})})},t.DEFAULT_FILTER_SIZES=[3,16,32,64,128,256,512,1024,1024],t}(vr),uE=function(n){Te(t,n);function t(e){e===void 0&&(e=!0);var r=this,a=Object.assign({},{withSeparableConvs:e,iouThreshold:J2,classes:["face"]},e?{anchors:Z2,meanRgb:eE}:{anchors:Q2,withClassScores:!0});return r=n.call(this,a)||this,r}return Object.defineProperty(t.prototype,"withSeparableConvs",{get:function(){return this.config.withSeparableConvs},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"anchors",{get:function(){return this.config.anchors},enumerable:!0,configurable:!0}),t.prototype.locateFaces=function(e,r){return xe(this,void 0,void 0,function(){var a;return be(this,function(o){switch(o.label){case 0:return[4,this.detect(e,r)];case 1:return a=o.sent(),[2,a.map(function(i){return new er(i.score,i.relativeBox,{width:i.imageWidth,height:i.imageHeight})})]}})})},t.prototype.getDefaultModelName=function(){return this.withSeparableConvs?nE:tE},t.prototype.extractParamsFromWeigthMap=function(e){return n.prototype.extractParamsFromWeigthMap.call(this,e)},t}($f),lE=function(n){Te(t,n);function t(){var e=n!==null&&n.apply(this,arguments)||this;return e._name="TinyFaceDetectorOptions",e}return t}(ml),ko=function(){function n(){}return n.prototype.then=function(t){return xe(this,void 0,void 0,function(){var e;return be(this,function(r){switch(r.label){case 0:return e=t,[4,this.run()];case 1:return[2,e.apply(void 0,[r.sent()])]}})})},n.prototype.run=function(){return xe(this,void 0,void 0,function(){return be(this,function(t){throw new Error("ComposableTask - run is not implemented")})})},n}();function es(n,t,e,r,a){return a===void 0&&(a=function(o){var i=o.alignedRect;return i}),xe(this,void 0,void 0,function(){var o,i,s,u,l;return be(this,function(c){switch(c.label){case 0:return o=n.map(function(p){return m2(p)?a(p):p.detection}),s=r,s?[3,5]:t instanceof at?[4,ll(t,o)]:[3,2];case 1:return u=c.sent(),[3,4];case 2:return[4,ul(t,o)];case 3:u=c.sent(),c.label=4;case 4:s=u,c.label=5;case 5:return i=s,[4,e(i)];case 6:return l=c.sent(),i.forEach(function(p){return p instanceof at&&p.dispose()}),[2,l]}})})}function gl(n,t,e,r,a){return xe(this,void 0,void 0,function(){var o=this;return be(this,function(i){return[2,es([n],t,function(s){return xe(o,void 0,void 0,function(){return be(this,function(u){return[2,e(s[0])]})})},r,a)]})})}function cE(n){return fe(function(){return vn(wt(n,3).reverse(),3)})}var Yo=2,Ti=12;function dE(n,t){var e=Qi(n,t),r=cl(n,t);function a(l,c){var p=yt(n(l));return t.push({paramPath:c}),p}function o(l,c,p){p===void 0&&(p=!1);var f=e(l[0],l[1],3,c+"/conv1"),d=a(l[1],c+"/prelu1_alpha"),h=e(l[1],l[2],3,c+"/conv2"),v=a(l[2],c+"/prelu2_alpha"),g=e(l[2],l[3],p?2:3,c+"/conv3"),m=a(l[3],c+"/prelu3_alpha");return{conv1:f,prelu1_alpha:d,conv2:h,prelu2_alpha:v,conv3:g,prelu3_alpha:m}}function i(){var l=o([3,10,16,32],"pnet"),c=e(32,2,1,"pnet/conv4_1"),p=e(32,4,1,"pnet/conv4_2");return Wt(Wt({},l),{conv4_1:c,conv4_2:p})}function s(){var l=o([3,28,48,64],"rnet",!0),c=r(576,128,"rnet/fc1"),p=a(128,"rnet/prelu4_alpha"),f=r(128,2,"rnet/fc2_1"),d=r(128,4,"rnet/fc2_2");return Wt(Wt({},l),{fc1:c,prelu4_alpha:p,fc2_1:f,fc2_2:d})}function u(){var l=o([3,32,64,64],"onet"),c=e(64,128,2,"onet/conv4"),p=a(128,"onet/prelu4_alpha"),f=r(1152,256,"onet/fc1"),d=a(256,"onet/prelu5_alpha"),h=r(256,2,"onet/fc2_1"),v=r(256,4,"onet/fc2_2"),g=r(256,10,"onet/fc2_3");return Wt(Wt({},l),{conv4:c,prelu4_alpha:p,fc1:f,prelu5_alpha:d,fc2_1:h,fc2_2:v,fc2_3:g})}return{extractPNetParams:i,extractRNetParams:s,extractONetParams:u}}function pE(n){var t=gr(n),e=t.extractWeights,r=t.getRemainingWeights,a=[],o=dE(e,a),i=o.extractPNetParams,s=o.extractRNetParams,u=o.extractONetParams,l=i(),c=s(),p=u();if(r().length!==0)throw new Error("weights remaing after extract: "+r().length);return{params:{pnet:l,rnet:c,onet:p},paramMappings:a}}function fE(n,t){var e=Ur(n,t);function r(c){var p=e(c+"/weights",4,c+"/filters"),f=e(c+"/bias",1);return{filters:p,bias:f}}function a(c){var p=e(c+"/weights",2),f=e(c+"/bias",1);return{weights:p,bias:f}}function o(c){return e(c,1)}function i(c){var p=r(c+"/conv1"),f=o(c+"/prelu1_alpha"),d=r(c+"/conv2"),h=o(c+"/prelu2_alpha"),v=r(c+"/conv3"),g=o(c+"/prelu3_alpha");return{conv1:p,prelu1_alpha:f,conv2:d,prelu2_alpha:h,conv3:v,prelu3_alpha:g}}function s(){var c=i("pnet"),p=r("pnet/conv4_1"),f=r("pnet/conv4_2");return Wt(Wt({},c),{conv4_1:p,conv4_2:f})}function u(){var c=i("rnet"),p=a("rnet/fc1"),f=o("rnet/prelu4_alpha"),d=a("rnet/fc2_1"),h=a("rnet/fc2_2");return Wt(Wt({},c),{fc1:p,prelu4_alpha:f,fc2_1:d,fc2_2:h})}function l(){var c=i("onet"),p=r("onet/conv4"),f=o("onet/prelu4_alpha"),d=a("onet/fc1"),h=o("onet/prelu5_alpha"),v=a("onet/fc2_1"),g=a("onet/fc2_2"),m=a("onet/fc2_3");return Wt(Wt({},c),{conv4:p,prelu4_alpha:f,fc1:d,prelu5_alpha:h,fc2_1:v,fc2_2:g,fc2_3:m})}return{extractPNetParams:s,extractRNetParams:u,extractONetParams:l}}function hE(n){var t=[],e=fE(n,t),r=e.extractPNetParams,a=e.extractRNetParams,o=e.extractONetParams,i=r(),s=a(),u=o();return mr(n,t),{params:{pnet:i,rnet:s,onet:u},paramMappings:t}}function yu(n,t){var e=t[0],r=t[1];return{height:Math.floor(e*n),width:Math.floor(r*n)}}function vE(n,t,e){for(var r=e[0],a=e[1],o=Ti/n,i=[],s=Math.min(r,a)*o,u=0;s>=12;)i.push(o*Math.pow(t,u)),s=s*t,u+=1;return i}var yl=function(n){Te(t,n);function t(e,r,a,o){return n.call(this,{left:e,top:r,right:a,bottom:o},!0)||this}return t}(Fr);function Hf(n){return fe(function(){return $t(St(n,ce(127.5)),ce(.0078125))})}function Ca(n,t){return fe(function(){return Fe(ot(n),$t(t,wi(ot(wi(n)))))})}function xl(n,t,e){return e===void 0&&(e=!1),fe(function(){var r=Pn(n,t.conv1,"valid");return r=Ca(r,t.prelu1_alpha),r=Dt(r,e?[2,2]:[3,3],[2,2],"same"),r=Pn(r,t.conv2,"valid"),r=Ca(r,t.prelu2_alpha),r=e?r:Dt(r,[3,3],[2,2],"valid"),r=Pn(r,t.conv3,"valid"),r=Ca(r,t.prelu3_alpha),r})}function mE(n,t){return fe(function(){var e=xl(n,t,!0),r=Pn(e,t.conv4_1,"valid"),a=bn(Gi(r,3),3),o=fr(St(r,a),3),i=Pn(e,t.conv4_2,"valid");return{prob:o,regions:i}})}function gE(n,t){return fe(function(){var e=yu(t,n.shape.slice(1)),r=e.height,a=e.width,o=Ku.resizeBilinear(n,[r,a]),i=Hf(o);return Mr(i,[0,2,1,3])})}function yE(n,t,e,r){for(var a=[],o=n.arraySync(),i=0;i<n.shape[0];i++)for(var s=0;s<n.shape[1];s++)o[i][s]>=r&&a.push(new Ge(s,i));var u=a.map(function(l){var c=new Ki(Math.round((l.y*Yo+1)/e),Math.round((l.x*Yo+1)/e),Math.round((l.y*Yo+Ti)/e),Math.round((l.x*Yo+Ti)/e)),p=o[l.y][l.x],f=t.arraySync(),d=new yl(f[l.y][l.x][0],f[l.y][l.x][1],f[l.y][l.x][2],f[l.y][l.x][3]);return{cell:c,score:p,region:d}});return u}function xE(n,t,e,r,a){a.stage1=[];var o=t.map(function(f){return fe(function(){var d={scale:f},h=gE(n,f),v=Date.now(),g=mE(h,r),m=g.prob,x=g.regions;d.pnet=Date.now()-v;var y=wt(wt(m,3)[1])[0],w=wt(x)[0];return{scoresTensor:y,regionsTensor:w,scale:f,statsForScale:d}})}),i=o.map(function(f){var d=f.scoresTensor,h=f.regionsTensor,v=f.scale,g=f.statsForScale,m=yE(d,h,v,e);if(d.dispose(),h.dispose(),!m.length)return a.stage1.push(g),[];var x=Date.now(),y=co(m.map(function(w){return w.cell}),m.map(function(w){return w.score}),.5);return g.nms=Date.now()-x,g.numBoxes=y.length,a.stage1.push(g),y.map(function(w){return m[w]})}),s=i.reduce(function(f,d){return f.concat(d)},[]),u=[],l=[];if(s.length>0){var c=Date.now(),p=co(s.map(function(f){return f.cell}),s.map(function(f){return f.score}),.7);a.stage1_nms=Date.now()-c,l=p.map(function(f){return s[f].score}),u=p.map(function(f){return s[f]}).map(function(f){var d=f.cell,h=f.region;return new Ki(d.left+h.left*d.width,d.top+h.top*d.height,d.right+h.right*d.width,d.bottom+h.bottom*d.height).toSquare().round()})}return{boxes:u,scores:l}}function Gf(n,t,e){var r=e.width,a=e.height;return xe(this,void 0,void 0,function(){var o,i,s,u=this;return be(this,function(l){switch(l.label){case 0:return o=Qr(n),[4,Promise.all(t.map(function(c){return xe(u,void 0,void 0,function(){var p,f,d,h,v,g,m,x;return be(this,function(y){return p=c.padAtBorders(n.height,n.width),f=p.y,d=p.ey,h=p.x,v=p.ex,g=h-1,m=f-1,x=o.getImageData(g,m,v-g,d-m),[2,Gt.isNodejs()?sl(x):createImageBitmap(x)]})})}))];case 1:return i=l.sent(),s=[],i.forEach(function(c){var p=Ji({width:r,height:a}),f=Qr(p);f.drawImage(c,0,0,r,a);for(var d=f.getImageData(0,0,r,a).data,h=[],v=0;v<d.length;v+=4)h.push(d[v+2]),h.push(d[v+1]),h.push(d[v]);s.push(h)}),[2,s.map(function(c){var p=fe(function(){var f=Mr(en(c,[1,r,a,3]),[0,2,1,3]).toFloat();return Hf(f)});return p})]}})})}function bE(n,t){return fe(function(){var e=xl(n,t),r=Nn(e,[e.shape[0],t.fc1.weights.shape[0]]),a=$n(r,t.fc1),o=Ca(a,t.prelu4_alpha),i=$n(o,t.fc2_1),s=bn(Gi(i,1),1),u=fr(St(i,s),1),l=$n(o,t.fc2_2),c=wt(u,1)[1];return{scores:c,regions:l}})}function _E(n,t,e,r,a){return xe(this,void 0,void 0,function(){var o,i,s,u,l,c,p,f,d,h,v,g,m,x;return be(this,function(y){switch(y.label){case 0:return o=Date.now(),[4,Gf(n,t,{width:24,height:24})];case 1:return i=y.sent(),a.stage2_extractImagePatches=Date.now()-o,o=Date.now(),s=i.map(function(w){var E=bE(w,r);return w.dispose(),E}),a.stage2_rnet=Date.now()-o,u=s.length>1?_t(s.map(function(w){return w.scores})):s[0].scores,p=(c=Array).from,[4,u.data()];case 2:return l=p.apply(c,[y.sent()]),u.dispose(),f=l.map(function(w,E){return{score:w,idx:E}}).filter(function(w){return w.score>e}).map(function(w){var E=w.idx;return E}),d=f.map(function(w){return t[w]}),h=f.map(function(w){return l[w]}),v=[],g=[],d.length>0&&(o=Date.now(),m=co(d,h,.7),a.stage2_nms=Date.now()-o,x=m.map(function(w){var E=s[f[w]].regions.arraySync();return new yl(E[0][0],E[0][1],E[0][2],E[0][3])}),g=m.map(function(w){return h[w]}),v=m.map(function(w,E){return d[w].calibrate(x[E])})),s.forEach(function(w){w.regions.dispose(),w.scores.dispose()}),[2,{boxes:v,scores:g}]}})})}function wE(n,t){return fe(function(){var e=xl(n,t);e=Dt(e,[2,2],[2,2],"same"),e=Pn(e,t.conv4,"valid"),e=Ca(e,t.prelu4_alpha);var r=Nn(e,[e.shape[0],t.fc1.weights.shape[0]]),a=$n(r,t.fc1),o=Ca(a,t.prelu5_alpha),i=$n(o,t.fc2_1),s=bn(Gi(i,1),1),u=fr(St(i,s),1),l=$n(o,t.fc2_2),c=$n(o,t.fc2_3),p=wt(u,1)[1];return{scores:p,regions:l,points:c}})}function EE(n,t,e,r,a){return xe(this,void 0,void 0,function(){var o,i,s,u,l,c,p,f,d,h,v,g,m,x,y;return be(this,function(w){switch(w.label){case 0:return o=Date.now(),[4,Gf(n,t,{width:48,height:48})];case 1:return i=w.sent(),a.stage3_extractImagePatches=Date.now()-o,o=Date.now(),s=i.map(function(E){var D=wE(E,r);return E.dispose(),D}),a.stage3_onet=Date.now()-o,u=s.length>1?_t(s.map(function(E){return E.scores})):s[0].scores,p=(c=Array).from,[4,u.data()];case 2:return l=p.apply(c,[w.sent()]),u.dispose(),f=l.map(function(E,D){return{score:E,idx:D}}).filter(function(E){return E.score>e}).map(function(E){var D=E.idx;return D}),d=f.map(function(E){var D=s[E].regions.arraySync();return new yl(D[0][0],D[0][1],D[0][2],D[0][3])}),h=f.map(function(E,D){return t[E].calibrate(d[D])}),v=f.map(function(E){return l[E]}),g=[],m=[],x=[],h.length>0&&(o=Date.now(),y=co(h,v,.7,!1),a.stage3_nms=Date.now()-o,g=y.map(function(E){return h[E]}),m=y.map(function(E){return v[E]}),x=y.map(function(E,D){return Array(5).fill(0).map(function(k,S){var _=s[E].points.arraySync();return new Ge(_[0][S]*(g[D].width+1)+g[D].left,_[0][S+5]*(g[D].height+1)+g[D].top)})})),s.forEach(function(E){E.regions.dispose(),E.scores.dispose(),E.points.dispose()}),[2,{boxes:g,scores:m,points:x}]}})})}var SE=function(n){Te(t,n);function t(){return n.call(this,"Mtcnn")||this}return t.prototype.load=function(e){return xe(this,void 0,void 0,function(){return be(this,function(r){return console.warn("mtcnn is deprecated and will be removed soon"),[2,n.prototype.load.call(this,e)]})})},t.prototype.loadFromDisk=function(e){return xe(this,void 0,void 0,function(){return be(this,function(r){return console.warn("mtcnn is deprecated and will be removed soon"),[2,n.prototype.loadFromDisk.call(this,e)]})})},t.prototype.forwardInput=function(e,r){return r===void 0&&(r={}),xe(this,void 0,void 0,function(){var a,o,i,s,u,l,c,p,f,d,h,v,g,m,x,y,w,E,D,k,S;return be(this,function(_){switch(_.label){case 0:if(a=this.params,!a)throw new Error("Mtcnn - load model before inference");if(o=e.canvases[0],!o)throw new Error("Mtcnn - inputCanvas is not defined, note that passing tensors into Mtcnn.forwardInput is not supported yet.");return i={},s=Date.now(),u=fe(function(){return cE(bn(nl.fromPixels(o)).toFloat())}),l=function(b){return u.dispose(),i.total=Date.now()-s,b},c=u.shape.slice(1),p=c[0],f=c[1],d=new qf(r),h=d.minFaceSize,v=d.scaleFactor,g=d.maxNumScales,m=d.scoreThresholds,x=d.scaleSteps,y=(x||vE(h,v,[p,f])).filter(function(b){var N=yu(b,[p,f]);return Math.min(N.width,N.height)>Ti}).slice(0,g),i.scales=y,i.pyramid=y.map(function(b){return yu(b,[p,f])}),w=Date.now(),[4,xE(u,y,m[0],a.pnet,i)];case 1:return E=_.sent(),i.total_stage1=Date.now()-w,E.boxes.length?(i.stage2_numInputBoxes=E.boxes.length,w=Date.now(),[4,_E(o,E.boxes,m[1],a.rnet,i)]):[2,l({results:[],stats:i})];case 2:return D=_.sent(),i.total_stage2=Date.now()-w,D.boxes.length?(i.stage3_numInputBoxes=D.boxes.length,w=Date.now(),[4,EE(o,D.boxes,m[2],a.onet,i)]):[2,l({results:[],stats:i})];case 3:return k=_.sent(),i.total_stage3=Date.now()-w,S=k.boxes.map(function(b,N){return fl(ol({},new er(k.scores[N],new al(b.left/f,b.top/p,b.width/f,b.height/p),{height:p,width:f})),new Zw(k.points[N].map(function(T){return T.sub(new Ge(b.left,b.top)).div(new Ge(b.width,b.height))}),{width:b.width,height:b.height}))}),[2,l({results:S,stats:i})]}})})},t.prototype.forward=function(e,r){return r===void 0&&(r={}),xe(this,void 0,void 0,function(){var a;return be(this,function(o){switch(o.label){case 0:return a=this.forwardInput,[4,Tt(e)];case 1:return[4,a.apply(this,[o.sent(),r])];case 2:return[2,o.sent().results]}})})},t.prototype.forwardWithStats=function(e,r){return r===void 0&&(r={}),xe(this,void 0,void 0,function(){var a;return be(this,function(o){switch(o.label){case 0:return a=this.forwardInput,[4,Tt(e)];case 1:return[2,a.apply(this,[o.sent(),r])]}})})},t.prototype.getDefaultModelName=function(){return"mtcnn_model"},t.prototype.extractParamsFromWeigthMap=function(e){return hE(e)},t.prototype.extractParams=function(e){return pE(e)},t}(vr),CE=.4,IE=[new Ge(1.603231,2.094468),new Ge(6.041143,7.080126),new Ge(2.882459,3.518061),new Ge(4.266906,5.178857),new Ge(9.041765,10.66308)],DE=[117.001,114.697,97.404],kE=function(n){Te(t,n);function t(){var e=this,r={withSeparableConvs:!0,iouThreshold:CE,classes:["face"],anchors:IE,meanRgb:DE,isFirstLayerConv2d:!0,filterSizes:[3,16,32,64,128,256,512]};return e=n.call(this,r)||this,e}return Object.defineProperty(t.prototype,"anchors",{get:function(){return this.config.anchors},enumerable:!0,configurable:!0}),t.prototype.locateFaces=function(e,r){return xe(this,void 0,void 0,function(){var a;return be(this,function(o){switch(o.label){case 0:return[4,this.detect(e,r)];case 1:return a=o.sent(),[2,a.map(function(i){return new er(i.score,i.relativeBox,{width:i.imageWidth,height:i.imageHeight})})]}})})},t.prototype.getDefaultModelName=function(){return"tiny_face_detector_model"},t.prototype.extractParamsFromWeigthMap=function(e){return n.prototype.extractParamsFromWeigthMap.call(this,e)},t}($f),Yt={ssdMobilenetv1:new zf,tinyFaceDetector:new kE,tinyYolov2:new uE,mtcnn:new SE,faceLandmark68Net:new Ff,faceLandmark68TinyNet:new T2,faceRecognitionNet:new F2,faceExpressionNet:new v2,ageGenderNet:new C2},jf=function(n){Te(t,n);function t(e,r,a){var o=n.call(this)||this;return o.parentTask=e,o.input=r,o.extractedFaces=a,o}return t}(ko),bl=function(n){Te(t,n);function t(){return n!==null&&n.apply(this,arguments)||this}return t.prototype.run=function(){return xe(this,void 0,void 0,function(){var e,r,a=this;return be(this,function(o){switch(o.label){case 0:return[4,this.parentTask];case 1:return e=o.sent(),[4,es(e,this.input,function(i){return xe(a,void 0,void 0,function(){return be(this,function(s){switch(s.label){case 0:return[4,Promise.all(i.map(function(u){return Yt.faceExpressionNet.predictExpressions(u)}))];case 1:return[2,s.sent()]}})})},this.extractedFaces)];case 2:return r=o.sent(),[2,e.map(function(i,s){return Pf(i,r[s])})]}})})},t.prototype.withAgeAndGender=function(){return new Sl(this,this.input)},t}(jf),_l=function(n){Te(t,n);function t(){return n!==null&&n.apply(this,arguments)||this}return t.prototype.run=function(){return xe(this,void 0,void 0,function(){var e,r;return be(this,function(a){switch(a.label){case 0:return[4,this.parentTask];case 1:return e=a.sent(),e?[4,gl(e,this.input,function(o){return Yt.faceExpressionNet.predictExpressions(o)},this.extractedFaces)]:[2];case 2:return r=a.sent(),[2,Pf(e,r)]}})})},t.prototype.withAgeAndGender=function(){return new Cl(this,this.input)},t}(jf),wl=function(n){Te(t,n);function t(){return n!==null&&n.apply(this,arguments)||this}return t.prototype.withAgeAndGender=function(){return new Il(this,this.input)},t.prototype.withFaceDescriptors=function(){return new kl(this,this.input)},t}(bl),El=function(n){Te(t,n);function t(){return n!==null&&n.apply(this,arguments)||this}return t.prototype.withAgeAndGender=function(){return new Dl(this,this.input)},t.prototype.withFaceDescriptor=function(){return new Tl(this,this.input)},t}(_l),Xf=function(n){Te(t,n);function t(e,r,a){var o=n.call(this)||this;return o.parentTask=e,o.input=r,o.extractedFaces=a,o}return t}(ko),Sl=function(n){Te(t,n);function t(){return n!==null&&n.apply(this,arguments)||this}return t.prototype.run=function(){return xe(this,void 0,void 0,function(){var e,r,a=this;return be(this,function(o){switch(o.label){case 0:return[4,this.parentTask];case 1:return e=o.sent(),[4,es(e,this.input,function(i){return xe(a,void 0,void 0,function(){return be(this,function(s){switch(s.label){case 0:return[4,Promise.all(i.map(function(u){return Yt.ageGenderNet.predictAgeAndGender(u)}))];case 1:return[2,s.sent()]}})})},this.extractedFaces)];case 2:return r=o.sent(),[2,e.map(function(i,s){var u=r[s],l=u.age,c=u.gender,p=u.genderProbability;return Uf(Wf(i,c,p),l)})]}})})},t.prototype.withFaceExpressions=function(){return new bl(this,this.input)},t}(Xf),Cl=function(n){Te(t,n);function t(){return n!==null&&n.apply(this,arguments)||this}return t.prototype.run=function(){return xe(this,void 0,void 0,function(){var e,r,a,o,i;return be(this,function(s){switch(s.label){case 0:return[4,this.parentTask];case 1:return e=s.sent(),e?[4,gl(e,this.input,function(u){return Yt.ageGenderNet.predictAgeAndGender(u)},this.extractedFaces)]:[2];case 2:return r=s.sent(),a=r.age,o=r.gender,i=r.genderProbability,[2,Uf(Wf(e,o,i),a)]}})})},t.prototype.withFaceExpressions=function(){return new _l(this,this.input)},t}(Xf),Il=function(n){Te(t,n);function t(){return n!==null&&n.apply(this,arguments)||this}return t.prototype.withFaceExpressions=function(){return new wl(this,this.input)},t.prototype.withFaceDescriptors=function(){return new kl(this,this.input)},t}(Sl),Dl=function(n){Te(t,n);function t(){return n!==null&&n.apply(this,arguments)||this}return t.prototype.withFaceExpressions=function(){return new El(this,this.input)},t.prototype.withFaceDescriptor=function(){return new Tl(this,this.input)},t}(Cl),Yf=function(n){Te(t,n);function t(e,r){var a=n.call(this)||this;return a.parentTask=e,a.input=r,a}return t}(ko),kl=function(n){Te(t,n);function t(){return n!==null&&n.apply(this,arguments)||this}return t.prototype.run=function(){return xe(this,void 0,void 0,function(){var e,r;return be(this,function(a){switch(a.label){case 0:return[4,this.parentTask];case 1:return e=a.sent(),[4,es(e,this.input,function(o){return Promise.all(o.map(function(i){return Yt.faceRecognitionNet.computeFaceDescriptor(i)}))},null,function(o){return o.landmarks.align(null,{useDlibAlignment:!0})})];case 2:return r=a.sent(),[2,r.map(function(o,i){return Bf(e[i],o)})]}})})},t.prototype.withFaceExpressions=function(){return new wl(this,this.input)},t.prototype.withAgeAndGender=function(){return new Il(this,this.input)},t}(Yf),Tl=function(n){Te(t,n);function t(){return n!==null&&n.apply(this,arguments)||this}return t.prototype.run=function(){return xe(this,void 0,void 0,function(){var e,r;return be(this,function(a){switch(a.label){case 0:return[4,this.parentTask];case 1:return e=a.sent(),e?[4,gl(e,this.input,function(o){return Yt.faceRecognitionNet.computeFaceDescriptor(o)},null,function(o){return o.landmarks.align(null,{useDlibAlignment:!0})})]:[2];case 2:return r=a.sent(),[2,Bf(e,r)]}})})},t.prototype.withFaceExpressions=function(){return new El(this,this.input)},t.prototype.withAgeAndGender=function(){return new Dl(this,this.input)},t}(Yf),Kf=function(n){Te(t,n);function t(e,r,a){var o=n.call(this)||this;return o.parentTask=e,o.input=r,o.useTinyLandmarkNet=a,o}return Object.defineProperty(t.prototype,"landmarkNet",{get:function(){return this.useTinyLandmarkNet?Yt.faceLandmark68TinyNet:Yt.faceLandmark68Net},enumerable:!0,configurable:!0}),t}(ko),TE=function(n){Te(t,n);function t(){return n!==null&&n.apply(this,arguments)||this}return t.prototype.run=function(){return xe(this,void 0,void 0,function(){var e,r,a,o,i,s=this;return be(this,function(u){switch(u.label){case 0:return[4,this.parentTask];case 1:return e=u.sent(),r=e.map(function(l){return l.detection}),this.input instanceof at?[4,ll(this.input,r)]:[3,3];case 2:return o=u.sent(),[3,5];case 3:return[4,ul(this.input,r)];case 4:o=u.sent(),u.label=5;case 5:return a=o,[4,Promise.all(a.map(function(l){return s.landmarkNet.detectLandmarks(l)}))];case 6:return i=u.sent(),a.forEach(function(l){return l instanceof at&&l.dispose()}),[2,e.map(function(l,c){return fl(l,i[c])})]}})})},t.prototype.withFaceExpressions=function(){return new wl(this,this.input)},t.prototype.withAgeAndGender=function(){return new Il(this,this.input)},t.prototype.withFaceDescriptors=function(){return new kl(this,this.input)},t}(Kf),NE=function(n){Te(t,n);function t(){return n!==null&&n.apply(this,arguments)||this}return t.prototype.run=function(){return xe(this,void 0,void 0,function(){var e,r,a,o,i;return be(this,function(s){switch(s.label){case 0:return[4,this.parentTask];case 1:return e=s.sent(),e?(r=e.detection,this.input instanceof at?[4,ll(this.input,[r])]:[3,3]):[2];case 2:return o=s.sent(),[3,5];case 3:return[4,ul(this.input,[r])];case 4:o=s.sent(),s.label=5;case 5:return a=o,[4,this.landmarkNet.detectLandmarks(a[0])];case 6:return i=s.sent(),a.forEach(function(u){return u instanceof at&&u.dispose()}),[2,fl(e,i)]}})})},t.prototype.withFaceExpressions=function(){return new El(this,this.input)},t.prototype.withAgeAndGender=function(){return new Dl(this,this.input)},t.prototype.withFaceDescriptor=function(){return new Tl(this,this.input)},t}(Kf),Jf=function(n){Te(t,n);function t(e,r){r===void 0&&(r=new Zi);var a=n.call(this)||this;return a.input=e,a.options=r,a}return t}(ko),RE=function(n){Te(t,n);function t(){return n!==null&&n.apply(this,arguments)||this}return t.prototype.run=function(){return xe(this,void 0,void 0,function(){var e,r,a,o;return be(this,function(i){switch(i.label){case 0:return e=this,r=e.input,a=e.options,a instanceof qf?[4,Yt.mtcnn.forward(r,a)]:[3,2];case 1:return[2,i.sent().map(function(s){return s.detection})];case 2:if(o=a instanceof lE?function(s){return Yt.tinyFaceDetector.locateFaces(s,a)}:a instanceof Zi?function(s){return Yt.ssdMobilenetv1.locateFaces(s,a)}:a instanceof ml?function(s){return Yt.tinyYolov2.locateFaces(s,a)}:null,!o)throw new Error("detectFaces - expected options to be instance of TinyFaceDetectorOptions | SsdMobilenetv1Options | MtcnnOptions | TinyYolov2Options");return[2,o(r)]}})})},t.prototype.runAndExtendWithFaceDetections=function(){var e=this;return new Promise(function(r){return xe(e,void 0,void 0,function(){var a;return be(this,function(o){switch(o.label){case 0:return[4,this.run()];case 1:return a=o.sent(),[2,r(a.map(function(i){return ol({},i)}))]}})})})},t.prototype.withFaceLandmarks=function(e){return e===void 0&&(e=!1),new TE(this.runAndExtendWithFaceDetections(),this.input,e)},t.prototype.withFaceExpressions=function(){return new bl(this.runAndExtendWithFaceDetections(),this.input)},t.prototype.withAgeAndGender=function(){return new Sl(this.runAndExtendWithFaceDetections(),this.input)},t}(Jf),AE=function(n){Te(t,n);function t(){return n!==null&&n.apply(this,arguments)||this}return t.prototype.run=function(){return xe(this,void 0,void 0,function(){var e,r;return be(this,function(a){switch(a.label){case 0:return[4,new RE(this.input,this.options)];case 1:return e=a.sent(),r=e[0],e.forEach(function(o){o.score>r.score&&(r=o)}),[2,r]}})})},t.prototype.runAndExtendWithFaceDetection=function(){var e=this;return new Promise(function(r){return xe(e,void 0,void 0,function(){var a;return be(this,function(o){switch(o.label){case 0:return[4,this.run()];case 1:return a=o.sent(),[2,r(a?ol({},a):void 0)]}})})})},t.prototype.withFaceLandmarks=function(e){return e===void 0&&(e=!1),new NE(this.runAndExtendWithFaceDetection(),this.input,e)},t.prototype.withFaceExpressions=function(){return new _l(this.runAndExtendWithFaceDetection(),this.input)},t.prototype.withAgeAndGender=function(){return new Cl(this.runAndExtendWithFaceDetection(),this.input)},t}(Jf);function PE(n,t){return t===void 0&&(t=new Zi),new AE(n,t)}function OE(n,t){if(n.length!==t.length)throw new Error("euclideanDistance: arr1.length !== arr2.length");var e=Array.from(n),r=Array.from(t);return Math.sqrt(e.map(function(a,o){return a-r[o]}).reduce(function(a,o){return a+Math.pow(o,2)},0))}(function(){function n(t,e){e===void 0&&(e=.6),this._distanceThreshold=e;var r=Array.isArray(t)?t:[t];if(!r.length)throw new Error("FaceRecognizer.constructor - expected atleast one input");var a=1,o=function(){return"person "+a++};this._labeledDescriptors=r.map(function(i){if(i instanceof Ho)return i;if(i instanceof Float32Array)return new Ho(o(),[i]);if(i.descriptor&&i.descriptor instanceof Float32Array)return new Ho(o(),[i.descriptor]);throw new Error("FaceRecognizer.constructor - expected inputs to be of type LabeledFaceDescriptors | WithFaceDescriptor<any> | Float32Array | Array<LabeledFaceDescriptors | WithFaceDescriptor<any> | Float32Array>")})}return Object.defineProperty(n.prototype,"labeledDescriptors",{get:function(){return this._labeledDescriptors},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"distanceThreshold",{get:function(){return this._distanceThreshold},enumerable:!0,configurable:!0}),n.prototype.computeMeanDistance=function(t,e){return e.map(function(r){return OE(r,t)}).reduce(function(r,a){return r+a},0)/(e.length||1)},n.prototype.matchDescriptor=function(t){var e=this;return this.labeledDescriptors.map(function(r){var a=r.descriptors,o=r.label;return new nd(o,e.computeMeanDistance(t,a))}).reduce(function(r,a){return r.distance<a.distance?r:a})},n.prototype.findBestMatch=function(t){var e=this.matchDescriptor(t);return e.distance<this.distanceThreshold?e:new nd("unknown",e.distance)},n.prototype.toJSON=function(){return{distanceThreshold:this.distanceThreshold,labeledDescriptors:this.labeledDescriptors.map(function(t){return t.toJSON()})}},n.fromJSON=function(t){var e=t.labeledDescriptors.map(function(r){return Ho.fromJSON(r)});return new n(e,t.distanceThreshold)},n})();var ei={exports:{}},Gs={exports:{}},js={};/**
* @vue/compiler-core v3.5.14
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**/const Ra=Symbol(""),Ia=Symbol(""),ts=Symbol(""),po=Symbol(""),Nl=Symbol(""),Vr=Symbol(""),Rl=Symbol(""),Al=Symbol(""),ns=Symbol(""),rs=Symbol(""),Ba=Symbol(""),as=Symbol(""),Pl=Symbol(""),os=Symbol(""),is=Symbol(""),ss=Symbol(""),us=Symbol(""),ls=Symbol(""),cs=Symbol(""),Ol=Symbol(""),Ml=Symbol(""),To=Symbol(""),fo=Symbol(""),ds=Symbol(""),ps=Symbol(""),Aa=Symbol(""),Ua=Symbol(""),fs=Symbol(""),Ni=Symbol(""),Qf=Symbol(""),Ri=Symbol(""),ho=Symbol(""),Zf=Symbol(""),eh=Symbol(""),hs=Symbol(""),th=Symbol(""),nh=Symbol(""),vs=Symbol(""),Fl=Symbol(""),Zr={[Ra]:"Fragment",[Ia]:"Teleport",[ts]:"Suspense",[po]:"KeepAlive",[Nl]:"BaseTransition",[Vr]:"openBlock",[Rl]:"createBlock",[Al]:"createElementBlock",[ns]:"createVNode",[rs]:"createElementVNode",[Ba]:"createCommentVNode",[as]:"createTextVNode",[Pl]:"createStaticVNode",[os]:"resolveComponent",[is]:"resolveDynamicComponent",[ss]:"resolveDirective",[us]:"resolveFilter",[ls]:"withDirectives",[cs]:"renderList",[Ol]:"renderSlot",[Ml]:"createSlots",[To]:"toDisplayString",[fo]:"mergeProps",[ds]:"normalizeClass",[ps]:"normalizeStyle",[Aa]:"normalizeProps",[Ua]:"guardReactiveProps",[fs]:"toHandlers",[Ni]:"camelize",[Qf]:"capitalize",[Ri]:"toHandlerKey",[ho]:"setBlockTracking",[Zf]:"pushScopeId",[eh]:"popScopeId",[hs]:"withCtx",[th]:"unref",[nh]:"isRef",[vs]:"withMemo",[Fl]:"isMemoSame"};function rh(n){Object.getOwnPropertySymbols(n).forEach(t=>{Zr[t]=n[t]})}const ME={HTML:0,0:"HTML",SVG:1,1:"SVG",MATH_ML:2,2:"MATH_ML"},FE={ROOT:0,0:"ROOT",ELEMENT:1,1:"ELEMENT",TEXT:2,2:"TEXT",COMMENT:3,3:"COMMENT",SIMPLE_EXPRESSION:4,4:"SIMPLE_EXPRESSION",INTERPOLATION:5,5:"INTERPOLATION",ATTRIBUTE:6,6:"ATTRIBUTE",DIRECTIVE:7,7:"DIRECTIVE",COMPOUND_EXPRESSION:8,8:"COMPOUND_EXPRESSION",IF:9,9:"IF",IF_BRANCH:10,10:"IF_BRANCH",FOR:11,11:"FOR",TEXT_CALL:12,12:"TEXT_CALL",VNODE_CALL:13,13:"VNODE_CALL",JS_CALL_EXPRESSION:14,14:"JS_CALL_EXPRESSION",JS_OBJECT_EXPRESSION:15,15:"JS_OBJECT_EXPRESSION",JS_PROPERTY:16,16:"JS_PROPERTY",JS_ARRAY_EXPRESSION:17,17:"JS_ARRAY_EXPRESSION",JS_FUNCTION_EXPRESSION:18,18:"JS_FUNCTION_EXPRESSION",JS_CONDITIONAL_EXPRESSION:19,19:"JS_CONDITIONAL_EXPRESSION",JS_CACHE_EXPRESSION:20,20:"JS_CACHE_EXPRESSION",JS_BLOCK_STATEMENT:21,21:"JS_BLOCK_STATEMENT",JS_TEMPLATE_LITERAL:22,22:"JS_TEMPLATE_LITERAL",JS_IF_STATEMENT:23,23:"JS_IF_STATEMENT",JS_ASSIGNMENT_EXPRESSION:24,24:"JS_ASSIGNMENT_EXPRESSION",JS_SEQUENCE_EXPRESSION:25,25:"JS_SEQUENCE_EXPRESSION",JS_RETURN_STATEMENT:26,26:"JS_RETURN_STATEMENT"},VE={ELEMENT:0,0:"ELEMENT",COMPONENT:1,1:"COMPONENT",SLOT:2,2:"SLOT",TEMPLATE:3,3:"TEMPLATE"},LE={NOT_CONSTANT:0,0:"NOT_CONSTANT",CAN_SKIP_PATCH:1,1:"CAN_SKIP_PATCH",CAN_CACHE:2,2:"CAN_CACHE",CAN_STRINGIFY:3,3:"CAN_STRINGIFY"},It={start:{line:1,column:1,offset:0},end:{line:1,column:1,offset:0},source:""};function ah(n,t=""){return{type:0,source:t,children:n,helpers:new Set,components:[],directives:[],hoists:[],imports:[],cached:[],temps:0,codegenNode:void 0,loc:It}}function Pa(n,t,e,r,a,o,i,s=!1,u=!1,l=!1,c=It){return n&&(s?(n.helper(Vr),n.helper(na(n.inSSR,l))):n.helper(ta(n.inSSR,l)),i&&n.helper(ls)),{type:13,tag:t,props:e,children:r,patchFlag:a,dynamicProps:o,directives:i,isBlock:s,disableTracking:u,isComponent:l,loc:c}}function Pr(n,t=It){return{type:17,loc:t,elements:n}}function hn(n,t=It){return{type:15,loc:t,properties:n}}function it(n,t){return{type:16,loc:It,key:bt(n)?De(n,!0):n,value:t}}function De(n,t=!1,e=It,r=0){return{type:4,loc:e,content:n,isStatic:t,constType:t?3:r}}function BE(n,t){return{type:5,loc:t,content:bt(n)?De(n,!1,t):n}}function En(n,t=It){return{type:8,loc:t,children:n}}function gt(n,t=[],e=It){return{type:14,loc:e,callee:n,arguments:t}}function ea(n,t=void 0,e=!1,r=!1,a=It){return{type:18,params:n,returns:t,newline:e,isSlot:r,loc:a}}function Ai(n,t,e,r=!0){return{type:19,test:n,consequent:t,alternate:e,newline:r,loc:It}}function oh(n,t,e=!1,r=!1){return{type:20,index:n,value:t,needPauseTracking:e,inVOnce:r,needArraySpread:!1,loc:It}}function ih(n){return{type:21,body:n,loc:It}}function UE(n){return{type:22,elements:n,loc:It}}function WE(n,t,e){return{type:23,test:n,consequent:t,alternate:e,loc:It}}function qE(n,t){return{type:24,left:n,right:t,loc:It}}function zE(n){return{type:25,expressions:n,loc:It}}function $E(n){return{type:26,returns:n,loc:It}}function ta(n,t){return n||t?ns:rs}function na(n,t){return n||t?Rl:Al}function ms(n,{helper:t,removeHelper:e,inSSR:r}){n.isBlock||(n.isBlock=!0,e(ta(r,n.isComponent)),t(Vr),t(na(r,n.isComponent)))}const ud=new Uint8Array([123,123]),ld=new Uint8Array([125,125]);function cd(n){return n>=97&&n<=122||n>=65&&n<=90}function un(n){return n===32||n===10||n===9||n===12||n===13}function Sr(n){return n===47||n===62||un(n)}function Pi(n){const t=new Uint8Array(n.length);for(let e=0;e<n.length;e++)t[e]=n.charCodeAt(e);return t}const Vt={Cdata:new Uint8Array([67,68,65,84,65,91]),CdataEnd:new Uint8Array([93,93,62]),CommentEnd:new Uint8Array([45,45,62]),ScriptEnd:new Uint8Array([60,47,115,99,114,105,112,116]),StyleEnd:new Uint8Array([60,47,115,116,121,108,101]),TitleEnd:new Uint8Array([60,47,116,105,116,108,101]),TextareaEnd:new Uint8Array([60,47,116,101,120,116,97,114,101,97])};class HE{constructor(t,e){this.stack=t,this.cbs=e,this.state=1,this.buffer="",this.sectionStart=0,this.index=0,this.entityStart=0,this.baseState=1,this.inRCDATA=!1,this.inXML=!1,this.inVPre=!1,this.newlines=[],this.mode=0,this.delimiterOpen=ud,this.delimiterClose=ld,this.delimiterIndex=-1,this.currentSequence=void 0,this.sequenceIndex=0}get inSFCRoot(){return this.mode===2&&this.stack.length===0}reset(){this.state=1,this.mode=0,this.buffer="",this.sectionStart=0,this.index=0,this.baseState=1,this.inRCDATA=!1,this.currentSequence=void 0,this.newlines.length=0,this.delimiterOpen=ud,this.delimiterClose=ld}getPos(t){let e=1,r=t+1;for(let a=this.newlines.length-1;a>=0;a--){const o=this.newlines[a];if(t>o){e=a+2,r=t-o;break}}return{column:r,line:e,offset:t}}peek(){return this.buffer.charCodeAt(this.index+1)}stateText(t){t===60?(this.index>this.sectionStart&&this.cbs.ontext(this.sectionStart,this.index),this.state=5,this.sectionStart=this.index):!this.inVPre&&t===this.delimiterOpen[0]&&(this.state=2,this.delimiterIndex=0,this.stateInterpolationOpen(t))}stateInterpolationOpen(t){if(t===this.delimiterOpen[this.delimiterIndex])if(this.delimiterIndex===this.delimiterOpen.length-1){const e=this.index+1-this.delimiterOpen.length;e>this.sectionStart&&this.cbs.ontext(this.sectionStart,e),this.state=3,this.sectionStart=e}else this.delimiterIndex++;else this.inRCDATA?(this.state=32,this.stateInRCDATA(t)):(this.state=1,this.stateText(t))}stateInterpolation(t){t===this.delimiterClose[0]&&(this.state=4,this.delimiterIndex=0,this.stateInterpolationClose(t))}stateInterpolationClose(t){t===this.delimiterClose[this.delimiterIndex]?this.delimiterIndex===this.delimiterClose.length-1?(this.cbs.oninterpolation(this.sectionStart,this.index+1),this.inRCDATA?this.state=32:this.state=1,this.sectionStart=this.index+1):this.delimiterIndex++:(this.state=3,this.stateInterpolation(t))}stateSpecialStartSequence(t){const e=this.sequenceIndex===this.currentSequence.length;if(!(e?Sr(t):(t|32)===this.currentSequence[this.sequenceIndex]))this.inRCDATA=!1;else if(!e){this.sequenceIndex++;return}this.sequenceIndex=0,this.state=6,this.stateInTagName(t)}stateInRCDATA(t){if(this.sequenceIndex===this.currentSequence.length){if(t===62||un(t)){const e=this.index-this.currentSequence.length;if(this.sectionStart<e){const r=this.index;this.index=e,this.cbs.ontext(this.sectionStart,e),this.index=r}this.sectionStart=e+2,this.stateInClosingTagName(t),this.inRCDATA=!1;return}this.sequenceIndex=0}(t|32)===this.currentSequence[this.sequenceIndex]?this.sequenceIndex+=1:this.sequenceIndex===0?this.currentSequence===Vt.TitleEnd||this.currentSequence===Vt.TextareaEnd&&!this.inSFCRoot?!this.inVPre&&t===this.delimiterOpen[0]&&(this.state=2,this.delimiterIndex=0,this.stateInterpolationOpen(t)):this.fastForwardTo(60)&&(this.sequenceIndex=1):this.sequenceIndex=+(t===60)}stateCDATASequence(t){t===Vt.Cdata[this.sequenceIndex]?++this.sequenceIndex===Vt.Cdata.length&&(this.state=28,this.currentSequence=Vt.CdataEnd,this.sequenceIndex=0,this.sectionStart=this.index+1):(this.sequenceIndex=0,this.state=23,this.stateInDeclaration(t))}fastForwardTo(t){for(;++this.index<this.buffer.length;){const e=this.buffer.charCodeAt(this.index);if(e===10&&this.newlines.push(this.index),e===t)return!0}return this.index=this.buffer.length-1,!1}stateInCommentLike(t){t===this.currentSequence[this.sequenceIndex]?++this.sequenceIndex===this.currentSequence.length&&(this.currentSequence===Vt.CdataEnd?this.cbs.oncdata(this.sectionStart,this.index-2):this.cbs.oncomment(this.sectionStart,this.index-2),this.sequenceIndex=0,this.sectionStart=this.index+1,this.state=1):this.sequenceIndex===0?this.fastForwardTo(this.currentSequence[0])&&(this.sequenceIndex=1):t!==this.currentSequence[this.sequenceIndex-1]&&(this.sequenceIndex=0)}startSpecial(t,e){this.enterRCDATA(t,e),this.state=31}enterRCDATA(t,e){this.inRCDATA=!0,this.currentSequence=t,this.sequenceIndex=e}stateBeforeTagName(t){t===33?(this.state=22,this.sectionStart=this.index+1):t===63?(this.state=24,this.sectionStart=this.index+1):cd(t)?(this.sectionStart=this.index,this.mode===0?this.state=6:this.inSFCRoot?this.state=34:this.inXML?this.state=6:t===116?this.state=30:this.state=t===115?29:6):t===47?this.state=8:(this.state=1,this.stateText(t))}stateInTagName(t){Sr(t)&&this.handleTagName(t)}stateInSFCRootTagName(t){if(Sr(t)){const e=this.buffer.slice(this.sectionStart,this.index);e!=="template"&&this.enterRCDATA(Pi("</"+e),0),this.handleTagName(t)}}handleTagName(t){this.cbs.onopentagname(this.sectionStart,this.index),this.sectionStart=-1,this.state=11,this.stateBeforeAttrName(t)}stateBeforeClosingTagName(t){un(t)||(t===62?(this.state=1,this.sectionStart=this.index+1):(this.state=cd(t)?9:27,this.sectionStart=this.index))}stateInClosingTagName(t){(t===62||un(t))&&(this.cbs.onclosetag(this.sectionStart,this.index),this.sectionStart=-1,this.state=10,this.stateAfterClosingTagName(t))}stateAfterClosingTagName(t){t===62&&(this.state=1,this.sectionStart=this.index+1)}stateBeforeAttrName(t){t===62?(this.cbs.onopentagend(this.index),this.inRCDATA?this.state=32:this.state=1,this.sectionStart=this.index+1):t===47?this.state=7:t===60&&this.peek()===47?(this.cbs.onopentagend(this.index),this.state=5,this.sectionStart=this.index):un(t)||this.handleAttrStart(t)}handleAttrStart(t){t===118&&this.peek()===45?(this.state=13,this.sectionStart=this.index):t===46||t===58||t===64||t===35?(this.cbs.ondirname(this.index,this.index+1),this.state=14,this.sectionStart=this.index+1):(this.state=12,this.sectionStart=this.index)}stateInSelfClosingTag(t){t===62?(this.cbs.onselfclosingtag(this.index),this.state=1,this.sectionStart=this.index+1,this.inRCDATA=!1):un(t)||(this.state=11,this.stateBeforeAttrName(t))}stateInAttrName(t){(t===61||Sr(t))&&(this.cbs.onattribname(this.sectionStart,this.index),this.handleAttrNameEnd(t))}stateInDirName(t){t===61||Sr(t)?(this.cbs.ondirname(this.sectionStart,this.index),this.handleAttrNameEnd(t)):t===58?(this.cbs.ondirname(this.sectionStart,this.index),this.state=14,this.sectionStart=this.index+1):t===46&&(this.cbs.ondirname(this.sectionStart,this.index),this.state=16,this.sectionStart=this.index+1)}stateInDirArg(t){t===61||Sr(t)?(this.cbs.ondirarg(this.sectionStart,this.index),this.handleAttrNameEnd(t)):t===91?this.state=15:t===46&&(this.cbs.ondirarg(this.sectionStart,this.index),this.state=16,this.sectionStart=this.index+1)}stateInDynamicDirArg(t){t===93?this.state=14:(t===61||Sr(t))&&(this.cbs.ondirarg(this.sectionStart,this.index+1),this.handleAttrNameEnd(t))}stateInDirModifier(t){t===61||Sr(t)?(this.cbs.ondirmodifier(this.sectionStart,this.index),this.handleAttrNameEnd(t)):t===46&&(this.cbs.ondirmodifier(this.sectionStart,this.index),this.sectionStart=this.index+1)}handleAttrNameEnd(t){this.sectionStart=this.index,this.state=17,this.cbs.onattribnameend(this.index),this.stateAfterAttrName(t)}stateAfterAttrName(t){t===61?this.state=18:t===47||t===62?(this.cbs.onattribend(0,this.sectionStart),this.sectionStart=-1,this.state=11,this.stateBeforeAttrName(t)):un(t)||(this.cbs.onattribend(0,this.sectionStart),this.handleAttrStart(t))}stateBeforeAttrValue(t){t===34?(this.state=19,this.sectionStart=this.index+1):t===39?(this.state=20,this.sectionStart=this.index+1):un(t)||(this.sectionStart=this.index,this.state=21,this.stateInAttrValueNoQuotes(t))}handleInAttrValue(t,e){(t===e||this.fastForwardTo(e))&&(this.cbs.onattribdata(this.sectionStart,this.index),this.sectionStart=-1,this.cbs.onattribend(e===34?3:2,this.index+1),this.state=11)}stateInAttrValueDoubleQuotes(t){this.handleInAttrValue(t,34)}stateInAttrValueSingleQuotes(t){this.handleInAttrValue(t,39)}stateInAttrValueNoQuotes(t){un(t)||t===62?(this.cbs.onattribdata(this.sectionStart,this.index),this.sectionStart=-1,this.cbs.onattribend(1,this.index),this.state=11,this.stateBeforeAttrName(t)):(t===39||t===60||t===61||t===96)&&this.cbs.onerr(18,this.index)}stateBeforeDeclaration(t){t===91?(this.state=26,this.sequenceIndex=0):this.state=t===45?25:23}stateInDeclaration(t){(t===62||this.fastForwardTo(62))&&(this.state=1,this.sectionStart=this.index+1)}stateInProcessingInstruction(t){(t===62||this.fastForwardTo(62))&&(this.cbs.onprocessinginstruction(this.sectionStart,this.index),this.state=1,this.sectionStart=this.index+1)}stateBeforeComment(t){t===45?(this.state=28,this.currentSequence=Vt.CommentEnd,this.sequenceIndex=2,this.sectionStart=this.index+1):this.state=23}stateInSpecialComment(t){(t===62||this.fastForwardTo(62))&&(this.cbs.oncomment(this.sectionStart,this.index),this.state=1,this.sectionStart=this.index+1)}stateBeforeSpecialS(t){t===Vt.ScriptEnd[3]?this.startSpecial(Vt.ScriptEnd,4):t===Vt.StyleEnd[3]?this.startSpecial(Vt.StyleEnd,4):(this.state=6,this.stateInTagName(t))}stateBeforeSpecialT(t){t===Vt.TitleEnd[3]?this.startSpecial(Vt.TitleEnd,4):t===Vt.TextareaEnd[3]?this.startSpecial(Vt.TextareaEnd,4):(this.state=6,this.stateInTagName(t))}startEntity(){}stateInEntity(){}parse(t){for(this.buffer=t;this.index<this.buffer.length;){const e=this.buffer.charCodeAt(this.index);switch(e===10&&this.newlines.push(this.index),this.state){case 1:{this.stateText(e);break}case 2:{this.stateInterpolationOpen(e);break}case 3:{this.stateInterpolation(e);break}case 4:{this.stateInterpolationClose(e);break}case 31:{this.stateSpecialStartSequence(e);break}case 32:{this.stateInRCDATA(e);break}case 26:{this.stateCDATASequence(e);break}case 19:{this.stateInAttrValueDoubleQuotes(e);break}case 12:{this.stateInAttrName(e);break}case 13:{this.stateInDirName(e);break}case 14:{this.stateInDirArg(e);break}case 15:{this.stateInDynamicDirArg(e);break}case 16:{this.stateInDirModifier(e);break}case 28:{this.stateInCommentLike(e);break}case 27:{this.stateInSpecialComment(e);break}case 11:{this.stateBeforeAttrName(e);break}case 6:{this.stateInTagName(e);break}case 34:{this.stateInSFCRootTagName(e);break}case 9:{this.stateInClosingTagName(e);break}case 5:{this.stateBeforeTagName(e);break}case 17:{this.stateAfterAttrName(e);break}case 20:{this.stateInAttrValueSingleQuotes(e);break}case 18:{this.stateBeforeAttrValue(e);break}case 8:{this.stateBeforeClosingTagName(e);break}case 10:{this.stateAfterClosingTagName(e);break}case 29:{this.stateBeforeSpecialS(e);break}case 30:{this.stateBeforeSpecialT(e);break}case 21:{this.stateInAttrValueNoQuotes(e);break}case 7:{this.stateInSelfClosingTag(e);break}case 23:{this.stateInDeclaration(e);break}case 22:{this.stateBeforeDeclaration(e);break}case 25:{this.stateBeforeComment(e);break}case 24:{this.stateInProcessingInstruction(e);break}case 33:{this.stateInEntity();break}}this.index++}this.cleanup(),this.finish()}cleanup(){this.sectionStart!==this.index&&(this.state===1||this.state===32&&this.sequenceIndex===0?(this.cbs.ontext(this.sectionStart,this.index),this.sectionStart=this.index):(this.state===19||this.state===20||this.state===21)&&(this.cbs.onattribdata(this.sectionStart,this.index),this.sectionStart=this.index))}finish(){this.handleTrailingData(),this.cbs.onend()}handleTrailingData(){const t=this.buffer.length;this.sectionStart>=t||(this.state===28?this.currentSequence===Vt.CdataEnd?this.cbs.oncdata(this.sectionStart,t):this.cbs.oncomment(this.sectionStart,t):this.state===6||this.state===11||this.state===18||this.state===17||this.state===12||this.state===13||this.state===14||this.state===15||this.state===16||this.state===20||this.state===19||this.state===21||this.state===9||this.cbs.ontext(this.sectionStart,t))}emitCodePoint(t,e){}}const GE={COMPILER_IS_ON_ELEMENT:"COMPILER_IS_ON_ELEMENT",COMPILER_V_BIND_SYNC:"COMPILER_V_BIND_SYNC",COMPILER_V_BIND_OBJECT_ORDER:"COMPILER_V_BIND_OBJECT_ORDER",COMPILER_V_ON_NATIVE:"COMPILER_V_ON_NATIVE",COMPILER_V_IF_V_FOR_PRECEDENCE:"COMPILER_V_IF_V_FOR_PRECEDENCE",COMPILER_NATIVE_TEMPLATE:"COMPILER_NATIVE_TEMPLATE",COMPILER_INLINE_TEMPLATE:"COMPILER_INLINE_TEMPLATE",COMPILER_FILTERS:"COMPILER_FILTERS"},jE={COMPILER_IS_ON_ELEMENT:{message:'Platform-native elements with "is" prop will no longer be treated as components in Vue 3 unless the "is" value is explicitly prefixed with "vue:".',link:"https://v3-migration.vuejs.org/breaking-changes/custom-elements-interop.html"},COMPILER_V_BIND_SYNC:{message:n=>`.sync modifier for v-bind has been removed. Use v-model with argument instead. \`v-bind:${n}.sync\` should be changed to \`v-model:${n}\`.`,link:"https://v3-migration.vuejs.org/breaking-changes/v-model.html"},COMPILER_V_BIND_OBJECT_ORDER:{message:'v-bind="obj" usage is now order sensitive and behaves like JavaScript object spread: it will now overwrite an existing non-mergeable attribute that appears before v-bind in the case of conflict. To retain 2.x behavior, move v-bind to make it the first attribute. You can also suppress this warning if the usage is intended.',link:"https://v3-migration.vuejs.org/breaking-changes/v-bind.html"},COMPILER_V_ON_NATIVE:{message:".native modifier for v-on has been removed as is no longer necessary.",link:"https://v3-migration.vuejs.org/breaking-changes/v-on-native-modifier-removed.html"},COMPILER_V_IF_V_FOR_PRECEDENCE:{message:"v-if / v-for precedence when used on the same element has changed in Vue 3: v-if now takes higher precedence and will no longer have access to v-for scope variables. It is best to avoid the ambiguity with <template> tags or use a computed property that filters v-for data source.",link:"https://v3-migration.vuejs.org/breaking-changes/v-if-v-for.html"},COMPILER_NATIVE_TEMPLATE:{message:"<template> with no special directives will render as a native template element instead of its inner content in Vue 3."},COMPILER_INLINE_TEMPLATE:{message:'"inline-template" has been removed in Vue 3.',link:"https://v3-migration.vuejs.org/breaking-changes/inline-template-attribute.html"},COMPILER_FILTERS:{message:'filters have been removed in Vue 3. The "|" symbol will be treated as native JavaScript bitwise OR operator. Use method calls or computed properties instead.',link:"https://v3-migration.vuejs.org/breaking-changes/filters.html"}};function xu(n,{compatConfig:t}){const e=t&&t[n];return n==="MODE"?e||3:e}function Kr(n,t){const e=xu("MODE",t),r=xu(n,t);return e===3?r===!0:r!==!1}function Oa(n,t,e,...r){return Kr(n,t)}function XE(n,t,e,...r){if(xu(n,t)==="suppress-warning")return;const{message:o,link:i}=jE[n],s=`(deprecation ${n}) ${typeof o=="function"?o(...r):o}${i?`
  Details: ${i}`:""}`,u=new SyntaxError(s);u.code=n,e&&(u.loc=e),t.onWarn(u)}function Vl(n){throw n}function sh(n){}function tt(n,t,e,r){const a=`https://vuejs.org/error-reference/#compiler-${n}`,o=new SyntaxError(String(a));return o.code=n,o.loc=t,o}const YE={ABRUPT_CLOSING_OF_EMPTY_COMMENT:0,0:"ABRUPT_CLOSING_OF_EMPTY_COMMENT",CDATA_IN_HTML_CONTENT:1,1:"CDATA_IN_HTML_CONTENT",DUPLICATE_ATTRIBUTE:2,2:"DUPLICATE_ATTRIBUTE",END_TAG_WITH_ATTRIBUTES:3,3:"END_TAG_WITH_ATTRIBUTES",END_TAG_WITH_TRAILING_SOLIDUS:4,4:"END_TAG_WITH_TRAILING_SOLIDUS",EOF_BEFORE_TAG_NAME:5,5:"EOF_BEFORE_TAG_NAME",EOF_IN_CDATA:6,6:"EOF_IN_CDATA",EOF_IN_COMMENT:7,7:"EOF_IN_COMMENT",EOF_IN_SCRIPT_HTML_COMMENT_LIKE_TEXT:8,8:"EOF_IN_SCRIPT_HTML_COMMENT_LIKE_TEXT",EOF_IN_TAG:9,9:"EOF_IN_TAG",INCORRECTLY_CLOSED_COMMENT:10,10:"INCORRECTLY_CLOSED_COMMENT",INCORRECTLY_OPENED_COMMENT:11,11:"INCORRECTLY_OPENED_COMMENT",INVALID_FIRST_CHARACTER_OF_TAG_NAME:12,12:"INVALID_FIRST_CHARACTER_OF_TAG_NAME",MISSING_ATTRIBUTE_VALUE:13,13:"MISSING_ATTRIBUTE_VALUE",MISSING_END_TAG_NAME:14,14:"MISSING_END_TAG_NAME",MISSING_WHITESPACE_BETWEEN_ATTRIBUTES:15,15:"MISSING_WHITESPACE_BETWEEN_ATTRIBUTES",NESTED_COMMENT:16,16:"NESTED_COMMENT",UNEXPECTED_CHARACTER_IN_ATTRIBUTE_NAME:17,17:"UNEXPECTED_CHARACTER_IN_ATTRIBUTE_NAME",UNEXPECTED_CHARACTER_IN_UNQUOTED_ATTRIBUTE_VALUE:18,18:"UNEXPECTED_CHARACTER_IN_UNQUOTED_ATTRIBUTE_VALUE",UNEXPECTED_EQUALS_SIGN_BEFORE_ATTRIBUTE_NAME:19,19:"UNEXPECTED_EQUALS_SIGN_BEFORE_ATTRIBUTE_NAME",UNEXPECTED_NULL_CHARACTER:20,20:"UNEXPECTED_NULL_CHARACTER",UNEXPECTED_QUESTION_MARK_INSTEAD_OF_TAG_NAME:21,21:"UNEXPECTED_QUESTION_MARK_INSTEAD_OF_TAG_NAME",UNEXPECTED_SOLIDUS_IN_TAG:22,22:"UNEXPECTED_SOLIDUS_IN_TAG",X_INVALID_END_TAG:23,23:"X_INVALID_END_TAG",X_MISSING_END_TAG:24,24:"X_MISSING_END_TAG",X_MISSING_INTERPOLATION_END:25,25:"X_MISSING_INTERPOLATION_END",X_MISSING_DIRECTIVE_NAME:26,26:"X_MISSING_DIRECTIVE_NAME",X_MISSING_DYNAMIC_DIRECTIVE_ARGUMENT_END:27,27:"X_MISSING_DYNAMIC_DIRECTIVE_ARGUMENT_END",X_V_IF_NO_EXPRESSION:28,28:"X_V_IF_NO_EXPRESSION",X_V_IF_SAME_KEY:29,29:"X_V_IF_SAME_KEY",X_V_ELSE_NO_ADJACENT_IF:30,30:"X_V_ELSE_NO_ADJACENT_IF",X_V_FOR_NO_EXPRESSION:31,31:"X_V_FOR_NO_EXPRESSION",X_V_FOR_MALFORMED_EXPRESSION:32,32:"X_V_FOR_MALFORMED_EXPRESSION",X_V_FOR_TEMPLATE_KEY_PLACEMENT:33,33:"X_V_FOR_TEMPLATE_KEY_PLACEMENT",X_V_BIND_NO_EXPRESSION:34,34:"X_V_BIND_NO_EXPRESSION",X_V_ON_NO_EXPRESSION:35,35:"X_V_ON_NO_EXPRESSION",X_V_SLOT_UNEXPECTED_DIRECTIVE_ON_SLOT_OUTLET:36,36:"X_V_SLOT_UNEXPECTED_DIRECTIVE_ON_SLOT_OUTLET",X_V_SLOT_MIXED_SLOT_USAGE:37,37:"X_V_SLOT_MIXED_SLOT_USAGE",X_V_SLOT_DUPLICATE_SLOT_NAMES:38,38:"X_V_SLOT_DUPLICATE_SLOT_NAMES",X_V_SLOT_EXTRANEOUS_DEFAULT_SLOT_CHILDREN:39,39:"X_V_SLOT_EXTRANEOUS_DEFAULT_SLOT_CHILDREN",X_V_SLOT_MISPLACED:40,40:"X_V_SLOT_MISPLACED",X_V_MODEL_NO_EXPRESSION:41,41:"X_V_MODEL_NO_EXPRESSION",X_V_MODEL_MALFORMED_EXPRESSION:42,42:"X_V_MODEL_MALFORMED_EXPRESSION",X_V_MODEL_ON_SCOPE_VARIABLE:43,43:"X_V_MODEL_ON_SCOPE_VARIABLE",X_V_MODEL_ON_PROPS:44,44:"X_V_MODEL_ON_PROPS",X_INVALID_EXPRESSION:45,45:"X_INVALID_EXPRESSION",X_KEEP_ALIVE_INVALID_CHILDREN:46,46:"X_KEEP_ALIVE_INVALID_CHILDREN",X_PREFIX_ID_NOT_SUPPORTED:47,47:"X_PREFIX_ID_NOT_SUPPORTED",X_MODULE_MODE_NOT_SUPPORTED:48,48:"X_MODULE_MODE_NOT_SUPPORTED",X_CACHE_HANDLER_NOT_SUPPORTED:49,49:"X_CACHE_HANDLER_NOT_SUPPORTED",X_SCOPE_ID_NOT_SUPPORTED:50,50:"X_SCOPE_ID_NOT_SUPPORTED",X_VNODE_HOOKS:51,51:"X_VNODE_HOOKS",X_V_BIND_INVALID_SAME_NAME_ARGUMENT:52,52:"X_V_BIND_INVALID_SAME_NAME_ARGUMENT",__EXTEND_POINT__:53,53:"__EXTEND_POINT__"},KE={0:"Illegal comment.",1:"CDATA section is allowed only in XML context.",2:"Duplicate attribute.",3:"End tag cannot have attributes.",4:"Illegal '/' in tags.",5:"Unexpected EOF in tag.",6:"Unexpected EOF in CDATA section.",7:"Unexpected EOF in comment.",8:"Unexpected EOF in script.",9:"Unexpected EOF in tag.",10:"Incorrectly closed comment.",11:"Incorrectly opened comment.",12:"Illegal tag name. Use '&lt;' to print '<'.",13:"Attribute value was expected.",14:"End tag name was expected.",15:"Whitespace was expected.",16:"Unexpected '<!--' in comment.",17:`Attribute name cannot contain U+0022 ("), U+0027 ('), and U+003C (<).`,18:"Unquoted attribute value cannot contain U+0022 (\"), U+0027 ('), U+003C (<), U+003D (=), and U+0060 (`).",19:"Attribute name cannot start with '='.",21:"'<?' is allowed only in XML context.",20:"Unexpected null character.",22:"Illegal '/' in tags.",23:"Invalid end tag.",24:"Element is missing end tag.",25:"Interpolation end sign was not found.",27:"End bracket for dynamic directive argument was not found. Note that dynamic directive argument cannot contain spaces.",26:"Legal directive name was expected.",28:"v-if/v-else-if is missing expression.",29:"v-if/else branches must use unique keys.",30:"v-else/v-else-if has no adjacent v-if or v-else-if.",31:"v-for is missing expression.",32:"v-for has invalid expression.",33:"<template v-for> key should be placed on the <template> tag.",34:"v-bind is missing expression.",52:"v-bind with same-name shorthand only allows static argument.",35:"v-on is missing expression.",36:"Unexpected custom directive on <slot> outlet.",37:"Mixed v-slot usage on both the component and nested <template>. When there are multiple named slots, all slots should use <template> syntax to avoid scope ambiguity.",38:"Duplicate slot names found. ",39:"Extraneous children found when component already has explicitly named default slot. These children will be ignored.",40:"v-slot can only be used on components or <template> tags.",41:"v-model is missing expression.",42:"v-model value must be a valid JavaScript member expression.",43:"v-model cannot be used on v-for or v-slot scope variables because they are not writable.",44:`v-model cannot be used on a prop, because local prop bindings are not writable.
Use a v-bind binding combined with a v-on listener that emits update:x event instead.`,45:"Error parsing JavaScript expression: ",46:"<KeepAlive> expects exactly one child component.",51:"@vnode-* hooks in templates are no longer supported. Use the vue: prefix instead. For example, @vnode-mounted should be changed to @vue:mounted. @vnode-* hooks support has been removed in 3.4.",47:'"prefixIdentifiers" option is not supported in this build of compiler.',48:"ES module mode is not supported in this build of compiler.",49:'"cacheHandlers" option is only supported when the "prefixIdentifiers" option is enabled.',50:'"scopeId" option is only supported in module mode.',53:""};function JE(n,t,e=!1,r=[],a=Object.create(null)){}function QE(n,t,e){return!1}function ZE(n,t){if(n&&(n.type==="ObjectProperty"||n.type==="ArrayPattern")){let e=t.length;for(;e--;){const r=t[e];if(r.type==="AssignmentExpression")return!0;if(r.type!=="ObjectProperty"&&!r.type.endsWith("Pattern"))break}}return!1}function eS(n){let t=n.length;for(;t--;){const e=n[t];if(e.type==="NewExpression")return!0;if(e.type!=="MemberExpression")break}return!1}function tS(n,t){for(const e of n.params)for(const r of sr(e))t(r)}function nS(n,t){for(const e of n.body)if(e.type==="VariableDeclaration"){if(e.declare)continue;for(const r of e.declarations)for(const a of sr(r.id))t(a)}else if(e.type==="FunctionDeclaration"||e.type==="ClassDeclaration"){if(e.declare||!e.id)continue;t(e.id)}else rS(e)&&aS(e,!0,t)}function rS(n){return n.type==="ForOfStatement"||n.type==="ForInStatement"||n.type==="ForStatement"}function aS(n,t,e){const r=n.type==="ForStatement"?n.init:n.left;if(r&&r.type==="VariableDeclaration"&&(r.kind==="var"&&t))for(const a of r.declarations)for(const o of sr(a.id))e(o)}function sr(n,t=[]){switch(n.type){case"Identifier":t.push(n);break;case"MemberExpression":let e=n;for(;e.type==="MemberExpression";)e=e.object;t.push(e);break;case"ObjectPattern":for(const r of n.properties)r.type==="RestElement"?sr(r.argument,t):sr(r.value,t);break;case"ArrayPattern":n.elements.forEach(r=>{r&&sr(r,t)});break;case"RestElement":sr(n.argument,t);break;case"AssignmentPattern":sr(n.left,t);break}return t}const oS=n=>/Function(?:Expression|Declaration)$|Method$/.test(n.type),uh=n=>n&&(n.type==="ObjectProperty"||n.type==="ObjectMethod")&&!n.computed,iS=(n,t)=>uh(t)&&t.key===n,lh=["TSAsExpression","TSTypeAssertion","TSNonNullExpression","TSInstantiationExpression","TSSatisfiesExpression"];function ch(n){return lh.includes(n.type)?ch(n.expression):n}const Kt=n=>n.type===4&&n.isStatic;function Ll(n){switch(n){case"Teleport":case"teleport":return Ia;case"Suspense":case"suspense":return ts;case"KeepAlive":case"keep-alive":return po;case"BaseTransition":case"base-transition":return Nl}}const sS=/^\d|[^\$\w\xA0-\uFFFF]/,No=n=>!sS.test(n),uS=/[A-Za-z_$\xA0-\uFFFF]/,lS=/[\.\?\w$\xA0-\uFFFF]/,cS=/\s+[.[]\s*|\s*[.[]\s+/g,dh=n=>n.type===4?n.content:n.loc.source,ph=n=>{const t=dh(n).trim().replace(cS,s=>s.trim());let e=0,r=[],a=0,o=0,i=null;for(let s=0;s<t.length;s++){const u=t.charAt(s);switch(e){case 0:if(u==="[")r.push(e),e=1,a++;else if(u==="(")r.push(e),e=2,o++;else if(!(s===0?uS:lS).test(u))return!1;break;case 1:u==="'"||u==='"'||u==="`"?(r.push(e),e=3,i=u):u==="["?a++:u==="]"&&(--a||(e=r.pop()));break;case 2:if(u==="'"||u==='"'||u==="`")r.push(e),e=3,i=u;else if(u==="(")o++;else if(u===")"){if(s===t.length-1)return!1;--o||(e=r.pop())}break;case 3:u===i&&(e=r.pop(),i=null);break}}return!a&&!o},dS=Za,Bl=ph,pS=/^\s*(async\s*)?(\([^)]*?\)|[\w$_]+)\s*(:[^=]+)?=>|^\s*(async\s+)?function(?:\s+[\w$]+)?\s*\(/,fh=n=>pS.test(dh(n)),fS=Za,hh=fh;function hS(n,t,e=t.length){return vh({offset:n.offset,line:n.line,column:n.column},t,e)}function vh(n,t,e=t.length){let r=0,a=-1;for(let o=0;o<e;o++)t.charCodeAt(o)===10&&(r++,a=o);return n.offset+=e,n.line+=r,n.column=a===-1?n.column+e:e-a,n}function vS(n,t){if(!n)throw new Error(t||"unexpected compiler condition")}function Xt(n,t,e=!1){for(let r=0;r<n.props.length;r++){const a=n.props[r];if(a.type===7&&(e||a.exp)&&(bt(t)?a.name===t:t.test(a.name)))return a}}function Ro(n,t,e=!1,r=!1){for(let a=0;a<n.props.length;a++){const o=n.props[a];if(o.type===6){if(e)continue;if(o.name===t&&(o.value||r))return o}else if(o.name==="bind"&&(o.exp||r)&&kr(o.arg,t))return o}}function kr(n,t){return!!(n&&Kt(n)&&n.content===t)}function mh(n){return n.props.some(t=>t.type===7&&t.name==="bind"&&(!t.arg||t.arg.type!==4||!t.arg.isStatic))}function ti(n){return n.type===5||n.type===2}function Ul(n){return n.type===7&&n.name==="slot"}function Ma(n){return n.type===1&&n.tagType===3}function vo(n){return n.type===1&&n.tagType===2}const mS=new Set([Aa,Ua]);function gh(n,t=[]){if(n&&!bt(n)&&n.type===14){const e=n.callee;if(!bt(e)&&mS.has(e))return gh(n.arguments[0],t.concat(n))}return[n,t]}function mo(n,t,e){let r,a=n.type===13?n.props:n.arguments[2],o=[],i;if(a&&!bt(a)&&a.type===14){const s=gh(a);a=s[0],o=s[1],i=o[o.length-1]}if(a==null||bt(a))r=hn([t]);else if(a.type===14){const s=a.arguments[0];!bt(s)&&s.type===15?dd(t,s)||s.properties.unshift(t):a.callee===fs?r=gt(e.helper(fo),[hn([t]),a]):a.arguments.unshift(hn([t])),!r&&(r=a)}else a.type===15?(dd(t,a)||a.properties.unshift(t),r=a):(r=gt(e.helper(fo),[hn([t]),a]),i&&i.callee===Ua&&(i=o[o.length-2]));n.type===13?i?i.arguments[0]=r:n.props=r:i?i.arguments[0]=r:n.arguments[2]=r}function dd(n,t){let e=!1;if(n.key.type===4){const r=n.key.content;e=t.properties.some(a=>a.key.type===4&&a.key.content===r)}return e}function Fa(n,t){return`_${t}_${n.replace(/[^\w]/g,(e,r)=>e==="-"?"_":n.charCodeAt(r).toString())}`}function kn(n,t){if(!n||Object.keys(t).length===0)return!1;switch(n.type){case 1:for(let e=0;e<n.props.length;e++){const r=n.props[e];if(r.type===7&&(kn(r.arg,t)||kn(r.exp,t)))return!0}return n.children.some(e=>kn(e,t));case 11:return kn(n.source,t)?!0:n.children.some(e=>kn(e,t));case 9:return n.branches.some(e=>kn(e,t));case 10:return kn(n.condition,t)?!0:n.children.some(e=>kn(e,t));case 4:return!n.isStatic&&No(n.content)&&!!t[n.content];case 8:return n.children.some(e=>Rd(e)&&kn(e,t));case 5:case 12:return kn(n.content,t);case 2:case 3:case 20:return!1;default:return!1}}function yh(n){return n.type===14&&n.callee===vs?n.arguments[1].returns:n}const xh=/([\s\S]*?)\s+(?:in|of)\s+(\S[\s\S]*)/,bh={parseMode:"base",ns:0,delimiters:["{{","}}"],getNamespace:()=>0,isVoidTag:Mo,isPreTag:Mo,isIgnoreNewlineTag:Mo,isCustomElement:Mo,onError:Vl,onWarn:sh,comments:!1,prefixIdentifiers:!1};let He=bh,go=null,lr="",Lt=null,Ue=null,Zt="",ar=-1,$r=-1,Wl=0,Cr=!1,bu=null;const rt=[],dt=new HE(rt,{onerr:nr,ontext(n,t){Ko(Rt(n,t),n,t)},ontextentity(n,t,e){Ko(n,t,e)},oninterpolation(n,t){if(Cr)return Ko(Rt(n,t),n,t);let e=n+dt.delimiterOpen.length,r=t-dt.delimiterClose.length;for(;un(lr.charCodeAt(e));)e++;for(;un(lr.charCodeAt(r-1));)r--;let a=Rt(e,r);a.includes("&")&&(a=He.decodeEntities(a,!1)),_u({type:5,content:ri(a,!1,vt(e,r)),loc:vt(n,t)})},onopentagname(n,t){const e=Rt(n,t);Lt={type:1,tag:e,ns:He.getNamespace(e,rt[0],He.ns),tagType:0,props:[],children:[],loc:vt(n-1,t),codegenNode:void 0}},onopentagend(n){fd(n)},onclosetag(n,t){const e=Rt(n,t);if(!He.isVoidTag(e)){let r=!1;for(let a=0;a<rt.length;a++)if(rt[a].tag.toLowerCase()===e.toLowerCase()){r=!0,a>0&&nr(24,rt[0].loc.start.offset);for(let i=0;i<=a;i++){const s=rt.shift();ni(s,t,i<a)}break}r||nr(23,_h(n,60))}},onselfclosingtag(n){const t=Lt.tag;Lt.isSelfClosing=!0,fd(n),rt[0]&&rt[0].tag===t&&ni(rt.shift(),n)},onattribname(n,t){Ue={type:6,name:Rt(n,t),nameLoc:vt(n,t),value:void 0,loc:vt(n)}},ondirname(n,t){const e=Rt(n,t),r=e==="."||e===":"?"bind":e==="@"?"on":e==="#"?"slot":e.slice(2);if(!Cr&&r===""&&nr(26,n),Cr||r==="")Ue={type:6,name:e,nameLoc:vt(n,t),value:void 0,loc:vt(n)};else if(Ue={type:7,name:r,rawName:e,exp:void 0,arg:void 0,modifiers:e==="."?[De("prop")]:[],loc:vt(n)},r==="pre"){Cr=dt.inVPre=!0,bu=Lt;const a=Lt.props;for(let o=0;o<a.length;o++)a[o].type===7&&(a[o]=DS(a[o]))}},ondirarg(n,t){if(n===t)return;const e=Rt(n,t);if(Cr)Ue.name+=e,Xr(Ue.nameLoc,t);else{const r=e[0]!=="[";Ue.arg=ri(r?e:e.slice(1,-1),r,vt(n,t),r?3:0)}},ondirmodifier(n,t){const e=Rt(n,t);if(Cr)Ue.name+="."+e,Xr(Ue.nameLoc,t);else if(Ue.name==="slot"){const r=Ue.arg;r&&(r.content+="."+e,Xr(r.loc,t))}else{const r=De(e,!0,vt(n,t));Ue.modifiers.push(r)}},onattribdata(n,t){Zt+=Rt(n,t),ar<0&&(ar=n),$r=t},onattribentity(n,t,e){Zt+=n,ar<0&&(ar=t),$r=e},onattribnameend(n){const t=Ue.loc.start.offset,e=Rt(t,n);Ue.type===7&&(Ue.rawName=e),Lt.props.some(r=>(r.type===7?r.rawName:r.name)===e)&&nr(2,t)},onattribend(n,t){if(Lt&&Ue){if(Xr(Ue.loc,t),n!==0)if(Zt.includes("&")&&(Zt=He.decodeEntities(Zt,!0)),Ue.type===6)Ue.name==="class"&&(Zt=Eh(Zt).trim()),n===1&&!Zt&&nr(13,t),Ue.value={type:2,content:Zt,loc:n===1?vt(ar,$r):vt(ar-1,$r+1)},dt.inSFCRoot&&Lt.tag==="template"&&Ue.name==="lang"&&Zt&&Zt!=="html"&&dt.enterRCDATA(Pi("</template"),0);else{let e=0;Ue.exp=ri(Zt,!1,vt(ar,$r),0,e),Ue.name==="for"&&(Ue.forParseResult=yS(Ue.exp));let r=-1;Ue.name==="bind"&&(r=Ue.modifiers.findIndex(a=>a.content==="sync"))>-1&&Oa("COMPILER_V_BIND_SYNC",He,Ue.loc,Ue.arg.loc.source)&&(Ue.name="model",Ue.modifiers.splice(r,1))}(Ue.type!==7||Ue.name!=="pre")&&Lt.props.push(Ue)}Zt="",ar=$r=-1},oncomment(n,t){He.comments&&_u({type:3,content:Rt(n,t),loc:vt(n-4,t+3)})},onend(){const n=lr.length;for(let t=0;t<rt.length;t++)ni(rt[t],n-1),nr(24,rt[t].loc.start.offset)},oncdata(n,t){rt[0].ns!==0?Ko(Rt(n,t),n,t):nr(1,n-9)},onprocessinginstruction(n){(rt[0]?rt[0].ns:He.ns)===0&&nr(21,n-1)}}),pd=/,([^,\}\]]*)(?:,([^,\}\]]*))?$/,gS=/^\(|\)$/g;function yS(n){const t=n.loc,e=n.content,r=e.match(xh);if(!r)return;const[,a,o]=r,i=(p,f,d=!1)=>{const h=t.start.offset+f,v=h+p.length;return ri(p,!1,vt(h,v),0,d?1:0)},s={source:i(o.trim(),e.indexOf(o,a.length)),value:void 0,key:void 0,index:void 0,finalized:!1};let u=a.trim().replace(gS,"").trim();const l=a.indexOf(u),c=u.match(pd);if(c){u=u.replace(pd,"").trim();const p=c[1].trim();let f;if(p&&(f=e.indexOf(p,l+u.length),s.key=i(p,f,!0)),c[2]){const d=c[2].trim();d&&(s.index=i(d,e.indexOf(d,s.key?f+p.length:l+u.length),!0))}}return u&&(s.value=i(u,l,!0)),s}function Rt(n,t){return lr.slice(n,t)}function fd(n){dt.inSFCRoot&&(Lt.innerLoc=vt(n+1,n+1)),_u(Lt);const{tag:t,ns:e}=Lt;e===0&&He.isPreTag(t)&&Wl++,He.isVoidTag(t)?ni(Lt,n):(rt.unshift(Lt),(e===1||e===2)&&(dt.inXML=!0)),Lt=null}function Ko(n,t,e){{const o=rt[0]&&rt[0].tag;o!=="script"&&o!=="style"&&n.includes("&")&&(n=He.decodeEntities(n,!1))}const r=rt[0]||go,a=r.children[r.children.length-1];a&&a.type===2?(a.content+=n,Xr(a.loc,e)):r.children.push({type:2,content:n,loc:vt(t,e)})}function ni(n,t,e=!1){e?Xr(n.loc,_h(t,60)):Xr(n.loc,xS(t,62)+1),dt.inSFCRoot&&(n.children.length?n.innerLoc.end=ur({},n.children[n.children.length-1].loc.end):n.innerLoc.end=ur({},n.innerLoc.start),n.innerLoc.source=Rt(n.innerLoc.start.offset,n.innerLoc.end.offset));const{tag:r,ns:a,children:o}=n;if(Cr||(r==="slot"?n.tagType=2:hd(n)?n.tagType=3:_S(n)&&(n.tagType=1)),dt.inRCDATA||(n.children=wh(o)),a===0&&He.isIgnoreNewlineTag(r)){const i=o[0];i&&i.type===2&&(i.content=i.content.replace(/^\r?\n/,""))}a===0&&He.isPreTag(r)&&Wl--,bu===n&&(Cr=dt.inVPre=!1,bu=null),dt.inXML&&(rt[0]?rt[0].ns:He.ns)===0&&(dt.inXML=!1);{const i=n.props;if(!dt.inSFCRoot&&Kr("COMPILER_NATIVE_TEMPLATE",He)&&n.tag==="template"&&!hd(n)){const u=rt[0]||go,l=u.children.indexOf(n);u.children.splice(l,1,...n.children)}const s=i.find(u=>u.type===6&&u.name==="inline-template");s&&Oa("COMPILER_INLINE_TEMPLATE",He,s.loc)&&n.children.length&&(s.value={type:2,content:Rt(n.children[0].loc.start.offset,n.children[n.children.length-1].loc.end.offset),loc:s.loc})}}function xS(n,t){let e=n;for(;lr.charCodeAt(e)!==t&&e<lr.length-1;)e++;return e}function _h(n,t){let e=n;for(;lr.charCodeAt(e)!==t&&e>=0;)e--;return e}const bS=new Set(["if","else","else-if","for","slot"]);function hd({tag:n,props:t}){if(n==="template"){for(let e=0;e<t.length;e++)if(t[e].type===7&&bS.has(t[e].name))return!0}return!1}function _S({tag:n,props:t}){if(He.isCustomElement(n))return!1;if(n==="component"||wS(n.charCodeAt(0))||Ll(n)||He.isBuiltInComponent&&He.isBuiltInComponent(n)||He.isNativeTag&&!He.isNativeTag(n))return!0;for(let e=0;e<t.length;e++){const r=t[e];if(r.type===6){if(r.name==="is"&&r.value){if(r.value.content.startsWith("vue:"))return!0;if(Oa("COMPILER_IS_ON_ELEMENT",He,r.loc))return!0}}else if(r.name==="bind"&&kr(r.arg,"is")&&Oa("COMPILER_IS_ON_ELEMENT",He,r.loc))return!0}return!1}function wS(n){return n>64&&n<91}const ES=/\r\n/g;function wh(n,t){const e=He.whitespace!=="preserve";let r=!1;for(let a=0;a<n.length;a++){const o=n[a];if(o.type===2)if(Wl)o.content=o.content.replace(ES,`
`);else if(SS(o.content)){const i=n[a-1]&&n[a-1].type,s=n[a+1]&&n[a+1].type;!i||!s||e&&(i===3&&(s===3||s===1)||i===1&&(s===3||s===1&&CS(o.content)))?(r=!0,n[a]=null):o.content=" "}else e&&(o.content=Eh(o.content))}return r?n.filter(Boolean):n}function SS(n){for(let t=0;t<n.length;t++)if(!un(n.charCodeAt(t)))return!1;return!0}function CS(n){for(let t=0;t<n.length;t++){const e=n.charCodeAt(t);if(e===10||e===13)return!0}return!1}function Eh(n){let t="",e=!1;for(let r=0;r<n.length;r++)un(n.charCodeAt(r))?e||(t+=" ",e=!0):(t+=n[r],e=!1);return t}function _u(n){(rt[0]||go).children.push(n)}function vt(n,t){return{start:dt.getPos(n),end:t==null?t:dt.getPos(t),source:t==null?t:Rt(n,t)}}function IS(n){return vt(n.start.offset,n.end.offset)}function Xr(n,t){n.end=dt.getPos(t),n.source=Rt(n.start.offset,t)}function DS(n){const t={type:6,name:n.rawName,nameLoc:vt(n.loc.start.offset,n.loc.start.offset+n.rawName.length),value:void 0,loc:n.loc};if(n.exp){const e=n.exp.loc;e.end.offset<n.loc.end.offset&&(e.start.offset--,e.start.column--,e.end.offset++,e.end.column++),t.value={type:2,content:n.exp.content,loc:e}}return t}function ri(n,t=!1,e,r=0,a=0){return De(n,t,e,r)}function nr(n,t,e){He.onError(tt(n,vt(t,t)))}function kS(){dt.reset(),Lt=null,Ue=null,Zt="",ar=-1,$r=-1,rt.length=0}function ql(n,t){if(kS(),lr=n,He=ur({},bh),t){let a;for(a in t)t[a]!=null&&(He[a]=t[a])}dt.mode=He.parseMode==="html"?1:He.parseMode==="sfc"?2:0,dt.inXML=He.ns===1||He.ns===2;const e=t&&t.delimiters;e&&(dt.delimiterOpen=Pi(e[0]),dt.delimiterClose=Pi(e[1]));const r=go=ah([],n);return dt.parse(lr),r.loc=vt(0,n.length),r.children=wh(r.children),go=null,r}function TS(n,t){ai(n,void 0,t,Sh(n,n.children[0]))}function Sh(n,t){const{children:e}=n;return e.length===1&&t.type===1&&!vo(t)}function ai(n,t,e,r=!1,a=!1){const{children:o}=n,i=[];for(let p=0;p<o.length;p++){const f=o[p];if(f.type===1&&f.tagType===0){const d=r?0:nn(f,e);if(d>0){if(d>=2){f.codegenNode.patchFlag=-1,i.push(f);continue}}else{const h=f.codegenNode;if(h.type===13){const v=h.patchFlag;if((v===void 0||v===512||v===1)&&Ih(f,e)>=2){const g=Dh(f);g&&(h.props=e.hoist(g))}h.dynamicProps&&(h.dynamicProps=e.hoist(h.dynamicProps))}}}else if(f.type===12&&(r?0:nn(f,e))>=2){i.push(f);continue}if(f.type===1){const d=f.tagType===1;d&&e.scopes.vSlot++,ai(f,n,e,!1,a),d&&e.scopes.vSlot--}else if(f.type===11)ai(f,n,e,f.children.length===1,!0);else if(f.type===9)for(let d=0;d<f.branches.length;d++)ai(f.branches[d],n,e,f.branches[d].children.length===1,a)}let s=!1;const u=[];if(i.length===o.length&&n.type===1){if(n.tagType===0&&n.codegenNode&&n.codegenNode.type===13&&or(n.codegenNode.children))n.codegenNode.children=l(Pr(n.codegenNode.children)),s=!0;else if(n.tagType===1&&n.codegenNode&&n.codegenNode.type===13&&n.codegenNode.children&&!or(n.codegenNode.children)&&n.codegenNode.children.type===15){const p=c(n.codegenNode,"default");p&&(u.push(e.cached.length),p.returns=l(Pr(p.returns)),s=!0)}else if(n.tagType===3&&t&&t.type===1&&t.tagType===1&&t.codegenNode&&t.codegenNode.type===13&&t.codegenNode.children&&!or(t.codegenNode.children)&&t.codegenNode.children.type===15){const p=Xt(n,"slot",!0),f=p&&p.arg&&c(t.codegenNode,p.arg);f&&(u.push(e.cached.length),f.returns=l(Pr(f.returns)),s=!0)}}if(!s)for(const p of i)u.push(e.cached.length),p.codegenNode=e.cache(p.codegenNode);u.length&&n.type===1&&n.tagType===1&&n.codegenNode&&n.codegenNode.type===13&&n.codegenNode.children&&!or(n.codegenNode.children)&&n.codegenNode.children.type===15&&n.codegenNode.children.properties.push(it("__",De(JSON.stringify(u),!1)));function l(p){const f=e.cache(p);return a&&e.hmr&&(f.needArraySpread=!0),f}function c(p,f){if(p.children&&!or(p.children)&&p.children.type===15){const d=p.children.properties.find(h=>h.key===f||h.key.content===f);return d&&d.value}}i.length&&e.transformHoist&&e.transformHoist(o,e,n)}function nn(n,t){const{constantCache:e}=t;switch(n.type){case 1:if(n.tagType!==0)return 0;const r=e.get(n);if(r!==void 0)return r;const a=n.codegenNode;if(a.type!==13||a.isBlock&&n.tag!=="svg"&&n.tag!=="foreignObject"&&n.tag!=="math")return 0;if(a.patchFlag===void 0){let i=3;const s=Ih(n,t);if(s===0)return e.set(n,0),0;s<i&&(i=s);for(let u=0;u<n.children.length;u++){const l=nn(n.children[u],t);if(l===0)return e.set(n,0),0;l<i&&(i=l)}if(i>1)for(let u=0;u<n.props.length;u++){const l=n.props[u];if(l.type===7&&l.name==="bind"&&l.exp){const c=nn(l.exp,t);if(c===0)return e.set(n,0),0;c<i&&(i=c)}}if(a.isBlock){for(let u=0;u<n.props.length;u++)if(n.props[u].type===7)return e.set(n,0),0;t.removeHelper(Vr),t.removeHelper(na(t.inSSR,a.isComponent)),a.isBlock=!1,t.helper(ta(t.inSSR,a.isComponent))}return e.set(n,i),i}else return e.set(n,0),0;case 2:case 3:return 3;case 9:case 11:case 10:return 0;case 5:case 12:return nn(n.content,t);case 4:return n.constType;case 8:let o=3;for(let i=0;i<n.children.length;i++){const s=n.children[i];if(bt(s)||Cu(s))continue;const u=nn(s,t);if(u===0)return 0;u<o&&(o=u)}return o;case 20:return 2;default:return 0}}const NS=new Set([ds,ps,Aa,Ua]);function Ch(n,t){if(n.type===14&&!bt(n.callee)&&NS.has(n.callee)){const e=n.arguments[0];if(e.type===4)return nn(e,t);if(e.type===14)return Ch(e,t)}return 0}function Ih(n,t){let e=3;const r=Dh(n);if(r&&r.type===15){const{properties:a}=r;for(let o=0;o<a.length;o++){const{key:i,value:s}=a[o],u=nn(i,t);if(u===0)return u;u<e&&(e=u);let l;if(s.type===4?l=nn(s,t):s.type===14?l=Ch(s,t):l=0,l===0)return l;l<e&&(e=l)}}return e}function Dh(n){const t=n.codegenNode;if(t.type===13)return t.props}function kh(n,{filename:t="",prefixIdentifiers:e=!1,hoistStatic:r=!1,hmr:a=!1,cacheHandlers:o=!1,nodeTransforms:i=[],directiveTransforms:s={},transformHoist:u=null,isBuiltInComponent:l=Za,isCustomElement:c=Za,expressionPlugins:p=[],scopeId:f=null,slotted:d=!0,ssr:h=!1,inSSR:v=!1,ssrCssVars:g="",bindingMetadata:m=lv,inline:x=!1,isTS:y=!1,onError:w=Vl,onWarn:E=sh,compatConfig:D}){const k=t.replace(/\?.*$/,"").match(/([^/\\]+)\.\w+$/),S={filename:t,selfName:k&&Nd(Tr(k[1])),prefixIdentifiers:e,hoistStatic:r,hmr:a,cacheHandlers:o,nodeTransforms:i,directiveTransforms:s,transformHoist:u,isBuiltInComponent:l,isCustomElement:c,expressionPlugins:p,scopeId:f,slotted:d,ssr:h,inSSR:v,ssrCssVars:g,bindingMetadata:m,inline:x,isTS:y,onError:w,onWarn:E,compatConfig:D,root:n,helpers:new Map,components:new Set,directives:new Set,hoists:[],imports:[],cached:[],constantCache:new WeakMap,temps:0,identifiers:Object.create(null),scopes:{vFor:0,vSlot:0,vPre:0,vOnce:0},parent:null,grandParent:null,currentNode:n,childIndex:0,inVOnce:!1,helper(_){const b=S.helpers.get(_)||0;return S.helpers.set(_,b+1),_},removeHelper(_){const b=S.helpers.get(_);if(b){const N=b-1;N?S.helpers.set(_,N):S.helpers.delete(_)}},helperString(_){return`_${Zr[S.helper(_)]}`},replaceNode(_){S.parent.children[S.childIndex]=S.currentNode=_},removeNode(_){const b=S.parent.children,N=_?b.indexOf(_):S.currentNode?S.childIndex:-1;!_||_===S.currentNode?(S.currentNode=null,S.onNodeRemoved()):S.childIndex>N&&(S.childIndex--,S.onNodeRemoved()),S.parent.children.splice(N,1)},onNodeRemoved:Za,addIdentifiers(_){},removeIdentifiers(_){},hoist(_){bt(_)&&(_=De(_)),S.hoists.push(_);const b=De(`_hoisted_${S.hoists.length}`,!1,_.loc,2);return b.hoisted=_,b},cache(_,b=!1,N=!1){const T=oh(S.cached.length,_,b,N);return S.cached.push(T),T}};return S.filters=new Set,S}function Th(n,t){const e=kh(n,t);Ao(n,e),t.hoistStatic&&TS(n,e),t.ssr||RS(n,e),n.helpers=new Set([...e.helpers.keys()]),n.components=[...e.components],n.directives=[...e.directives],n.imports=e.imports,n.hoists=e.hoists,n.temps=e.temps,n.cached=e.cached,n.transformed=!0,n.filters=[...e.filters]}function RS(n,t){const{helper:e}=t,{children:r}=n;if(r.length===1){const a=r[0];if(Sh(n,a)&&a.codegenNode){const o=a.codegenNode;o.type===13&&ms(o,t),n.codegenNode=o}else n.codegenNode=a}else if(r.length>1){let a=64;n.codegenNode=Pa(t,e(Ra),void 0,n.children,a,void 0,void 0,!0,void 0,!1)}}function AS(n,t){let e=0;const r=()=>{e--};for(;e<n.children.length;e++){const a=n.children[e];bt(a)||(t.grandParent=t.parent,t.parent=n,t.childIndex=e,t.onNodeRemoved=r,Ao(a,t))}}function Ao(n,t){t.currentNode=n;const{nodeTransforms:e}=t,r=[];for(let o=0;o<e.length;o++){const i=e[o](n,t);if(i&&(or(i)?r.push(...i):r.push(i)),t.currentNode)n=t.currentNode;else return}switch(n.type){case 3:t.ssr||t.helper(Ba);break;case 5:t.ssr||t.helper(To);break;case 9:for(let o=0;o<n.branches.length;o++)Ao(n.branches[o],t);break;case 10:case 11:case 1:case 0:AS(n,t);break}t.currentNode=n;let a=r.length;for(;a--;)r[a]()}function zl(n,t){const e=bt(n)?r=>r===n:r=>n.test(r);return(r,a)=>{if(r.type===1){const{props:o}=r;if(r.tagType===3&&o.some(Ul))return;const i=[];for(let s=0;s<o.length;s++){const u=o[s];if(u.type===7&&e(u.name)){o.splice(s,1),s--;const l=t(r,u,a);l&&i.push(l)}}return i}}}const gs="/*@__PURE__*/",Nh=n=>`${Zr[n]}: _${Zr[n]}`;function PS(n,{mode:t="function",prefixIdentifiers:e=t==="module",sourceMap:r=!1,filename:a="template.vue.html",scopeId:o=null,optimizeImports:i=!1,runtimeGlobalName:s="Vue",runtimeModuleName:u="vue",ssrRuntimeModuleName:l="vue/server-renderer",ssr:c=!1,isTS:p=!1,inSSR:f=!1}){const d={mode:t,prefixIdentifiers:e,sourceMap:r,filename:a,scopeId:o,optimizeImports:i,runtimeGlobalName:s,runtimeModuleName:u,ssrRuntimeModuleName:l,ssr:c,isTS:p,inSSR:f,source:n.source,code:"",column:1,line:1,offset:0,indentLevel:0,pure:!1,map:void 0,helper(v){return`_${Zr[v]}`},push(v,g=-2,m){d.code+=v},indent(){h(++d.indentLevel)},deindent(v=!1){v?--d.indentLevel:h(--d.indentLevel)},newline(){h(d.indentLevel)}};function h(v){d.push(`
`+"  ".repeat(v),0)}return d}function Rh(n,t={}){const e=PS(n,t);t.onContextCreated&&t.onContextCreated(e);const{mode:r,push:a,prefixIdentifiers:o,indent:i,deindent:s,newline:u,scopeId:l,ssr:c}=e,p=Array.from(n.helpers),f=p.length>0,d=!o&&r!=="module";OS(n,e);const v=c?"ssrRender":"render",m=(c?["_ctx","_push","_parent","_attrs"]:["_ctx","_cache"]).join(", ");if(a(`function ${v}(${m}) {`),i(),d&&(a("with (_ctx) {"),i(),f&&(a(`const { ${p.map(Nh).join(", ")} } = _Vue
`,-1),u())),n.components.length&&(Xs(n.components,"component",e),(n.directives.length||n.temps>0)&&u()),n.directives.length&&(Xs(n.directives,"directive",e),n.temps>0&&u()),n.filters&&n.filters.length&&(u(),Xs(n.filters,"filter",e),u()),n.temps>0){a("let ");for(let x=0;x<n.temps;x++)a(`${x>0?", ":""}_temp${x}`)}return(n.components.length||n.directives.length||n.temps)&&(a(`
`,0),u()),c||a("return "),n.codegenNode?Ht(n.codegenNode,e):a("null"),d&&(s(),a("}")),s(),a("}"),{ast:n,code:e.code,preamble:"",map:e.map?e.map.toJSON():void 0}}function OS(n,t){const{ssr:e,prefixIdentifiers:r,push:a,newline:o,runtimeModuleName:i,runtimeGlobalName:s,ssrRuntimeModuleName:u}=t,l=s,c=Array.from(n.helpers);if(c.length>0&&(a(`const _Vue = ${l}
`,-1),n.hoists.length)){const p=[ns,rs,Ba,as,Pl].filter(f=>c.includes(f)).map(Nh).join(", ");a(`const { ${p} } = _Vue
`,-1)}MS(n.hoists,t),o(),a("return ")}function Xs(n,t,{helper:e,push:r,newline:a,isTS:o}){const i=e(t==="filter"?us:t==="component"?os:ss);for(let s=0;s<n.length;s++){let u=n[s];const l=u.endsWith("__self");l&&(u=u.slice(0,-6)),r(`const ${Fa(u,t)} = ${i}(${JSON.stringify(u)}${l?", true":""})${o?"!":""}`),s<n.length-1&&a()}}function MS(n,t){if(!n.length)return;t.pure=!0;const{push:e,newline:r}=t;r();for(let a=0;a<n.length;a++){const o=n[a];o&&(e(`const _hoisted_${a+1} = `),Ht(o,t),r())}t.pure=!1}function $l(n,t){const e=n.length>3||!1;t.push("["),e&&t.indent(),Po(n,t,e),e&&t.deindent(),t.push("]")}function Po(n,t,e=!1,r=!0){const{push:a,newline:o}=t;for(let i=0;i<n.length;i++){const s=n[i];bt(s)?a(s,-3):or(s)?$l(s,t):Ht(s,t),i<n.length-1&&(e?(r&&a(","),o()):r&&a(", "))}}function Ht(n,t){if(bt(n)){t.push(n,-3);return}if(Cu(n)){t.push(t.helper(n));return}switch(n.type){case 1:case 9:case 11:Ht(n.codegenNode,t);break;case 2:FS(n,t);break;case 4:Ah(n,t);break;case 5:VS(n,t);break;case 12:Ht(n.codegenNode,t);break;case 8:Ph(n,t);break;case 3:BS(n,t);break;case 13:US(n,t);break;case 14:qS(n,t);break;case 15:zS(n,t);break;case 17:$S(n,t);break;case 18:HS(n,t);break;case 19:GS(n,t);break;case 20:jS(n,t);break;case 21:Po(n.body,t,!0,!1);break}}function FS(n,t){t.push(JSON.stringify(n.content),-3,n)}function Ah(n,t){const{content:e,isStatic:r}=n;t.push(r?JSON.stringify(e):e,-3,n)}function VS(n,t){const{push:e,helper:r,pure:a}=t;a&&e(gs),e(`${r(To)}(`),Ht(n.content,t),e(")")}function Ph(n,t){for(let e=0;e<n.children.length;e++){const r=n.children[e];bt(r)?t.push(r,-3):Ht(r,t)}}function LS(n,t){const{push:e}=t;if(n.type===8)e("["),Ph(n,t),e("]");else if(n.isStatic){const r=No(n.content)?n.content:JSON.stringify(n.content);e(r,-2,n)}else e(`[${n.content}]`,-3,n)}function BS(n,t){const{push:e,helper:r,pure:a}=t;a&&e(gs),e(`${r(Ba)}(${JSON.stringify(n.content)})`,-3,n)}function US(n,t){const{push:e,helper:r,pure:a}=t,{tag:o,props:i,children:s,patchFlag:u,dynamicProps:l,directives:c,isBlock:p,disableTracking:f,isComponent:d}=n;let h;u&&(h=String(u)),c&&e(r(ls)+"("),p&&e(`(${r(Vr)}(${f?"true":""}), `),a&&e(gs);const v=p?na(t.inSSR,d):ta(t.inSSR,d);e(r(v)+"(",-2,n),Po(WS([o,i,s,h,l]),t),e(")"),p&&e(")"),c&&(e(", "),Ht(c,t),e(")"))}function WS(n){let t=n.length;for(;t--&&n[t]==null;);return n.slice(0,t+1).map(e=>e||"null")}function qS(n,t){const{push:e,helper:r,pure:a}=t,o=bt(n.callee)?n.callee:r(n.callee);a&&e(gs),e(o+"(",-2,n),Po(n.arguments,t),e(")")}function zS(n,t){const{push:e,indent:r,deindent:a,newline:o}=t,{properties:i}=n;if(!i.length){e("{}",-2,n);return}const s=i.length>1||!1;e(s?"{":"{ "),s&&r();for(let u=0;u<i.length;u++){const{key:l,value:c}=i[u];LS(l,t),e(": "),Ht(c,t),u<i.length-1&&(e(","),o())}s&&a(),e(s?"}":" }")}function $S(n,t){$l(n.elements,t)}function HS(n,t){const{push:e,indent:r,deindent:a}=t,{params:o,returns:i,body:s,newline:u,isSlot:l}=n;l&&e(`_${Zr[hs]}(`),e("(",-2,n),or(o)?Po(o,t):o&&Ht(o,t),e(") => "),(u||s)&&(e("{"),r()),i?(u&&e("return "),or(i)?$l(i,t):Ht(i,t)):s&&Ht(s,t),(u||s)&&(a(),e("}")),l&&(n.isNonScopedSlot&&e(", undefined, true"),e(")"))}function GS(n,t){const{test:e,consequent:r,alternate:a,newline:o}=n,{push:i,indent:s,deindent:u,newline:l}=t;if(e.type===4){const p=!No(e.content);p&&i("("),Ah(e,t),p&&i(")")}else i("("),Ht(e,t),i(")");o&&s(),t.indentLevel++,o||i(" "),i("? "),Ht(r,t),t.indentLevel--,o&&l(),o||i(" "),i(": ");const c=a.type===19;c||t.indentLevel++,Ht(a,t),c||t.indentLevel--,o&&u(!0)}function jS(n,t){const{push:e,helper:r,indent:a,deindent:o,newline:i}=t,{needPauseTracking:s,needArraySpread:u}=n;u&&e("[...("),e(`_cache[${n.index}] || (`),s&&(a(),e(`${r(ho)}(-1`),n.inVOnce&&e(", true"),e("),"),i(),e("(")),e(`_cache[${n.index}] = `),Ht(n.value,t),s&&(e(`).cacheIndex = ${n.index},`),i(),e(`${r(ho)}(1),`),i(),e(`_cache[${n.index}]`),o()),e(")"),u&&e(")]")}new RegExp("\\b"+"arguments,await,break,case,catch,class,const,continue,debugger,default,delete,do,else,export,extends,finally,for,function,if,import,let,new,return,super,switch,throw,try,var,void,while,with,yield".split(",").join("\\b|\\b")+"\\b");const XS=(n,t)=>{if(n.type===5)n.content=oi(n.content,t);else if(n.type===1){const e=Xt(n,"memo");for(let r=0;r<n.props.length;r++){const a=n.props[r];if(a.type===7&&a.name!=="for"){const o=a.exp,i=a.arg;o&&o.type===4&&!(a.name==="on"&&i)&&!(e&&i&&i.type===4&&i.content==="key")&&(a.exp=oi(o,t,a.name==="slot")),i&&i.type===4&&!i.isStatic&&(a.arg=oi(i,t))}}}};function oi(n,t,e=!1,r=!1,a=Object.create(t.identifiers)){return n}function Oh(n){return bt(n)?n:n.type===4?n.content:n.children.map(Oh).join("")}const YS=zl(/^(if|else|else-if)$/,(n,t,e)=>Mh(n,t,e,(r,a,o)=>{const i=e.parent.children;let s=i.indexOf(r),u=0;for(;s-->=0;){const l=i[s];l&&l.type===9&&(u+=l.branches.length)}return()=>{if(o)r.codegenNode=md(a,u,e);else{const l=KS(r.codegenNode);l.alternate=md(a,u+r.branches.length-1,e)}}}));function Mh(n,t,e,r){if(t.name!=="else"&&(!t.exp||!t.exp.content.trim())){const a=t.exp?t.exp.loc:n.loc;e.onError(tt(28,t.loc)),t.exp=De("true",!1,a)}if(t.name==="if"){const a=vd(n,t),o={type:9,loc:IS(n.loc),branches:[a]};if(e.replaceNode(o),r)return r(o,a,!0)}else{const a=e.parent.children;let o=a.indexOf(n);for(;o-->=-1;){const i=a[o];if(i&&i.type===3){e.removeNode(i);continue}if(i&&i.type===2&&!i.content.trim().length){e.removeNode(i);continue}if(i&&i.type===9){t.name==="else-if"&&i.branches[i.branches.length-1].condition===void 0&&e.onError(tt(30,n.loc)),e.removeNode();const s=vd(n,t);i.branches.push(s);const u=r&&r(i,s,!1);Ao(s,e),u&&u(),e.currentNode=null}else e.onError(tt(30,n.loc));break}}}function vd(n,t){const e=n.tagType===3;return{type:10,loc:n.loc,condition:t.name==="else"?void 0:t.exp,children:e&&!Xt(n,"for")?n.children:[n],userKey:Ro(n,"key"),isTemplateIf:e}}function md(n,t,e){return n.condition?Ai(n.condition,gd(n,t,e),gt(e.helper(Ba),['""',"true"])):gd(n,t,e)}function gd(n,t,e){const{helper:r}=e,a=it("key",De(`${t}`,!1,It,2)),{children:o}=n,i=o[0];if(o.length!==1||i.type!==1)if(o.length===1&&i.type===11){const u=i.codegenNode;return mo(u,a,e),u}else return Pa(e,r(Ra),hn([a]),o,64,void 0,void 0,!0,!1,!1,n.loc);else{const u=i.codegenNode,l=yh(u);return l.type===13&&ms(l,e),mo(l,a,e),u}}function KS(n){for(;;)if(n.type===19)if(n.alternate.type===19)n=n.alternate;else return n;else n.type===20&&(n=n.value)}const Fh=(n,t,e)=>{const{modifiers:r,loc:a}=n,o=n.arg;let{exp:i}=n;if(i&&i.type===4&&!i.content.trim()&&(i=void 0),!i){if(o.type!==4||!o.isStatic)return e.onError(tt(52,o.loc)),{props:[it(o,De("",!0,a))]};Vh(n),i=n.exp}return o.type!==4?(o.children.unshift("("),o.children.push(') || ""')):o.isStatic||(o.content=`${o.content} || ""`),r.some(s=>s.content==="camel")&&(o.type===4?o.isStatic?o.content=Tr(o.content):o.content=`${e.helperString(Ni)}(${o.content})`:(o.children.unshift(`${e.helperString(Ni)}(`),o.children.push(")"))),e.inSSR||(r.some(s=>s.content==="prop")&&yd(o,"."),r.some(s=>s.content==="attr")&&yd(o,"^")),{props:[it(o,i)]}},Vh=(n,t)=>{const e=n.arg,r=Tr(e.content);n.exp=De(r,!1,e.loc)},yd=(n,t)=>{n.type===4?n.isStatic?n.content=t+n.content:n.content=`\`${t}\${${n.content}}\``:(n.children.unshift(`'${t}' + (`),n.children.push(")"))},JS=zl("for",(n,t,e)=>{const{helper:r,removeHelper:a}=e;return Lh(n,t,e,o=>{const i=gt(r(cs),[o.source]),s=Ma(n),u=Xt(n,"memo"),l=Ro(n,"key",!1,!0);l&&l.type===7&&!l.exp&&Vh(l);let p=l&&(l.type===6?l.value?De(l.value.content,!0):void 0:l.exp);const f=l&&p?it("key",p):null,d=o.source.type===4&&o.source.constType>0,h=d?64:l?128:256;return o.codegenNode=Pa(e,r(Ra),void 0,i,h,void 0,void 0,!0,!d,!1,n.loc),()=>{let v;const{children:g}=o,m=g.length!==1||g[0].type!==1,x=vo(n)?n:s&&n.children.length===1&&vo(n.children[0])?n.children[0]:null;if(x?(v=x.codegenNode,s&&f&&mo(v,f,e)):m?v=Pa(e,r(Ra),f?hn([f]):void 0,n.children,64,void 0,void 0,!0,void 0,!1):(v=g[0].codegenNode,s&&f&&mo(v,f,e),v.isBlock!==!d&&(v.isBlock?(a(Vr),a(na(e.inSSR,v.isComponent))):a(ta(e.inSSR,v.isComponent))),v.isBlock=!d,v.isBlock?(r(Vr),r(na(e.inSSR,v.isComponent))):r(ta(e.inSSR,v.isComponent))),u){const y=ea(Oi(o.parseResult,[De("_cached")]));y.body=ih([En(["const _memo = (",u.exp,")"]),En(["if (_cached",...p?[" && _cached.key === ",p]:[],` && ${e.helperString(Fl)}(_cached, _memo)) return _cached`]),En(["const _item = ",v]),De("_item.memo = _memo"),De("return _item")]),i.arguments.push(y,De("_cache"),De(String(e.cached.length))),e.cached.push(null)}else i.arguments.push(ea(Oi(o.parseResult),v,!0))}})});function Lh(n,t,e,r){if(!t.exp){e.onError(tt(31,t.loc));return}const a=t.forParseResult;if(!a){e.onError(tt(32,t.loc));return}Hl(a);const{addIdentifiers:o,removeIdentifiers:i,scopes:s}=e,{source:u,value:l,key:c,index:p}=a,f={type:11,loc:t.loc,source:u,valueAlias:l,keyAlias:c,objectIndexAlias:p,parseResult:a,children:Ma(n)?n.children:[n]};e.replaceNode(f),s.vFor++;const d=r&&r(f);return()=>{s.vFor--,d&&d()}}function Hl(n,t){n.finalized||(n.finalized=!0)}function Oi({value:n,key:t,index:e},r=[]){return QS([n,t,e,...r])}function QS(n){let t=n.length;for(;t--&&!n[t];);return n.slice(0,t+1).map((e,r)=>e||De("_".repeat(r+1),!1))}const xd=De("undefined",!1),Bh=(n,t)=>{if(n.type===1&&(n.tagType===1||n.tagType===3)){const e=Xt(n,"slot");if(e)return e.exp,t.scopes.vSlot++,()=>{t.scopes.vSlot--}}},ZS=(n,t)=>{let e;if(Ma(n)&&n.props.some(Ul)&&(e=Xt(n,"for"))){const r=e.forParseResult;if(r){Hl(r);const{value:a,key:o,index:i}=r,{addIdentifiers:s,removeIdentifiers:u}=t;return a&&s(a),o&&s(o),i&&s(i),()=>{a&&u(a),o&&u(o),i&&u(i)}}}},eC=(n,t,e,r)=>ea(n,e,!1,!0,e.length?e[0].loc:r);function Uh(n,t,e=eC){t.helper(hs);const{children:r,loc:a}=n,o=[],i=[];let s=t.scopes.vSlot>0||t.scopes.vFor>0;const u=Xt(n,"slot",!0);if(u){const{arg:g,exp:m}=u;g&&!Kt(g)&&(s=!0),o.push(it(g||De("default",!0),e(m,void 0,r,a)))}let l=!1,c=!1;const p=[],f=new Set;let d=0;for(let g=0;g<r.length;g++){const m=r[g];let x;if(!Ma(m)||!(x=Xt(m,"slot",!0))){m.type!==3&&p.push(m);continue}if(u){t.onError(tt(37,x.loc));break}l=!0;const{children:y,loc:w}=m,{arg:E=De("default",!0),exp:D,loc:k}=x;let S;Kt(E)?S=E?E.content:"default":s=!0;const _=Xt(m,"for"),b=e(D,_,y,w);let N,T;if(N=Xt(m,"if"))s=!0,i.push(Ai(N.exp,Jo(E,b,d++),xd));else if(T=Xt(m,/^else(-if)?$/,!0)){let P=g,F;for(;P--&&(F=r[P],F.type===3););if(F&&Ma(F)&&Xt(F,/^(else-)?if$/)){let M=i[i.length-1];for(;M.alternate.type===19;)M=M.alternate;M.alternate=T.exp?Ai(T.exp,Jo(E,b,d++),xd):Jo(E,b,d++)}else t.onError(tt(30,T.loc))}else if(_){s=!0;const P=_.forParseResult;P?(Hl(P),i.push(gt(t.helper(cs),[P.source,ea(Oi(P),Jo(E,b),!0)]))):t.onError(tt(32,_.loc))}else{if(S){if(f.has(S)){t.onError(tt(38,k));continue}f.add(S),S==="default"&&(c=!0)}o.push(it(E,b))}}if(!u){const g=(m,x)=>{const y=e(m,void 0,x,a);return t.compatConfig&&(y.isNonScopedSlot=!0),it("default",y)};l?p.length&&p.some(m=>Wh(m))&&(c?t.onError(tt(39,p[0].loc)):o.push(g(void 0,p))):o.push(g(void 0,r))}const h=s?2:ii(n.children)?3:1;let v=hn(o.concat(it("_",De(h+"",!1))),a);return i.length&&(v=gt(t.helper(Ml),[v,Pr(i)])),{slots:v,hasDynamicSlots:s}}function Jo(n,t,e){const r=[it("name",n),it("fn",t)];return e!=null&&r.push(it("key",De(String(e),!0))),hn(r)}function ii(n){for(let t=0;t<n.length;t++){const e=n[t];switch(e.type){case 1:if(e.tagType===2||ii(e.children))return!0;break;case 9:if(ii(e.branches))return!0;break;case 10:case 11:if(ii(e.children))return!0;break}}return!1}function Wh(n){return n.type!==2&&n.type!==12?!0:n.type===2?!!n.content.trim():Wh(n.content)}const qh=new WeakMap,zh=(n,t)=>function(){if(n=t.currentNode,!(n.type===1&&(n.tagType===0||n.tagType===1)))return;const{tag:r,props:a}=n,o=n.tagType===1;let i=o?$h(n,t):`"${r}"`;const s=Rd(i)&&i.callee===is;let u,l,c=0,p,f,d,h=s||i===Ia||i===ts||!o&&(r==="svg"||r==="foreignObject"||r==="math");if(a.length>0){const v=Gl(n,t,void 0,o,s);u=v.props,c=v.patchFlag,f=v.dynamicPropNames;const g=v.directives;d=g&&g.length?Pr(g.map(m=>Hh(m,t))):void 0,v.shouldUseBlock&&(h=!0)}if(n.children.length>0)if(i===po&&(h=!0,c|=1024),o&&i!==Ia&&i!==po){const{slots:g,hasDynamicSlots:m}=Uh(n,t);l=g,m&&(c|=1024)}else if(n.children.length===1&&i!==Ia){const g=n.children[0],m=g.type,x=m===5||m===8;x&&nn(g,t)===0&&(c|=1),x||m===2?l=g:l=n.children}else l=n.children;f&&f.length&&(p=nC(f)),n.codegenNode=Pa(t,i,u,l,c===0?void 0:c,p,d,!!h,!1,o,n.loc)};function $h(n,t,e=!1){let{tag:r}=n;const a=wu(r),o=Ro(n,"is",!1,!0);if(o)if(a||Kr("COMPILER_IS_ON_ELEMENT",t)){let s;if(o.type===6?s=o.value&&De(o.value.content,!0):(s=o.exp,s||(s=De("is",!1,o.arg.loc))),s)return gt(t.helper(is),[s])}else o.type===6&&o.value.content.startsWith("vue:")&&(r=o.value.content.slice(4));const i=Ll(r)||t.isBuiltInComponent(r);return i?(e||t.helper(i),i):(t.helper(os),t.components.add(r),Fa(r,"component"))}function Gl(n,t,e=n.props,r,a,o=!1){const{tag:i,loc:s,children:u}=n;let l=[];const c=[],p=[],f=u.length>0;let d=!1,h=0,v=!1,g=!1,m=!1,x=!1,y=!1,w=!1;const E=[],D=b=>{l.length&&(c.push(hn(bd(l),s)),l=[]),b&&c.push(b)},k=()=>{t.scopes.vFor>0&&l.push(it(De("ref_for",!0),De("true")))},S=({key:b,value:N})=>{if(Kt(b)){const T=b.content,P=Ad(T);if(P&&(!r||a)&&T.toLowerCase()!=="onclick"&&T!=="onUpdate:modelValue"&&!oc(T)&&(x=!0),P&&oc(T)&&(w=!0),P&&N.type===14&&(N=N.arguments[0]),N.type===20||(N.type===4||N.type===8)&&nn(N,t)>0)return;T==="ref"?v=!0:T==="class"?g=!0:T==="style"?m=!0:T!=="key"&&!E.includes(T)&&E.push(T),r&&(T==="class"||T==="style")&&!E.includes(T)&&E.push(T)}else y=!0};for(let b=0;b<e.length;b++){const N=e[b];if(N.type===6){const{loc:T,name:P,nameLoc:F,value:M}=N;let L=!0;if(P==="ref"&&(v=!0,k()),P==="is"&&(wu(i)||M&&M.content.startsWith("vue:")||Kr("COMPILER_IS_ON_ELEMENT",t)))continue;l.push(it(De(P,!0,F),De(M?M.content:"",L,M?M.loc:T)))}else{const{name:T,arg:P,exp:F,loc:M,modifiers:L}=N,A=T==="bind",$=T==="on";if(T==="slot"){r||t.onError(tt(40,M));continue}if(T==="once"||T==="memo"||T==="is"||A&&kr(P,"is")&&(wu(i)||Kr("COMPILER_IS_ON_ELEMENT",t))||$&&o)continue;if((A&&kr(P,"key")||$&&f&&kr(P,"vue:before-update"))&&(d=!0),A&&kr(P,"ref")&&k(),!P&&(A||$)){if(y=!0,F)if(A){if(k(),D(),Kr("COMPILER_V_BIND_OBJECT_ORDER",t)){c.unshift(F);continue}c.push(F)}else D({type:14,loc:M,callee:t.helper(fs),arguments:r?[F]:[F,"true"]});else t.onError(tt(A?34:35,M));continue}A&&L.some(z=>z.content==="prop")&&(h|=32);const q=t.directiveTransforms[T];if(q){const{props:z,needRuntime:K}=q(N,n,t);!o&&z.forEach(S),$&&P&&!Kt(P)?D(hn(z,s)):l.push(...z),K&&(p.push(N),Cu(K)&&qh.set(N,K))}else uv(T)||(p.push(N),f&&(d=!0))}}let _;if(c.length?(D(),c.length>1?_=gt(t.helper(fo),c,s):_=c[0]):l.length&&(_=hn(bd(l),s)),y?h|=16:(g&&!r&&(h|=2),m&&!r&&(h|=4),E.length&&(h|=8),x&&(h|=32)),!d&&(h===0||h===32)&&(v||w||p.length>0)&&(h|=512),!t.inSSR&&_)switch(_.type){case 15:let b=-1,N=-1,T=!1;for(let M=0;M<_.properties.length;M++){const L=_.properties[M].key;Kt(L)?L.content==="class"?b=M:L.content==="style"&&(N=M):L.isHandlerKey||(T=!0)}const P=_.properties[b],F=_.properties[N];T?_=gt(t.helper(Aa),[_]):(P&&!Kt(P.value)&&(P.value=gt(t.helper(ds),[P.value])),F&&(m||F.value.type===4&&F.value.content.trim()[0]==="["||F.value.type===17)&&(F.value=gt(t.helper(ps),[F.value])));break;case 14:break;default:_=gt(t.helper(Aa),[gt(t.helper(Ua),[_])]);break}return{props:_,directives:p,patchFlag:h,dynamicPropNames:E,shouldUseBlock:d}}function bd(n){const t=new Map,e=[];for(let r=0;r<n.length;r++){const a=n[r];if(a.key.type===8||!a.key.isStatic){e.push(a);continue}const o=a.key.content,i=t.get(o);i?(o==="style"||o==="class"||Ad(o))&&tC(i,a):(t.set(o,a),e.push(a))}return e}function tC(n,t){n.value.type===17?n.value.elements.push(t.value):n.value=Pr([n.value,t.value],n.loc)}function Hh(n,t){const e=[],r=qh.get(n);r?e.push(t.helperString(r)):(t.helper(ss),t.directives.add(n.name),e.push(Fa(n.name,"directive")));const{loc:a}=n;if(n.exp&&e.push(n.exp),n.arg&&(n.exp||e.push("void 0"),e.push(n.arg)),Object.keys(n.modifiers).length){n.arg||(n.exp||e.push("void 0"),e.push("void 0"));const o=De("true",!1,a);e.push(hn(n.modifiers.map(i=>it(i,o)),a))}return Pr(e,n.loc)}function nC(n){let t="[";for(let e=0,r=n.length;e<r;e++)t+=JSON.stringify(n[e]),e<r-1&&(t+=", ");return t+"]"}function wu(n){return n==="component"||n==="Component"}const rC=(n,t)=>{if(vo(n)){const{children:e,loc:r}=n,{slotName:a,slotProps:o}=Gh(n,t),i=[t.prefixIdentifiers?"_ctx.$slots":"$slots",a,"{}","undefined","true"];let s=2;o&&(i[2]=o,s=3),e.length&&(i[3]=ea([],e,!1,!1,r),s=4),t.scopeId&&!t.slotted&&(s=5),i.splice(s),n.codegenNode=gt(t.helper(Ol),i,r)}};function Gh(n,t){let e='"default"',r;const a=[];for(let o=0;o<n.props.length;o++){const i=n.props[o];if(i.type===6)i.value&&(i.name==="name"?e=JSON.stringify(i.value.content):(i.name=Tr(i.name),a.push(i)));else if(i.name==="bind"&&kr(i.arg,"name")){if(i.exp)e=i.exp;else if(i.arg&&i.arg.type===4){const s=Tr(i.arg.content);e=i.exp=De(s,!1,i.arg.loc)}}else i.name==="bind"&&i.arg&&Kt(i.arg)&&(i.arg.content=Tr(i.arg.content)),a.push(i)}if(a.length>0){const{props:o,directives:i}=Gl(n,t,a,!1,!1);r=o,i.length&&t.onError(tt(36,i[0].loc))}return{slotName:e,slotProps:r}}const jl=(n,t,e,r)=>{const{loc:a,modifiers:o,arg:i}=n;!n.exp&&!o.length&&e.onError(tt(35,a));let s;if(i.type===4)if(i.isStatic){let p=i.content;p.startsWith("vue:")&&(p=`vnode-${p.slice(4)}`);const f=t.tagType!==0||p.startsWith("vnode")||!/[A-Z]/.test(p)?cv(Tr(p)):`on:${p}`;s=De(f,!0,i.loc)}else s=En([`${e.helperString(Ri)}(`,i,")"]);else s=i,s.children.unshift(`${e.helperString(Ri)}(`),s.children.push(")");let u=n.exp;u&&!u.content.trim()&&(u=void 0);let l=e.cacheHandlers&&!u&&!e.inVOnce;if(u){const p=Bl(u),f=!(p||hh(u)),d=u.content.includes(";");(f||l&&p)&&(u=En([`${f?"$event":"(...args)"} => ${d?"{":"("}`,u,d?"}":")"]))}let c={props:[it(s,u||De("() => {}",!1,a))]};return r&&(c=r(c)),l&&(c.props[0].value=e.cache(c.props[0].value)),c.props.forEach(p=>p.key.isHandlerKey=!0),c},aC=(n,t)=>{if(n.type===0||n.type===1||n.type===11||n.type===10)return()=>{const e=n.children;let r,a=!1;for(let o=0;o<e.length;o++){const i=e[o];if(ti(i)){a=!0;for(let s=o+1;s<e.length;s++){const u=e[s];if(ti(u))r||(r=e[o]=En([i],i.loc)),r.children.push(" + ",u),e.splice(s,1),s--;else{r=void 0;break}}}}if(!(!a||e.length===1&&(n.type===0||n.type===1&&n.tagType===0&&!n.props.find(o=>o.type===7&&!t.directiveTransforms[o.name])&&n.tag!=="template")))for(let o=0;o<e.length;o++){const i=e[o];if(ti(i)||i.type===8){const s=[];(i.type!==2||i.content!==" ")&&s.push(i),!t.ssr&&nn(i,t)===0&&s.push("1"),e[o]={type:12,content:i,loc:i.loc,codegenNode:gt(t.helper(as),s)}}}}},_d=new WeakSet,oC=(n,t)=>{if(n.type===1&&Xt(n,"once",!0))return _d.has(n)||t.inVOnce||t.inSSR?void 0:(_d.add(n),t.inVOnce=!0,t.helper(ho),()=>{t.inVOnce=!1;const e=t.currentNode;e.codegenNode&&(e.codegenNode=t.cache(e.codegenNode,!0,!0))})},Xl=(n,t,e)=>{const{exp:r,arg:a}=n;if(!r)return e.onError(tt(41,n.loc)),Qo();const o=r.loc.source.trim(),i=r.type===4?r.content:o,s=e.bindingMetadata[o];if(s==="props"||s==="props-aliased")return e.onError(tt(44,r.loc)),Qo();if(!i.trim()||!Bl(r))return e.onError(tt(42,r.loc)),Qo();const u=a||De("modelValue",!0),l=a?Kt(a)?`onUpdate:${Tr(a.content)}`:En(['"onUpdate:" + ',a]):"onUpdate:modelValue";let c;const p=e.isTS?"($event: any)":"$event";c=En([`${p} => ((`,r,") = $event)"]);const f=[it(u,n.exp),it(l,c)];if(n.modifiers.length&&t.tagType===1){const d=n.modifiers.map(v=>v.content).map(v=>(No(v)?v:JSON.stringify(v))+": true").join(", "),h=a?Kt(a)?`${a.content}Modifiers`:En([a,' + "Modifiers"']):"modelModifiers";f.push(it(h,De(`{ ${d} }`,!1,n.loc,2)))}return Qo(f)};function Qo(n=[]){return{props:n}}const iC=/[\w).+\-_$\]]/,sC=(n,t)=>{Kr("COMPILER_FILTERS",t)&&(n.type===5?Mi(n.content,t):n.type===1&&n.props.forEach(e=>{e.type===7&&e.name!=="for"&&e.exp&&Mi(e.exp,t)}))};function Mi(n,t){if(n.type===4)wd(n,t);else for(let e=0;e<n.children.length;e++){const r=n.children[e];typeof r=="object"&&(r.type===4?wd(r,t):r.type===8?Mi(n,t):r.type===5&&Mi(r.content,t))}}function wd(n,t){const e=n.content;let r=!1,a=!1,o=!1,i=!1,s=0,u=0,l=0,c=0,p,f,d,h,v=[];for(d=0;d<e.length;d++)if(f=p,p=e.charCodeAt(d),r)p===39&&f!==92&&(r=!1);else if(a)p===34&&f!==92&&(a=!1);else if(o)p===96&&f!==92&&(o=!1);else if(i)p===47&&f!==92&&(i=!1);else if(p===124&&e.charCodeAt(d+1)!==124&&e.charCodeAt(d-1)!==124&&!s&&!u&&!l)h===void 0?(c=d+1,h=e.slice(0,d).trim()):g();else{switch(p){case 34:a=!0;break;case 39:r=!0;break;case 96:o=!0;break;case 40:l++;break;case 41:l--;break;case 91:u++;break;case 93:u--;break;case 123:s++;break;case 125:s--;break}if(p===47){let m=d-1,x;for(;m>=0&&(x=e.charAt(m),x===" ");m--);(!x||!iC.test(x))&&(i=!0)}}h===void 0?h=e.slice(0,d).trim():c!==0&&g();function g(){v.push(e.slice(c,d).trim()),c=d+1}if(v.length){for(d=0;d<v.length;d++)h=uC(h,v[d],t);n.content=h,n.ast=void 0}}function uC(n,t,e){e.helper(us);const r=t.indexOf("(");if(r<0)return e.filters.add(t),`${Fa(t,"filter")}(${n})`;{const a=t.slice(0,r),o=t.slice(r+1);return e.filters.add(a),`${Fa(a,"filter")}(${n}${o!==")"?","+o:o}`}}const Ed=new WeakSet,lC=(n,t)=>{if(n.type===1){const e=Xt(n,"memo");return!e||Ed.has(n)?void 0:(Ed.add(n),()=>{const r=n.codegenNode||t.currentNode.codegenNode;r&&r.type===13&&(n.tagType!==1&&ms(r,t),n.codegenNode=gt(t.helper(vs),[e.exp,ea(void 0,r),"_cache",String(t.cached.length)]),t.cached.push(null))})}};function jh(n){return[[oC,YS,lC,JS,sC,rC,zh,Bh,aC],{on:jl,bind:Fh,model:Xl}]}function Xh(n,t={}){const e=t.onError||Vl,r=t.mode==="module";t.prefixIdentifiers===!0?e(tt(47)):r&&e(tt(48));const a=!1;t.cacheHandlers&&e(tt(49)),t.scopeId&&!r&&e(tt(50));const o=ur({},t,{prefixIdentifiers:a}),i=bt(n)?ql(n,o):n,[s,u]=jh();return Th(i,ur({},o,{nodeTransforms:[...s,...t.nodeTransforms||[]],directiveTransforms:ur({},u,t.directiveTransforms||{})})),Rh(i,o)}const cC={DATA:"data",PROPS:"props",PROPS_ALIASED:"props-aliased",SETUP_LET:"setup-let",SETUP_CONST:"setup-const",SETUP_REACTIVE_CONST:"setup-reactive-const",SETUP_MAYBE_REF:"setup-maybe-ref",SETUP_REF:"setup-ref",OPTIONS:"options",LITERAL_CONST:"literal-const"},Yh=()=>({props:[]});/**
* @vue/compiler-dom v3.5.14
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**/const Yl=Symbol(""),Kl=Symbol(""),Jl=Symbol(""),Ql=Symbol(""),Fi=Symbol(""),Zl=Symbol(""),ec=Symbol(""),tc=Symbol(""),nc=Symbol(""),rc=Symbol("");rh({[Yl]:"vModelRadio",[Kl]:"vModelCheckbox",[Jl]:"vModelText",[Ql]:"vModelSelect",[Fi]:"vModelDynamic",[Zl]:"withModifiers",[ec]:"withKeys",[tc]:"vShow",[nc]:"Transition",[rc]:"TransitionGroup"});let pa;function dC(n,t=!1){return pa||(pa=document.createElement("div")),t?(pa.innerHTML=`<div foo="${n.replace(/"/g,"&quot;")}">`,pa.children[0].getAttribute("foo")):(pa.innerHTML=n,pa.textContent)}const ac={parseMode:"html",isVoidTag:hv,isNativeTag:n=>dv(n)||pv(n)||fv(n),isPreTag:n=>n==="pre",isIgnoreNewlineTag:n=>n==="pre"||n==="textarea",decodeEntities:dC,isBuiltInComponent:n=>{if(n==="Transition"||n==="transition")return nc;if(n==="TransitionGroup"||n==="transition-group")return rc},getNamespace(n,t,e){let r=t?t.ns:e;if(t&&r===2)if(t.tag==="annotation-xml"){if(n==="svg")return 1;t.props.some(a=>a.type===6&&a.name==="encoding"&&a.value!=null&&(a.value.content==="text/html"||a.value.content==="application/xhtml+xml"))&&(r=0)}else/^m(?:[ions]|text)$/.test(t.tag)&&n!=="mglyph"&&n!=="malignmark"&&(r=0);else t&&r===1&&(t.tag==="foreignObject"||t.tag==="desc"||t.tag==="title")&&(r=0);if(r===0){if(n==="svg")return 1;if(n==="math")return 2}return r}},Kh=n=>{n.type===1&&n.props.forEach((t,e)=>{t.type===6&&t.name==="style"&&t.value&&(n.props[e]={type:7,name:"bind",arg:De("style",!0,t.loc),exp:pC(t.value.content,t.loc),modifiers:[],loc:t.loc})})},pC=(n,t)=>{const e=vv(n);return De(JSON.stringify(e),!1,t,3)};function cr(n,t){return tt(n,t)}const fC={X_V_HTML_NO_EXPRESSION:53,53:"X_V_HTML_NO_EXPRESSION",X_V_HTML_WITH_CHILDREN:54,54:"X_V_HTML_WITH_CHILDREN",X_V_TEXT_NO_EXPRESSION:55,55:"X_V_TEXT_NO_EXPRESSION",X_V_TEXT_WITH_CHILDREN:56,56:"X_V_TEXT_WITH_CHILDREN",X_V_MODEL_ON_INVALID_ELEMENT:57,57:"X_V_MODEL_ON_INVALID_ELEMENT",X_V_MODEL_ARG_ON_ELEMENT:58,58:"X_V_MODEL_ARG_ON_ELEMENT",X_V_MODEL_ON_FILE_INPUT_ELEMENT:59,59:"X_V_MODEL_ON_FILE_INPUT_ELEMENT",X_V_MODEL_UNNECESSARY_VALUE:60,60:"X_V_MODEL_UNNECESSARY_VALUE",X_V_SHOW_NO_EXPRESSION:61,61:"X_V_SHOW_NO_EXPRESSION",X_TRANSITION_INVALID_CHILDREN:62,62:"X_TRANSITION_INVALID_CHILDREN",X_IGNORED_SIDE_EFFECT_TAG:63,63:"X_IGNORED_SIDE_EFFECT_TAG",__EXTEND_POINT__:64,64:"__EXTEND_POINT__"},hC={53:"v-html is missing expression.",54:"v-html will override element children.",55:"v-text is missing expression.",56:"v-text will override element children.",57:"v-model can only be used on <input>, <textarea> and <select> elements.",58:"v-model argument is not supported on plain elements.",59:"v-model cannot be used on file inputs since they are read-only. Use a v-on:change listener instead.",60:"Unnecessary value binding used alongside v-model. It will interfere with v-model's behavior.",61:"v-show is missing expression.",62:"<Transition> expects exactly one child element or component.",63:"Tags with side effect (<script> and <style>) are ignored in client component templates."},vC=(n,t,e)=>{const{exp:r,loc:a}=n;return r||e.onError(cr(53,a)),t.children.length&&(e.onError(cr(54,a)),t.children.length=0),{props:[it(De("innerHTML",!0,a),r||De("",!0))]}},mC=(n,t,e)=>{const{exp:r,loc:a}=n;return r||e.onError(cr(55,a)),t.children.length&&(e.onError(cr(56,a)),t.children.length=0),{props:[it(De("textContent",!0),r?nn(r,e)>0?r:gt(e.helperString(To),[r],a):De("",!0))]}},gC=(n,t,e)=>{const r=Xl(n,t,e);if(!r.props.length||t.tagType===1)return r;n.arg&&e.onError(cr(58,n.arg.loc));const{tag:a}=t,o=e.isCustomElement(a);if(a==="input"||a==="textarea"||a==="select"||o){let i=Jl,s=!1;if(a==="input"||o){const u=Ro(t,"type");if(u){if(u.type===7)i=Fi;else if(u.value)switch(u.value.content){case"radio":i=Yl;break;case"checkbox":i=Kl;break;case"file":s=!0,e.onError(cr(59,n.loc));break}}else mh(t)&&(i=Fi)}else a==="select"&&(i=Ql);s||(r.needRuntime=e.helper(i))}else e.onError(cr(57,n.loc));return r.props=r.props.filter(i=>!(i.key.type===4&&i.key.content==="modelValue")),r},yC=Li("passive,once,capture"),xC=Li("stop,prevent,self,ctrl,shift,alt,meta,exact,middle"),bC=Li("left,right"),Jh=Li("onkeyup,onkeydown,onkeypress"),_C=(n,t,e,r)=>{const a=[],o=[],i=[];for(let s=0;s<t.length;s++){const u=t[s].content;u==="native"&&Oa("COMPILER_V_ON_NATIVE",e)||yC(u)?i.push(u):bC(u)?Kt(n)?Jh(n.content.toLowerCase())?a.push(u):o.push(u):(a.push(u),o.push(u)):xC(u)?o.push(u):a.push(u)}return{keyModifiers:a,nonKeyModifiers:o,eventOptionModifiers:i}},Sd=(n,t)=>Kt(n)&&n.content.toLowerCase()==="onclick"?De(t,!0):n.type!==4?En(["(",n,`) === "onClick" ? "${t}" : (`,n,")"]):n,wC=(n,t,e)=>jl(n,t,e,r=>{const{modifiers:a}=n;if(!a.length)return r;let{key:o,value:i}=r.props[0];const{keyModifiers:s,nonKeyModifiers:u,eventOptionModifiers:l}=_C(o,a,e,n.loc);if(u.includes("right")&&(o=Sd(o,"onContextmenu")),u.includes("middle")&&(o=Sd(o,"onMouseup")),u.length&&(i=gt(e.helper(Zl),[i,JSON.stringify(u)])),s.length&&(!Kt(o)||Jh(o.content.toLowerCase()))&&(i=gt(e.helper(ec),[i,JSON.stringify(s)])),l.length){const c=l.map(Nd).join("");o=Kt(o)?De(`${o.content}${c}`,!0):En(["(",o,`) + "${c}"`])}return{props:[it(o,i)]}}),EC=(n,t,e)=>{const{exp:r,loc:a}=n;return r||e.onError(cr(61,a)),{props:[],needRuntime:e.helper(tc)}},SC=(n,t)=>{n.type===1&&n.tagType===0&&(n.tag==="script"||n.tag==="style")&&t.removeNode()},Qh=[Kh],Zh={cloak:Yh,html:vC,text:mC,model:gC,on:wC,show:EC};function CC(n,t={}){return Xh(n,ur({},ac,t,{nodeTransforms:[SC,...Qh,...t.nodeTransforms||[]],directiveTransforms:ur({},Zh,t.directiveTransforms||{}),transformHoist:null}))}function IC(n,t={}){return ql(n,ur({},ac,t))}const DC=Object.freeze(Object.defineProperty({__proto__:null,BASE_TRANSITION:Nl,BindingTypes:cC,CAMELIZE:Ni,CAPITALIZE:Qf,CREATE_BLOCK:Rl,CREATE_COMMENT:Ba,CREATE_ELEMENT_BLOCK:Al,CREATE_ELEMENT_VNODE:rs,CREATE_SLOTS:Ml,CREATE_STATIC:Pl,CREATE_TEXT:as,CREATE_VNODE:ns,CompilerDeprecationTypes:GE,ConstantTypes:LE,DOMDirectiveTransforms:Zh,DOMErrorCodes:fC,DOMErrorMessages:hC,DOMNodeTransforms:Qh,ElementTypes:VE,ErrorCodes:YE,FRAGMENT:Ra,GUARD_REACTIVE_PROPS:Ua,IS_MEMO_SAME:Fl,IS_REF:nh,KEEP_ALIVE:po,MERGE_PROPS:fo,NORMALIZE_CLASS:ds,NORMALIZE_PROPS:Aa,NORMALIZE_STYLE:ps,Namespaces:ME,NodeTypes:FE,OPEN_BLOCK:Vr,POP_SCOPE_ID:eh,PUSH_SCOPE_ID:Zf,RENDER_LIST:cs,RENDER_SLOT:Ol,RESOLVE_COMPONENT:os,RESOLVE_DIRECTIVE:ss,RESOLVE_DYNAMIC_COMPONENT:is,RESOLVE_FILTER:us,SET_BLOCK_TRACKING:ho,SUSPENSE:ts,TELEPORT:Ia,TO_DISPLAY_STRING:To,TO_HANDLERS:fs,TO_HANDLER_KEY:Ri,TRANSITION:nc,TRANSITION_GROUP:rc,TS_NODE_TYPES:lh,UNREF:th,V_MODEL_CHECKBOX:Kl,V_MODEL_DYNAMIC:Fi,V_MODEL_RADIO:Yl,V_MODEL_SELECT:Ql,V_MODEL_TEXT:Jl,V_ON_WITH_KEYS:ec,V_ON_WITH_MODIFIERS:Zl,V_SHOW:tc,WITH_CTX:hs,WITH_DIRECTIVES:ls,WITH_MEMO:vs,advancePositionWithClone:hS,advancePositionWithMutation:vh,assert:vS,baseCompile:Xh,baseParse:ql,buildDirectiveArgs:Hh,buildProps:Gl,buildSlots:Uh,checkCompatEnabled:Oa,compile:CC,convertToBlock:ms,createArrayExpression:Pr,createAssignmentExpression:qE,createBlockStatement:ih,createCacheExpression:oh,createCallExpression:gt,createCompilerError:tt,createCompoundExpression:En,createConditionalExpression:Ai,createDOMCompilerError:cr,createForLoopParams:Oi,createFunctionExpression:ea,createIfStatement:WE,createInterpolation:BE,createObjectExpression:hn,createObjectProperty:it,createReturnStatement:$E,createRoot:ah,createSequenceExpression:zE,createSimpleExpression:De,createStructuralDirectiveTransform:zl,createTemplateLiteral:UE,createTransformContext:kh,createVNodeCall:Pa,errorMessages:KE,extractIdentifiers:sr,findDir:Xt,findProp:Ro,forAliasRE:xh,generate:Rh,generateCodeFrame:mv,getBaseTransformPreset:jh,getConstantType:nn,getMemoedVNodeCall:yh,getVNodeBlockHelper:na,getVNodeHelper:ta,hasDynamicKeyVBind:mh,hasScopeRef:kn,helperNameMap:Zr,injectProp:mo,isCoreComponent:Ll,isFnExpression:hh,isFnExpressionBrowser:fh,isFnExpressionNode:fS,isFunctionType:oS,isInDestructureAssignment:ZE,isInNewExpression:eS,isMemberExpression:Bl,isMemberExpressionBrowser:ph,isMemberExpressionNode:dS,isReferencedIdentifier:QE,isSimpleIdentifier:No,isSlotOutlet:vo,isStaticArgOf:kr,isStaticExp:Kt,isStaticProperty:uh,isStaticPropertyKey:iS,isTemplateNode:Ma,isText:ti,isVSlot:Ul,locStub:It,noopDirectiveTransform:Yh,parse:IC,parserOptions:ac,processExpression:oi,processFor:Lh,processIf:Mh,processSlotOutlet:Gh,registerRuntimeHelpers:rh,resolveComponentType:$h,stringifyExpression:Oh,toValidAssetId:Fa,trackSlotScopes:Bh,trackVForSlotScopes:ZS,transform:Th,transformBind:Fh,transformElement:zh,transformExpression:XS,transformModel:Xl,transformOn:jl,transformStyle:Kh,traverseNode:Ao,unwrapTSNode:ch,walkBlockDeclarations:nS,walkFunctionParams:tS,walkIdentifiers:JE,warnDeprecation:XE},Symbol.toStringTag,{value:"Module"})),kC=Iu(DC),TC=Iu(gv),NC=Iu(yv);/**
* vue v3.5.14
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**/var Cd;function RC(){return Cd||(Cd=1,function(n){Object.defineProperty(n,"__esModule",{value:!0});var t=kC,e=TC,r=NC;function a(u){var l=Object.create(null);if(u)for(var c in u)l[c]=u[c];return l.default=u,Object.freeze(l)}var o=a(e);const i=Object.create(null);function s(u,l){if(!r.isString(u))if(u.nodeType)u=u.innerHTML;else return r.NOOP;const c=r.genCacheKey(u,l),p=i[c];if(p)return p;if(u[0]==="#"){const v=document.querySelector(u);u=v?v.innerHTML:""}const f=r.extend({hoistStatic:!0,onError:void 0,onWarn:r.NOOP},l);!f.isCustomElement&&typeof customElements<"u"&&(f.isCustomElement=v=>!!customElements.get(v));const{code:d}=t.compile(u,f),h=new Function("Vue",d)(o);return h._rc=!0,i[c]=h}e.registerRuntimeCompiler(s),n.compile=s,Object.keys(e).forEach(function(u){u!=="default"&&!Object.prototype.hasOwnProperty.call(n,u)&&(n[u]=e[u])})}(js)),js}var Id;function AC(){return Id||(Id=1,Gs.exports=RC()),Gs.exports}var PC=ei.exports,Dd;function OC(){return Dd||(Dd=1,function(n,t){(function(e,r){n.exports=r(AC())})(PC,function(e){/*! *****************************************************************************
		    Copyright (c) Microsoft Corporation.

		    Permission to use, copy, modify, and/or distribute this software for any
		    purpose with or without fee is hereby granted.

		    THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
		    REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
		    AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
		    INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
		    LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
		    OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
		    PERFORMANCE OF THIS SOFTWARE.
		    ***************************************************************************** */function r(d,h,v,g){function m(x){return x instanceof v?x:new v(function(y){y(x)})}return new(v||(v=Promise))(function(x,y){function w(k){try{D(g.next(k))}catch(S){y(S)}}function E(k){try{D(g.throw(k))}catch(S){y(S)}}function D(k){k.done?x(k.value):m(k.value).then(w,E)}D((g=g.apply(d,[])).next())})}function a(d,h){var v={label:0,sent:function(){if(x[0]&1)throw x[1];return x[1]},trys:[],ops:[]},g,m,x,y;return y={next:w(0),throw:w(1),return:w(2)},typeof Symbol=="function"&&(y[Symbol.iterator]=function(){return this}),y;function w(D){return function(k){return E([D,k])}}function E(D){if(g)throw new TypeError("Generator is already executing.");for(;v;)try{if(g=1,m&&(x=D[0]&2?m.return:D[0]?m.throw||((x=m.return)&&x.call(m),0):m.next)&&!(x=x.call(m,D[1])).done)return x;switch(m=0,x&&(D=[D[0]&2,x.value]),D[0]){case 0:case 1:x=D;break;case 4:return v.label++,{value:D[1],done:!1};case 5:v.label++,m=D[1],D=[0];continue;case 7:D=v.ops.pop(),v.trys.pop();continue;default:if(x=v.trys,!(x=x.length>0&&x[x.length-1])&&(D[0]===6||D[0]===2)){v=0;continue}if(D[0]===3&&(!x||D[1]>x[0]&&D[1]<x[3])){v.label=D[1];break}if(D[0]===6&&v.label<x[1]){v.label=x[1],x=D;break}if(x&&v.label<x[2]){v.label=x[2],v.ops.push(D);break}x[2]&&v.ops.pop(),v.trys.pop();continue}D=h.call(d,v)}catch(k){D=[6,k],m=0}finally{g=x=0}if(D[0]&5)throw D[1];return{value:D[0]?D[1]:void 0,done:!0}}}var o=e.defineComponent({name:"Camera",components:{},emits:["loading","started","stopped","paused","resumed","camera-change","snapshot","error"],props:{resolution:{type:Object,default:function(){return{width:1920,height:1080}}},facingMode:{type:String,default:"environment"},autoplay:{type:Boolean,default:!0},playsinline:{type:Boolean,default:!0},constraints:{type:Object,required:!1}},setup:function(d,h){var v=this,g=h.emit;e.onMounted(function(){if(!navigator.mediaDevices)throw new Error("Media devices not available");var P=document.getElementById("video");d.playsinline&&P&&P.setAttribute("playsinline",""),d.autoplay&&k()}),e.onUnmounted(function(){return T()});var m=e.ref(),x=e.ref(),y=e.ref(),w=d.constraints||{video:{width:d.resolution.width,height:d.resolution.height,facingMode:d.facingMode,deviceId:{}},audio:!1},E=function(P){return P===void 0&&(P=["audioinput","videoinput"]),r(v,void 0,void 0,function(){var F;return a(this,function(M){switch(M.label){case 0:return[4,navigator.mediaDevices.enumerateDevices()];case 1:return F=M.sent(),[2,F.filter(function(L){return P.includes(L.kind)})]}})})},D=function(){if(y.value){var P=y.value.getVideoTracks().map(function(F){return F.getSettings().deviceId});if(P.length>0)return P[0]}},k=function(){return r(v,void 0,void 0,function(){var P,F;return a(this,function(M){switch(M.label){case 0:g("loading"),M.label=1;case 1:return M.trys.push([1,3,,4]),P=y,[4,navigator.mediaDevices.getUserMedia(w)];case 2:if(P.value=M.sent(),!m.value)throw new Error("Video ref is null");return m.value.srcObject=y.value,g("started"),[3,4];case 3:return F=M.sent(),g("error",F),[3,4];case 4:return[2]}})})},S=function(P,F,M){var L;if(P===void 0&&(P=d.resolution),F===void 0&&(F="image/png"),!m.value)throw new Error("Video ref is null");if(!x.value)throw new Error("Canvas ref is null");var A=P.width,$=P.height;return x.value.width=A,x.value.height=$,(L=x.value.getContext("2d"))===null||L===void 0||L.drawImage(m.value,0,0,A,$),new Promise(function(q){var z;(z=x.value)===null||z===void 0||z.toBlob(function(K){g("snapshot",K),q(K)},F,M)})},_=function(P){return r(v,void 0,void 0,function(){return a(this,function(F){switch(F.label){case 0:return T(),w.video.deviceId.exact=P,[4,k()];case 1:return F.sent(),g("camera-change",P),[2]}})})},b=function(){var P;(P=m.value)===null||P===void 0||P.play(),g("resumed")},N=function(){var P;(P=m.value)===null||P===void 0||P.pause(),g("paused")},T=function(){var P;(P=y.value)===null||P===void 0||P.getTracks().forEach(function(F){return F.stop()}),g("stopped")};return{start:k,stop:T,video:m,snapshot:S,canvas:x,devices:E,currentDeviceID:D,pause:N,resume:b,changeCamera:_,stream:y}}});const i={id:"camera-container"},s={autoplay:"",ref:"video",id:"video"},u={id:"slot-container"},l={ref:"canvas",id:"canvas"};function c(d,h,v,g,m,x){return e.openBlock(),e.createElementBlock(e.Fragment,null,[e.createElementVNode("div",i,[e.createElementVNode("video",s,null,512),e.createElementVNode("div",u,[e.renderSlot(d.$slots,"default")])]),e.createElementVNode("canvas",l,null,512)],64)}function p(d,h){h===void 0&&(h={});var v=h.insertAt;if(!(typeof document>"u")){var g=document.head||document.getElementsByTagName("head")[0],m=document.createElement("style");m.type="text/css",v==="top"&&g.firstChild?g.insertBefore(m,g.firstChild):g.appendChild(m),m.styleSheet?m.styleSheet.cssText=d:m.appendChild(document.createTextNode(d))}}var f=`
#camera-container[data-v-74104ed5] {
    position: relative;
    width: 100%;
    height: 100%;
}
#slot-container[data-v-74104ed5] {
    position: absolute;
    height: 100%;
    width: 100%;
    left: 0;
    top: 0;
}
#video[data-v-74104ed5] {
    width: 100%;
    height: 100%;
}
#canvas[data-v-74104ed5] {
    display: none;
}
`;return p(f),o.render=c,o.__scopeId="data-v-74104ed5",o.__file="src/components/Camera.vue",o})}(ei)),ei.exports}var MC=OC();const FC=Sv(MC),VC={class:"q-gutter-sm"},LC={__name:"BiometricDialog",props:{modelValue:String,dialogName:String},emits:["update:modelValue"],setup(n,{emit:t}){const e=Jt(),r=nt(),a=n,o=t,i=Be({get:()=>a.modelValue===a.dialogName,set:g=>{g||o("update:modelValue",null)}}),s=B(!1),u=B(null);B(""),B(null),B(!1);async function l(){const g="/models";await Yt.ssdMobilenetv1.loadFromUri(g),await Yt.faceLandmark68Net.loadFromUri(g),await Yt.faceRecognitionNet.loadFromUri(g)}async function c(){if(!u.value)return null;try{const g=await u.value.snapshot();return await p(g)}catch(g){return console.error("Error capturing snapshot:",g),null}}function p(g){return new Promise((m,x)=>{const y=new Image;y.onload=()=>m(y),y.onerror=x,y.src=URL.createObjectURL(g)})}async function f(){const g=await c();if(!g)return null;const m=await PE(g).withFaceLandmarks().withFaceDescriptor();return m?{descriptor:m.descriptor,img:g}:null}const d=async()=>{s.value=!0;const g=await f();if(!g||!g.img||!g.descriptor){me.fire({icon:"error",title:"No face detected",text:"Please align your face and try again."}),s.value=!1;return}const m=document.createElement("canvas");m.width=g.img.width,m.height=g.img.height,m.getContext("2d").drawImage(g.img,0,0);try{const y=await Re.post(`/employee/${r.data?.id}/biometric`,{descriptor:Array.from(g.descriptor),imageBase64:m.toDataURL("image/png")});o("update:modelValue",null),me.fire({icon:"success",html:`
                <div class="text-h6 text-bold text-uppercase">granted!</div>
                <div class="text-caption text-capitalize;">${y.data.message}<div>
            `})}catch(y){y.response&&y.response.data&&(h(y.response.data),me.fire({icon:"error",html:`
                    <div class="text-h6 text-bold text-uppercase">Request Failed</div>
                    <div class="text-caption">Something went wrong.</div>
                `}))}finally{s.value=!1}},h=g=>{const m=Array.isArray(g)?g:g?.errors||[];Object.keys(Errors).forEach(x=>{Errors[x].type=null,Errors[x].messages=[]}),m.forEach(x=>{Errors[x.path]!==void 0&&(Errors[x.path].type=!0,Errors[x.path].messages.push(x.msg))})},v=async g=>{await l()};return(g,m)=>(H(),pe(Ke,{modelValue:i.value,"onUpdate:modelValue":m[4]||(m[4]=x=>i.value=x),"full-height":"",position:"right",persistent:"",square:"",class:"dialog",onBeforeShow:m[5]||(m[5]=x=>v())},{default:R(()=>[C(_e,{class:"dialog-card column full-height"},{default:R(()=>[C(oe,{class:"q-pa-lg"},{default:R(()=>m[6]||(m[6]=[I("div",{class:"text-h6 text-uppercase"},"face recognition",-1)])),_:1,__:[6]}),C(pt,{inset:""}),C(oe,{class:"col q-pa-lg scroll"},{default:R(()=>[C(ke(FC),{onLoading:m[0]||(m[0]=()=>{s.value=!0}),onStarted:m[1]||(m[1]=()=>{s.value=!1}),ref_key:"camera",ref:u},null,512)]),_:1}),C(ft,{class:"q-pa-lg bg"},{default:R(()=>[I("div",VC,[ke(e).hasRole(["SuperAdmin","Admin","HR"])?(H(),pe(de,{key:0,unelevated:"",size:"md",color:"primary",class:"btn text-capitalize",label:"save",onClick:m[2]||(m[2]=x=>d())})):we("",!0),C(de,{unelevated:"",size:"md",color:"primary",class:"btn text-capitalize",label:"discard",onClick:m[3]||(m[3]=()=>{o("update:modelValue",null)}),outline:""})])]),_:1}),C(ht,{showing:s.value},{default:R(()=>[C(_e,{class:"no-shadow radius-md q-pa-md"},{default:R(()=>[C(oe,{class:"text-center"},{default:R(()=>[I("div",null,[C(an,{color:"dark"})]),m[7]||(m[7]=I("div",{class:"text-dark text-uppercase text-caption"},"we're working on it!",-1))]),_:1,__:[7]})]),_:1})]),_:1},8,["showing"])]),_:1})]),_:1},8,["modelValue"]))}},BC={class:"profile-section q-mb-lg"},UC=["src"],WC={key:0,class:"row"},qC={class:"q-gutter-sm"},zC={__name:"PhotoDialog",props:{modelValue:String,dialogName:String},emits:["update:modelValue","saved"],setup(n,{emit:t}){const e=Jt(),r=nt(),a=n,o=t,i=Be({get:()=>a.modelValue===a.dialogName,set:m=>{m||o("update:modelValue",null)}}),s=B(!1),u=B(null),l=async m=>{s.value=!0;try{const x=await Re.get("/employee/photo",{params:{id:m}});u.value=x.data.record.photo}catch(x){console.error("Error fetching all data:",x),me.fire({icon:"error",html:`
                <div class="text-h6 text-bold text-uppercase">Error</div>
                <div class="text-caption text-capitalize;">Unable to fetch records</div>
            `})}finally{s.value=!1}},c=()=>{l(r.data?.id)},p=B(""),f=()=>{p.value=""},d=jt({file:{type:null,msg:""}}),h=()=>{let m=!1;const x=5*1024*1024,y=["image/jpeg","image/png"];return p.value?y.includes(p.value.type)?p.value.size>x&&(d.file.type=!0,d.file.msg="file size must not exceed to 5MB",m=!0):(d.file.type=!0,d.file.msg="file must be a image file",m=!0):(d.file.type=!0,d.file.msg="file is required",m=!0),m&&me.fire({icon:"error",html:`
                <div class="text-h6 text-bold text-uppercase">Request Failed</div>
                <div class="text-caption">Something went wrong.</div>
            `}),!m},v=async()=>{if(h()){s.value=!0;try{const m=new FormData;m.append("file",p.value);const x=await Re.post(`/employee/${r.data?.id}/photo`,m,{headers:{"Content-Type":"multipart/form-data"}});o("saved"),o("update:modelValue",null),me.fire({icon:"success",html:`
                <div class="text-h6 text-bold text-uppercase">granted!</div>
                <div class="text-caption text-capitalize;">${x.data.message}<div>
            `})}catch(m){m.response&&m.response.data&&(g(m.response.data),me.fire({icon:"error",html:`
                    <div class="text-h6 text-bold text-uppercase">Request Failed</div>
                    <div class="text-caption">Something went wrong.</div>
                `}))}finally{s.value=!1}}},g=m=>{const x=Array.isArray(m)?m:m?.errors||[];Object.keys(d).forEach(y=>{d[y].type=null,d[y].messages=[]}),x.forEach(y=>{d[y.path]!==void 0&&(d[y.path].type=!0,d[y.path].messages.push(y.msg))})};return(m,x)=>(H(),pe(Ke,{modelValue:i.value,"onUpdate:modelValue":x[3]||(x[3]=y=>i.value=y),"full-height":"",position:"right",persistent:"",square:"",class:"dialog",onBeforeShow:x[4]||(x[4]=()=>{c(),f()})},{default:R(()=>[C(_e,{class:"dialog-card column full-height"},{default:R(()=>[C(oe,{class:"q-pa-lg"},{default:R(()=>x[5]||(x[5]=[I("div",{class:"text-h6 text-uppercase"},"photo information",-1)])),_:1,__:[5]}),C(pt,{inset:""}),C(oe,{class:"col q-pa-lg scroll"},{default:R(()=>[I("div",BC,[I("img",{src:u.value,alt:"Profile",class:"profile-img"},null,8,UC)]),ke(e).hasRole(["SuperAdmin","Admin","HR"])?(H(),se("div",WC,[I("div",null,[I("div",{class:ne(["text-caption text-uppercase q-mb-xs",d.file.type?"text-negative":"text-grey"])},X(d.file.type?d.file.msg:"upload photo"),3),C(Od,{modelValue:p.value,"onUpdate:modelValue":x[0]||(x[0]=y=>p.value=y),label:"Upload Photo",outlined:"",error:d.file.type,"no-error-icon":!0,class:"col-2"},null,8,["modelValue","error"])])])):we("",!0)]),_:1}),C(ft,{class:"q-pa-lg bg"},{default:R(()=>[I("div",qC,[ke(e).hasRole(["SuperAdmin","Admin","HR"])?(H(),pe(de,{key:0,unelevated:"",size:"md",color:"primary",class:"btn text-capitalize",label:"save",onClick:x[1]||(x[1]=y=>v())})):we("",!0),C(de,{unelevated:"",size:"md",color:"primary",class:"btn text-capitalize",label:"discard",onClick:x[2]||(x[2]=()=>{o("update:modelValue",null)}),outline:""})])]),_:1}),C(ht,{showing:s.value},{default:R(()=>[C(_e,{class:"no-shadow radius-md q-pa-md"},{default:R(()=>[C(oe,{class:"text-center"},{default:R(()=>[I("div",null,[C(an,{color:"dark"})]),x[6]||(x[6]=I("div",{class:"text-dark text-uppercase text-caption"},"we're working on it!",-1))]),_:1,__:[6]})]),_:1})]),_:1},8,["showing"])]),_:1})]),_:1},8,["modelValue"]))}},$C=Kn(zC,[["__scopeId","data-v-ef7815b7"]]),HC={class:"text-uppercase text-body1 text-bold"},GC={class:"row q-col-gutter-xs q-mb-sm"},jC={class:"col-2"},XC={class:"col-4"},YC={class:"col-4"},KC={class:"row q-col-gutter-xs q-mb-sm"},JC={class:"col-2"},QC={class:"col-2"},ZC={class:"q-gutter-sm"},eI={class:"text-center"},tI={__name:"EducationDialog",props:{modelValue:String,dialogName:String},emits:["update:modelValue"],setup(n,{emit:t}){const e=Jt(),r=nt(),a=n,o=t,i=Be({get:()=>a.modelValue===a.dialogName,set:q=>{q||o("update:modelValue",null)}}),s=B(!1),u=B([{id:"",schoollevel:"",schoolId:"",courseId:"",startDate:new Date().toISOString().split("T")[0],endDate:new Date().toISOString().split("T")[0]}]),l=()=>({id:"",schoollevel:"",schoolId:"",courseId:"",startDate:new Date().toISOString().split("T")[0],endDate:new Date().toISOString().split("T")[0]}),c=async q=>{s.value=!0;try{const z=await Re.get("/employee/education",{params:{id:q}});z.data.record.length?p(z.data.record):l()}catch(z){console.error("Error fetching all data:",z),me.fire({icon:"error",html:`
                <div class="text-h6 text-bold text-uppercase">Error</div>
                <div class="text-caption text-capitalize;">Unable to fetch records</div>
            `})}finally{s.value=!1}},p=(q=[])=>{u.value=q.map(z=>({id:z.id??"",schoollevel:z.school_level??"",schoolId:Number(z.school_id)??"",courseId:Number(z.course_id)??"",startDate:z.start_date??"",endDate:z.end_date??""}))},f=()=>{b(),_(),c(r.data?.id)},d=jt({educations:{schoollevel:{type:[],msg:""},schoolId:{type:[],msg:""},courseId:{type:[],msg:""},startDate:{type:[],msg:""},endDate:{type:[],msg:""}}}),h=()=>{d.educations.schoollevel.type=u.value.map(()=>null),d.educations.schoolId.type=u.value.map(()=>null),d.educations.courseId.type=u.value.map(()=>null),d.educations.startDate.type=u.value.map(()=>null),d.educations.endDate.type=u.value.map(()=>null)},v=()=>{let q=!1;return d.educations.schoollevel={type:null,msg:""},d.educations.schoolId={type:null,msg:""},d.educations.courseId={type:null,msg:""},d.educations.startDate={type:null,msg:""},d.educations.endDate={type:null,msg:""},h(),u.value.forEach((z,K)=>{z.schoollevel||(d.educations.schoollevel.type[K]=!0,d.educations.schoollevel.msg="school level is required",q=!0),z.schoolId||(d.educations.schoolId.type[K]=!0,d.educations.schoolId.msg="school is required",q=!0),z.courseId||(d.educations.courseId.type[K]=!0,d.educations.courseId.msg="degree is required",q=!0),z.startDate?isNaN(new Date(z.startDate).getTime())&&(d.educations.startDate.type[K]=!0,d.educations.startDate.msg="start date must be a valid date",q=!0):(d.educations.startDate.type[K]=!0,d.educations.startDate.msg="start date is required",q=!0),z.endDate?isNaN(new Date(z.endDate).getTime())&&(d.educations.endDate.type[K]=!0,d.educations.endDate.msg="end date must be a valid date",q=!0):(d.educations.endDate.type[K]=!0,d.educations.endDate.msg="end date is required",q=!0)}),q&&me.fire({icon:"error",html:`
                <div class="text-h6 text-bold text-uppercase">Request Failed</div>
                <div class="text-caption">Something went wrong.</div>
            `}),!q},g=B(["High School","Vocational","College","Graduate Studies"]),m=B([]),x=B([]),y=B([]),w=B([]),E=(q,z)=>(K,re)=>{if(K===""){re(()=>{z.value=q.value});return}re(()=>{const ae=K.toLowerCase();z.value=q.value.filter(Se=>Se.label.toLowerCase().includes(ae))})},D=(q=[])=>q.map(z=>({label:z.label??z.name??String(z.text??z.value??""),value:Number(z.value??z.id)})),k=E(m,y),S=E(x,w),_=async()=>{try{const{data:q}=await Re.get("/employee/option/school");m.value=D(q),y.value=[...m.value]}catch(q){console.error("Error fetching options:",q)}},b=async()=>{try{const{data:q}=await Re.get("/employee/option/course");x.value=D(q),w.value=[...x.value]}catch(q){console.error("Error fetching options:",q)}},N=()=>{u.value.push({id:"",schoollevel:"",schoolId:"",courseId:"",startDate:new Date().toISOString().split("T")[0],endDate:new Date().toISOString().split("T")[0]})},T=q=>{u.value.splice(q,1)},P=async()=>{if(v()){s.value=!0;try{const q=await Re.post(`/employee/${r.data?.id}/education`,{educations:u.value});o("update:modelValue",null),me.fire({icon:"success",html:`
                <div class="text-h6 text-bold text-uppercase">granted!</div>
                <div class="text-caption text-capitalize;">${q.data.message}<div>
            `})}catch(q){q.response&&q.response.data&&(F(q.response.data),me.fire({icon:"error",html:`
                    <div class="text-h6 text-bold text-uppercase">Request Failed</div>
                    <div class="text-caption">Something went wrong.</div>
                `}))}finally{s.value=!1}}},F=q=>{const z=Array.isArray(q)?q:q?.errors||[];Object.keys(d).forEach(K=>{d[K].type=null,d[K].messages=[]}),z.forEach(K=>{d[K.path]!==void 0&&(d[K.path].type=!0,d[K.path].messages.push(K.msg))})},M=B([]),L=B([]);function A(q){Xn(()=>{M.value[q]&&M.value[q].hide()})}function $(q){Xn(()=>{L.value[q]&&L.value[q].hide()})}return(q,z)=>(H(),pe(Ke,{modelValue:i.value,"onUpdate:modelValue":z[2]||(z[2]=K=>i.value=K),"full-height":"",position:"right",persistent:"",square:"",class:"dialog",onBeforeShow:z[3]||(z[3]=K=>f())},{default:R(()=>[C(_e,{class:"dialog-card column full-height"},{default:R(()=>[C(oe,{class:"q-pa-lg"},{default:R(()=>z[4]||(z[4]=[I("div",{class:"text-h6 text-uppercase"},"education information",-1)])),_:1,__:[4]}),C(pt,{inset:""}),C(oe,{class:"col q-pa-lg scroll"},{default:R(()=>[(H(!0),se(Ve,null,We(u.value,(K,re)=>(H(),se("div",{key:re,class:"q-mb-md"},[I("div",null,[I("span",HC,"education "+X(re+1),1),u.value.length>1&&ke(e).hasRole(["SuperAdmin","Admin","HR"])?(H(),pe(de,{key:0,round:"",icon:"bi-trash3",flat:"",unelevated:"",color:"grey",onClick:ae=>T(re),size:"sm",class:"q-ml-sm"},null,8,["onClick"])):we("",!0)]),I("div",GC,[I("div",jC,[I("div",{class:ne(["text-caption text-uppercase q-mb-xs",d.educations.schoollevel.msg?"text-negative":"text-grey"])},X(d.educations.schoollevel.msg?d.educations.schoollevel.msg:"school level"),3),C(An,{outlined:"",modelValue:K.schoollevel,"onUpdate:modelValue":ae=>K.schoollevel=ae,label:"Choose School Level","input-debounce":"300",options:g.value,error:d.educations.schoollevel.type[re],"hide-dropdown-icon":"","no-error-icon":!0},{"no-option":R(()=>[C(lt,null,{default:R(()=>[C(ct,{class:"text-italic text-grey"},{default:R(()=>z[5]||(z[5]=[Ye(" No options ")])),_:1,__:[5]})]),_:1})]),option:R(ae=>[C(lt,ga({ref_for:!0},ae.itemProps),{default:R(()=>[C(ct,null,{default:R(()=>[C(Rn,null,{default:R(()=>[Ye(X(q.$CapitalizeWords(ae.opt)),1)]),_:2},1024)]),_:2},1024)]),_:2},1040)]),_:2},1032,["modelValue","onUpdate:modelValue","options","error"])]),I("div",XC,[I("div",{class:ne(["text-caption text-uppercase q-mb-xs",d.educations.schoolId.msg?"text-negative":"text-grey"])},X(d.educations.schoolId.msg?d.educations.schoolId.msg:"school"),3),C(An,{outlined:"",modelValue:K.schoolId,"onUpdate:modelValue":ae=>K.schoolId=ae,label:"Choose School","emit-value":"","map-options":"","use-input":"","input-debounce":"300",options:y.value,onFilter:ke(k),error:d.educations.schoolId.type[re],"hide-dropdown-icon":"","no-error-icon":!0},{"no-option":R(()=>[C(lt,null,{default:R(()=>[C(ct,{class:"text-italic text-grey"},{default:R(()=>z[6]||(z[6]=[Ye(" No options ")])),_:1,__:[6]})]),_:1})]),option:R(ae=>[C(lt,ga({ref_for:!0},ae.itemProps),{default:R(()=>[C(ct,null,{default:R(()=>[C(Rn,null,{default:R(()=>[Ye(X(q.$CapitalizeWords(ae.opt.label)),1)]),_:2},1024)]),_:2},1024)]),_:2},1040)]),_:2},1032,["modelValue","onUpdate:modelValue","options","onFilter","error"])]),I("div",YC,[I("div",{class:ne(["text-caption text-uppercase q-mb-xs",d.educations.courseId.msg?"text-negative":"text-grey"])},X(d.educations.courseId.msg?d.educations.courseId.msg:"degree"),3),C(An,{outlined:"",modelValue:K.courseId,"onUpdate:modelValue":ae=>K.courseId=ae,label:"Choose Degree","emit-value":"","map-options":"","use-input":"","input-debounce":"300",options:w.value,onFilter:ke(S),error:d.educations.courseId.type[re],"hide-dropdown-icon":"","no-error-icon":!0},{"no-option":R(()=>[C(lt,null,{default:R(()=>[C(ct,{class:"text-italic text-grey"},{default:R(()=>z[7]||(z[7]=[Ye(" No options ")])),_:1,__:[7]})]),_:1})]),option:R(ae=>[C(lt,ga({ref_for:!0},ae.itemProps),{default:R(()=>[C(ct,null,{default:R(()=>[C(Rn,null,{default:R(()=>[Ye(X(q.$CapitalizeWords(ae.opt.label)),1)]),_:2},1024)]),_:2},1024)]),_:2},1040)]),_:2},1032,["modelValue","onUpdate:modelValue","options","onFilter","error"])])]),I("div",KC,[I("div",JC,[I("div",{class:ne(["text-caption text-uppercase q-mb-xs",d.educations.startDate.msg?"text-negative":"text-grey"])},X(d.educations.startDate.msg?d.educations.startDate.msg:"start date (YYYY-MM-DD)"),3),C(le,{outlined:"",modelValue:K.startDate,"onUpdate:modelValue":ae=>K.startDate=ae,label:"Enter Date"},{default:R(()=>[C(Ft,{cover:"","transition-show":"scale","transition-hide":"scale",class:"no-shadow custom-border radius-sm",ref_for:!0,ref:ae=>M.value[re]=ae},{default:R(()=>[C(Mt,{modelValue:K.startDate,"onUpdate:modelValue":[ae=>K.startDate=ae,()=>A(re)],mask:"YYYY-MM-DD"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1536)]),_:2},1032,["modelValue","onUpdate:modelValue"])]),I("div",QC,[I("div",{class:ne(["text-caption text-uppercase q-mb-xs",d.educations.endDate.msg?"text-negative":"text-grey"])},X(d.educations.endDate.msg?d.educations.endDate.msg:"end date (YYYY-MM-DD)"),3),C(le,{outlined:"",modelValue:K.endDate,"onUpdate:modelValue":ae=>K.endDate=ae,label:"Enter Date"},{default:R(()=>[C(Ft,{cover:"","transition-show":"scale","transition-hide":"scale",class:"no-shadow custom-border radius-sm",ref_for:!0,ref:ae=>L.value[re]=ae},{default:R(()=>[C(Mt,{modelValue:K.endDate,"onUpdate:modelValue":[ae=>K.endDate=ae,()=>$(re)],mask:"YYYY-MM-DD"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1536)]),_:2},1032,["modelValue","onUpdate:modelValue"])])])]))),128))]),_:1}),C(ft,{class:"q-pa-lg bg"},{default:R(()=>[I("div",ZC,[ke(e).hasRole(["SuperAdmin","Admin","HR"])?(H(),pe(de,{key:0,unelevated:"",size:"md",color:"primary",class:"btn text-capitalize",label:"save",onClick:z[0]||(z[0]=K=>P())})):we("",!0),ke(e).hasRole(["SuperAdmin","Admin","HR"])?(H(),pe(de,{key:1,unelevated:"",size:"md",color:"primary",class:"btn text-capitalize",label:"add",onClick:N,outline:""})):we("",!0),C(de,{unelevated:"",size:"md",color:"primary",class:"btn text-capitalize",label:"discard",onClick:z[1]||(z[1]=()=>{o("update:modelValue",null)}),outline:""})])]),_:1}),C(ht,{showing:s.value},{default:R(()=>[I("div",eI,[C(Sn,{size:"md"}),z[8]||(z[8]=I("div",{class:"text-caption text-grey text-uppercase q-mt-xs"},"we're working on it!",-1))])]),_:1},8,["showing"])]),_:1})]),_:1},8,["modelValue"]))}},nI={class:"text-uppercase text-body1 text-bold"},rI={class:"row q-col-gutter-xs q-mb-sm"},aI={class:"col-2"},oI={class:"col-4"},iI={class:"row q-col-gutter-xs q-mb-sm"},sI={class:"col-2"},uI={class:"col-2"},lI={class:"col-1"},cI={class:"q-gutter-sm"},dI={class:"text-center"},pI={__name:"TrainingDialog",props:{modelValue:String,dialogName:String},emits:["update:modelValue"],setup(n,{emit:t}){const e=Jt(),r=nt(),a=n,o=t,i=Be({get:()=>a.modelValue===a.dialogName,set:_=>{_||o("update:modelValue",null)}}),s=B(!1),u=B([{id:"",title:"",startDate:new Date().toISOString().split("T")[0],endDate:new Date().toISOString().split("T")[0],hour:"",trainingtype:""}]),l=()=>({id:"",trainingtype:"",title:"",startDate:new Date().toISOString().split("T")[0],endDate:new Date().toISOString().split("T")[0],hour:""}),c=async _=>{s.value=!0;try{const b=await Re.get("/employee/training",{params:{id:_}});b.data.record.length?p(b.data.record):l()}catch(b){console.error("Error fetching all data:",b),me.fire({icon:"error",html:`
                <div class="text-h6 text-bold text-uppercase">Error</div>
                <div class="text-caption text-capitalize;">Unable to fetch records</div>
            `})}finally{s.value=!1}},p=(_=[])=>{u.value=_.map(b=>({id:b.id??"",trainingtype:b.type??"",title:b.title??"",startDate:b.start_date??"",endDate:b.end_date??"",hour:b.hour??""}))},f=()=>{c(r.data?.id)},d=jt({trainings:{trainingtype:{type:[],msg:""},title:{type:[],msg:""},startDate:{type:[],msg:""},endDate:{type:[],msg:""},hour:{type:[],msg:""}}}),h=()=>{d.trainings.trainingtype.type=u.value.map(()=>null),d.trainings.title.type=u.value.map(()=>null),d.trainings.startDate.type=u.value.map(()=>null),d.trainings.endDate.type=u.value.map(()=>null),d.trainings.hour.type=u.value.map(()=>null)},v=()=>{let _=!1;return d.trainings.trainingtype={type:null,msg:""},d.trainings.title={type:null,msg:""},d.trainings.startDate={type:null,msg:""},d.trainings.endDate={type:null,msg:""},d.trainings.hour={type:null,msg:""},h(),u.value.forEach((b,N)=>{b.trainingtype||(d.trainings.trainingtype.type[N]=!0,d.trainings.trainingtype.msg="training type is required",_=!0),b.title||(d.trainings.title.type[N]=!0,d.trainings.title.msg="title is required",_=!0),b.startDate?isNaN(new Date(b.startDate).getTime())&&(d.trainings.startDate.type[N]=!0,d.trainings.startDate.msg="start date must be a valid date",_=!0):(d.trainings.startDate.type[N]=!0,d.trainings.startDate.msg="start date is required",_=!0),b.endDate?isNaN(new Date(b.endDate).getTime())&&(d.trainings.endDate.type[N]=!0,d.trainings.endDate.msg="end date must be a valid date",_=!0):(d.trainings.endDate.type[N]=!0,d.trainings.endDate.msg="end date is required",_=!0),b.hour?(isNaN(b.hour)||b.hour<1||b.hour>23)&&(d.trainings.hour.type[N]=!0,d.trainings.hour.msg="hour/s must be a valid number between 1 to 23",_=!0):(d.trainings.hour.type[N]=!0,d.trainings.hour.msg="hour/s is required",_=!0)}),_&&me.fire({icon:"error",html:`
                <div class="text-h6 text-bold text-uppercase">Request Failed</div>
                <div class="text-caption">Something went wrong.</div>
            `}),!_},g=B(["Managerial","Supervisory","Technical","Orientation","Compliance","Seminar","Workshop","Conference","Other"]),m=()=>{u.value.push({id:"",trainingtype:"",title:"",startDate:new Date().toISOString().split("T")[0],endDate:new Date().toISOString().split("T")[0],hour:""})},x=_=>{u.value.splice(_,1)},y=async()=>{if(v()){s.value=!0;try{const _=await Re.post(`/employee/${r.data?.id}/training`,{trainings:u.value});o("update:modelValue",null),me.fire({icon:"success",html:`
                <div class="text-h6 text-bold text-uppercase">granted!</div>
                <div class="text-caption text-capitalize;">${_.data.message}<div>
            `})}catch(_){_.response&&_.response.data&&(w(_.response.data),me.fire({icon:"error",html:`
                    <div class="text-h6 text-bold text-uppercase">Request Failed</div>
                    <div class="text-caption">Something went wrong.</div>
                `}))}finally{s.value=!1}}},w=_=>{const b=Array.isArray(_)?_:_?.errors||[];Object.keys(d).forEach(N=>{d[N].type=null,d[N].messages=[]}),b.forEach(N=>{d[N.path]!==void 0&&(d[N.path].type=!0,d[N.path].messages.push(N.msg))})},E=B([]),D=B([]);function k(_){Xn(()=>{E.value[_]&&E.value[_].hide()})}function S(_){Xn(()=>{D.value[_]&&D.value[_].hide()})}return(_,b)=>(H(),pe(Ke,{modelValue:i.value,"onUpdate:modelValue":b[2]||(b[2]=N=>i.value=N),"full-height":"",position:"right",persistent:"",square:"",class:"dialog",onBeforeShow:b[3]||(b[3]=N=>f())},{default:R(()=>[C(_e,{class:"dialog-card column full-height"},{default:R(()=>[C(oe,{class:"q-pa-lg"},{default:R(()=>b[4]||(b[4]=[I("div",{class:"text-h6 text-uppercase"},"training information",-1)])),_:1,__:[4]}),C(pt,{inset:""}),C(oe,{class:"col q-pa-lg scroll"},{default:R(()=>[(H(!0),se(Ve,null,We(u.value,(N,T)=>(H(),se("div",{key:T,class:"q-mb-md"},[I("div",null,[I("span",nI,"training "+X(T+1),1),u.value.length>1&&ke(e).hasRole(["SuperAdmin","Admin","HR"])?(H(),pe(de,{key:0,round:"",icon:"bi-trash3",flat:"",unelevated:"",color:"grey",onClick:P=>x(T),size:"sm",class:"q-ml-sm"},null,8,["onClick"])):we("",!0)]),I("div",rI,[I("div",aI,[I("div",{class:ne(["text-caption text-uppercase q-mb-xs",d.trainings.trainingtype.msg?"text-negative":"text-grey"])},X(d.trainings.trainingtype.msg?d.trainings.trainingtype.msg:"training type"),3),C(An,{outlined:"",modelValue:N.trainingtype,"onUpdate:modelValue":P=>N.trainingtype=P,label:"Choose Training Type","input-debounce":"300",options:g.value,error:d.trainings.trainingtype.type[T],"hide-dropdown-icon":"","no-error-icon":!0},{"no-option":R(()=>[C(lt,null,{default:R(()=>[C(ct,{class:"text-italic text-grey"},{default:R(()=>b[5]||(b[5]=[Ye(" No options ")])),_:1,__:[5]})]),_:1})]),option:R(P=>[C(lt,ga({ref_for:!0},P.itemProps),{default:R(()=>[C(ct,null,{default:R(()=>[C(Rn,null,{default:R(()=>[Ye(X(_.$CapitalizeWords(P.opt)),1)]),_:2},1024)]),_:2},1024)]),_:2},1040)]),_:2},1032,["modelValue","onUpdate:modelValue","options","error"])]),I("div",oI,[I("div",{class:ne(["text-caption text-uppercase q-mb-xs",d.trainings.title.msg?"text-negative":"text-grey"])},X(d.trainings.title.msg?d.trainings.title.msg:"title"),3),C(le,{modelValue:N.title,"onUpdate:modelValue":P=>N.title=P,label:"Enter Title",outlined:"",error:d.trainings.title.type[T],"no-error-icon":!0,"input-class":"text-capitalize"},null,8,["modelValue","onUpdate:modelValue","error"])])]),I("div",iI,[I("div",sI,[I("div",{class:ne(["text-caption text-uppercase q-mb-xs",d.trainings.startDate.msg?"text-negative":"text-grey"])},X(d.trainings.startDate.msg?d.trainings.startDate.msg:"start date (YYYY-MM-DD)"),3),C(le,{outlined:"",modelValue:N.startDate,"onUpdate:modelValue":P=>N.startDate=P,label:"Enter Date",error:d.trainings.startDate.type[T],"no-error-icon":!0},{default:R(()=>[C(Ft,{cover:"","transition-show":"scale","transition-hide":"scale",class:"no-shadow custom-border radius-sm",ref_for:!0,ref:P=>E.value[T]=P},{default:R(()=>[C(Mt,{modelValue:N.startDate,"onUpdate:modelValue":[P=>N.startDate=P,()=>k(T)],mask:"YYYY-MM-DD"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1536)]),_:2},1032,["modelValue","onUpdate:modelValue","error"])]),I("div",uI,[I("div",{class:ne(["text-caption text-uppercase q-mb-xs",d.trainings.endDate.msg?"text-negative":"text-grey"])},X(d.trainings.endDate.msg?d.trainings.endDate.msg:"end date (YYYY-MM-DD)"),3),C(le,{outlined:"",modelValue:N.endDate,"onUpdate:modelValue":P=>N.endDate=P,label:"Enter Date",error:d.trainings.endDate.type[T],"no-error-icon":!0},{default:R(()=>[C(Ft,{cover:"","transition-show":"scale","transition-hide":"scale",class:"no-shadow custom-border radius-sm",ref_for:!0,ref:P=>D.value[T]=P},{default:R(()=>[C(Mt,{modelValue:N.endDate,"onUpdate:modelValue":[P=>N.endDate=P,()=>S(T)],mask:"YYYY-MM-DD"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1536)]),_:2},1032,["modelValue","onUpdate:modelValue","error"])]),I("div",lI,[I("div",{class:ne(["text-caption text-uppercase q-mb-xs",d.trainings.hour.msg?"text-negative":"text-grey"])},X(d.trainings.hour.msg?d.trainings.hour.msg:"hour/s"),3),C(le,{modelValue:N.hour,"onUpdate:modelValue":P=>N.hour=P,label:"Enter Hour/s",outlined:"",error:d.trainings.hour.type[T],"no-error-icon":!0},null,8,["modelValue","onUpdate:modelValue","error"])])])]))),128))]),_:1}),C(ft,{class:"q-pa-lg bg"},{default:R(()=>[I("div",cI,[ke(e).hasRole(["SuperAdmin","Admin","HR"])?(H(),pe(de,{key:0,unelevated:"",size:"md",color:"primary",class:"btn text-capitalize",label:"save",onClick:b[0]||(b[0]=N=>y())})):we("",!0),ke(e).hasRole(["SuperAdmin","Admin","HR"])?(H(),pe(de,{key:1,unelevated:"",size:"md",color:"primary",class:"btn text-capitalize",label:"add",onClick:m,outline:""})):we("",!0),C(de,{unelevated:"",size:"md",color:"primary",class:"btn text-capitalize",label:"discard",onClick:b[1]||(b[1]=()=>{o("update:modelValue",null)}),outline:""})])]),_:1}),C(ht,{showing:s.value},{default:R(()=>[I("div",dI,[C(Sn,{size:"md"}),b[6]||(b[6]=I("div",{class:"text-caption text-grey text-uppercase q-mt-xs"},"we're working on it!",-1))])]),_:1},8,["showing"])]),_:1})]),_:1},8,["modelValue"]))}},fI={class:"text-uppercase text-body1 text-bold"},hI={class:"row q-col-gutter-xs q-mb-sm"},vI={class:"col-3"},mI={class:"col-3"},gI={class:"row q-col-gutter-xs q-mb-sm"},yI={class:"col-2"},xI={class:"col-2"},bI={class:"q-gutter-sm"},_I={class:"text-center"},wI={__name:"ExperienceDialog",props:{modelValue:String,dialogName:String},emits:["update:modelValue"],setup(n,{emit:t}){const e=Jt(),r=nt(),a=n,o=t,i=Be({get:()=>a.modelValue===a.dialogName,set:S=>{S||o("update:modelValue",null)}}),s=B(!1),u=B([{id:"",position:"",startDate:new Date().toISOString().split("T")[0],endDate:new Date().toISOString().split("T")[0],description:""}]),l=()=>({id:"",position:"",startDate:new Date().toISOString().split("T")[0],endDate:new Date().toISOString().split("T")[0],description:""}),c=async S=>{s.value=!0;try{const _=await Re.get("/employee/experience",{params:{id:S}});_.data.record.length?p(_.data.record):l()}catch(_){console.error("Error fetching all data:",_),me.fire({icon:"error",html:`
                <div class="text-h6 text-bold text-uppercase">Error</div>
                <div class="text-caption text-capitalize;">Unable to fetch records</div>
            `})}finally{s.value=!1}},p=(S=[])=>{u.value=S.map(_=>({id:_.id??"",position:_.position??"",description:_.description??"",startDate:_.start_date??"",endDate:_.end_date??""}))},f=()=>{c(r.data?.id)},d=jt({experiences:{position:{type:[],msg:""},startDate:{type:[],msg:""},endDate:{type:[],msg:""},description:{type:[],msg:""}}}),h=()=>{d.experiences.position.type=u.value.map(()=>null),d.experiences.startDate.type=u.value.map(()=>null),d.experiences.endDate.type=u.value.map(()=>null),d.experiences.description.type=u.value.map(()=>null)},v=()=>{let S=!1;return d.experiences.position={type:null,msg:""},d.experiences.startDate={type:null,msg:""},d.experiences.endDate={type:null,msg:""},d.experiences.description={type:null,msg:""},h(),u.value.forEach((_,b)=>{_.position||(d.experiences.position.type[b]=!0,d.experiences.position.msg="position is required",S=!0),_.startDate?isNaN(new Date(_.startDate).getTime())&&(d.experiences.startDate.type[b]=!0,d.experiences.startDate.msg="start date must be a valid date",S=!0):(d.experiences.startDate.type[b]=!0,d.experiences.startDate.msg="start date is required",S=!0),_.endDate?isNaN(new Date(_.endDate).getTime())&&(d.experiences.endDate.type[b]=!0,d.experiences.endDate.msg="end date must a valid date",S=!0):(d.experiences.endDate.type[b]=!0,d.experiences.endDate.msg="end date is required",S=!0),_.description||(d.experiences.description.type[b]=!0,d.experiences.description.msg="job description is required",S=!0)}),S&&me.fire({icon:"error",html:`
                <div class="text-h6 text-bold text-uppercase">Request Failed</div>
                <div class="text-caption">Something went wrong.</div>
            `}),!S},g=()=>{u.value.push({position:"",description:"",startDate:new Date().toISOString().split("T")[0],endDate:new Date().toISOString().split("T")[0]})},m=S=>{u.value.splice(S,1)},x=async()=>{if(v()){s.value=!0;try{const S=await Re.post(`/employee/${r.data?.id}/experience`,{experiences:u.value});o("update:modelValue",null),me.fire({icon:"success",html:`
                <div class="text-h6 text-bold text-uppercase">granted!</div>
                <div class="text-caption text-capitalize;">${S.data.message}<div>
            `})}catch(S){S.response&&S.response.data&&(y(S.response.data),me.fire({icon:"error",html:`
                    <div class="text-h6 text-bold text-uppercase">Request Failed</div>
                    <div class="text-caption">Something went wrong.</div>
                `}))}finally{s.value=!1}}},y=S=>{const _=Array.isArray(S)?S:S?.errors||[];Object.keys(d).forEach(b=>{d[b].type=null,d[b].messages=[]}),_.forEach(b=>{d[b.path]!==void 0&&(d[b.path].type=!0,d[b.path].messages.push(b.msg))})},w=B([]),E=B([]);function D(S){Xn(()=>{w.value[S]&&w.value[S].hide()})}function k(S){Xn(()=>{E.value[S]&&E.value[S].hide()})}return(S,_)=>(H(),pe(Ke,{modelValue:i.value,"onUpdate:modelValue":_[2]||(_[2]=b=>i.value=b),"full-height":"",position:"right",persistent:"",square:"",class:"dialog",onBeforeShow:_[3]||(_[3]=b=>f())},{default:R(()=>[C(_e,{class:"dialog-card column full-height"},{default:R(()=>[C(oe,{class:"q-pa-lg"},{default:R(()=>_[4]||(_[4]=[I("div",{class:"text-h6 text-uppercase"},"experience information",-1)])),_:1,__:[4]}),C(pt,{inset:""}),C(oe,{class:"col q-pa-lg scroll"},{default:R(()=>[(H(!0),se(Ve,null,We(u.value,(b,N)=>(H(),se("div",{key:N,class:"q-mb-md"},[I("div",null,[I("span",fI,"experience "+X(N+1),1),u.value.length>1&&ke(e).hasRole(["SuperAdmin","Admin","HR"])?(H(),pe(de,{key:0,round:"",icon:"delete",flat:"",unelevated:"",color:"grey",onClick:T=>m(N),size:"sm",class:"q-ml-sm"},null,8,["onClick"])):we("",!0)]),I("div",hI,[I("div",vI,[I("div",{class:ne(["text-caption text-uppercase q-mb-xs",d.experiences.position.msg?"text-negative":"text-grey"])},X(d.experiences.position.msg?d.experiences.position.msg:"position"),3),C(le,{modelValue:b.position,"onUpdate:modelValue":T=>b.position=T,label:"Enter Position",outlined:"",error:d.experiences.position.type[N],"no-error-icon":!0,"input-class":"text-capitalize"},null,8,["modelValue","onUpdate:modelValue","error"])]),I("div",mI,[I("div",{class:ne(["text-caption text-uppercase q-mb-xs",d.experiences.description.msg?"text-negative":"text-grey"])},X(d.experiences.description.msg?d.experiences.description.msg:"job description"),3),C(le,{modelValue:b.description,"onUpdate:modelValue":T=>b.description=T,label:"EnterJob Description",outlined:"",error:d.experiences.description.type[N],"no-error-icon":!0},null,8,["modelValue","onUpdate:modelValue","error"])])]),I("div",gI,[I("div",yI,[I("div",{class:ne(["text-caption text-uppercase q-mb-xs",d.experiences.startDate.msg?"text-negative":"text-grey"])},X(d.experiences.startDate.msg?d.experiences.startDate.msg:"start date (YYYY-MM-DD)"),3),C(le,{outlined:"",modelValue:b.startDate,"onUpdate:modelValue":T=>b.startDate=T,label:"Enter Date"},{default:R(()=>[C(Ft,{cover:"","transition-show":"scale","transition-hide":"scale",class:"no-shadow custom-border radius-sm",ref_for:!0,ref:T=>w.value[N]=T},{default:R(()=>[C(Mt,{modelValue:b.startDate,"onUpdate:modelValue":[T=>b.startDate=T,()=>D(N)],mask:"YYYY-MM-DD"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1536)]),_:2},1032,["modelValue","onUpdate:modelValue"])]),I("div",xI,[I("div",{class:ne(["text-caption text-uppercase q-mb-xs",d.experiences.endDate.msg?"text-negative":"text-grey"])},X(d.experiences.endDate.msg?d.experiences.endDate.msg:"end date (YYYY-MM-DD)"),3),C(le,{outlined:"",modelValue:b.endDate,"onUpdate:modelValue":T=>b.endDate=T,label:"Enter Date"},{default:R(()=>[C(Ft,{cover:"","transition-show":"scale","transition-hide":"scale",class:"no-shadow custom-border radius-sm",ref_for:!0,ref:T=>E.value[N]=T},{default:R(()=>[C(Mt,{modelValue:b.endDate,"onUpdate:modelValue":[T=>b.endDate=T,()=>k(N)],mask:"YYYY-MM-DD"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1536)]),_:2},1032,["modelValue","onUpdate:modelValue"])])])]))),128))]),_:1}),C(ft,{class:"q-pa-lg bg"},{default:R(()=>[I("div",bI,[ke(e).hasRole(["SuperAdmin","Admin","HR"])?(H(),pe(de,{key:0,unelevated:"",size:"md",color:"primary",class:"btn text-capitalize",label:"save",onClick:_[0]||(_[0]=b=>x())})):we("",!0),ke(e).hasRole(["SuperAdmin","Admin","HR"])?(H(),pe(de,{key:1,unelevated:"",size:"md",color:"primary",class:"btn text-capitalize",label:"add",onClick:g,outline:""})):we("",!0),C(de,{unelevated:"",size:"md",color:"primary",class:"btn text-capitalize",label:"discard",onClick:_[1]||(_[1]=()=>{o("update:modelValue",null)}),outline:""})])]),_:1}),C(ht,{showing:s.value},{default:R(()=>[I("div",_I,[C(Sn,{size:"md"}),_[5]||(_[5]=I("div",{class:"text-caption text-grey text-uppercase q-mt-xs"},"we're working on it!",-1))])]),_:1},8,["showing"])]),_:1})]),_:1},8,["modelValue"]))}},EI={class:"text-uppercase text-body1 text-bold"},SI={class:"row q-col-gutter-xs q-mb-sm"},CI={class:"col-2"},II={class:"col-2"},DI={class:"col-2"},kI={class:"col-2"},TI={class:"col-1"},NI={class:"row q-col-gutter-xs q-mb-sm"},RI={class:"col-2"},AI={class:"col-2"},PI={class:"col-2"},OI={class:"col-3"},MI={class:"q-gutter-sm"},FI={class:"text-center"},VI={__name:"DependentDialog",props:{modelValue:String,dialogName:String},emits:["update:modelValue"],setup(n,{emit:t}){const e=Jt(),r=nt(),a=n,o=t,i=Be({get:()=>a.modelValue===a.dialogName,set:S=>{S||o("update:modelValue",null)}}),s=B(!1),u=B([{id:"",relationship:"",firstname:"",middlename:"",lastname:"",suffix:"",birthdate:new Date().toISOString().split("T")[0],contactNo:"",email:"",address:"",isEmergency:!1}]),l=()=>({id:"",relationship:"",firstname:"",middlename:"",lastname:"",suffix:"",birthdate:new Date().toISOString().split("T")[0],contactNo:"",email:"",address:"",isEmergency:!1}),c=async S=>{s.value=!0;try{const _=await Re.get("/employee/dependent",{params:{id:S}});_.data.record.length?p(_.data.record):l()}catch(_){console.error("Error fetching all data:",_),me.fire({icon:"error",html:`
                <div class="text-h6 text-bold text-uppercase">Error</div>
                <div class="text-caption text-capitalize;">Unable to fetch records</div>
            `})}finally{s.value=!1}},p=(S=[])=>{u.value=S.map(_=>({id:_.id??"",relationship:_.relationship??"",firstname:_.first_name??"",middlename:_.middle_name??"",lastname:_.last_name??"",suffix:_.suffix??"",birthdate:_.birthdate??"",contactNo:_.contact_number??"",email:_.email??"",address:_.address??"",isEmergency:!!_.is_emergency}))},f=()=>{c(r.data?.id)},d=jt({dependents:{relationship:{type:[],msg:""},firstname:{type:[],msg:""},middlename:{type:[],msg:""},lastname:{type:[],msg:""},suffix:{type:[],msg:""},birthdate:{type:[],msg:""},contactNo:{type:[],msg:""},email:{type:[],msg:""},address:{type:[],msg:""}}}),h=()=>{d.dependents.relationship.type=u.value.map(()=>null),d.dependents.firstname.type=u.value.map(()=>null),d.dependents.middlename.type=u.value.map(()=>null),d.dependents.lastname.type=u.value.map(()=>null),d.dependents.suffix.type=u.value.map(()=>null),d.dependents.birthdate.type=u.value.map(()=>null),d.dependents.contactNo.type=u.value.map(()=>null),d.dependents.email.type=u.value.map(()=>null),d.dependents.address.type=u.value.map(()=>null)},v=()=>{let S=!1;return d.dependents.relationship={type:null,msg:""},d.dependents.firstname={type:null,msg:""},d.dependents.middlename={type:null,msg:""},d.dependents.lastname={type:null,msg:""},d.dependents.suffix={type:null,msg:""},d.dependents.birthdate={type:null,msg:""},d.dependents.contactNo={type:null,msg:""},d.dependents.email={type:null,msg:""},d.dependents.address={type:null,msg:""},h(),u.value.forEach((_,b)=>{_.relationship||(d.dependents.relationship.type[b]=!0,d.dependents.relationship.msg="relationship is required",S=!0),_.firstname||(d.dependents.firstname.type[b]=!0,d.dependents.firstname.msg="firstname is required",S=!0),_.middlename||(d.dependents.middlename.type[b]=!0,d.dependents.middlename.msg="middlename is required",S=!0),_.lastname||(d.dependents.lastname.type[b]=!0,d.dependents.lastname.msg="lastname is required",S=!0);const N=["SR","JR","II","III","IV","V","VI","VII","VIII","IX","X"];if(_.suffix){const T=suffix.value.trim().toUpperCase();N.includes(T)||(d.dependents.suffix.type[b]=!0,d.dependents.suffix.msg="suffix is required",S=!0)}_.birthdate||(d.dependents.birthdate.type[b]=!0,d.dependents.birthdate.msg="birthdate is required",S=!0),_.contactNo||(d.dependents.contactNo.type[b]=!0,d.dependents.contactNo.msg="contact number is required",S=!0),_.email||(d.dependents.email.type[b]=!0,d.dependents.email.msg="email is required",S=!0),_.address||(d.dependents.address.type[b]=!0,d.dependents.address.msg="address is required",S=!0)}),S&&me.fire({icon:"error",html:`
                <div class="text-h6 text-bold text-uppercase">Request Failed</div>
                <div class="text-caption">Something went wrong.</div>
            `}),!S},g=B(["Spouse","Child","Parent","Sibling","Other"]),m=()=>{u.value.push({id:"",relationship:"",firstname:"",middlename:"",lastname:"",suffix:"",birthdate:new Date().toISOString().split("T")[0],contactNo:"",email:"",address:"",isEmergency:!1})},x=S=>{u.value.splice(S,1)},y=S=>{u.value.forEach((_,b)=>{_.isEmergency=b===S})},w=async()=>{if(v()){s.value=!0;try{const S=await Re.post(`/employee/${r.data?.id}/dependent`,{dependents:u.value});o("update:modelValue",null),me.fire({icon:"success",html:`
                <div class="text-h6 text-bold text-uppercase">granted!</div>
                <div class="text-caption text-capitalize;">${S.data.message}<div>
            `})}catch(S){S.response&&S.response.data&&(E(S.response.data),me.fire({icon:"error",html:`
                    <div class="text-h6 text-bold text-uppercase">Request Failed</div>
                    <div class="text-caption">Something went wrong.</div>
                `}))}finally{s.value=!1}}},E=S=>{const _=Array.isArray(S)?S:S?.errors||[];Object.keys(d).forEach(b=>{d[b].type=null,d[b].messages=[]}),_.forEach(b=>{d[b.path]!==void 0&&(d[b.path].type=!0,d[b.path].messages.push(b.msg))})},D=B([]);function k(S){Xn(()=>{D.value[S]&&D.value[S].hide()})}return(S,_)=>(H(),pe(Ke,{modelValue:i.value,"onUpdate:modelValue":_[2]||(_[2]=b=>i.value=b),"full-height":"",position:"right",persistent:"",square:"",class:"dialog",onBeforeShow:_[3]||(_[3]=()=>{f()})},{default:R(()=>[C(_e,{class:"dialog-card column full-height"},{default:R(()=>[C(oe,{class:"q-pa-lg"},{default:R(()=>_[4]||(_[4]=[I("div",{class:"text-h6 text-uppercase"},"dependent information",-1)])),_:1,__:[4]}),C(pt,{inset:""}),C(oe,{class:"col q-pa-lg scroll"},{default:R(()=>[(H(!0),se(Ve,null,We(u.value,(b,N)=>(H(),se("div",{key:N,class:"q-mb-md"},[I("div",null,[I("span",EI,"dependent "+X(N+1),1),u.value.length>1&&ke(e).hasRole(["SuperAdmin","Admin","HR"])?(H(),pe(de,{key:0,round:"",icon:"bi-trash3",flat:"",unelevated:"",color:"grey",onClick:T=>x(N),size:"sm",class:"q-ml-sm"},null,8,["onClick"])):we("",!0)]),I("div",SI,[I("div",CI,[I("div",{class:ne(["text-caption text-uppercase q-mb-xs",d.dependents.relationship.msg?"text-negative":"text-grey"])},X(d.dependents.relationship.msg?d.dependents.relationship.msg:"relationship"),3),C(An,{outlined:"",modelValue:b.relationship,"onUpdate:modelValue":T=>b.relationship=T,label:"Choose Relationship","input-debounce":"300",options:g.value,error:d.dependents.relationship.type[N],"hide-dropdown-icon":"","no-error-icon":!0},{"no-option":R(()=>[C(lt,null,{default:R(()=>[C(ct,{class:"text-italic text-grey"},{default:R(()=>_[5]||(_[5]=[Ye(" No options ")])),_:1,__:[5]})]),_:1})]),option:R(T=>[C(lt,ga({ref_for:!0},T.itemProps),{default:R(()=>[C(ct,null,{default:R(()=>[C(Rn,null,{default:R(()=>[Ye(X(S.$CapitalizeWords(T.opt)),1)]),_:2},1024)]),_:2},1024)]),_:2},1040)]),_:2},1032,["modelValue","onUpdate:modelValue","options","error"])]),I("div",II,[I("div",{class:ne(["text-caption text-uppercase q-mb-xs",d.dependents.firstname.msg?"text-negative":"text-grey"])},X(d.dependents.firstname.msg?d.dependents.firstname.msg:"firstname"),3),C(le,{modelValue:b.firstname,"onUpdate:modelValue":T=>b.firstname=T,label:"Enter Firstname",outlined:"",error:d.dependents.firstname.type[N],"no-error-icon":!0,"input-class":"text-capitalize"},null,8,["modelValue","onUpdate:modelValue","error"])]),I("div",DI,[I("div",{class:ne(["text-caption text-uppercase q-mb-xs",d.dependents.middlename.msg?"text-negative":"text-grey"])},X(d.dependents.middlename.msg?d.dependents.middlename.msg:"middlename"),3),C(le,{modelValue:b.middlename,"onUpdate:modelValue":T=>b.middlename=T,label:"Enter Middlename",outlined:"",error:d.dependents.middlename.type[N],"no-error-icon":!0,"input-class":"text-capitalize"},null,8,["modelValue","onUpdate:modelValue","error"])]),I("div",kI,[I("div",{class:ne(["text-caption text-uppercase q-mb-xs",d.dependents.lastname.msg?"text-negative":"text-grey"])},X(d.dependents.lastname.msg?d.dependents.lastname.msg:"lastname"),3),C(le,{modelValue:b.lastname,"onUpdate:modelValue":T=>b.lastname=T,label:"Enter Lastname",outlined:"",error:d.dependents.lastname.type[N],"no-error-icon":!0,"input-class":"text-capitalize"},null,8,["modelValue","onUpdate:modelValue","error"])]),I("div",TI,[I("div",{class:ne(["text-caption text-uppercase q-mb-xs",d.dependents.suffix.msg?"text-negative":"text-grey"])},X(d.dependents.suffix.msg?d.dependents.suffix.msg:"suffix"),3),C(le,{modelValue:b.suffix,"onUpdate:modelValue":T=>b.suffix=T,label:"Enter Suffix",outlined:"",error:d.dependents.suffix.type[N],"no-error-icon":!0,"input-class":"text-capitalize"},null,8,["modelValue","onUpdate:modelValue","error"])])]),I("div",NI,[I("div",RI,[I("div",{class:ne(["text-caption text-uppercase q-mb-xs",d.dependents.birthdate.msg?"text-negative":"text-grey"])},X(d.dependents.birthdate.msg?d.dependents.birthdate.msg:"birthdate (YYYY-MM-DD)"),3),C(le,{outlined:"",modelValue:b.birthdate,"onUpdate:modelValue":T=>b.birthdate=T,label:"Enter Date"},{default:R(()=>[C(Ft,{cover:"","transition-show":"scale","transition-hide":"scale",class:"no-shadow custom-border radius-sm",ref_for:!0,ref:T=>D.value[N]=T},{default:R(()=>[C(Mt,{modelValue:b.birthdate,"onUpdate:modelValue":[T=>b.birthdate=T,()=>k(N)],mask:"YYYY-MM-DD"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1536)]),_:2},1032,["modelValue","onUpdate:modelValue"])]),I("div",AI,[I("div",{class:ne(["text-caption text-uppercase q-mb-xs",d.dependents.contactNo.msg?"text-negative":"text-grey"])},X(d.dependents.contactNo.msg?d.dependents.contactNo.msg:"contact No"),3),C(le,{modelValue:b.contactNo,"onUpdate:modelValue":T=>b.contactNo=T,label:"Enter Contact No.",outlined:"",error:d.dependents.contactNo.type[N],"no-error-icon":!0},null,8,["modelValue","onUpdate:modelValue","error"])]),I("div",PI,[I("div",{class:ne(["text-caption text-uppercase q-mb-xs",d.dependents.email.msg?"text-negative":"text-grey"])},X(d.dependents.email.msg?d.dependents.email.msg:"email"),3),C(le,{modelValue:b.email,"onUpdate:modelValue":T=>b.email=T,label:"Enter Email",outlined:"",error:d.dependents.email.type[N],"no-error-icon":!0},null,8,["modelValue","onUpdate:modelValue","error"])]),I("div",OI,[I("div",{class:ne(["text-caption text-uppercase q-mb-xs",d.dependents.address.msg?"text-negative":"text-grey"])},X(d.dependents.address.msg?d.dependents.address.msg:"address"),3),C(le,{modelValue:b.address,"onUpdate:modelValue":T=>b.address=T,label:"Enter Address",outlined:"",error:d.dependents.address.type[N],"no-error-icon":!0,"input-class":"text-capitalize"},null,8,["modelValue","onUpdate:modelValue","error"])])]),I("div",null,[C(Pd,{"left-label":"",modelValue:b.isEmergency,"onUpdate:modelValue":[T=>b.isEmergency=T,()=>y(N)],label:"emergency contact person","checked-icon":"bi-check2-circle","unchecked-icon":"bi-circle",class:"text-capitalize"},null,8,["modelValue","onUpdate:modelValue"])])]))),128))]),_:1}),C(ft,{class:"q-pa-lg bg"},{default:R(()=>[I("div",MI,[ke(e).hasRole(["SuperAdmin","Admin","HR"])?(H(),pe(de,{key:0,unelevated:"",size:"md",color:"primary",class:"btn text-capitalize",label:"save",onClick:_[0]||(_[0]=b=>w())})):we("",!0),ke(e).hasRole(["SuperAdmin","Admin","HR"])?(H(),pe(de,{key:1,unelevated:"",size:"md",color:"primary",class:"btn text-capitalize",label:"add",onClick:m,outline:""})):we("",!0),C(de,{unelevated:"",size:"md",color:"primary",class:"btn text-capitalize",label:"discard",onClick:_[1]||(_[1]=()=>{o("update:modelValue",null)}),outline:""})])]),_:1}),C(ht,{showing:s.value},{default:R(()=>[I("div",FI,[C(Sn,{size:"md"}),_[6]||(_[6]=I("div",{class:"text-caption text-grey text-uppercase q-mt-xs"},"we're working on it!",-1))])]),_:1},8,["showing"])]),_:1})]),_:1},8,["modelValue"]))}},LI={class:"q-mb-lg"},BI={class:"row q-col-gutter-xs q-mb-xs"},UI={class:"col-3"},WI={class:"col-3"},qI={class:"col-1"},zI={class:"card-grid"},$I={key:0,class:"card-anim-wrapper",style:{animationDelay:"120ms"}},HI=["onClick"],GI={class:"text-subtitle2 text-uppercase"},jI={class:"q-gutter-sm"},XI={class:"text-center"},YI={class:"iframe-container"},KI=["src"],JI={__name:"DocumentDialog",props:{modelValue:String,dialogName:String},emits:["update:modelValue"],setup(n,{emit:t}){const e=Jt(),r=nt(),a=n,o=t,i=Be({get:()=>a.modelValue===a.dialogName,set:k=>{k||o("update:modelValue",null)}}),s=B(!1),u=B([]);B("");const l=async k=>{s.value=!0;try{const S=await Re.get("/employee/document",{params:{id:k}});u.value=S.data.record}catch(S){console.error("Error fetching all data:",S),me.fire({icon:"error",html:`
                <div class="text-h6 text-bold text-uppercase">Error</div>
                <div class="text-caption text-capitalize;">Unable to fetch records</div>
            `})}finally{s.value=!1}},c=()=>{l(r.data?.id)},p=()=>{f.value=[{file:""}]},f=B([{file:""}]),d=jt({documents:{file:{type:[],msg:""}}}),h=()=>{d.documents.file.type=f.value.map(()=>null)},v=()=>{let k=!1;return d.documents.file={type:null,msg:""},h(),f.value.forEach((S,_)=>{S.file?S.file.type!=="application/pdf"?(d.documents.file.type[_]=!0,d.documents.file.msg="file must be a PDF document",k=!0):S.file.size>5242880&&(d.documents.file.type[_]=!0,d.documents.file.msg="file size must not exceed to 5MB",k=!0):(d.documents.file.type[_]=!0,d.documents.file.msg="file is required",k=!0)}),k&&me.fire({icon:"error",html:`
                <div class="text-h6 text-bold text-uppercase">Request Failed</div>
                <div class="text-caption">Something went wrong.</div>
            `}),!k},g=async()=>{if(v()){s.value=!0;try{const k=new FormData;f.value.forEach((_,b)=>{k.append(`documents[${b}][documentId]`,_.documentId),_.file&&k.append(`documents[${b}][file]`,_.file)});const S=await Re.post(`/employee/${r.data?.id}/document`,k,{headers:{"Content-Type":"multipart/form-data"}});o("update:modelValue",null),me.fire({icon:"success",html:`
                <div class="text-h6 text-bold text-uppercase">granted!</div>
                <div class="text-caption text-capitalize;">${S.data.message}<div>
            `})}catch(k){k.response&&k.response.data&&(m(k.response.data),me.fire({icon:"error",html:`
                    <div class="text-h6 text-bold text-uppercase">Request Failed</div>
                    <div class="text-caption">Something went wrong.</div>
                `}))}finally{s.value=!1}}},m=k=>{const S=Array.isArray(k)?k:k?.errors||[];Object.keys(d).forEach(_=>{d[_].type=null,d[_].messages=[]}),S.forEach(_=>{d[_.path]!==void 0&&(d[_.path].type=!0,d[_.path].messages.push(_.msg))})},x=()=>{f.value.push({file:""})},y=k=>{f.value.splice(k,1)},w=B(!1),E=B(null),D=async k=>{s.value=!0;try{const S=await Re.get(`/employee/document/${k}/pdf`,{responseType:"arraybuffer"}),_=new Blob([S.data],{type:"application/pdf"}),b=window.URL.createObjectURL(_)+"#view=FitW";E.value=b,w.value=!0,s.value=!1}catch(S){s.value=!1,console.error("Error generating PDF:",S)}};return(k,S)=>(H(),se(Ve,null,[C(Ke,{modelValue:i.value,"onUpdate:modelValue":S[2]||(S[2]=_=>i.value=_),"full-height":"",position:"right",persistent:"",square:"",class:"dialog",onBeforeShow:S[3]||(S[3]=()=>{c(),p()})},{default:R(()=>[C(_e,{class:"dialog-card column full-height"},{default:R(()=>[C(oe,{class:"q-pa-lg"},{default:R(()=>S[5]||(S[5]=[I("div",{class:"text-h6 text-uppercase"},"document information",-1)])),_:1,__:[5]}),C(pt,{inset:""}),C(oe,{class:"col q-pa-lg scroll"},{default:R(()=>[I("div",LI,[I("div",BI,[I("div",UI,[I("div",{class:ne(["text-caption text-uppercase q-mb-xs",d.documents.file.msg?"text-negative":"text-grey"])},X(d.documents.file.msg?d.documents.file.msg:"documents"),3)])]),(H(!0),se(Ve,null,We(f.value,(_,b)=>(H(),se("div",{class:"row q-col-gutter-xs q-mb-xs",key:b},[I("div",WI,[C(Od,{modelValue:_.file,"onUpdate:modelValue":N=>_.file=N,label:"Upload File",outlined:"",error:d.documents.file.type[b],"no-error-icon":!0},null,8,["modelValue","onUpdate:modelValue","error"])]),I("div",qI,[f.value.length>1&&ke(e).hasRole(["SuperAdmin","Admin","HR"])?(H(),pe(de,{key:0,round:"",icon:"bi-trash3",flat:"",unelevated:"",color:"grey",onClick:N=>y(b),size:"sm",class:"q-mt-md"},null,8,["onClick"])):we("",!0)])]))),128))]),I("div",zI,[!s.value&&u.value.length===0?(H(),se("div",$I,[C(_e,{key:"data-add",class:"card card-hover-animate flex flex-center q-pa-md no-shadow cursor-pointer radius-sm"},{default:R(()=>[C(oe,{class:"text-center"},{default:R(()=>S[6]||(S[6]=[I("div",{class:"text-caption text-uppercase text-grey"},"no data found",-1)])),_:1,__:[6]})]),_:1})])):(H(!0),se(Ve,{key:1},We(u.value,(_,b)=>(H(),se("div",{key:`data-${_.id}`,class:"card-anim-wrapper",style:dr({animationDelay:`${b*120}ms`}),onClick:N=>D(_.id)},[C(_e,{class:"card card-hover-animate flex flex-center q-pa-md no-shadow cursor-pointer radius-sm"},{default:R(()=>[C(oe,{class:"text-center full-width"},{default:R(()=>[I("div",GI,X(_?.filename),1)]),_:2},1024)]),_:2},1024)],12,HI))),128))])]),_:1}),C(ft,{class:"q-pa-lg bg"},{default:R(()=>[I("div",jI,[ke(e).hasRole(["SuperAdmin","Admin","HR"])?(H(),pe(de,{key:0,unelevated:"",size:"md",color:"primary",class:"btn text-capitalize",label:"save",onClick:S[0]||(S[0]=_=>g())})):we("",!0),ke(e).hasRole(["SuperAdmin","Admin","HR"])?(H(),pe(de,{key:1,unelevated:"",size:"md",color:"primary",class:"btn text-capitalize",label:"add",onClick:x,outline:""})):we("",!0),C(de,{unelevated:"",size:"md",color:"primary",class:"btn text-capitalize",label:"discard",onClick:S[1]||(S[1]=()=>{o("update:modelValue",null)}),outline:""})])]),_:1}),C(ht,{showing:s.value},{default:R(()=>[I("div",XI,[C(Sn,{size:"md"}),S[7]||(S[7]=I("div",{class:"text-caption text-grey text-uppercase q-mt-xs"},"we're working on it!",-1))])]),_:1},8,["showing"])]),_:1})]),_:1},8,["modelValue"]),C(Ke,{modelValue:w.value,"onUpdate:modelValue":S[4]||(S[4]=_=>w.value=_),"full-height":"","full-width":"",class:"pdf"},{default:R(()=>[C(_e,{class:"bg-white q-pa-none",style:{height:"100vh",overflow:"hidden"}},{default:R(()=>[Or(C(de,{icon:"bi-x",class:"fixed bg-white text-primary shadow-2",round:"",dense:"",style:{top:"15px",right:"15px","z-index":"999"}},null,512),[[yo]]),C(oe,{class:"q-pa-none",style:{height:"100%",overflow:"hidden"}},{default:R(()=>[I("div",YI,[E.value?(H(),se("iframe",{key:0,src:E.value,frameborder:"0"},null,8,KI)):we("",!0)])]),_:1})]),_:1})]),_:1},8,["modelValue"])],64))}},QI=Kn(JI,[["__scopeId","data-v-4fa2146d"]]),ZI={class:"iframe-container"},eD=["src"],tD={class:"q-gutter-sm"},nD={__name:"IdentificationDialog",props:{modelValue:String,dialogName:String},emits:["update:modelValue"],setup(n,{emit:t}){const e=nt(),r=n,a=t,o=Be({get:()=>r.modelValue===r.dialogName,set:c=>{c||a("update:modelValue",null)}}),i=B(!1),s=()=>{l()},u=B(null),l=async()=>{i.value=!0;try{const c=await Re.get(`/employee/${e.data?.id}/pdf`,{responseType:"arraybuffer"}),p=new Blob([c.data],{type:"application/pdf"}),f=window.URL.createObjectURL(p)+"#view=FitW";u.value=f}catch(c){console.error("Error generating PDF:",c)}finally{i.value=!1}};return(c,p)=>(H(),pe(Ke,{modelValue:o.value,"onUpdate:modelValue":p[1]||(p[1]=f=>o.value=f),"full-height":"",position:"right",persistent:"",square:"",class:"dialog",onBeforeShow:p[2]||(p[2]=f=>s())},{default:R(()=>[C(_e,{class:"dialog-card column full-height"},{default:R(()=>[C(oe,{class:"q-pa-lg"},{default:R(()=>p[3]||(p[3]=[I("div",{class:"text-h6 text-uppercase"},"digital id",-1)])),_:1,__:[3]}),C(pt,{inset:""}),C(oe,{class:"col q-pa-none scroll"},{default:R(()=>[I("div",ZI,[u.value?(H(),se("iframe",{key:0,src:u.value,frameborder:"0"},null,8,eD)):we("",!0)])]),_:1}),C(ft,{class:"q-pa-lg bg"},{default:R(()=>[I("div",tD,[C(de,{unelevated:"",size:"md",color:"primary",class:"btn text-capitalize",label:"discard",onClick:p[0]||(p[0]=()=>{a("update:modelValue",null)}),outline:""})])]),_:1}),C(ht,{showing:i.value},{default:R(()=>[C(_e,{class:"no-shadow radius-md q-pa-md"},{default:R(()=>[C(oe,{class:"text-center"},{default:R(()=>[I("div",null,[C(an,{color:"dark"})]),p[4]||(p[4]=I("div",{class:"text-dark text-uppercase text-caption"},"we're working on it!",-1))]),_:1,__:[4]})]),_:1})]),_:1},8,["showing"])]),_:1})]),_:1},8,["modelValue"]))}},rD={class:"filter-inline"},aD={class:"q-gutter-xs"},oD={class:"q-mt-md"},iD={class:"q-mb-xl"},sD={class:"row q-col-gutter-xs q-mb-xs"},uD={class:"col-1"},lD={class:"col-1"},cD={class:"col-4"},dD={class:"row items-center q-gutter-xs"},pD={class:"col"},fD={class:"row items-center q-gutter-xs"},hD={class:"q-gutter-sm"},vD={class:"iframe-container"},mD=["src"],gD={__name:"AttendanceDialog",props:{modelValue:String,dialogName:String},emits:["update:modelValue"],setup(n,{emit:t}){const e=nt(),r=n,a=t,o=Be({get:()=>r.modelValue===r.dialogName,set:D=>{D||a("update:modelValue",null)}}),i=B(!1);B("");const s=new Date,u=B(String(s.getMonth()+1).padStart(2,"0")),l=B(String(s.getFullYear())),c=Array.from({length:12},(D,k)=>{const S=new Date(0,k).toLocaleString("en-US",{month:"short"}),_=String(k+1).padStart(2,"0");return{label:S,value:_}}),p=B([]),f=B(""),d=async D=>{i.value=!0;try{const S=(await Re.get("/employee/attendance",{params:{id:D,year:l.value,month:u.value}})).data;p.value=S.logs,f.value=S.attendance_id}catch(k){console.error("Error fetching all data:",k),me.fire({icon:"error",html:`
                <div class="text-h6 text-bold text-uppercase">Error</div>
                <div class="text-caption text-capitalize;">Unable to fetch records</div>
            `})}finally{i.value=!1}},h=()=>{d(e.data?.id)},v=D=>D?ys(D).format("DD"):"",g=D=>D?ys(D).format("dddd"):"",m=D=>D?ys(D,["HH:mm","HH:mm:ss"],!0).format("hh:mm A"):"",x=D=>{const k=Number(D)||0;if(k<=0)return"0 min";const S=24*60,_=Math.floor(k/S),b=Math.floor(k%S/60),N=k%60,T=[];return _&&T.push(`${_} ${_===1?"day":"days"}`),b&&T.push(`${b} ${b===1?"hr":"hrs"}`),N&&T.push(`${N} ${N===1?"min":"mins"}`),T.join(" ")},y=B(!1),w=B(null),E=async()=>{i.value=!0;try{const D=await Re.get(`/attendance/${f.value}/pdf`,{responseType:"arraybuffer"}),k=new Blob([D.data],{type:"application/pdf"}),S=window.URL.createObjectURL(k)+"#view=FitW";w.value=S,y.value=!0,i.value=!1}catch(D){console.error("Error generating PDF:",D)}finally{i.value=!1}};return(D,k)=>(H(),se(Ve,null,[C(Ke,{modelValue:o.value,"onUpdate:modelValue":k[3]||(k[3]=S=>o.value=S),"full-height":"",position:"right",persistent:"",square:"",class:"dialog",onBeforeShow:k[4]||(k[4]=S=>h())},{default:R(()=>[C(_e,{class:"dialog-card column full-height"},{default:R(()=>[C(oe,{class:"q-pa-lg"},{default:R(()=>k[6]||(k[6]=[I("div",{class:"text-h6 text-uppercase"},"daily time record",-1)])),_:1,__:[6]}),C(pt,{inset:""}),C(oe,{class:"col q-pa-lg scroll"},{default:R(()=>[I("div",rD,[C(le,{outlined:"",modelValue:l.value,"onUpdate:modelValue":k[0]||(k[0]=S=>l.value=S),style:{width:"80px"},dense:""},null,8,["modelValue"]),I("div",aD,[(H(!0),se(Ve,null,We(ke(c),(S,_)=>(H(),pe(de,{round:"",unelevated:"",class:ne(u.value===S.value?"active":"inactive"),onClick:()=>{u.value=S.value,d(ke(e).data?.id)},size:"md",label:S.label},null,8,["class","onClick","label"]))),256))])]),I("div",oD,[k[7]||(k[7]=I("div",{class:"row q-col-gutter-xs"},[I("div",{class:"col-1"},[I("div",{class:"q-mb-xs"},[I("span",{class:"text-caption text-uppercase text-grey q-mr-sm"},"date")])]),I("div",{class:"col-1"},[I("div",{class:"q-mb-xs"},[I("span",{class:"text-caption text-uppercase text-grey q-mr-sm"},"day")])]),I("div",{class:"col-4"},[I("div",{class:"q-mb-xs"},[I("span",{class:"text-caption text-uppercase text-grey q-mr-sm"},"attendance")])]),I("div",{class:"col-4"},[I("div",{class:"q-mb-xs"},[I("span",{class:"text-caption text-uppercase text-grey q-mr-sm"},"logs")])])],-1)),I("div",iD,[(H(!0),se(Ve,null,We(p.value,(S,_)=>(H(),se("div",sD,[I("div",uD,[C(le,{outlined:"",dense:"","model-value":v(S.date)},null,8,["model-value"])]),I("div",lD,[C(le,{outlined:"",dense:"","model-value":g(S.date)},null,8,["model-value"])]),I("div",cD,[I("div",dD,[C(le,{outlined:"",dense:"","model-value":m(S.time_in),readonly:!0,style:{width:"100px"}},null,8,["model-value"]),C(le,{outlined:"",dense:"","model-value":m(S.time_out),readonly:!0,style:{width:"100px"}},null,8,["model-value"]),C(le,{outlined:"",dense:"","model-value":x(S.late),readonly:!0,style:{width:"100px"}},null,8,["model-value"]),C(le,{outlined:"",dense:"","model-value":x(S.undertime),readonly:!0,style:{width:"100px"}},null,8,["model-value"]),C(le,{outlined:"",dense:"","model-value":x(S.overtime),readonly:!0,style:{width:"100px"}},null,8,["model-value"])])]),I("div",pD,[I("div",fD,[(H(!0),se(Ve,null,We(S.logs,(b,N)=>(H(),pe(le,{outlined:"",dense:"","model-value":m(S.logs[N]),readonly:!0,style:{width:"100px"}},null,8,["model-value"]))),256)),S.notes.length?(H(!0),se(Ve,{key:0},We(S.notes,b=>(H(),pe(Kv,{rounded:"",color:"primary",label:b.type,class:"text-uppercase cursor-pointer"},{default:R(()=>[C(Ka,{anchor:"top middle",self:"center middle",class:"text-uppercase"},{default:R(()=>[I("div",null,X(b.name),1)]),_:2},1024)]),_:2},1032,["label"]))),256)):we("",!0)])])]))),256))])])]),_:1}),C(ft,{class:"q-pa-lg bg"},{default:R(()=>[I("div",hD,[C(de,{disable:!f.value,unelevated:"",size:"md",color:"primary",class:"btn text-capitalize",label:"print",onClick:k[1]||(k[1]=()=>{E()})},null,8,["disable"]),C(de,{unelevated:"",size:"md",color:"primary",class:"btn text-capitalize",label:"discard",onClick:k[2]||(k[2]=()=>{a("update:modelValue",null)}),outline:""})])]),_:1}),C(ht,{showing:i.value},{default:R(()=>[C(_e,{class:"no-shadow radius-md q-pa-md"},{default:R(()=>[C(oe,{class:"text-center"},{default:R(()=>[I("div",null,[C(an,{color:"dark"})]),k[8]||(k[8]=I("div",{class:"text-dark text-uppercase text-caption"},"we're working on it!",-1))]),_:1,__:[8]})]),_:1})]),_:1},8,["showing"])]),_:1})]),_:1},8,["modelValue"]),C(Ke,{modelValue:y.value,"onUpdate:modelValue":k[5]||(k[5]=S=>y.value=S),"full-height":"","full-width":"",class:"pdf"},{default:R(()=>[C(_e,{class:"bg-white q-pa-none",style:{height:"100vh",overflow:"hidden"}},{default:R(()=>[Or(C(de,{icon:"bi-x",class:"fixed bg-white text-primary shadow-2",round:"",dense:"",style:{top:"15px",right:"15px","z-index":"999"}},null,512),[[yo]]),C(oe,{class:"q-pa-none",style:{height:"100%",overflow:"hidden"}},{default:R(()=>[I("div",vD,[w.value?(H(),se("iframe",{key:0,src:w.value,frameborder:"0"},null,8,mD)):we("",!0)])]),_:1})]),_:1})]),_:1},8,["modelValue"])],64))}},yD=Kn(gD,[["__scopeId","data-v-48aed48f"]]),xD={class:"q-mb-lg"},bD={key:0},_D={class:"row q-col-gutter-xs q-mb-xs"},wD={class:"col-1"},ED={class:"col-1"},SD={class:"col-1"},CD={class:"col-2"},ID={class:"col-1"},DD={class:"col-1"},kD={class:"col-1"},TD={class:"col-1"},ND={key:1},RD={class:"card-grid"},AD={class:"text-subtitle2 text-uppercase"},PD={class:"text-caption"},OD={class:"q-mb-lg"},MD={class:"filter-inline q-mb-md"},FD={class:"q-gutter-xs"},VD={class:"card-grid"},LD={key:0,class:"inner-card-anim-wrapper",style:{animationDelay:"120ms"}},BD={class:"text-subtitle2 text-uppercase"},UD={class:"text-caption text-uppercase text-grey"},WD={class:"text-caption"},qD={class:"text-caption text-uppercase text-grey"},zD={class:"q-gutter-sm"},$D={class:"iframe-container"},HD=["src"],GD={__name:"LeaveDialog",props:{modelValue:String,dialogName:String},emits:["update:modelValue"],setup(n,{emit:t}){const e=nt(),r=n,a=t,o=Be({get:()=>r.modelValue===r.dialogName,set:P=>{P||a("update:modelValue",null)}}),i=B(!1),s=new Date,u=B(String(s.getMonth()+1).padStart(2,"0")),l=B(String(s.getFullYear())),c=Array.from({length:12},(P,F)=>{const M=new Date(0,F).toLocaleString("en-US",{month:"short"}),L=String(F+1).padStart(2,"0");return{label:M,value:L}}),p=B([]),f=B([]),d=async P=>{i.value=!0;try{const F=await Re.get("/employee/leave/balance",{params:{id:P}});p.value=F.data.record}catch(F){console.error("Error fetching all data:",F),me.fire({icon:"error",html:`
                <div class="text-h6 text-bold text-uppercase">Error</div>
                <div class="text-caption text-capitalize;">Unable to fetch records</div>
            `})}finally{i.value=!1}},h=async P=>{i.value=!0;try{const F=await Re.get("/employee/leave/application",{params:{id:P,month:u.value,year:l.value}});f.value=F.data.record}catch(F){console.error("Error fetching all data:",F),me.fire({icon:"error",html:`
                <div class="text-h6 text-bold text-uppercase">Error</div>
                <div class="text-caption text-capitalize;">Unable to fetch records</div>
            `})}finally{i.value=!1}},v=B([]),g=async()=>{try{const{data:P}=await Re.get("/employee/option/leavetype");m(P)}catch(P){console.error("Error fetching options:",P)}},m=(P=[])=>{v.value=P.map(F=>({leavetypeid:F.id??"",leavetype:F.name??"",credit:F.credit??"",earned:"",used:"",balance:""}))},x=()=>{d(e.data?.id),h(e.data?.id),g()},y=jt({leaves:{credit:{type:[],msg:""},earned:{type:[],msg:""},used:{type:[],msg:""}}}),w=()=>{y.leaves.credit.type=v.value.map(()=>null),y.leaves.earned.type=v.value.map(()=>null),y.leaves.used.type=v.value.map(()=>null)},E=()=>{let P=!1;return y.leaves.credit={type:null,msg:""},y.leaves.earned={type:null,msg:""},y.leaves.used={type:null,msg:""},w(),v.value.forEach((F,M)=>{F.credit||(y.leaves.credit.type[M]=!0,y.leaves.credit.msg="credit is required",P=!0),F.earned||(y.leaves.earned.type[M]=!0,y.leaves.earned.msg="earned is required",P=!0),F.used||(y.leaves.used.type[M]=!0,y.leaves.used.msg="used is required",P=!0)}),P&&me.fire({icon:"error",html:`
                <div class="text-h6 text-bold text-uppercase">Request Failed</div>
                <div class="text-caption">Something went wrong.</div>
            `}),!P},D=async()=>{if(E()){i.value=!0;try{const P=await Re.post(`/employee/${e.data?.id}/leave`,{leaves:v.value});a("update:modelValue",null),me.fire({icon:"success",html:`
                <div class="text-h6 text-bold text-uppercase">granted!</div>
                <div class="text-caption text-capitalize;">${P.data.message}<div>
            `})}catch(P){P.response&&P.response.data&&(k(P.response.data),me.fire({icon:"error",html:`
                    <div class="text-h6 text-bold text-uppercase">Request Failed</div>
                    <div class="text-caption">Something went wrong.</div>
                `}))}finally{i.value=!1}}},k=P=>{const F=Array.isArray(P)?P:P?.errors||[];Object.keys(y).forEach(M=>{y[M].type=null,y[M].messages=[]}),F.forEach(M=>{y[M.path]!==void 0&&(y[M.path].type=!0,y[M.path].messages.push(M.msg))})},S=(P,F,M="en-US")=>{if(!P)return"";const L=new Date(P),A=new Date(F||P),$=L.getFullYear()===A.getFullYear()&&L.getMonth()===A.getMonth()&&L.getDate()===A.getDate(),q=re=>re.toLocaleString(M,{month:"long"}),z=re=>re.getDate(),K=re=>re.getFullYear();return $?`${q(L)} ${z(L)}, ${K(L)}`:L.getMonth()===A.getMonth()&&L.getFullYear()===A.getFullYear()?`${q(L)} ${z(L)}-${z(A)}, ${K(L)}`:`${q(L)} ${z(L)}, ${K(L)} - ${q(A)} ${z(A)}, ${K(A)}`},_=(P,F)=>{if(!P)return 0;const M=new Date(P),L=new Date(F||P);M.setHours(0,0,0,0),L.setHours(0,0,0,0);const A=Math.round((L-M)/(1e3*60*60*24));return A>=0?A+1:0},b=B(!1),N=B(null),T=async P=>{i.value=!0;try{const F=await Re.get(`/leave/${P}/pdf`,{responseType:"arraybuffer"}),M=new Blob([F.data],{type:"application/pdf"}),L=window.URL.createObjectURL(M)+"#view=FitW";N.value=L,b.value=!0,i.value=!1}catch(F){i.value=!1,console.error("Error generating PDF:",F)}};return(P,F)=>(H(),se(Ve,null,[C(Ke,{modelValue:o.value,"onUpdate:modelValue":F[3]||(F[3]=M=>o.value=M),"full-height":"",position:"right",persistent:"",square:"",class:"dialog",onBeforeShow:F[4]||(F[4]=M=>x())},{default:R(()=>[C(_e,{class:"dialog-card column full-height"},{default:R(()=>[C(oe,{class:"q-pa-lg"},{default:R(()=>F[6]||(F[6]=[I("div",{class:"text-h6 text-uppercase"},"leave information",-1)])),_:1,__:[6]}),C(pt,{inset:""}),C(oe,{class:"col q-pa-lg scroll"},{default:R(()=>[I("div",xD,[F[10]||(F[10]=I("div",{class:"text-uppercase text-body1 text-bold q-mb-sm"},"leave credit",-1)),p.value.length===0?(H(),se("div",bD,[I("div",_D,[F[7]||(F[7]=I("div",{class:"col-2"},[I("div",{class:"text-caption text-uppercase text-grey"},"leave")],-1)),I("div",wD,[I("div",{class:ne(["text-caption text-uppercase",y.leaves.credit.msg?"text-negative text-italic":"text-grey"])},X(y.leaves.credit.msg?y.leaves.credit.msg:"credit"),3)]),I("div",ED,[I("div",{class:ne(["text-caption text-uppercase",y.leaves.earned.msg?"text-negative text-italic":"text-grey"])},X(y.leaves.earned.msg?y.leaves.earned.msg:"earned"),3)]),I("div",SD,[I("div",{class:ne(["text-caption text-uppercase",y.leaves.used.msg?"text-negative text-italic":"text-grey"])},X(y.leaves.used.msg?y.leaves.used.msg:"used"),3)]),F[8]||(F[8]=I("div",{class:"col-1"},[I("div",{class:"text-caption text-uppercase text-grey"},"balance")],-1))]),(H(!0),se(Ve,null,We(v.value,(M,L)=>(H(),se("div",{class:"row q-col-gutter-xs q-mb-xs",key:L},[I("div",CD,[C(le,{modelValue:M.leavetype,"onUpdate:modelValue":A=>M.leavetype=A,outlined:"","no-error-icon":!0,readonly:!0,class:"text-capitalize"},null,8,["modelValue","onUpdate:modelValue"])]),I("div",ID,[C(le,{modelValue:M.credit,"onUpdate:modelValue":A=>M.credit=A,outlined:"",error:y.leaves.credit.type[L],"no-error-icon":!0},null,8,["modelValue","onUpdate:modelValue","error"])]),I("div",DD,[C(le,{modelValue:M.earned,"onUpdate:modelValue":A=>M.earned=A,error:y.leaves.earned.type[L],outlined:""},null,8,["modelValue","onUpdate:modelValue","error"])]),I("div",kD,[C(le,{modelValue:M.used,"onUpdate:modelValue":A=>M.used=A,error:y.leaves.used.type[L],outlined:""},null,8,["modelValue","onUpdate:modelValue","error"])]),I("div",TD,[C(le,{"model-value":(Number(M.earned)||0)-(Number(M.used)||0),outlined:"",readonly:!0},null,8,["model-value"])])]))),128))])):(H(),se("div",ND,[I("div",RD,[(H(!0),se(Ve,null,We(p.value,(M,L)=>(H(),se("div",{key:`data-${M.id}`,class:"inner-card-anim-wrapper",style:dr({animationDelay:`${L*120}ms`})},[C(_e,{class:"card card-hover-animate flex column justify-center items-center no-shadow cursor-pointer radius-sm"},{default:R(()=>[C(oe,null,{default:R(()=>[I("div",AD,X(M?.leaveType?.name),1)]),_:2},1024),C(oe,null,{default:R(()=>[I("div",PD,X(M.balance),1),F[9]||(F[9]=I("div",{class:"text-caption text-uppercase text-grey"},"balance",-1))]),_:2,__:[9]},1024)]),_:2},1024)],4))),128))])]))]),I("div",OD,[F[12]||(F[12]=I("div",{class:"text-uppercase text-body1 text-bold q-mb-sm"},"leave application",-1)),I("div",MD,[C(le,{outlined:"",modelValue:l.value,"onUpdate:modelValue":F[0]||(F[0]=M=>l.value=M),style:{width:"80px"},dense:""},null,8,["modelValue"]),I("div",FD,[(H(!0),se(Ve,null,We(ke(c),(M,L)=>(H(),pe(de,{round:"",unelevated:"",class:ne(u.value===M.value?"active":"inactive"),onClick:()=>{u.value=M.value,h(ke(e).data?.id)},size:"md",label:M.label},null,8,["class","onClick","label"]))),256))])]),I("div",VD,[!i.value&&f.value.length===0?(H(),se("div",LD,[C(_e,{key:"data-add",class:"card card-hover-animate flex column justify-center items-center no-shadow cursor-pointer radius-sm"},{default:R(()=>[C(oe,{class:"text-center"},{default:R(()=>F[11]||(F[11]=[I("div",{class:"text-caption text-uppercase text-grey"},"no data found",-1)])),_:1,__:[11]})]),_:1})])):we("",!0),(H(!0),se(Ve,null,We(f.value,(M,L)=>(H(),se("div",{key:`data-${M.id}`,class:"inner-card-anim-wrapper",style:dr({animationDelay:`${L*120}ms`})},[C(_e,{onClick:()=>{T(M.id)},class:"card card-menu card-hover-animate flex column justify-center items-center no-shadow cursor-pointer radius-sm no-shadow"},{default:R(()=>[C(oe,null,{default:R(()=>[I("div",BD,X(M.leaveType?.name),1),I("div",UD,X(M?.status),1)]),_:2},1024),C(oe,null,{default:R(()=>[I("div",WD,X(S(M?.date_from,M?.date_to)),1),I("div",qD,X(_(M?.date_from,M?.date_to))+" day/s",1)]),_:2},1024)]),_:2},1032,["onClick"])],4))),128))])])]),_:1}),C(ft,{class:"q-pa-lg bg"},{default:R(()=>[I("div",zD,[p.value.length===0?(H(),pe(de,{key:0,unelevated:"",size:"md",color:"primary",class:"btn text-capitalize",label:"save",onClick:F[1]||(F[1]=M=>D())})):we("",!0),C(de,{unelevated:"",size:"md",color:"primary",class:"btn text-capitalize",label:"discard",onClick:F[2]||(F[2]=()=>{a("update:modelValue",null)}),outline:""})])]),_:1}),C(ht,{showing:i.value},{default:R(()=>[C(_e,{class:"no-shadow radius-md q-pa-md"},{default:R(()=>[C(oe,{class:"text-center"},{default:R(()=>[I("div",null,[C(an,{color:"dark"})]),F[13]||(F[13]=I("div",{class:"text-dark text-uppercase text-caption"},"we're working on it!",-1))]),_:1,__:[13]})]),_:1})]),_:1},8,["showing"])]),_:1})]),_:1},8,["modelValue"]),C(Ke,{modelValue:b.value,"onUpdate:modelValue":F[5]||(F[5]=M=>b.value=M),"full-height":"","full-width":"",class:"pdf"},{default:R(()=>[C(_e,{class:"bg-white q-pa-none",style:{height:"100vh",overflow:"hidden"}},{default:R(()=>[Or(C(de,{icon:"bi-x",class:"fixed bg-white text-primary shadow-2",round:"",dense:"",style:{top:"15px",right:"15px","z-index":"999"}},null,512),[[yo]]),C(oe,{class:"q-pa-none",style:{height:"100%",overflow:"hidden"}},{default:R(()=>[I("div",$D,[N.value?(H(),se("iframe",{key:0,src:N.value,frameborder:"0"},null,8,HD)):we("",!0)])]),_:1})]),_:1})]),_:1},8,["modelValue"])],64))}},jD=Kn(GD,[["__scopeId","data-v-9fa8b8d7"]]),XD={class:"q-gutter-sm"},YD={class:"text-center"},KD={__name:"PerformanceDialog",props:{modelValue:String,dialogName:String},emits:["update:modelValue"],setup(n,{emit:t}){nt();const e=n,r=t,a=Be({get:()=>e.modelValue===e.dialogName,set:s=>{s||r("update:modelValue",null)}}),o=B(!1),i=()=>{};return(s,u)=>(H(),pe(Ke,{modelValue:a.value,"onUpdate:modelValue":u[2]||(u[2]=l=>a.value=l),"full-height":"",position:"right",persistent:"",square:"",class:"dialog",onBeforeShow:u[3]||(u[3]=l=>i())},{default:R(()=>[C(_e,{class:"dialog-card column full-height"},{default:R(()=>[C(oe,{class:"q-pa-lg"},{default:R(()=>u[4]||(u[4]=[I("div",{class:"text-h6 text-uppercase"},"performance information",-1)])),_:1,__:[4]}),C(pt,{inset:""}),C(oe,{class:"col q-pa-lg scroll"}),C(ft,{class:"q-pa-lg bg"},{default:R(()=>[I("div",XD,[C(de,{unelevated:"",size:"md",color:"primary",class:"btn text-capitalize",label:"save",onClick:u[0]||(u[0]=l=>s.SaveProfile())}),C(de,{unelevated:"",size:"md",color:"primary",class:"btn text-capitalize",label:"discard",onClick:u[1]||(u[1]=()=>{r("update:modelValue",null)}),outline:""})])]),_:1}),C(ht,{showing:o.value},{default:R(()=>[I("div",YD,[C(Sn,{size:"md"}),u[5]||(u[5]=I("div",{class:"text-caption text-grey text-uppercase q-mt-xs"},"we're working on it!",-1))])]),_:1},8,["showing"])]),_:1})]),_:1},8,["modelValue"]))}},JD={class:"q-gutter-sm"},QD={class:"text-center"},ZD={__name:"IncidentDialog",props:{modelValue:String,dialogName:String},emits:["update:modelValue"],setup(n,{emit:t}){nt();const e=n,r=t,a=Be({get:()=>e.modelValue===e.dialogName,set:s=>{s||r("update:modelValue",null)}}),o=B(!1),i=()=>{};return(s,u)=>(H(),pe(Ke,{modelValue:a.value,"onUpdate:modelValue":u[2]||(u[2]=l=>a.value=l),"full-height":"",position:"right",persistent:"",square:"",class:"dialog",onBeforeShow:u[3]||(u[3]=l=>i())},{default:R(()=>[C(_e,{class:"dialog-card column full-height"},{default:R(()=>[C(oe,{class:"q-pa-lg"},{default:R(()=>u[4]||(u[4]=[I("div",{class:"text-h6 text-uppercase"},"disciplinary information",-1)])),_:1,__:[4]}),C(pt,{inset:""}),C(oe,{class:"col q-pa-lg scroll"}),C(ft,{class:"q-pa-lg bg"},{default:R(()=>[I("div",JD,[C(de,{unelevated:"",size:"md",color:"primary",class:"btn text-capitalize",label:"save",onClick:u[0]||(u[0]=l=>s.SaveProfile())}),C(de,{unelevated:"",size:"md",color:"primary",class:"btn text-capitalize",label:"discard",onClick:u[1]||(u[1]=()=>{r("update:modelValue",null)}),outline:""})])]),_:1}),C(ht,{showing:o.value},{default:R(()=>[I("div",QD,[C(Sn,{size:"md"}),u[5]||(u[5]=I("div",{class:"text-caption text-grey text-uppercase q-mt-xs"},"we're working on it!",-1))])]),_:1},8,["showing"])]),_:1})]),_:1},8,["modelValue"]))}},ek={class:"q-gutter-sm"},tk={class:"text-center"},nk={__name:"PayslipDialog",props:{modelValue:String,dialogName:String},emits:["update:modelValue"],setup(n,{emit:t}){nt();const e=n,r=t,a=Be({get:()=>e.modelValue===e.dialogName,set:s=>{s||r("update:modelValue",null)}}),o=B(!1),i=()=>{};return(s,u)=>(H(),pe(Ke,{modelValue:a.value,"onUpdate:modelValue":u[2]||(u[2]=l=>a.value=l),"full-height":"",position:"right",persistent:"",square:"",class:"dialog",onBeforeShow:u[3]||(u[3]=l=>i())},{default:R(()=>[C(_e,{class:"dialog-card column full-height"},{default:R(()=>[C(oe,{class:"q-pa-lg"},{default:R(()=>u[4]||(u[4]=[I("div",{class:"text-h6 text-uppercase"},"payslip",-1)])),_:1,__:[4]}),C(pt,{inset:""}),C(oe,{class:"col q-pa-lg scroll"}),C(ft,{class:"q-pa-lg bg"},{default:R(()=>[I("div",ek,[C(de,{unelevated:"",size:"md",color:"primary",class:"btn text-capitalize",label:"save",onClick:u[0]||(u[0]=l=>s.SaveProfile())}),C(de,{unelevated:"",size:"md",color:"primary",class:"btn text-capitalize",label:"discard",onClick:u[1]||(u[1]=()=>{r("update:modelValue",null)}),outline:""})])]),_:1}),C(ht,{showing:o.value},{default:R(()=>[I("div",tk,[C(Sn,{size:"md"}),u[5]||(u[5]=I("div",{class:"text-caption text-grey text-uppercase q-mt-xs"},"we're working on it!",-1))])]),_:1},8,["showing"])]),_:1})]),_:1},8,["modelValue"]))}},rk={class:"q-gutter-sm"},ak={class:"text-center"},ok={__name:"OvertimeDialog",props:{modelValue:String,dialogName:String},emits:["update:modelValue"],setup(n,{emit:t}){nt();const e=n,r=t,a=Be({get:()=>e.modelValue===e.dialogName,set:s=>{s||r("update:modelValue",null)}}),o=B(!1),i=()=>{};return(s,u)=>(H(),pe(Ke,{modelValue:a.value,"onUpdate:modelValue":u[2]||(u[2]=l=>a.value=l),"full-height":"",position:"right",persistent:"",square:"",class:"dialog",onBeforeShow:u[3]||(u[3]=l=>i())},{default:R(()=>[C(_e,{class:"dialog-card column full-height"},{default:R(()=>[C(oe,{class:"q-pa-lg"},{default:R(()=>u[4]||(u[4]=[I("div",{class:"text-h6 text-uppercase"},"overtime information",-1)])),_:1,__:[4]}),C(pt,{inset:""}),C(oe,{class:"col q-pa-lg scroll"}),C(ft,{class:"q-pa-lg bg"},{default:R(()=>[I("div",rk,[C(de,{unelevated:"",size:"md",color:"primary",class:"btn text-capitalize",label:"save",onClick:u[0]||(u[0]=l=>s.SaveProfile())}),C(de,{unelevated:"",size:"md",color:"primary",class:"btn text-capitalize",label:"discard",onClick:u[1]||(u[1]=()=>{r("update:modelValue",null)}),outline:""})])]),_:1}),C(ht,{showing:o.value},{default:R(()=>[I("div",ak,[C(Sn,{size:"md"}),u[5]||(u[5]=I("div",{class:"text-caption text-grey text-uppercase q-mt-xs"},"we're working on it!",-1))])]),_:1},8,["showing"])]),_:1})]),_:1},8,["modelValue"]))}},ik={class:"q-mb-md"},sk={class:"card-grid"},uk={class:"inner-card-anim-wrapper",style:{animationDelay:"100ms"}},lk={class:"text-caption text-dark text-uppercase"},ck={class:"text-caption text-grey text-uppercase"},dk={class:"absolute-left"},pk={class:"q-mb-md"},fk={class:"q-gutter-sm"},hk={class:"row q-col-gutter-xs q-mb-md"},vk={class:"col-2"},mk={class:"col-2"},gk={class:"col-2"},yk={key:0,class:"col-2"},xk={class:"col-2"},bk={class:"q-mb-md"},_k={class:"q-gutter-sm"},wk={class:"q-mb-md q-mt-xl"},Ek={class:"q-gutter-sm"},Sk={class:"row q-col-gutter-xs q-mb-md"},Ck={class:"col-2"},Ik={class:"q-mb-md"},Dk={class:"q-gutter-sm"},kk={class:"row q-gutter-sm"},Tk={class:"text-caption text-uppercase text-grey"},Nk={__name:"SalaryDialog",props:{modelValue:String,dialogName:String},emits:["update:modelValue"],setup(n,{emit:t}){const e=Jt(),r=nt(),a=n,o=t,i=Be({get:()=>a.modelValue===a.dialogName,set:ie=>{ie||o("update:modelValue",null)}}),s=B([]),u=B([{value:"HIRE",label:"Hiring Rate"},{value:"PROMO",label:"Promotion Increase"},{value:"MERIT",label:"Merit Increase"},{value:"ANNUAL",label:"Annual Increase"},{value:"COLA",label:"Cost of Living Allowance"},{value:"PROB",label:"Probationary Increase"},{value:"ADJUST",label:"Salary Adjustment"},{value:"GOVT",label:"Government Mandated Increase"}]),l=B(["Monthly","Daily","Hourly"]),c=B(["Monthly","Semi-Monthly","Weekly"]),p=B(["S","ME","S1","S2","S3","S4","ME1","ME2","ME3","ME4","Z"]),f=B(["Regular","Probationary","Contractual","Temporary","Intern"]);function d(ie,ee="PHP"){return ie?ie.split("-").map(ue=>parseFloat(ue.replace(/,/g,"")).toLocaleString("en-PH",{style:"currency",currency:ee,minimumFractionDigits:2})).join(" - "):""}const h=async()=>{try{const ie=await Re.get("/salary/option/position");s.value=ie.data}catch(ie){console.error("Error fetching options:",ie)}},v=B(""),g=B(new Date().toISOString().split("T")[0]),m=B(""),x=B(""),y=B(""),w=B(""),E=B(""),D=B(""),k=B(""),S=B(""),_=B(!1),b=jt({datestart:{type:null,msg:""},dateend:{type:null,msg:""},salarygroup:{type:null,msg:""},salarytype:{type:null,msg:""},employmentstatus:{type:null,msg:""},amount:{type:null,msg:""},payrollgroup:{type:null,msg:""},taxstatus:{type:null,msg:""}}),N=()=>me.fire({icon:"error",html:`
        <div class="text-h6 text-bold text-uppercase">Request Failed</div>
        <div class="text-caption">Something went wrong.</div>
        `}),T=(ie,ee="required")=>(b[ie].type=!0,b[ie].msg=ee,!0),P=ie=>(b[ie].type=null,b[ie].msg="",!1),F=(ie,ee)=>ee?P(ie):T(ie,"required"),M=()=>{let ie=!1;return ie||=F("salarytype",y.value),ie||=F("datestart",g.value),ie||=m.value&&g.value&&new Date(m.value)<new Date(g.value)?T("dateend","must be after start date"):P("dateend"),ie||=F("salarygroup",x.value),ie||=!v.value&&(!k.value||isNaN(+k.value)||+k.value<=0)?T("amount",k.value?"invalid amount":"required"):P("amount"),ie||=F("employmentstatus",w.value),ie||=F("payrollgroup",E.value),ie||=F("taxstatus",D.value),ie&&N(),!ie},L=B(!1),A=()=>{const ie=r.data;h(),E.value=ie?.employment?.payroll_group,D.value=ie?.employment?.tax_status},$=async()=>{if(!(M&&!M())){L.value=!0;try{const ie=await Re.post(`/employee/${r.data?.employment?.id}/salary`,{positionid:v.value.id?v.value.id:r.data?.employment?.position?.id,salarytype:y.value,employmentstatus:w.value,datestart:g.value,dateend:m.value,salarygroup:x.value,amount:k.value,notes:S.value,payrollgroup:E.value,taxstatus:D.value,isPremium:_.value});o("update:modelValue",null),me.fire({icon:"success",html:`
                <div class="text-h6 text-bold text-uppercase">granted!</div>
                <div class="text-caption text-capitalize;">${ie.data.message}<div>
            `})}catch(ie){ie.response&&ie.response.data&&(q(ie.response.data),me.fire({icon:"error",html:`
                    <div class="text-h6 text-bold text-uppercase">Request Failed</div>
                    <div class="text-caption">Something went wrong.</div>
                `}))}finally{L.value=!1}}},q=ie=>{const ee=Array.isArray(ie)?ie:ie?.errors||[];Object.keys(b).forEach(ue=>{b[ue].type=null,b[ue].messages=[]}),ee.forEach(ue=>{b[ue.path]!==void 0&&(b[ue.path].type=!0,b[ue.path].messages.push(ue.msg))})},z=()=>{v.value="",g.value=new Date().toISOString().split("T")[0],m.value="",y.value="",x.value="",k.value="",S.value=""},K=()=>{Object.keys(b).forEach(ie=>{b[ie].type=null,b[ie].msg=""})},re=B(null),ae=B(""),Se=Be(()=>{const ie=ae.value.trim().toLowerCase();return s.value.filter(ee=>ee.status==="Vacant").filter(ee=>!ie||String(ee.label||"").toLowerCase().includes(ie))}),Ce=Be(()=>Se.value.slice(0,5)),Pe=Be(()=>Ce.value.length),Me=Be(()=>Se.value.length);return(ie,ee)=>(H(),pe(Ke,{modelValue:i.value,"onUpdate:modelValue":ee[19]||(ee[19]=ue=>i.value=ue),"full-height":"",position:"right",persistent:"",square:"",class:"dialog",onBeforeShow:ee[20]||(ee[20]=()=>{A(),z(),K()})},{default:R(()=>[C(_e,{class:"dialog-card column full-height"},{default:R(()=>[C(oe,{class:"q-pa-lg"},{default:R(()=>ee[21]||(ee[21]=[I("div",{class:"text-h6 text-uppercase"},"salary schedule",-1)])),_:1,__:[21]}),C(pt,{inset:""}),C(oe,{class:"col q-pa-lg scroll"},{default:R(()=>[I("div",ik,[ee[23]||(ee[23]=I("div",{class:"text-caption text-uppercase text-grey"},"position",-1)),I("div",sk,[I("div",uk,[Ce.value.length?we("",!0):(H(),pe(_e,{key:0,class:"card card-menu card-hover-animate flex column justify-center items-center no-shadow cursor-pointer radius-sm"},{default:R(()=>[C(oe,{class:"text-center"},{default:R(()=>ee[22]||(ee[22]=[I("div",{class:"text-caption text-dark text-uppercase"},"no record found",-1)])),_:1,__:[22]})]),_:1}))]),Ce.value.length?(H(!0),se(Ve,{key:0},We(Ce.value,(ue,Ie)=>(H(),se("div",{key:`data-${ue.id}`,class:"inner-card-anim-wrapper",style:dr({animationDelay:`${Ie*100}ms`})},[C(_e,{onClick:()=>{v.value=ue,y.value=ue.salary_type,k.value=ue.amount},class:ne(["card card-menu card-hover-animate flex column justify-center items-center no-shadow cursor-pointer radius-sm",{"card--active":v.value===ue}])},{default:R(()=>[C(oe,{class:"text-center"},{default:R(()=>[I("div",lk,X(ue.label),1),I("div",ck,X(d(ue?.amount)),1)]),_:2},1024),I("div",dk,[C(Ut,{modelValue:v.value,"onUpdate:modelValue":ee[0]||(ee[0]=$e=>v.value=$e),val:ue,"checked-icon":"bi-check-circle-fill","unchecked-icon":"bi-check-circle",size:"xs"},null,8,["modelValue","val"])])]),_:2},1032,["onClick","class"])],4))),128)):we("",!0)])]),I("div",pk,[I("div",{class:ne(["text-caption text-uppercase",b.salarytype.type?"text-negative text-italic":"text-grey"])},X(b.salarytype.type?b.salarytype.msg:"salary type"),3),I("div",fk,[(H(!0),se(Ve,null,We(l.value,ue=>(H(),pe(Ut,{modelValue:y.value,"onUpdate:modelValue":ee[1]||(ee[1]=Ie=>y.value=Ie),"checked-icon":"bi-check-circle-fill","unchecked-icon":"bi-check-circle",val:ue,label:ue},null,8,["modelValue","val","label"]))),256))])]),I("div",hk,[I("div",vk,[I("div",{class:ne(["text-caption text-uppercase",b.datestart.msg?"text-negative text-italic":"text-grey"])},X(b.datestart.msg?b.datestart.msg:"date start (YYYY-MM-DD)"),3),C(le,{outlined:"",modelValue:g.value,"onUpdate:modelValue":ee[4]||(ee[4]=ue=>g.value=ue),label:"Enter Date"},{default:R(()=>[C(Ft,{cover:"","transition-show":"scale","transition-hide":"scale",ref_key:"popup",ref:re,class:"no-shadow custom-border radius-sm"},{default:R(()=>[C(Mt,{modelValue:g.value,"onUpdate:modelValue":[ee[2]||(ee[2]=ue=>g.value=ue),ee[3]||(ee[3]=()=>{re.value.hide()})],mask:"YYYY-MM-DD"},null,8,["modelValue"])]),_:1},512)]),_:1},8,["modelValue"])]),I("div",mk,[I("div",{class:ne(["text-caption text-uppercase",b.dateend.msg?"text-negative text-italic":"text-grey"])},X(b.dateend.msg?b.dateend.msg:"date end (YYYY-MM-DD)"),3),C(le,{outlined:"",modelValue:m.value,"onUpdate:modelValue":ee[7]||(ee[7]=ue=>m.value=ue),label:"Enter Date"},{default:R(()=>[C(Ft,{cover:"","transition-show":"scale","transition-hide":"scale",ref_key:"popup",ref:re,class:"no-shadow custom-border radius-sm"},{default:R(()=>[C(Mt,{modelValue:m.value,"onUpdate:modelValue":[ee[5]||(ee[5]=ue=>m.value=ue),ee[6]||(ee[6]=()=>{re.value.hide()})],mask:"YYYY-MM-DD"},null,8,["modelValue"])]),_:1},512)]),_:1},8,["modelValue"])]),I("div",gk,[I("div",{class:ne(["text-caption text-uppercase",b.salarygroup.msg?"text-negative text-italic":"text-grey"])},X(b.salarygroup.msg?b.salarygroup.msg:"salary group"),3),C(An,{outlined:"",modelValue:x.value,"onUpdate:modelValue":ee[8]||(ee[8]=ue=>x.value=ue),label:"Choose Salary Group","emit-value":"","map-options":"","use-input":"","input-debounce":"300",options:u.value,error:b.salarygroup.type,"hide-dropdown-icon":"","no-error-icon":!0,class:"text-capitalize"},{"no-option":R(()=>[C(lt,null,{default:R(()=>[C(ct,{class:"text-italic text-grey"},{default:R(()=>ee[24]||(ee[24]=[Ye(" No options ")])),_:1,__:[24]})]),_:1})]),option:R(ue=>[C(lt,Ja(Qa(ue.itemProps)),{default:R(()=>[C(ct,null,{default:R(()=>[C(Rn,null,{default:R(()=>[Ye(X(ie.$CapitalizeWords(ue.opt.label)),1)]),_:2},1024)]),_:2},1024)]),_:2},1040)]),_:1},8,["modelValue","options","error"])]),v.value?we("",!0):(H(),se("div",yk,[I("div",{class:ne(["text-caption text-uppercase",b.amount.type?"text-negative text-italic":"text-grey"])},X(b.amount.type?b.amount.msg:"amount"),3),C(le,{modelValue:k.value,"onUpdate:modelValue":ee[9]||(ee[9]=ue=>k.value=ue),label:"Enter Amount",outlined:"",error:b.amount.type,"no-error-icon":!0},null,8,["modelValue","error"])])),I("div",xk,[ee[25]||(ee[25]=I("div",{class:"text-caption text-uppercase text-grey"},"note",-1)),C(le,{modelValue:S.value,"onUpdate:modelValue":ee[10]||(ee[10]=ue=>S.value=ue),label:"Enter Notes",outlined:"","no-error-icon":!0},null,8,["modelValue"])])]),I("div",bk,[I("div",{class:ne(["text-caption text-uppercase",b.employmentstatus.type?"text-negative text-italic":"text-grey"])},X(b.employmentstatus.type?b.employmentstatus.msg:"employment status"),3),I("div",_k,[(H(!0),se(Ve,null,We(f.value,ue=>(H(),pe(Ut,{modelValue:w.value,"onUpdate:modelValue":ee[11]||(ee[11]=Ie=>w.value=Ie),"checked-icon":"bi-check-circle-fill","unchecked-icon":"bi-check-circle",val:ue,label:ue,class:"text-capitalize"},null,8,["modelValue","val","label"]))),256))])]),I("div",wk,[I("div",{class:ne(["text-caption text-uppercase",b.payrollgroup.type?"text-negative text-italic":"text-grey"])},X(b.payrollgroup.type?b.payrollgroup.msg:"payroll group"),3),I("div",Ek,[(H(!0),se(Ve,null,We(c.value,ue=>(H(),pe(Ut,{modelValue:E.value,"onUpdate:modelValue":ee[12]||(ee[12]=Ie=>E.value=Ie),"checked-icon":"bi-check-circle-fill","unchecked-icon":"bi-check-circle",val:ue,label:ue,class:"text-capitalize"},null,8,["modelValue","val","label"]))),256))])]),I("div",Sk,[I("div",Ck,[I("div",{class:ne(["text-caption text-uppercase",b.taxstatus.type?"text-negative text-italic":"text-grey"])},X(b.taxstatus.type?b.taxstatus.msg:"tax status"),3),C(An,{outlined:"",modelValue:D.value,"onUpdate:modelValue":ee[13]||(ee[13]=ue=>D.value=ue),label:"Choose Tax Status","use-input":"","input-debounce":"300",options:p.value,error:b.taxstatus.type,"hide-dropdown-icon":"","no-error-icon":!0,class:"text-capitalize"},{"no-option":R(()=>[C(lt,null,{default:R(()=>[C(ct,{class:"text-italic text-grey"},{default:R(()=>ee[26]||(ee[26]=[Ye(" No options ")])),_:1,__:[26]})]),_:1})]),option:R(ue=>[C(lt,Ja(Qa(ue.itemProps)),{default:R(()=>[C(ct,null,{default:R(()=>[C(Rn,null,{default:R(()=>[Ye(X(ie.$CapitalizeWords(ue.opt)),1)]),_:2},1024)]),_:2},1024)]),_:2},1040)]),_:1},8,["modelValue","options","error"])])]),I("div",Ik,[ee[27]||(ee[27]=I("div",{class:"text-caption text-uppercase text-grey'"},"for premium payment",-1)),I("div",Dk,[C(Pd,{modelValue:_.value,"onUpdate:modelValue":ee[14]||(ee[14]=ue=>_.value=ue),"checked-icon":"bi-check-circle-fill","unchecked-icon":"bi-check-circle",label:"Additional Pay"},null,8,["modelValue"])])])]),_:1}),C(ft,{class:"q-pa-lg bg"},{default:R(()=>[I("div",kk,[ke(e).hasRole(["SuperAdmin","Admin","HR"])?(H(),pe(de,{key:0,unelevated:"",size:"md",color:"primary",class:"btn text-capitalize",label:"save",onClick:ee[15]||(ee[15]=ue=>$())})):we("",!0),C(de,{unelevated:"",size:"md",color:"primary",class:"btn text-capitalize",label:"clear",onClick:ee[16]||(ee[16]=()=>{z()}),outline:""}),C(de,{unelevated:"",size:"md",color:"primary",class:"btn text-capitalize",label:"discard",onClick:ee[17]||(ee[17]=()=>{o("update:modelValue",null)}),outline:""}),C(le,{outlined:"",dense:"",debounce:"1000",modelValue:ae.value,"onUpdate:modelValue":ee[18]||(ee[18]=ue=>ae.value=ue),placeholder:"Search..."},{prepend:R(()=>[C(ro,{name:"bi-search",style:{"font-size":"1rem"}})]),after:R(()=>[I("div",Tk,X(Pe.value)+" of "+X(Me.value),1)]),_:1},8,["modelValue"])])]),_:1}),C(ht,{showing:L.value},{default:R(()=>[C(_e,{class:"no-shadow radius-md q-pa-md"},{default:R(()=>[C(oe,{class:"text-center"},{default:R(()=>[I("div",null,[C(an,{color:"dark"})]),ee[28]||(ee[28]=I("div",{class:"text-dark text-uppercase text-caption"},"we're working on it!",-1))]),_:1,__:[28]})]),_:1})]),_:1},8,["showing"])]),_:1})]),_:1},8,["modelValue"]))}},Rk=Kn(Nk,[["__scopeId","data-v-ca1546de"]]),Ak={class:"text-uppercase text-body1 text-bold"},Pk={class:"q-mb-md"},Ok={class:"row q-col-gutter-xs q-mb-sm"},Mk={class:"col-2"},Fk={class:"col-2"},Vk={class:"q-mb-md"},Lk={class:"q-gutter-sm"},Bk={__name:"AccountDialog",props:{modelValue:String,dialogName:String},emits:["update:modelValue"],setup(n,{emit:t}){const e=Jt(),r=nt(),a=n,o=t,i=Be({get:()=>a.modelValue===a.dialogName,set:S=>{S||o("update:modelValue",null)}}),s=B(!1),u=B(!1),l=B([{id:"",employeeid:"",username:"",password:"",role:"",status:""}]),c=()=>({id:"",employeeid:"",username:"",password:"",role:"",status:""}),p=async S=>{u.value=!0;try{const _=await Re.get("/employee/account",{params:{id:S}});_.data.record.length?f(_.data.record):c()}catch(_){console.error("Error fetching all data:",_),me.fire({icon:"error",html:`
                <div class="text-h6 text-bold text-uppercase">Error</div>
                <div class="text-caption text-capitalize;">Unable to fetch records</div>
            `})}finally{u.value=!1}},f=(S=[])=>{l.value=S.map(_=>({id:_.id??"",username:_.user?.username??"",role:_.user?.role??"",status:_.user?.status??""}))},d=()=>{p(r.data?.id),l.value=[{id:"",employeeid:"",username:"",password:"",role:"",status:""}],l.value.length||c()},h=jt({accounts:{username:{type:[],msg:""},password:{type:[],msg:""},role:{type:[],msg:""},status:{type:[],msg:""}}}),v=()=>{h.accounts.username.type=l.value.map(()=>null),h.accounts.password.type=l.value.map(()=>null),h.accounts.role.type=l.value.map(()=>null),h.accounts.status.type=l.value.map(()=>null)},g=()=>{let S=!1;return h.accounts.username={type:null,msg:""},h.accounts.password={type:null,msg:""},h.accounts.role={type:null,msg:""},h.accounts.status={type:null,msg:""},v(),l.value.forEach((_,b)=>{_.username||(h.accounts.username.type[b]=!0,h.accounts.username.msg="username is required",S=!0),_.id||_.password||(h.accounts.password.type[b]=!0,h.accounts.password.msg="password is required",S=!0),_.role||(h.accounts.role.type[b]=!0,h.accounts.role.msg="role is required",S=!0),_.status||(h.accounts.status.type[b]=!0,h.accounts.status.msg="status is required",S=!0)}),S&&me.fire({icon:"error",html:`
                <div class="text-h6 text-bold text-uppercase">Request Failed</div>
                <div class="text-caption">Something went wrong.</div>
            `}),!S},m=B([{value:"SuperAdmin",label:"Super Administrator"},{value:"Admin",label:"Administrator"},{value:"Management",label:"Management"},{value:"HR",label:"HR"},{value:"Finance",label:"Finance"},{value:"Employee",label:"Employee"}]),x=B(["Active","Inactive","Suspended"]),y=()=>{l.value.push({id:"",employeeid:"",username:"",password:"",role:"",status:""})},w=S=>{l.value.splice(S,1)},E=async()=>{if(g()){u.value=!0;try{const S=await Re.post(`/employee/${r.data?.id}/account`,{accounts:l.value});o("update:modelValue",null),me.fire({icon:"success",html:`
                <div class="text-h6 text-bold text-uppercase">granted!</div>
                <div class="text-caption text-capitalize;">${S.data.message}<div>
            `})}catch(S){S.response&&S.response.data&&(D(S.response.data),me.fire({icon:"error",html:`
                    <div class="text-h6 text-bold text-uppercase">Request Failed</div>
                    <div class="text-caption">Something went wrong.</div>
                `}))}finally{u.value=!1}}},D=S=>{const _=Array.isArray(S)?S:S?.errors||[];Object.keys(h).forEach(b=>{h[b].type=null,h[b].messages=[]}),_.forEach(b=>{h[b.path]!==void 0&&(h[b.path].type=!0,h[b.path].messages.push(b.msg))})},k=S=>["SuperAdmin"].includes(S);return(S,_)=>(H(),pe(Ke,{modelValue:i.value,"onUpdate:modelValue":_[3]||(_[3]=b=>i.value=b),"full-height":"",position:"right",persistent:"",square:"",class:"dialog",onBeforeShow:_[4]||(_[4]=b=>d())},{default:R(()=>[C(_e,{class:"dialog-card column full-height"},{default:R(()=>[C(oe,{class:"q-pa-lg"},{default:R(()=>_[5]||(_[5]=[I("div",{class:"text-h6 text-uppercase"},"employee account",-1)])),_:1,__:[5]}),C(pt,{inset:""}),C(oe,{class:"col q-pa-lg scroll"},{default:R(()=>[(H(!0),se(Ve,null,We(l.value,(b,N)=>(H(),se("div",{key:N,class:"q-mb-md"},[I("div",null,[I("span",Ak,"account "+X(N+1),1),l.value.length>1&&ke(e).hasRole(["SuperAdmin","Admin","HR"])?(H(),pe(de,{key:0,round:"",icon:"bi-trash3",flat:"",unelevated:"",color:"grey",onClick:T=>w(N),size:"sm",class:"q-ml-sm"},null,8,["onClick"])):we("",!0)]),I("div",Pk,[I("div",{class:ne(["text-caption text-uppercase",h.accounts.role.msg?"text-negative text-italic":"text-grey"])},X(h.accounts.role.msg?h.accounts.role.msg:"role"),3),(H(!0),se(Ve,null,We(m.value,(T,P)=>(H(),pe(Ut,{modelValue:b.role,"onUpdate:modelValue":F=>b.role=F,"checked-icon":"bi-check-circle-fill","unchecked-icon":"bi-check-circle",val:T.value,label:T.label,class:"text-uppercase",disable:k(T.value)},null,8,["modelValue","onUpdate:modelValue","val","label","disable"]))),256))]),I("div",Ok,[I("div",Mk,[I("div",{class:ne(["text-caption text-uppercase",h.accounts.username.msg?"text-negative text-italic":"text-grey"])},X(h.accounts.username.msg?h.accounts.username.msg:"username"),3),C(le,{modelValue:b.username,"onUpdate:modelValue":T=>b.username=T,label:"Enter Username",outlined:"",error:h.accounts.username.type[N],"no-error-icon":!0},null,8,["modelValue","onUpdate:modelValue","error"])]),I("div",Fk,[I("div",{class:ne(["text-caption text-uppercase",h.accounts.password.msg?"text-negative text-italic":"text-grey"])},X(h.accounts.password.msg?h.accounts.password.msg:"password"),3),C(le,{modelValue:b.password,"onUpdate:modelValue":T=>b.password=T,label:"Enter Password",outlined:"",error:h.accounts.password.type[N],"no-error-icon":!0,type:s.value?"text":"password"},{append:R(()=>[C(ro,{name:s.value?"bi-eye":"bi-eye-slash",class:"cursor-pointer",onClick:_[0]||(_[0]=T=>s.value=!s.value),style:{"font-size":"1rem"}},null,8,["name"])]),_:2},1032,["modelValue","onUpdate:modelValue","error","type"])])]),I("div",Vk,[I("div",{class:ne(["text-caption text-uppercase",h.accounts.status.msg?"text-negative text-italic":"text-grey"])},X(h.accounts.status.msg?h.accounts.status.msg:"status"),3),(H(!0),se(Ve,null,We(x.value,(T,P)=>(H(),pe(Ut,{modelValue:b.status,"onUpdate:modelValue":F=>b.status=F,"checked-icon":"bi-check-circle-fill","unchecked-icon":"bi-check-circle",val:T,label:T,class:"text-uppercase",disable:k(T)},null,8,["modelValue","onUpdate:modelValue","val","label","disable"]))),256))])]))),128))]),_:1}),C(ft,{class:"q-pa-lg bg"},{default:R(()=>[I("div",Lk,[ke(e).hasRole(["SuperAdmin","Admin","HR"])?(H(),pe(de,{key:0,unelevated:"",size:"md",color:"primary",class:"btn text-capitalize",label:"save",onClick:_[1]||(_[1]=b=>E())})):we("",!0),ke(e).hasRole(["SuperAdmin","Admin","HR"])?(H(),pe(de,{key:1,unelevated:"",size:"md",color:"primary",class:"btn text-capitalize",label:"add",onClick:y,outline:""})):we("",!0),C(de,{unelevated:"",size:"md",color:"primary",class:"btn text-capitalize",label:"discard",onClick:_[2]||(_[2]=()=>{o("update:modelValue",null)}),outline:""})])]),_:1}),C(ht,{showing:u.value},{default:R(()=>[C(_e,{class:"no-shadow radius-md q-pa-md"},{default:R(()=>[C(oe,{class:"text-center"},{default:R(()=>[I("div",null,[C(an,{color:"dark"})]),_[6]||(_[6]=I("div",{class:"text-dark text-uppercase text-caption"},"we're working on it!",-1))]),_:1,__:[6]})]),_:1})]),_:1},8,["showing"])]),_:1})]),_:1},8,["modelValue"]))}};/*!
 * Signature Pad v5.1.3 | https://github.com/szimek/signature_pad
 * (c) 2025 Szymon Nowak | Released under the MIT license
 */var Vi=class{x;y;pressure;time;constructor(n,t,e,r){if(isNaN(n)||isNaN(t))throw new Error(`Point is invalid: (${n}, ${t})`);this.x=+n,this.y=+t,this.pressure=e||0,this.time=r||Date.now()}distanceTo(n){return Math.sqrt(Math.pow(this.x-n.x,2)+Math.pow(this.y-n.y,2))}equals(n){return this.x===n.x&&this.y===n.y&&this.pressure===n.pressure&&this.time===n.time}velocityFrom(n){return this.time!==n.time?this.distanceTo(n)/(this.time-n.time):0}},Uk=class ev{constructor(t,e,r,a,o,i){this.startPoint=t,this.control2=e,this.control1=r,this.endPoint=a,this.startWidth=o,this.endWidth=i}static fromPoints(t,e){const r=this.calculateControlPoints(t[0],t[1],t[2]).c2,a=this.calculateControlPoints(t[1],t[2],t[3]).c1;return new ev(t[1],r,a,t[2],e.start,e.end)}static calculateControlPoints(t,e,r){const a=t.x-e.x,o=t.y-e.y,i=e.x-r.x,s=e.y-r.y,u={x:(t.x+e.x)/2,y:(t.y+e.y)/2},l={x:(e.x+r.x)/2,y:(e.y+r.y)/2},c=Math.sqrt(a*a+o*o),p=Math.sqrt(i*i+s*s),f=u.x-l.x,d=u.y-l.y,h=c+p==0?0:p/(c+p),v={x:l.x+f*h,y:l.y+d*h},g=e.x-v.x,m=e.y-v.y;return{c1:new Vi(u.x+g,u.y+m),c2:new Vi(l.x+g,l.y+m)}}length(){let e=0,r,a;for(let o=0;o<=10;o+=1){const i=o/10,s=this.point(i,this.startPoint.x,this.control1.x,this.control2.x,this.endPoint.x),u=this.point(i,this.startPoint.y,this.control1.y,this.control2.y,this.endPoint.y);if(o>0){const l=s-r,c=u-a;e+=Math.sqrt(l*l+c*c)}r=s,a=u}return e}point(t,e,r,a,o){return e*(1-t)*(1-t)*(1-t)+3*r*(1-t)*(1-t)*t+3*a*(1-t)*t*t+o*t*t*t}},Wk=class{_et;constructor(){try{this._et=new EventTarget}catch{this._et=document}}addEventListener(n,t,e){this._et.addEventListener(n,t,e)}dispatchEvent(n){return this._et.dispatchEvent(n)}removeEventListener(n,t,e){this._et.removeEventListener(n,t,e)}};function qk(n,t=250){let e=0,r=null,a,o,i;const s=()=>{e=Date.now(),r=null,a=n.apply(o,i),r||(o=null,i=[])};return function(...l){const c=Date.now(),p=t-(c-e);return o=this,i=l,p<=0||p>t?(r&&(clearTimeout(r),r=null),e=c,a=n.apply(o,i),r||(o=null,i=[])):r||(r=window.setTimeout(s,p)),a}}var zk=class Eu extends Wk{constructor(t,e={}){super(),this.canvas=t,this.velocityFilterWeight=e.velocityFilterWeight||.7,this.minWidth=e.minWidth||.5,this.maxWidth=e.maxWidth||2.5,this.throttle=e.throttle??16,this.minDistance=e.minDistance??5,this.dotSize=e.dotSize||0,this.penColor=e.penColor||"black",this.backgroundColor=e.backgroundColor||"rgba(0,0,0,0)",this.compositeOperation=e.compositeOperation||"source-over",this.canvasContextOptions=e.canvasContextOptions??{},this._strokeMoveUpdate=this.throttle?qk(Eu.prototype._strokeUpdate,this.throttle):Eu.prototype._strokeUpdate,this._handleMouseDown=this._handleMouseDown.bind(this),this._handleMouseMove=this._handleMouseMove.bind(this),this._handleMouseUp=this._handleMouseUp.bind(this),this._handleTouchStart=this._handleTouchStart.bind(this),this._handleTouchMove=this._handleTouchMove.bind(this),this._handleTouchEnd=this._handleTouchEnd.bind(this),this._handlePointerDown=this._handlePointerDown.bind(this),this._handlePointerMove=this._handlePointerMove.bind(this),this._handlePointerUp=this._handlePointerUp.bind(this),this._handlePointerCancel=this._handlePointerCancel.bind(this),this._handleTouchCancel=this._handleTouchCancel.bind(this),this._ctx=t.getContext("2d",this.canvasContextOptions),this.clear(),this.on()}dotSize;minWidth;maxWidth;penColor;minDistance;velocityFilterWeight;compositeOperation;backgroundColor;throttle;canvasContextOptions;_ctx;_drawingStroke=!1;_isEmpty=!0;_dataUrl;_dataUrlOptions;_lastPoints=[];_data=[];_lastVelocity=0;_lastWidth=0;_strokeMoveUpdate;_strokePointerId;clear(){const{_ctx:t,canvas:e}=this;t.fillStyle=this.backgroundColor,t.clearRect(0,0,e.width,e.height),t.fillRect(0,0,e.width,e.height),this._data=[],this._reset(this._getPointGroupOptions()),this._isEmpty=!0,this._dataUrl=void 0,this._dataUrlOptions=void 0,this._strokePointerId=void 0}redraw(){const t=this._data,e=this._dataUrl,r=this._dataUrlOptions;this.clear(),e&&this.fromDataURL(e,r),this.fromData(t,{clear:!1})}fromDataURL(t,e={}){return new Promise((r,a)=>{const o=new Image,i=e.ratio||window.devicePixelRatio||1,s=e.width||this.canvas.width/i,u=e.height||this.canvas.height/i,l=e.xOffset||0,c=e.yOffset||0;this._reset(this._getPointGroupOptions()),o.onload=()=>{this._ctx.drawImage(o,l,c,s,u),r()},o.onerror=p=>{a(p)},o.crossOrigin="anonymous",o.src=t,this._isEmpty=!1,this._dataUrl=t,this._dataUrlOptions={...e}})}toDataURL(t="image/png",e){switch(t){case"image/svg+xml":return typeof e!="object"&&(e=void 0),`data:image/svg+xml;base64,${btoa(this.toSVG(e))}`;default:return typeof e!="number"&&(e=void 0),this.canvas.toDataURL(t,e)}}on(){this.canvas.style.touchAction="none",this.canvas.style.msTouchAction="none",this.canvas.style.userSelect="none",this.canvas.style.webkitUserSelect="none";const t=/Macintosh/.test(navigator.userAgent)&&"ontouchstart"in document;window.PointerEvent&&!t?this._handlePointerEvents():(this._handleMouseEvents(),"ontouchstart"in window&&this._handleTouchEvents())}off(){this.canvas.style.touchAction="auto",this.canvas.style.msTouchAction="auto",this.canvas.style.userSelect="auto",this.canvas.style.webkitUserSelect="auto",this.canvas.removeEventListener("pointerdown",this._handlePointerDown),this.canvas.removeEventListener("mousedown",this._handleMouseDown),this.canvas.removeEventListener("touchstart",this._handleTouchStart),this._removeMoveUpEventListeners()}_getListenerFunctions(){const t=window.document===this.canvas.ownerDocument?window:this.canvas.ownerDocument.defaultView??this.canvas.ownerDocument;return{addEventListener:t.addEventListener.bind(t),removeEventListener:t.removeEventListener.bind(t)}}_removeMoveUpEventListeners(){const{removeEventListener:t}=this._getListenerFunctions();t("pointermove",this._handlePointerMove),t("pointerup",this._handlePointerUp),t("pointercancel",this._handlePointerCancel),t("mousemove",this._handleMouseMove),t("mouseup",this._handleMouseUp),t("touchmove",this._handleTouchMove),t("touchend",this._handleTouchEnd),t("touchcancel",this._handleTouchCancel)}isEmpty(){return this._isEmpty}fromData(t,{clear:e=!0}={}){e&&this.clear(),this._fromData(t,this._drawCurve.bind(this),this._drawDot.bind(this)),this._data=this._data.concat(t)}toData(){return this._data}_isLeftButtonPressed(t,e){return e?t.buttons===1:(t.buttons&1)===1}_pointerEventToSignatureEvent(t){return{event:t,type:t.type,x:t.clientX,y:t.clientY,pressure:"pressure"in t?t.pressure:0}}_touchEventToSignatureEvent(t){const e=t.changedTouches[0];return{event:t,type:t.type,x:e.clientX,y:e.clientY,pressure:e.force}}_handleMouseDown(t){!this._isLeftButtonPressed(t,!0)||this._drawingStroke||this._strokeBegin(this._pointerEventToSignatureEvent(t))}_handleMouseMove(t){if(!this._isLeftButtonPressed(t,!0)||!this._drawingStroke){this._strokeEnd(this._pointerEventToSignatureEvent(t),!1);return}this._strokeMoveUpdate(this._pointerEventToSignatureEvent(t))}_handleMouseUp(t){this._isLeftButtonPressed(t)||this._strokeEnd(this._pointerEventToSignatureEvent(t))}_handleTouchStart(t){t.targetTouches.length!==1||this._drawingStroke||(t.cancelable&&t.preventDefault(),this._strokeBegin(this._touchEventToSignatureEvent(t)))}_handleTouchMove(t){if(t.targetTouches.length===1){if(t.cancelable&&t.preventDefault(),!this._drawingStroke){this._strokeEnd(this._touchEventToSignatureEvent(t),!1);return}this._strokeMoveUpdate(this._touchEventToSignatureEvent(t))}}_handleTouchEnd(t){t.targetTouches.length===0&&(t.cancelable&&t.preventDefault(),this._strokeEnd(this._touchEventToSignatureEvent(t)))}_handlePointerCancel(t){this._allowPointerId(t)&&(t.preventDefault(),this._strokeEnd(this._pointerEventToSignatureEvent(t),!1))}_handleTouchCancel(t){t.cancelable&&t.preventDefault(),this._strokeEnd(this._touchEventToSignatureEvent(t),!1)}_getPointerId(t){return t.persistentDeviceId||t.pointerId}_allowPointerId(t,e=!1){return typeof this._strokePointerId>"u"?e:this._getPointerId(t)===this._strokePointerId}_handlePointerDown(t){this._drawingStroke||!this._isLeftButtonPressed(t)||!this._allowPointerId(t,!0)||(this._strokePointerId=this._getPointerId(t),t.preventDefault(),this._strokeBegin(this._pointerEventToSignatureEvent(t)))}_handlePointerMove(t){if(this._allowPointerId(t)){if(!this._isLeftButtonPressed(t,!0)||!this._drawingStroke){this._strokeEnd(this._pointerEventToSignatureEvent(t),!1);return}t.preventDefault(),this._strokeMoveUpdate(this._pointerEventToSignatureEvent(t))}}_handlePointerUp(t){this._isLeftButtonPressed(t)||!this._allowPointerId(t)||(t.preventDefault(),this._strokeEnd(this._pointerEventToSignatureEvent(t)))}_getPointGroupOptions(t){return{penColor:t&&"penColor"in t?t.penColor:this.penColor,dotSize:t&&"dotSize"in t?t.dotSize:this.dotSize,minWidth:t&&"minWidth"in t?t.minWidth:this.minWidth,maxWidth:t&&"maxWidth"in t?t.maxWidth:this.maxWidth,velocityFilterWeight:t&&"velocityFilterWeight"in t?t.velocityFilterWeight:this.velocityFilterWeight,compositeOperation:t&&"compositeOperation"in t?t.compositeOperation:this.compositeOperation}}_strokeBegin(t){if(!this.dispatchEvent(new CustomEvent("beginStroke",{detail:t,cancelable:!0})))return;const{addEventListener:r}=this._getListenerFunctions();switch(t.event.type){case"mousedown":r("mousemove",this._handleMouseMove,{passive:!1}),r("mouseup",this._handleMouseUp,{passive:!1});break;case"touchstart":r("touchmove",this._handleTouchMove,{passive:!1}),r("touchend",this._handleTouchEnd,{passive:!1}),r("touchcancel",this._handleTouchCancel,{passive:!1});break;case"pointerdown":r("pointermove",this._handlePointerMove,{passive:!1}),r("pointerup",this._handlePointerUp,{passive:!1}),r("pointercancel",this._handlePointerCancel,{passive:!1});break}this._drawingStroke=!0;const a=this._getPointGroupOptions(),o={...a,points:[]};this._data.push(o),this._reset(a),this._strokeUpdate(t)}_strokeUpdate(t){if(!this._drawingStroke)return;if(this._data.length===0){this._strokeBegin(t);return}this.dispatchEvent(new CustomEvent("beforeUpdateStroke",{detail:t}));const e=this._createPoint(t.x,t.y,t.pressure),r=this._data[this._data.length-1],a=r.points,o=a.length>0&&a[a.length-1],i=o?e.distanceTo(o)<=this.minDistance:!1,s=this._getPointGroupOptions(r);if(!o||!(o&&i)){const u=this._addPoint(e,s);o?u&&this._drawCurve(u,s):this._drawDot(e,s),a.push({time:e.time,x:e.x,y:e.y,pressure:e.pressure})}this.dispatchEvent(new CustomEvent("afterUpdateStroke",{detail:t}))}_strokeEnd(t,e=!0){this._removeMoveUpEventListeners(),this._drawingStroke&&(e&&this._strokeUpdate(t),this._drawingStroke=!1,this._strokePointerId=void 0,this.dispatchEvent(new CustomEvent("endStroke",{detail:t})))}_handlePointerEvents(){this._drawingStroke=!1,this.canvas.addEventListener("pointerdown",this._handlePointerDown,{passive:!1})}_handleMouseEvents(){this._drawingStroke=!1,this.canvas.addEventListener("mousedown",this._handleMouseDown,{passive:!1})}_handleTouchEvents(){this.canvas.addEventListener("touchstart",this._handleTouchStart,{passive:!1})}_reset(t){this._lastPoints=[],this._lastVelocity=0,this._lastWidth=(t.minWidth+t.maxWidth)/2,this._ctx.fillStyle=t.penColor,this._ctx.globalCompositeOperation=t.compositeOperation}_createPoint(t,e,r){const a=this.canvas.getBoundingClientRect();return new Vi(t-a.left,e-a.top,r,new Date().getTime())}_addPoint(t,e){const{_lastPoints:r}=this;if(r.push(t),r.length>2){r.length===3&&r.unshift(r[0]);const a=this._calculateCurveWidths(r[1],r[2],e),o=Uk.fromPoints(r,a);return r.shift(),o}return null}_calculateCurveWidths(t,e,r){const a=r.velocityFilterWeight*e.velocityFrom(t)+(1-r.velocityFilterWeight)*this._lastVelocity,o=this._strokeWidth(a,r),i={end:o,start:this._lastWidth};return this._lastVelocity=a,this._lastWidth=o,i}_strokeWidth(t,e){return Math.max(e.maxWidth/(t+1),e.minWidth)}_drawCurveSegment(t,e,r){const a=this._ctx;a.moveTo(t,e),a.arc(t,e,r,0,2*Math.PI,!1),this._isEmpty=!1}_drawCurve(t,e){const r=this._ctx,a=t.endWidth-t.startWidth,o=Math.ceil(t.length())*2;r.beginPath(),r.fillStyle=e.penColor;for(let i=0;i<o;i+=1){const s=i/o,u=s*s,l=u*s,c=1-s,p=c*c,f=p*c;let d=f*t.startPoint.x;d+=3*p*s*t.control1.x,d+=3*c*u*t.control2.x,d+=l*t.endPoint.x;let h=f*t.startPoint.y;h+=3*p*s*t.control1.y,h+=3*c*u*t.control2.y,h+=l*t.endPoint.y;const v=Math.min(t.startWidth+l*a,e.maxWidth);this._drawCurveSegment(d,h,v)}r.closePath(),r.fill()}_drawDot(t,e){const r=this._ctx,a=e.dotSize>0?e.dotSize:(e.minWidth+e.maxWidth)/2;r.beginPath(),this._drawCurveSegment(t.x,t.y,a),r.closePath(),r.fillStyle=e.penColor,r.fill()}_fromData(t,e,r){for(const a of t){const{points:o}=a,i=this._getPointGroupOptions(a);if(o.length>1)for(let s=0;s<o.length;s+=1){const u=o[s],l=new Vi(u.x,u.y,u.pressure,u.time);s===0&&this._reset(i);const c=this._addPoint(l,i);c&&e(c,i)}else this._reset(i),r(o[0],i)}}toSVG({includeBackgroundColor:t=!1,includeDataUrl:e=!1}={}){const r=this._data,a=Math.max(window.devicePixelRatio||1,1),o=0,i=0,s=this.canvas.width/a,u=this.canvas.height/a,l=document.createElementNS("http://www.w3.org/2000/svg","svg");if(l.setAttribute("xmlns","http://www.w3.org/2000/svg"),l.setAttribute("xmlns:xlink","http://www.w3.org/1999/xlink"),l.setAttribute("viewBox",`${o} ${i} ${s} ${u}`),l.setAttribute("width",s.toString()),l.setAttribute("height",u.toString()),t&&this.backgroundColor){const c=document.createElement("rect");c.setAttribute("width","100%"),c.setAttribute("height","100%"),c.setAttribute("fill",this.backgroundColor),l.appendChild(c)}if(e&&this._dataUrl){const c=this._dataUrlOptions?.ratio||window.devicePixelRatio||1,p=this._dataUrlOptions?.width||this.canvas.width/c,f=this._dataUrlOptions?.height||this.canvas.height/c,d=this._dataUrlOptions?.xOffset||0,h=this._dataUrlOptions?.yOffset||0,v=document.createElement("image");v.setAttribute("x",d.toString()),v.setAttribute("y",h.toString()),v.setAttribute("width",p.toString()),v.setAttribute("height",f.toString()),v.setAttribute("preserveAspectRatio","none"),v.setAttribute("href",this._dataUrl),l.appendChild(v)}return this._fromData(r,(c,{penColor:p})=>{const f=document.createElement("path");if(!isNaN(c.control1.x)&&!isNaN(c.control1.y)&&!isNaN(c.control2.x)&&!isNaN(c.control2.y)){const d=`M ${c.startPoint.x.toFixed(3)},${c.startPoint.y.toFixed(3)} C ${c.control1.x.toFixed(3)},${c.control1.y.toFixed(3)} ${c.control2.x.toFixed(3)},${c.control2.y.toFixed(3)} ${c.endPoint.x.toFixed(3)},${c.endPoint.y.toFixed(3)}`;f.setAttribute("d",d),f.setAttribute("stroke-width",(c.endWidth*2.25).toFixed(3)),f.setAttribute("stroke",p),f.setAttribute("fill","none"),f.setAttribute("stroke-linecap","round"),l.appendChild(f)}},(c,{penColor:p,dotSize:f,minWidth:d,maxWidth:h})=>{const v=document.createElement("circle"),g=f>0?f:(d+h)/2;v.setAttribute("r",g.toString()),v.setAttribute("cx",c.x.toString()),v.setAttribute("cy",c.y.toString()),v.setAttribute("fill",p),l.appendChild(v)}),l.outerHTML}};const $k={class:"row q-col-gutter-md"},Hk={class:"col-3"},Gk={class:"q-mb-lg"},jk={key:0,class:"text-body1 text-capitalize text-grey"},Xk=["src"],Yk={key:2,class:"text-body1 text-capitalize text-grey"},Kk={class:"col"},Jk={class:"q-gutter-sm"},Qk={__name:"SignatureDialog",props:{modelValue:String,dialogName:String},emits:["update:modelValue","saved"],setup(n,{emit:t}){const e=Jt(),r=nt(),a=n,o=t,i=Be({get:()=>a.modelValue===a.dialogName,set:b=>{b||o("update:modelValue",null)}}),s=B(!1),u=B(null),l=async b=>{s.value=!0;try{const N=await Re.get("/employee/signature",{params:{id:b}});u.value=N.data.record.signature}catch(N){console.error("Error fetching all data:",N),me.fire({icon:"error",html:`
                <div class="text-h6 text-bold text-uppercase">Error</div>
                <div class="text-caption text-capitalize;">${N.response.data.message}</div>
            `})}finally{s.value=!1}},c=()=>{l(r.data?.id)},p=B(""),f=()=>{p.value=""},d=jt({file:{type:null,msg:""}}),h=()=>{let b=!1;return(!y||y.isEmpty())&&(d.file.type=!0,d.file.msg="required",b=!0),b&&me.fire({icon:"error",html:`
                <div class="text-h6 text-bold text-uppercase">Request Failed</div>
                <div class="text-caption">Something went wrong.</div>
            `}),!b},v=async()=>{if(!h())return;const b=y.toDataURL("image/png"),N=_(b);s.value=!0;try{const T=new FormData;T.append("file",N);const P=await Re.post(`/employee/${r.data?.id}/signature`,T,{headers:{"Content-Type":"multipart/form-data"}});o("saved"),o("update:modelValue",null),me.fire({icon:"success",html:`
                <div class="text-h6 text-bold text-uppercase">granted!</div>
                <div class="text-caption text-capitalize;">${P.data.message}<div>
            `})}catch(T){T.response&&T.response.data&&(g(T.response.data),me.fire({icon:"error",html:`
                    <div class="text-h6 text-bold text-uppercase">Request Failed</div>
                    <div class="text-caption">Something went wrong.</div>
                `}))}finally{s.value=!1}},g=b=>{const N=Array.isArray(b)?b:b?.errors||[];Object.keys(d).forEach(T=>{d[T].type=null,d[T].messages=[]}),N.forEach(T=>{d[T.path]!==void 0&&(d[T.path].type=!0,d[T.path].messages.push(T.msg))})},m=B(null),x=B(null);let y=null;const w=async()=>{await Xn(),D(),k(),window.addEventListener("resize",k)},E=()=>{window.removeEventListener("resize",k),y?.off?.(),y=null},D=()=>{const b=x.value;b&&(y=new zk(b,{backgroundColor:"rgba(255,255,255,0)",penColor:"#000",maxWidth:4}))},k=()=>{const b=x.value,N=m.value;if(!b||!N)return;const T=Math.max(window.devicePixelRatio||1,1),{width:P,height:F}=N.getBoundingClientRect();b.width=Math.floor(P*T),b.height=Math.floor(F*T),b.style.width=`${P}px`,b.style.height=`${F}px`,b.getContext("2d").setTransform(T,0,0,T,0,0),y?.clear()},S=()=>{y?.clear()},_=(b,N="signature.png")=>{const T=b.split(","),P=T[0].match(/:(.*?);/)[1],F=atob(T[1]);let M=F.length;const L=new Uint8Array(M);for(;M--;)L[M]=F.charCodeAt(M);return new File([L],N,{type:P})};return(b,N)=>(H(),pe(Ke,{modelValue:i.value,"onUpdate:modelValue":N[3]||(N[3]=T=>i.value=T),"full-height":"",position:"right",persistent:"",square:"",class:"dialog",onBeforeShow:N[4]||(N[4]=()=>{c(),f()}),onShow:w,onHide:E},{default:R(()=>[C(_e,{class:"dialog-card column full-height"},{default:R(()=>[C(oe,{class:"q-pa-lg"},{default:R(()=>N[5]||(N[5]=[I("div",{class:"text-h6 text-uppercase"},"signature information",-1)])),_:1,__:[5]}),C(pt,{inset:""}),C(oe,{class:"col q-pa-lg scroll"},{default:R(()=>[I("div",$k,[I("div",Hk,[I("div",Gk,[u.value?(H(),se("div",jk,"current signature")):we("",!0),u.value?(H(),se("img",{key:1,src:u.value,width:"200"},null,8,Xk)):(H(),se("div",Yk,"no signature found"))])]),I("div",Kk,[I("div",{class:ne(["text-caption text-uppercase q-mb-xs",d.file.type?"text-negative":"text-grey"])},X(d.file.type?d.file.msg:"please sign here to continue"),3),I("div",{ref_key:"containerRef",ref:m,class:"signature-container"},[I("canvas",{ref_key:"canvasRef",ref:x,class:"signature-canvas"},null,512)],512)])])]),_:1}),C(ft,{class:"q-pa-lg bg"},{default:R(()=>[I("div",Jk,[ke(e).hasRole(["SuperAdmin","Admin","HR"])?(H(),pe(de,{key:0,unelevated:"",size:"md",color:"primary",class:"btn text-capitalize",label:"save",onClick:N[0]||(N[0]=()=>{v()})})):we("",!0),C(de,{unelevated:"",size:"md",color:"primary",class:"btn text-capitalize",label:"clear",onClick:N[1]||(N[1]=()=>{S()}),outline:""}),C(de,{unelevated:"",size:"md",color:"primary",class:"btn text-capitalize",label:"discard",onClick:N[2]||(N[2]=()=>{o("update:modelValue",null)}),outline:""})])]),_:1}),C(ht,{showing:s.value},{default:R(()=>[C(_e,{class:"no-shadow radius-md q-pa-md"},{default:R(()=>[C(oe,{class:"text-center"},{default:R(()=>[I("div",null,[C(an,{color:"dark"})]),N[6]||(N[6]=I("div",{class:"text-dark text-uppercase text-caption"},"we're working on it!",-1))]),_:1,__:[6]})]),_:1})]),_:1},8,["showing"])]),_:1})]),_:1},8,["modelValue"]))}},Zk=Kn(Qk,[["__scopeId","data-v-d34f23fc"]]),eT={class:"text-uppercase text-body1 text-bold"},tT={class:"row q-col-gutter-xs q-mb-sm"},nT={class:"col-2"},rT={class:"row q-col-gutter-xs q-mb-sm"},aT={class:"col-2"},oT={class:"col-2"},iT={class:"q-gutter-sm"},sT={class:"text-center"},uT={__name:"ShiftDialog",props:{modelValue:String,dialogName:String},emits:["update:modelValue"],setup(n,{emit:t}){const e=Jt(),r=nt(),a=n,o=t,i=Be({get:()=>a.modelValue===a.dialogName,set:P=>{P||o("update:modelValue",null)}}),s=B(!1),u=B([{id:"",shiftId:"",effectiveFrom:"",effectiveTo:"",notes:""}]),l=()=>({id:"",shiftId:"",effectiveFrom:"",effectiveTo:"",notes:""}),c=async P=>{s.value=!0;try{const F=await Re.get("/employee/schedule",{params:{id:P}});F.data.record.length?p(F.data.record):l()}catch(F){console.error("Error fetching all data:",F),me.fire({icon:"error",html:`
                <div class="text-h6 text-bold text-uppercase">Error</div>
                <div class="text-caption text-capitalize;">Unable to fetch records</div>
            `})}finally{s.value=!1}},p=(P=[])=>{u.value=P.map(F=>({id:F.id??"",shiftId:Number(F.shift_id)??"",effectiveFrom:F.effective_from??"",effectiveTo:F.effective_to??"",notes:F.notes??""}))},f=()=>{w(),c(r.data?.id)},d=jt({schedules:{shiftId:{type:[],msg:""},effectiveFrom:{type:[],msg:""},effectiveTo:{type:[],msg:""}}}),h=()=>{d.schedules.shiftId.type=u.value.map(()=>null),d.schedules.effectiveFrom.type=u.value.map(()=>null),d.schedules.effectiveTo.type=u.value.map(()=>null)},v=()=>{let P=!1;return d.schedules.shiftId={type:null,msg:""},d.schedules.effectiveFrom={type:null,msg:""},d.schedules.effectiveTo={type:null,msg:""},h(),u.value.forEach((F,M)=>{F.shiftId||(d.schedules.shiftId.type[M]=!0,d.schedules.shiftId.msg="required",P=!0),F.effectiveFrom?isNaN(new Date(F.effectiveFrom).getTime())&&(d.schedules.effectiveFrom.type[M]=!0,d.schedules.effectiveFrom.msg="invalid",P=!0):(d.schedules.effectiveFrom.type[M]=!0,d.schedules.effectiveFrom.msg="required",P=!0),F.effectiveTo&&isNaN(new Date(F.effectiveTo).getTime())&&(d.educations.effectiveTo.type[M]=!0,d.educations.effectiveTo.msg="invalid",P=!0)}),P&&me.fire({icon:"error",html:`
                <div class="text-h6 text-bold text-uppercase">Request Failed</div>
                <div class="text-caption">Something went wrong.</div>
            `}),!P},g=B([]),m=B([]),y=((P,F)=>(M,L)=>{if(M===""){L(()=>{F.value=P.value});return}L(()=>{const A=M.toLowerCase();F.value=P.value.filter($=>$.label.toLowerCase().includes(A))})})(g,m),w=async()=>{try{const{data:P}=await Re.get("/employee/option/shift");g.value=(P||[]).map(F=>({label:F.label??F.name??String(F.text??F.value??""),value:Number(F.value??F.id)})),m.value=[...g.value]}catch(P){console.error("Error fetching options:",P)}},E=()=>{u.value.push({id:"",shiftId:"",effectiveFrom:"",effectiveTo:"",notes:""})},D=P=>{u.value.splice(P,1)},k=async()=>{if(v()){s.value=!0;try{const P=await Re.post(`/employee/${r.data?.id}/schedule`,{schedules:u.value});o("update:modelValue",null),me.fire({icon:"success",html:`
                <div class="text-h6 text-bold text-uppercase">granted!</div>
                <div class="text-caption text-capitalize;">${P.data.message}<div>
            `})}catch(P){P.response&&P.response.data&&(S(P.response.data),me.fire({icon:"error",html:`
                    <div class="text-h6 text-bold text-uppercase">Request Failed</div>
                    <div class="text-caption">Something went wrong.</div>
                `}))}finally{s.value=!1}}},S=P=>{const F=Array.isArray(P)?P:P?.errors||[];Object.keys(d).forEach(M=>{d[M].type=null,d[M].messages=[]}),F.forEach(M=>{d[M.path]!==void 0&&(d[M.path].type=!0,d[M.path].messages.push(M.msg))})},_=B([]),b=B([]);function N(P){Xn(()=>{_.value[P]&&_.value[P].hide()})}function T(P){Xn(()=>{b.value[P]&&b.value[P].hide()})}return(P,F)=>(H(),pe(Ke,{modelValue:i.value,"onUpdate:modelValue":F[3]||(F[3]=M=>i.value=M),"full-height":"",position:"right",persistent:"",square:"",class:"dialog",onBeforeShow:F[4]||(F[4]=M=>f())},{default:R(()=>[C(_e,{class:"dialog-card column full-height"},{default:R(()=>[C(oe,{class:"q-pa-lg"},{default:R(()=>F[5]||(F[5]=[I("div",{class:"text-h6 text-uppercase"},"shift information",-1)])),_:1,__:[5]}),C(pt,{inset:""}),C(oe,{class:"col q-pa-lg scroll"},{default:R(()=>[(H(!0),se(Ve,null,We(u.value,(M,L)=>(H(),se("div",{key:L,class:"q-mb-md"},[I("div",null,[I("span",eT,"shift "+X(L+1),1),u.value.length>1&&ke(e).hasRole(["SuperAdmin","Admin","HR"])?(H(),pe(de,{key:0,round:"",icon:"bi-trash3",flat:"",unelevated:"",color:"grey",onClick:A=>D(L),size:"sm",class:"q-ml-sm"},null,8,["onClick"])):we("",!0)]),I("div",tT,[I("div",nT,[I("div",{class:ne(["text-caption text-uppercase q-mb-xs",d.schedules.shiftId.msg?"text-negative":"text-grey"])},X(d.schedules.shiftId.msg?d.schedules.shiftId.msg:"shift"),3),C(An,{outlined:"",modelValue:M.shiftId,"onUpdate:modelValue":A=>M.shiftId=A,label:"Choose Shift","emit-value":"","map-options":"","use-input":"","input-debounce":"300",options:m.value,onFilter:ke(y),error:d.schedules.shiftId.type[L],"hide-dropdown-icon":"","no-error-icon":!0,class:"text-capitalize"},{"no-option":R(()=>[C(lt,null,{default:R(()=>[C(ct,{class:"text-italic text-grey"},{default:R(()=>F[6]||(F[6]=[Ye(" No options ")])),_:1,__:[6]})]),_:1})]),option:R(A=>[C(lt,ga({ref_for:!0},A.itemProps),{default:R(()=>[C(ct,null,{default:R(()=>[C(Rn,null,{default:R(()=>[Ye(X(P.$CapitalizeWords(A.opt.label)),1)]),_:2},1024)]),_:2},1024)]),_:2},1040)]),_:2},1032,["modelValue","onUpdate:modelValue","options","onFilter","error"])])]),I("div",rT,[I("div",aT,[I("div",{class:ne(["text-caption text-uppercase q-mb-xs",d.schedules.effectiveFrom.msg?"text-negative":"text-grey"])},X(d.schedules.effectiveFrom.msg?d.schedules.effectiveFrom.msg:"start date (YYYY-MM-DD)"),3),C(le,{outlined:"",modelValue:M.effectiveFrom,"onUpdate:modelValue":A=>M.effectiveFrom=A,label:"Enter Date"},{default:R(()=>[C(Ft,{cover:"","transition-show":"scale","transition-hide":"scale",class:"no-shadow custom-border radius-sm",ref_for:!0,ref:A=>_.value[L]=A},{default:R(()=>[C(Mt,{modelValue:M.effectiveFrom,"onUpdate:modelValue":[A=>M.effectiveFrom=A,()=>N(L)],mask:"YYYY-MM-DD"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1536)]),_:2},1032,["modelValue","onUpdate:modelValue"])]),I("div",oT,[I("div",{class:ne(["text-caption text-uppercase q-mb-xs",d.schedules.effectiveTo.msg?"text-negative":"text-grey"])},X(d.schedules.effectiveTo.msg?d.schedules.effectiveTo.msg:"end date (YYYY-MM-DD)"),3),C(le,{outlined:"",modelValue:M.effectiveTo,"onUpdate:modelValue":A=>M.effectiveTo=A,label:"Enter Date"},{default:R(()=>[C(Ft,{cover:"","transition-show":"scale","transition-hide":"scale",class:"no-shadow custom-border radius-sm",ref_for:!0,ref:A=>b.value[L]=A},{default:R(()=>[C(Mt,{modelValue:M.effectiveTo,"onUpdate:modelValue":[A=>M.effectiveTo=A,()=>T(L)],mask:"YYYY-MM-DD"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1536)]),_:2},1032,["modelValue","onUpdate:modelValue"])])])]))),128))]),_:1}),C(ft,{class:"q-pa-lg bg"},{default:R(()=>[I("div",iT,[ke(e).hasRole(["SuperAdmin","Admin","HR"])?(H(),pe(de,{key:0,unelevated:"",size:"md",color:"primary",class:"btn text-capitalize",label:"save",onClick:F[0]||(F[0]=()=>{k()})})):we("",!0),ke(e).hasRole(["SuperAdmin","Admin","HR"])?(H(),pe(de,{key:1,unelevated:"",size:"md",color:"primary",class:"btn text-capitalize",label:"add",onClick:F[1]||(F[1]=()=>{E()}),outline:""})):we("",!0),C(de,{unelevated:"",size:"md",color:"primary",class:"btn text-capitalize",label:"discard",onClick:F[2]||(F[2]=()=>{o("update:modelValue",null)}),outline:""})])]),_:1}),C(ht,{showing:s.value},{default:R(()=>[I("div",sT,[C(Sn,{size:"md"}),F[7]||(F[7]=I("div",{class:"text-caption text-grey text-uppercase q-mt-xs"},"we're working on it!",-1))])]),_:1},8,["showing"])]),_:1})]),_:1},8,["modelValue"]))}},lT={class:"profile-component"},cT={class:"row q-col-gutter-md"},dT={class:"col-3"},pT={class:"cover-photo"},fT=["src"],hT=["src"],vT={class:"text-caption text-uppercase text-white"},mT={class:"text-h5 text-uppercase text-bold text-white"},gT={class:"text-body1 text-uppercase text-white"},yT={class:"text-caption text-uppercase text-white"},xT={class:"text-body1 text-bold text-white"},bT={class:"text-body1 text-bold text-white"},_T={class:"text-body1 text-capitalize text-bold text-white"},wT={class:"absolute-top-left q-ma-sm"},ET={class:"col-9"},ST={class:"card-grid"},CT={class:"text-body2 text-grey text-uppercase"},IT={id:"glass-overlay"},DT=25,kT={__name:"ProfileComponent",setup(n){const t=nt(),e=[{label:"profile",dialog:"ProfileDialog"},{label:"employment",dialog:"EmploymentDialog"},{label:"salary",dialog:"SalaryDialog"},{label:"service recrod",dialog:"ServiceDialog"},{label:"photo",dialog:"PhotoDialog"},{label:"signature",dialog:"SignatureDialog"},{label:"face recognition",dialog:"BiometricDialog"},{label:"account",dialog:"AccountDialog"},{label:"shift",dialog:"ShiftDialog"},{label:"dtr",dialog:"AttendanceDialog"},{label:"leaves",dialog:"LeaveDialog"},{label:"education",dialog:"EducationDialog"},{label:"trainings",dialog:"TrainingDialog"},{label:"experiences",dialog:"ExperienceDialog"},{label:"dependents",dialog:"DependentDialog"},{label:"documents",dialog:"DocumentDialog"}],r=p=>{if(!p)return"";const f=p.first_name||"",d=p.middle_name?p.middle_name.charAt(0).toUpperCase()+".":"",h=p.last_name||"",v=p.suffix?` ${p.suffix}`:"";return`${f} ${d} ${h}${v}`.trim()},a=B(null),o=p=>{a.value=p},i=B(!1),s=B([]),u=async()=>{i.value=!0;try{const p=await Re.get(`/employee/${t.data?.id}/information`);s.value=p.data.record}catch(p){console.error("Error fetching all data:",p),me.fire({icon:"error",html:`
                <div class="text-h6 text-bold text-uppercase">Error</div>
                <div class="text-caption text-capitalize;">Unable to fetch records</div>
            `})}finally{i.value=!1}};Ys(()=>{u()});const l=B("");Ys(()=>{const p=Math.floor(Math.random()*DT)+1;l.value=new URL(Object.assign({"../../assets/cover/1.jpg":Yv,"../../assets/cover/10.jpg":Xv,"../../assets/cover/11.jpg":jv,"../../assets/cover/12.jpg":Gv,"../../assets/cover/13.jpg":Hv,"../../assets/cover/14.jpg":$v,"../../assets/cover/15.jpg":zv,"../../assets/cover/16.jpg":qv,"../../assets/cover/17.jpg":Wv,"../../assets/cover/18.jpg":Uv,"../../assets/cover/19.jpg":Bv,"../../assets/cover/2.jpg":Lv,"../../assets/cover/20.jpg":Vv,"../../assets/cover/21.jpg":Fv,"../../assets/cover/22.jpg":Mv,"../../assets/cover/23.jpg":Ov,"../../assets/cover/24.jpg":Pv,"../../assets/cover/25.jpg":Av,"../../assets/cover/3.jpg":Rv,"../../assets/cover/4.jpg":Nv,"../../assets/cover/5.jpg":Tv,"../../assets/cover/6.jpg":kv,"../../assets/cover/7.jpg":Dv,"../../assets/cover/8.jpg":Iv,"../../assets/cover/9.jpg":Cv})[`../../assets/cover/${p}.jpg`],import.meta.url).href});const c=B(!0);return kd(()=>{setTimeout(()=>{c.value=!1},1e3)}),(p,f)=>(H(),se("div",lT,[I("div",cT,[I("div",dT,[C(_e,{key:"data-add",class:"card card-profile no-shadow radius-sm q-mb-sm q-pb-lg"},{default:R(()=>[I("div",pT,[I("img",{src:l.value,alt:"Cover"},null,8,fT)]),C(oe,{class:"text-center profile-section"},{default:R(()=>[I("img",{src:s.value?.photo,alt:"Profile",class:"profile-img"},null,8,hT)]),_:1}),C(oe,{class:"text-center q-pt-sm"},{default:R(()=>[I("div",vT,X(s.value?.employment?.employee_no),1),I("div",mT,X(r(s.value)),1),I("div",gT,X(s.value?.employment?.position?.name),1),I("div",yT,X(s.value?.employment?.employment_status),1)]),_:1}),C(oe,{class:"text-center"},{default:R(()=>[f[22]||(f[22]=I("div",{class:"text-caption text-uppercase text-white"},"email address",-1)),I("div",xT,X(s.value?.email),1)]),_:1,__:[22]}),C(oe,{class:"text-center"},{default:R(()=>[f[23]||(f[23]=I("div",{class:"text-caption text-uppercase text-white"},"contact number",-1)),I("div",bT,X(s.value?.contact_number),1)]),_:1,__:[23]}),C(oe,{class:"text-center"},{default:R(()=>[f[24]||(f[24]=I("div",{class:"text-caption text-uppercase text-white"},"adderss",-1)),I("div",_T,X(s.value?.address),1)]),_:1,__:[24]}),C(oe,{class:"text-center"},{default:R(()=>[C(de,{unelevated:"",size:"sm",label:"print employee data","text-color":"primary",color:"white"})]),_:1}),I("div",wT,[C(de,{round:"",size:"sm",icon:"bi-arrow-left","text-color":"primary",color:"white",onClick:f[0]||(f[0]=()=>{ke(t).component="EmployeeComponent"})})])]),_:1})]),I("div",ET,[I("div",ST,[(H(),se(Ve,null,We(e,(d,h)=>I("div",{key:`data-${d.id}`,class:"inner-card-anim-wrapper",style:dr({animationDelay:`${h*100}ms`})},[C(_e,{onClick:v=>o(d.dialog),class:"card card-menu card-hover-animate flex column justify-center items-center no-shadow cursor-pointer radius-sm"},{default:R(()=>[C(oe,{class:"text-center"},{default:R(()=>[I("div",CT,X(d.label),1)]),_:2},1024)]),_:2},1032,["onClick"])],4)),64))])])]),C(Lg,{modelValue:a.value,"onUpdate:modelValue":f[1]||(f[1]=d=>a.value=d),"dialog-name":"ProfileDialog",onSaved:u},null,8,["modelValue"]),C(Kg,{modelValue:a.value,"onUpdate:modelValue":f[2]||(f[2]=d=>a.value=d),"dialog-name":"EmploymentDialog",onSaved:u},null,8,["modelValue"]),C(cy,{modelValue:a.value,"onUpdate:modelValue":f[3]||(f[3]=d=>a.value=d),"dialog-name":"ServiceDialog"},null,8,["modelValue"]),C(LC,{modelValue:a.value,"onUpdate:modelValue":f[4]||(f[4]=d=>a.value=d),"dialog-name":"BiometricDialog"},null,8,["modelValue"]),C($C,{modelValue:a.value,"onUpdate:modelValue":f[5]||(f[5]=d=>a.value=d),"dialog-name":"PhotoDialog",onSaved:u},null,8,["modelValue"]),C(tI,{modelValue:a.value,"onUpdate:modelValue":f[6]||(f[6]=d=>a.value=d),"dialog-name":"EducationDialog"},null,8,["modelValue"]),C(pI,{modelValue:a.value,"onUpdate:modelValue":f[7]||(f[7]=d=>a.value=d),"dialog-name":"TrainingDialog"},null,8,["modelValue"]),C(wI,{modelValue:a.value,"onUpdate:modelValue":f[8]||(f[8]=d=>a.value=d),"dialog-name":"ExperienceDialog"},null,8,["modelValue"]),C(VI,{modelValue:a.value,"onUpdate:modelValue":f[9]||(f[9]=d=>a.value=d),"dialog-name":"DependentDialog"},null,8,["modelValue"]),C(QI,{modelValue:a.value,"onUpdate:modelValue":f[10]||(f[10]=d=>a.value=d),"dialog-name":"DocumentDialog"},null,8,["modelValue"]),C(nD,{modelValue:a.value,"onUpdate:modelValue":f[11]||(f[11]=d=>a.value=d),"dialog-name":"IdentificationDialog"},null,8,["modelValue"]),C(yD,{modelValue:a.value,"onUpdate:modelValue":f[12]||(f[12]=d=>a.value=d),"dialog-name":"AttendanceDialog"},null,8,["modelValue"]),C(jD,{modelValue:a.value,"onUpdate:modelValue":f[13]||(f[13]=d=>a.value=d),"dialog-name":"LeaveDialog"},null,8,["modelValue"]),C(KD,{modelValue:a.value,"onUpdate:modelValue":f[14]||(f[14]=d=>a.value=d),"dialog-name":"PerformanceDialog"},null,8,["modelValue"]),C(ZD,{modelValue:a.value,"onUpdate:modelValue":f[15]||(f[15]=d=>a.value=d),"dialog-name":"IncidentDialog"},null,8,["modelValue"]),C(nk,{modelValue:a.value,"onUpdate:modelValue":f[16]||(f[16]=d=>a.value=d),"dialog-name":"PayslipDialog"},null,8,["modelValue"]),C(ok,{modelValue:a.value,"onUpdate:modelValue":f[17]||(f[17]=d=>a.value=d),"dialog-name":"OvertimeDialog"},null,8,["modelValue"]),C(Rk,{modelValue:a.value,"onUpdate:modelValue":f[18]||(f[18]=d=>a.value=d),"dialog-name":"SalaryDialog"},null,8,["modelValue"]),C(Bk,{modelValue:a.value,"onUpdate:modelValue":f[19]||(f[19]=d=>a.value=d),"dialog-name":"AccountDialog"},null,8,["modelValue"]),C(Zk,{modelValue:a.value,"onUpdate:modelValue":f[20]||(f[20]=d=>a.value=d),"dialog-name":"SignatureDialog"},null,8,["modelValue"]),C(uT,{modelValue:a.value,"onUpdate:modelValue":f[21]||(f[21]=d=>a.value=d),"dialog-name":"ShiftDialog"},null,8,["modelValue"]),C(Su,{name:"glass-fade"},{default:R(()=>[Or(I("div",IT,[C(_e,{class:"no-shadow radius-md q-pa-md"},{default:R(()=>[C(oe,{class:"text-center"},{default:R(()=>[I("div",null,[C(an,{color:"dark"})]),f[25]||(f[25]=I("div",{class:"text-dark text-uppercase text-caption"},"we're working on it!",-1))]),_:1,__:[25]})]),_:1})],512),[[Td,c.value]])]),_:1})]))}},TT={__name:"EmployeePage",setup(n){const t=nt(),e={EmployeeComponent:gg,ProfileComponent:kT};return xv(()=>{t.component="EmployeeComponent"}),(r,a)=>(H(),se("div",null,[(H(),pe(bv(e[ke(t).component]),{key:ke(t).component}))]))}},GT=Kn(TT,[["__scopeId","data-v-06bf7d6d"]]);export{GT as default};
